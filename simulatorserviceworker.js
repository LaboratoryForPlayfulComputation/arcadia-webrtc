function initSimulatorServiceWorker(){var r="@relprefix@".replace("---","").replace(/^\//,""),n=-1===r.indexOf("/"),i="makecode-sim;"+r+";@pxtRelId@",t=["@simUrl@","/arcadia-webrtc/bluebird.min.js","/arcadia-webrtc/pxtsim.js","/arcadia-webrtc/sim.js"].map(function(e){return e.trim()}).filter(function(e){return!!e&&0!==e.indexOf("@")}),o=!(self.setSimulatorWorkerOptions=function(e){e&&Array.isArray(e.urls)&&t.push.apply(t,c(e.urls.map(function(e){return e.trim()}).filter(function(e){return!!e})))});function c(e){for(var n=[],t=0,r=e;t<r.length;t++){var i=r[t];-1===n.indexOf(i)&&n.push(i)}return n}self.addEventListener("install",function(e){if(n){o=!0;try{importScripts("@simworkerconfigUrl@")}catch(e){console.log("Failed to load target service worker config")}console.log("Installing service worker..."),e.waitUntil(caches.open(i).then(function(e){return console.log("Opened cache"),e.addAll(c(t))}).then(function(){return self.skipWaiting()}))}else console.log("Skipping service worker install for unnamed endpoint")}),self.addEventListener("activate",function(e){n?(console.log("Activating service worker..."),e.waitUntil(caches.keys().then(function(e){var n=e.filter(function(e){var n,t=3!==(n=e.split(";")).length?null:n[1];return null===t||t===r&&e!==i});return Promise.all(n.map(function(e){return caches.delete(e)}))}).then(function(){return o?(o=!1,(e=self).clients.claim().then(function(){return e.clients.matchAll()}).then(function(e){e.forEach(function(e){return e.postMessage({type:"serviceworker",state:"activated",ref:r})})})):Promise.resolve();var e}))):console.log("Skipping service worker activate for unnamed endpoint")}),self.addEventListener("fetch",function(n){n.respondWith(caches.match(n.request).then(function(e){return e||fetch(n.request)}))})}initSimulatorServiceWorker();