var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,a,s,c){return new(s||(s=Promise))(function(n,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function i(e){try{o(c.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,i)}o((c=c.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};pxt||(pxt={}),function(c){!function(e){var a={},s={},t=!1;function n(){return"undefined"!=typeof mscc&&!mscc.hasConsent()}e.addDefaultProperties=function(t){Object.keys(t).forEach(function(e){"string"==typeof t[e]?a[e]=t[e]:s[e]=t[e]})},e.enable=function(){if(c.aiTrackException&&c.aiTrackEvent&&!t){t=!0,c.debug("setting up app insights");var o=c.tickEvent;c.tickEvent=function(e,t,n){if(o&&o(e,t,n),n&&n.interactiveConsent&&"undefined"!=typeof mscc&&!mscc.hasConsent()&&mscc.setConsent(),t){var r=a||{},i=s||{};Object.keys(t).forEach(function(e){"string"==typeof t[e]?r[e]=t[e]:"number"==typeof t[e]?i[e]=t[e]:r[e]=JSON.stringify(t[e]||"")}),c.aiTrackEvent(e,r,i)}else c.aiTrackEvent(e)};var r=c.reportException;c.reportException=function(e,t){r&&r(e,t);var n={target:c.appTarget.id,version:c.appTarget.versions.target};t&&c.Util.jsonMergeFrom(n,t),c.aiTrackException(e,"exception",n)};var e=c.reportError;c.reportError=function(t,n,r){e&&e(t,n,r);try{throw n}catch(e){var i={target:c.appTarget.id,version:c.appTarget.versions.target,category:t,message:n};r&&c.Util.jsonMergeFrom(i,r),c.aiTrackException(e,"error",i)}}}},e.isCookieBannerVisible=n,e.enableCookies=function(){n()&&mscc.setConsent()}}(c.analytics||(c.analytics={}))}(pxt||(pxt={})),pxt||(pxt={}),function(e){!function(e){var n,r,i,o=0,a=!1;function s(){return n||(n=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}return}()),n}function t(){n&&(i.gain.setTargetAtTime(0,n.currentTime,.015),o=0)}e.mute=function(e){n&&(a=e,t(),e&&r&&(r.disconnect(),i.disconnect(),i=r=void 0))},e.stop=t,e.frequency=function(){return o},e.tone=function(e){if(!(a||e<=0)){o=e;var t=s();if(t)try{r||((r=t.createOscillator()).type="triangle",(i=t.createGain()).connect(t.destination),r.connect(i),r.start(0)),r.frequency.value=e,i.gain.setTargetAtTime(1,n.currentTime,.015)}catch(e){return void(r=void 0)}}}}(e.AudioContextManager||(e.AudioContextManager={}))}(pxt||(pxt={})),(pxt||(pxt={})).tickEvent=function(e){},function(e){(e.pxtc||(e.pxtc={})).__dummy=42}(ts||(ts={}));var pxtc=ts.pxtc;!function(e){var t;(function(f){function t(e){return e.replace(/[^\w .!?\-$]/g,function(e){var t=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-t.length)+t})}f.assert=function(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)},f.flatClone=function(t){if(null==t)return null;var n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n},f.clone=function(e){return null==e?null:JSON.parse(JSON.stringify(e))},f.htmlEscape=function(e){return e?e.replace(/([^\w .!?\-$])/g,function(e){return"&#"+e.charCodeAt(0)+";"}):e},f.htmlUnescape=function(e){return e?e.replace(/(&#\d+;)/g,function(e){return String.fromCharCode(Number(e.substr(2,e.length-3)))}):e},f.jsStringQuote=t,f.jsStringLiteral=function(e){return'"'+t(e)+'"'};var n="en",r={},e={};function i(){return n}function o(e){var t=/^(\w{2})-(\w{2}$)/i.exec(e);return t&&t[1]&&t[2]?[t[1].toLowerCase()+"-"+t[2].toUpperCase(),t[1].toLowerCase(),t[1].toLowerCase()+"-"+t[2].toLowerCase()]:[(e||"en").toLowerCase()]}function a(e,u){return 0==u.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){var r=u[parseInt(t)],i="",o=/^:f(\d*)\.(\d+)/.exec(n);if(o){var a=parseInt(o[2]),s=parseInt(o[1])||0,c=/^0/.test(o[1])?"0":" ",l=r.toFixed(a);if(0<s&&0<a&&(s+=a+1),0<s)for(;l.length<s;)l=c+l;i=l}else i=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(i.toLowerCase())?i="an "+i:/^\s*[bcdfgjklmnpqrstvwxz]/.test(i.toLowerCase())&&(i="a "+i):":s"==n?i=1==r?"":"s":":q"==n?i=f.htmlEscape(i):":jq"==n?i=f.jsStringQuote(i):":uri"==n?i=encodeURIComponent(i).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?i=encodeURI(i).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(i=(100*r).toFixed(1).toString()+"%"),i})}f.localizeLive=!1,f.localeInfo=function(){return(f.localizeLive?"live-":"")+i()},f.userLanguage=i,f.normalizeLanguageCode=o,f.setUserLanguage=function(e){n=o(e)[0]},f.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(n)},f.TRANSLATION_LOCALE="pxt",f.isTranslationMode=function(){return i()==f.TRANSLATION_LOCALE},f._localize=function(e){return r[e]||e},f.getLocalizedStrings=function(){return r},f.setLocalizedStrings=function(e){r=e},f.translationsCache=function(){return e},f.fmt_va=a,f.fmt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return a(e,t)};var s={};f.dumpLocStats=function(){var t={};Object.keys(s).sort(function(e,t){return s[t]-s[e]}).forEach(function(e){return t[e]=e}),console.log("prioritized list of strings:"),console.log(JSON.stringify(t,null,2))};var c=!0;function l(e,t){if(!e)return e;s[e]=(s[e]||0)+1;var n=f._localize(e);return!c&&n!=e&&/\d:s\}/.test(n)&&(n=n.replace(/\{\d+:s\}/g,"")),a(n=n.replace(/^\{(id|loc):[^\}]+\}/g,""),t)}f.lf_va=l,f.lf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return l(e,t)},f.rlf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return l(e,t)},f.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},f.isoTime=function(e){var t=new Date(1e3*e);return f.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},f.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t},f.isPyLangPref=function(){return"py"==localStorage.getItem("editorlangpref")},f.getEditorLanguagePref=function(){return localStorage.getItem("editorlangpref")},f.setEditorLanguagePref=function(e){e.match(/prj$/)&&(e=e.replace(/prj$/,"")),localStorage.setItem("editorlangpref",e)},f.getToolboxAnimation=function(){return localStorage.getItem("toolboxanimation")},f.setToolboxAnimation=function(){localStorage.setItem("toolboxanimation","1")},f.deq=function e(t,n){if(t===n)return null;if(!t||!n)return"Null value";if("object"==typeof t&&"object"==typeof n){if(Array.isArray(t)){if(!Array.isArray(n))return"Expected array";if(t.length!=n.length)return"Expected array of length "+t.length+", got "+n.length;for(var r=0;r<t.length;r++)if(null!=e(t[r],n[r]))return"Expected array value "+t[r]+" got "+n[r];return null}var i=Object.keys(t),o=Object.keys(t);if(i.length!=o.length)return"Expected "+i.length+" keys, got "+o.length;for(r=0;r<i.length;r++){if(!Object.prototype.hasOwnProperty.call(n,i[r]))return"Missing key "+i[r];if(null!=e(t[i[r]],n[i[r]]))return"Expected value of "+i[r]+" to be "+t[i[r]]+", got "+n[i[r]]}return null}return"Unable to compare "+t+", "+n}})((t=e.pxtc||(e.pxtc={})).Util||(t.Util={}))}(ts||(ts={}));var pxt,ts,pxtmelody,lf=ts.pxtc.Util.lf;!function(e){var t;(t=e.pxtc||(e.pxtc={})).decodeBase64=function(e){return atob(e)},t.encodeBase64=function(e){return btoa(e)}}(ts||(ts={})),function(k){var x;(function(v){var e=function(){function e(){this.pending=!1,this.cancelled=!1}return e.prototype.startOperation=function(){this.pending=!0},e.prototype.isRunning=function(){return this.pending},e.prototype.onProgress=function(e){this.progressHandler=e},e.prototype.reportProgress=function(e,t){this.progressHandler&&this.progressHandler(e,t)},e.prototype.cancel=function(){this.cancelled=!0,this.pending=!1},e.prototype.cancelAsync=function(){var t=this;return this.cancelled||!this.pending?(this.cancelled=!0,this.pending=!1,Promise.resolve()):(this.cancelled=!0,this.deferred=new Promise(function(e){t.resolve=e}),this.deferred)},e.prototype.isCancelled=function(){return this.cancelled},e.prototype.throwIfCancelled=function(){if(this.isCancelled())throw new Error},e.prototype.resolveCancel=function(){this.pending=!1,this.deferred&&(this.resolve(),this.deferred=void 0,this.resolve=void 0)},e}();function r(e,t){for(var n=0;n<t.length;++n)e.push(t[n])}function t(e){for(var t=[],n=0;n<e.length;++n)r(t,e[n]);return t}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function l(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=n.length-r);for(var o=0;o<i;++o)e[t+o]=n[r+o]}function o(e,t){return e==t?0:e<t?-1:1}function n(n,r){var i={};return function(e){var t=n(e);return i.hasOwnProperty(t)?i[t]:i[t]=r(e)}}v.CancellationToken=e,v.codalHash16=function(e){var i=[251,175,119,215,81,14,79,191,103,49,181,143,186,157,0,232,31,32,55,60,152,58,17,237,174,70,160,144,220,90,57,223,59,3,18,140,111,166,203,196,134,243,124,95,222,179,197,65,180,48,36,15,107,46,233,130,165,30,123,161,209,23,97,16,40,91,219,61,100,10,210,109,250,127,22,138,29,108,244,67,207,9,178,204,74,98,126,249,167,116,34,77,193,200,121,5,20,113,71,35,128,13,182,94,25,226,227,199,75,27,41,245,230,224,43,225,177,26,155,150,212,142,218,115,241,73,88,105,39,114,62,255,192,201,145,214,168,158,221,148,154,122,12,84,82,163,44,139,228,236,205,242,217,11,187,146,159,64,86,239,195,42,106,198,118,112,184,172,87,2,173,117,176,229,247,253,137,185,99,164,102,147,45,66,231,52,141,211,194,206,246,238,56,110,78,248,63,240,189,93,92,51,53,183,19,171,72,50,33,104,101,69,8,252,83,120,76,135,85,54,202,125,188,213,96,235,136,208,162,129,190,132,156,38,47,1,7,254,24,4,216,131,89,21,28,133,37,153,149,80,170,68,6,169,234,151];function a(e){for(var t=0,n=0;n<e.length;n++){var r=e[n];t=i[t^r]}return t}return e?function(e,t){for(var n=new Uint8Array(e.length),r=0;r<e.length;++r){var i=e.charCodeAt(r);n[r]=255&i}var o=0;for(r=0;r<t;++r)o|=a(n)<<8*r,n[0]=(n[0]+1)%255;return o}(e,2):0},v.bufferSerial=function(e,t,n,r){void 0===t&&(t=""),void 0===n&&(n="?"),void 0===r&&(r=255);for(var i=0;i<t.length;++i){var o=t[i];if(e[n]=(e[n]||"")+o,"\n"===o||e[n].length>r){var a=e[n];e[n]="",window.postMessage({type:"serial",id:n,data:a},"*")}}},v.blobReadAsDataURL=function(r){return r?new Promise(function(e,t){var n=new FileReader;n.onload=function(){return e(n.result)},n.onerror=function(e){return t(e)},n.readAsDataURL(r)}):Promise.resolve(void 0)},v.fileReadAsBufferAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(new Uint8Array(n.result))},n.readAsArrayBuffer(r)}):Promise.resolve(null)},v.fileReadAsTextAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(n.result)},n.readAsText(r)}):Promise.resolve(null)},v.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},v.listsEqual=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},v.oops=function(e){throw void 0===e&&(e="OOPS"),new Error(e)},v.reversed=function(e){return(e=e.slice(0)).reverse(),e},v.iterMap=function(t,n){Object.keys(t).forEach(function(e){return n(e,t[e])})},v.mapMap=function(t,n){var r={};return Object.keys(t).forEach(function(e){return r[e]=n(e,t[e])}),r},v.values=function(t){return Object.keys(t||{}).map(function(e){return t[e]})},v.pushRange=r,v.concatArrayLike=function(e){return t(e)},v.concat=t,v.memcpy=l,v.uint8ArrayConcat=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=(c=r[n]).length;for(var i=new Uint8Array(t),o=0,a=0,s=e;a<s.length;a++){var c;l(i,o,c=s[a]),o+=c.length}return i},v.jsonTryParse=function(e){try{return JSON.parse(e)}catch(e){return}},v.jsonMergeFrom=function t(n,r){r&&Object.keys(r).forEach(function(e){i(n[e])&&i(r[e])?t(n[e],r[e]):n[e]=v.clone(r[e])})},v.jsonCopyFrom=function(e,t){for(var n=v.clone(t),r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];e[o]=n[o]}},v.jsonFlatten=function(e){var o={},a=function(e,t){if(null!==t&&"object"==typeof t){v.assert(!Array.isArray(t)),e&&(e+=".");for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];a(e+i,t[i])}}else o[e]=t};return a("",e),o},v.jsonUnFlatten=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++)for(var i=r[n],o=t,a=i.split("."),s=0;s<a.length;++s){var c=a[s];s==a.length-1?o[c]=e[i]:("object"!=typeof o[c]&&(o[c]={}),o=o[c])}return t},v.strcmp=o,v.stringMapEq=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!t.hasOwnProperty(a))return!1;if(e[a]!==t[a])return!1}return!0},v.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},v.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},v.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||-1<e.indexOf(t))},v.replaceAll=function(e,t,n){return t?e.split(t).join(n):e},v.sortObjectFields=function(t){var e=Object.keys(t);e.sort(o);var n={};return e.forEach(function(e){return n[e]=t[e]}),n},v.chopArray=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},v.unique=function(e,n){var r=[],i={};return e.forEach(function(e){var t=n(e);i.hasOwnProperty(t)||(i[t]=null,r.push(e))}),r},v.groupBy=function(e,n){var r={};return e.forEach(function(e){var t=n(e);r.hasOwnProperty(t)||(r[t]=[]),r[t].push(e)}),r},v.toDictionary=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=e}),n},v.toSet=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=!0}),n},v.toArray=function(e){if(Array.isArray(e))return e;var t=[];if(!e)return t;for(var n=0;n<e.length;++n)t.push(e[n]);return t},v.indexOfMatching=function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},v.nextTick=function(e){Promise._async._schedule(e)},v.memoizeString=function(e){return n(function(e){return e},e)},v.memoize=n,v.debounce=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;return clearTimeout(a),a=setTimeout(function(){a=null,o||r.apply(e,t)},i),n&&r.apply(e,t),a}};var a=function(){function e(e,t,n,r){var i=this;void 0===t&&(t=300),void 0===n&&(n=2e3),void 0===r&&(r=2),this.func=e,this.minDelay=t,this.maxDelay=n,this.slowdownFactor=r,this.lastPoke=0,this.recentGaps=[],this.wrapped=function(){i.timeout=null,i.func()}}return e.prototype.poke=function(){var e=Date.now();if(this.lastPoke){var t=e-this.lastPoke;if(t<10)return;for(t<4e3&&this.recentGaps.push(t);10<this.recentGaps.length;)this.recentGaps.shift()}this.lastPoke=e},e.prototype.trigger=function(){var e=this.maxDelay;if(this.lastPoke){var t=this.recentGaps.slice();t.sort();var n=t[t.length>>1]||1;e=Math.min(Math.max(n*this.slowdownFactor|0,this.minDelay),this.maxDelay),(e-=Date.now()-this.lastPoke)<0&&(e=0),this.lastPoke=null}clearTimeout(this.timeout),this.timeout=setTimeout(this.wrapped,e)},e}();function s(e){return e&&(e=e.replace(/\\/g,"/")),e}function c(i){return v.httpRequestCoreAsync(i).then(function(e){var t=e.statusCode;if((i.successCodes||[304,200,201,202]).indexOf(t)<0&&!i.allowHttpErrors){var n=v.lf("Bad HTTP status code: {0} at {1}; message: {2}",e.statusCode,i.url,(e.text||"").slice(0,500)),r=new Error(n);return r.statusCode=e.statusCode,Promise.reject(r)}return e.text&&/application\/json/.test(e.headers["content-type"])&&(e.json=x.U.jsonTryParse(e.text)),e})}function u(e,t){var n="";if(!e)return n;for(var r=0;r<e.length;++r){var i=e.charCodeAt(r);if(i<=127)n+=e.charAt(r);else if(i<=2047)n+=String.fromCharCode(192|i>>6,128|63&i);else{if(!t&&55296<=i&&i<=56319){var o=e.charCodeAt(++r);isNaN(o)||(i=65536+(i-55296<<10)+(o-56320))}n+=i<=65535?String.fromCharCode(224|i>>12,128|i>>6&63,128|63&i):String.fromCharCode(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}}return n}v.AdaptiveDebouncer=a,v.throttle=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;a||(a=setTimeout(function(){a=null,o||r.apply(e,t)},i)),n&&r.apply(e,t)}},v.randomPermute=function(e){for(var t=0;t<e.length;++t){var n=m()%e.length,r=e[t];e[t]=e[n],e[n]=r}},v.randomPick=function(e){return 0==e.length?null:e[m()%e.length]},v.timeSince=function(e){var t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?v.lf("in a few seconds"):t<120?v.lf("in a minute"):t<3600?v.lf("in {0} minute{0:s}",Math.floor(t/60)):t<7200?v.lf("in an hour"):t<86400?v.lf("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?v.lf("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?v.lf("in {0} month{0:s}",Math.floor(t/60/60/24/30)):v.lf("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?v.lf("now"):t<10?v.lf("a few seconds ago"):t<60?v.lf("{0} second{0:s} ago",Math.floor(t)):t<120?v.lf("a minute ago"):t<3600?v.lf("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?v.lf("an hour ago"):t<86400?v.lf("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?v.lf("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?v.lf("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):v.lf("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},v.unicodeToChar=function(e){return e.replace(/\\u([\d\w]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})},v.escapeForRegex=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},v.stripUrlProtocol=function(e){return e.replace(/.*?:\/\//g,"")},v.normalizePath=s,v.pathJoin=function(e,t){if(s(e),s(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),"/"==t.charAt(0)&&(t=t.substring(1)),e+t):e:t},v.isNodeJS="undefined"==typeof window,v.requestAsync=c,v.httpGetTextAsync=function(e){return c({url:e}).then(function(e){return e.text})},v.httpGetJsonAsync=function(e){return c({url:e}).then(function(e){return e.json})},v.httpPostJsonAsync=function(e,t){return c({url:e,data:t||{}}).then(function(e){return e.json})},v.stringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n},v.uint8ArrayToString=function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n},v.fromUTF8=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e.charCodeAt(n);t+=37==r||127<r?"%"+r.toString(16):e.charAt(n)}return decodeURIComponent(t)},v.toUTF8=u,v.toHex=function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t},v.fromHex=function(e){for(var t=new Uint8Array(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t};var f=function(){function e(){this.promises={}}return e.prototype.enqueue=function(r,i){var o=this;return new Promise(function(e,t){var n=o.promises[r];n||(n=o.promises[r]=[]),n.push(function(){return i().finally(function(){n.shift(),0==n.length?delete o.promises[r]:n[0]()}).then(e,t)}),1==n.length&&n[0]()})},e}();v.PromiseQueue=f;var p,d,h=function(){function e(){this.waiting=[],this.available=[]}return e.prototype.drain=function(){for(var e=0,t=this.waiting;e<t.length;e++)(0,t[e])(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]},e.prototype.pushError=function(e){this.push(e)},e.prototype.push=function(e){var t=this.waiting.shift();t?t(e):this.available.push(e)},e.prototype.shiftAsync=function(e){var i=this;if(void 0===e&&(e=0),0<this.available.length){var t=this.available.shift();return t instanceof Error?Promise.reject(t):Promise.resolve(t)}return new Promise(function(t,n){var r=function(e){e instanceof Error?n(e):t(e)};i.waiting.push(r),0<e&&Promise.delay(e).then(function(){var e=i.waiting.indexOf(r);0<=e&&(i.waiting.splice(e,1),n(new Error("Timeout")))})})},e}();function g(){return Date.now()}function m(){var e=new Uint8Array(4);return v.getRandomBuf(e),new Uint32Array(e.buffer)[0]}function y(i,o,a,s){function t(n){pxt.debug("downloading translations for "+i+" "+o+" "+(a||""));var e=pxt.BrowserUtils.isLocalHost()||pxt.webConfig.isStatic?"https://makecode.com/api/":"",t=e+"translations?lang="+encodeURIComponent(i)+"&filename="+encodeURIComponent(o)+"&approved=true";a&&(t+="&branch="+encodeURIComponent(a));var r={};return s&&!pxt.Cloud.useCdnApi()&&(r["If-None-Match"]=s),(e?c:pxt.Cloud.apiRequestWithCdnAsync)({url:t,headers:r}).then(function(t){return 304==t.statusCode||200==t.statusCode?(s=t.headers.etag||"",pxt.BrowserUtils.translationDbAsync().then(function(e){return e.setAsync(i,o,a,s,t.json||n)}).then(function(){return t.json||n})):t.json},function(e){console.log("failed to load translations from "+t)})}return pxt.BrowserUtils.translationDbAsync().then(function(e){return e.getAsync(i,o,a)}).then(function(e){return e?(s=e.etag,300<(Date.now()-e.time)/1e3&&t(e.strings).done(),e.strings):t()})}function b(e){var t=v.normalizeLanguageCode(e),n=t[0],r=t[1],i=pxt.appTarget.appTheme;if(i&&i.availableLocales){if(-1<i.availableLocales.indexOf(n))return!0;if(r&&-1<i.availableLocales.indexOf(r))return!0}return!1}function w(e,t,n,r,i,o,a){if(a=a||p.Editor,"en-US"===(n=v.normalizeLanguageCode(n)[0])||"en"===n)return Promise.resolve(void 0);var s,c,l=n+"/"+o+"/"+a;if(v.translationsCache()[l])return Promise.resolve(v.translationsCache()[l]);switch(a){case p.Editor:s=[{branch:r,staticName:"strings.json",path:"strings.json"},{branch:i,staticName:"target-strings.json",path:e+"/target-strings.json"}];break;case p.Sim:s=[{branch:i,staticName:"sim-strings.json",path:e+"/sim-strings.json"}];break;case p.Apis:s=[{branch:i,staticName:"bundled-strings.json",path:e+"/bundled-strings.json"}]}function u(t){t&&(c||(c={}),Object.keys(t).filter(function(e){return!!t[e]}).forEach(function(e){return c[e]=t[e]}))}if(o){var f=0;return Promise.mapSeries(s,function(e){return y(n,e.path,e.branch).then(u,function(e){console.log(e.message),++f})}).then(function(){return f&&(v.translationsCache()[l]=c),f!==s.length&&c?Promise.resolve(c):(pxt.tickEvent("translations.livetranslationsfailed"),w(e,t,n,r,i,!1,a))})}return Promise.all(s.map(function(e){return v.httpGetJsonAsync(t+"locales/"+n+"/"+e.staticName).catch(function(e){})})).then(function(e){var t={};e.forEach(function(e){return pxt.Util.jsonMergeFrom(t,e)}),Object.keys(t).length&&(c=t,v.translationsCache()[l]=c)},function(e){console.error("failed to load localizations")}).then(function(){return c})}v.PromiseBuffer=h,v.now=g,v.nowSeconds=function(){return Math.round(g()/1e3)},v.cpuUs=function(){var e="undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now;return v.cpuUs=function(){return 1e3*e()},v.cpuUs()},v.getMime=function(e){var t=/\.([a-zA-Z0-9]+)$/.exec(e);if(!t)return"application/octet-stream";switch(t[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";default:return"application/octet-stream"}},v.randomUint32=m,v.guidGen=function(){function e(){return(65536|m()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()},v.downloadLiveTranslationsAsync=y,v.pxtLangCookieId="PXT_LANG",v.langCookieExpirationDays=30,v.allLanguages={af:{englishName:"Afrikaans",localizedName:"Afrikaans"},ar:{englishName:"Arabic",localizedName:"العربية"},az:{englishName:"Azerbaijani",localizedName:"آذربایجان دیلی"},bg:{englishName:"Bulgarian",localizedName:"български"},bn:{englishName:"Bengali",localizedName:"বাংলা"},ca:{englishName:"Catalan",localizedName:"Català"},cs:{englishName:"Czech",localizedName:"Čeština"},da:{englishName:"Danish",localizedName:"Dansk"},de:{englishName:"German",localizedName:"Deutsch"},el:{englishName:"Greek",localizedName:"Ελληνικά"},en:{englishName:"English",localizedName:"English"},"es-ES":{englishName:"Spanish (Spain)",localizedName:"Español (España)"},"es-MX":{englishName:"Spanish (Mexico)",localizedName:"Español (México)"},et:{englishName:"Estonian",localizedName:"Eesti"},eu:{englishName:"Basque",localizedName:"Euskara"},fa:{englishName:"Persian",localizedName:"فارسی"},fi:{englishName:"Finnish",localizedName:"Suomi"},fr:{englishName:"French",localizedName:"Français"},"fr-CA":{englishName:"French (Canada)",localizedName:"Français (Canada)"},"gu-IN":{englishName:"Gujarati",localizedName:"ગુજરાતી"},he:{englishName:"Hebrew",localizedName:"עברית"},hr:{englishName:"Croatian",localizedName:"Hrvatski"},hu:{englishName:"Hungarian",localizedName:"Magyar"},"hy-AM":{englishName:"Armenian (Armenia)",localizedName:"Հայերէն (Հայաստան)"},id:{englishName:"Indonesian",localizedName:"Bahasa Indonesia"},is:{englishName:"Icelandic",localizedName:"Íslenska"},it:{englishName:"Italian",localizedName:"Italiano"},ja:{englishName:"Japanese",localizedName:"日本語"},kab:{englishName:"Kabyle",localizedName:"شئعم"},ko:{englishName:"Korean",localizedName:"한국어"},kmr:{englishName:"Kurmanji (Kurdish)",localizedName:"کورمانجی‎"},kn:{englishName:"Kannada",localizedName:"ಕನ್ನಡ"},lt:{englishName:"Lithuanian",localizedName:"Lietuvių"},lv:{englishName:"Latvian",localizedName:"Latviešu"},"ml-IN":{englishName:"Malayalam",localizedName:"മലയാളം"},mr:{englishName:"Marathi",localizedName:"मराठी"},nl:{englishName:"Dutch",localizedName:"Nederlands"},no:{englishName:"Norwegian",localizedName:"Norsk"},nb:{englishName:"Norwegian Bokmal",localizedName:"Norsk bokmål"},"nn-NO":{englishName:"Norwegian Nynorsk",localizedName:"Norsk nynorsk"},"pa-IN":{englishName:"Punjabi",localizedName:"ਪੰਜਾਬੀ"},pl:{englishName:"Polish",localizedName:"Polski"},"pt-BR":{englishName:"Portuguese (Brazil)",localizedName:"Português (Brasil)"},"pt-PT":{englishName:"Portuguese (Portugal)",localizedName:"Português (Portugal)"},ro:{englishName:"Romanian",localizedName:"Română"},ru:{englishName:"Russian",localizedName:"Русский"},"si-LK":{englishName:"Sinhala (Sri Lanka)",localizedName:"සිංහල (ශ්රී ලංකා)"},sk:{englishName:"Slovak",localizedName:"Slovenčina"},sl:{englishName:"Slovenian",localizedName:"Slovenski"},sr:{englishName:"Serbian",localizedName:"Srpski"},su:{englishName:"Sundanese",localizedName:"ᮘᮞ ᮞᮥᮔ᮪ᮓ"},"sv-SE":{englishName:"Swedish (Sweden)",localizedName:"Svenska (Sverige)"},ta:{englishName:"Tamil",localizedName:"தமிழ்"},te:{englishName:"Telugu",localizedName:"తెలుగు"},th:{englishName:"Thai",localizedName:"ภาษาไทย"},tl:{englishName:"Tagalog",localizedName:"ᜏᜒᜃᜅ᜔ ᜆᜄᜎᜓᜄ᜔"},tr:{englishName:"Turkish",localizedName:"Türkçe"},uk:{englishName:"Ukrainian",localizedName:"Українська"},"ur-IN":{englishName:"Urdu (India)",localizedName:"اردو (ہندوستان)"},"ur-PK":{englishName:"Urdu (Pakistan)",localizedName:"اردو (پاکستان)"},vi:{englishName:"Vietnamese",localizedName:"Tiếng việt"},"zh-CN":{englishName:"Chinese (Simplified)",localizedName:"简体中文"},"zh-TW":{englishName:"Chinese (Traditional)",localizedName:"繁体中文"}},v.isLocaleEnabled=b,v.updateLocalizationAsync=function(t,n,r,i,o,a,e){return"en-US"===(r=v.normalizeLanguageCode(r)[0])&&(r="en"),r===v.userLanguage()||!b(r)&&!e?(pxt.debug("loc: "+r+" (using built-in)"),Promise.resolve()):(pxt.debug("loc: "+r),w(t,n,r,i,o,a,k.pxtc.Util.TranslationsKind.Editor).then(function(e){return e&&(v.setUserLanguage(r),v.setLocalizedStrings(e),a&&(v.localizeLive=!0)),a?Promise.resolve():k.pxtc.Util.downloadTranslationsAsync(t,n,r,i,o,a,k.pxtc.Util.TranslationsKind.Apis).then(function(e){e&&(k.pxtc.apiLocalizationStrings=e)})}))},(d=p=v.TranslationsKind||(v.TranslationsKind={}))[d.Editor=0]="Editor",d[d.Sim=1]="Sim",d[d.Apis=2]="Apis",v.downloadTranslationsAsync=w,v.capitalize=function(e){return e?e[0].toLocaleUpperCase()+e.slice(1):e},v.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},v.range=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},v.multipartPostAsync=function(e,r,t,n){void 0===r&&(r={}),void 0===t&&(t=null),void 0===n&&(n=null);var i,o,a,s="--------------------------0461489f461126c5",c="";Object.keys(r).forEach(function(e){return n=r[t=e],c+=s+"\r\n",c+='Content-Disposition: form-data; name="'+t+'"\r\n\r\n',void(c+=n+"\r\n");var t,n}),t&&(o=n,a=(i=t).split("/").reverse()[0],c+=s+"\r\n",c+='Content-Disposition: form-data; name="files['+i+']"; filename="'+a+'"\r\n',c+="\r\n",c+=o+"\r\n"),c+=s+"--\r\n";var l={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+s.slice(2)},data:c};return v.httpRequestCoreAsync(l)},v.toDataUri=function(e,t){return/^https?:/i.test(e)?e:/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?"data:"+t+","+encodeURIComponent(e):"data:"+(t||"image/png")+";base64,"+x.encodeBase64(u(e)))},v.imageMagic=1496611453,v.imageHeaderSize=36,v.encodeBlobAsync=function(e,t){for(var n=v.imageHeaderSize+t.length,r=3*(e.width*e.height-1),i=1;i<4&&!(8*n<=r*i);)i++;var o=r*i>>3,a=n-o,s=0,c=e.width*e.height*4;if(0<a){var l=3*e.width;s=Math.ceil(a/l);var u=document.createElement("canvas");u.width=e.width,u.height=e.height+s,u.getContext("2d").drawImage(e,0,0),e=u}var f=pxt.HF2.encodeU32LE([v.imageMagic,t.length,s,0,0,0,0,0,0]);function p(e,t,n,r){for(var i=0,o=0,a=r[o++],s=(1<<n)-1,c=!0;c;){var l=a>>i&s,u=8-i;if(u<=n){if(o>=r.length){if(0==u)break;c=!1}l|=(a=r[o++])<<u&s,i=n-u}else i+=n;e[t]=255&(e[t]&~s|l),3==(3&++t)&&(e[t++]=255)}return t}pxt.Util.assert(f.length==v.imageHeaderSize);var d=e.getContext("2d"),h=d.getImageData(0,0,e.width,e.height);p(h.data,0,1,[i]);var g=4;if(g=p(h.data,g,i,f),pxt.Util.assert(0==(3&g)),0==s)g=p(h.data,g,i,t);else{var m=o-f.length;g=p(h.data,g,i,t.slice(0,m)),g=p(h.data,c,8,t.slice(m))}for(g|=3;g<h.data.length;)h.data[g]=255,g+=4;return d.putImageData(h,0,0),e},v.decodeBlobAsync=function(e){return pxt.BrowserUtils.loadCanvasAsync(e).then(function(e){var s=e.getContext("2d").getImageData(0,0,e.width,e.height).data,t=1&s[0]|(1&s[1])<<1|(1&s[2])<<2;if(5<t)return Promise.reject(new Error(v.lf("Invalid encoded PNG format")));function n(e,t,n){for(var r=0,i=0,o=0,a=(1<<t)-1;i<n.length;)o|=(s[e++]&a)<<r,3==(3&e)&&e++,8<=(r+=t)&&(n[i++]=255&o,o>>=8,r-=8);return e}var r=new Uint8Array(pxt.Util.imageHeaderSize),i=n(4,t,r),o=pxt.HF2.decodeU32LE(r);if(o[0]!=pxt.Util.imageMagic)return Promise.reject(new Error(v.lf("Invalid magic in encoded PNG")));var a=new Uint8Array(o[1]),c=o[2];if(0<c){var l=(e.height-c)*e.width,u=new Uint8Array((3*(l-1)*t>>3)-pxt.Util.imageHeaderSize);n(i,t,u),a.set(u);var f=new Uint8Array(a.length-u.length);n(4*l,8,f),a.set(f,u.length)}else n(i,t,a);return a})}})((x=k.pxtc||(k.pxtc={})).Util||(x.Util={}))}(ts||(ts={})),function(e){var v;(function(e){v.Util.httpRequestCoreAsync=function(c){return new Promise(function(t,e){var r,i=!1,n=v.Util.clone(c.headers)||{};r=new XMLHttpRequest,c.responseArrayBuffer&&(r.responseType="arraybuffer"),r.onreadystatechange=function(){if(!i&&4==r.readyState){i=!0;var n={statusCode:r.status,headers:{},buffer:r.responseBody||r.response,text:c.responseArrayBuffer?void 0:r.responseText},e=r.getAllResponseHeaders();e.split(/\r?\n/).forEach(function(e){var t=/^\s*([^:]+): (.*)/.exec(e);t&&(n.headers[t[1].toLowerCase()]=t[2])}),t(n)}};var o,a=c.data,s=c.method||(null==a?"GET":"POST");null==a?o=null:a instanceof Uint8Array?o=a:"object"==typeof a?(o=JSON.stringify(a),n["content-type"]="application/json; charset=utf8"):"string"==typeof a?o=a:v.Util.oops("bad data"),r.open(s,c.url),Object.keys(n).forEach(function(e){r.setRequestHeader(e,n[e])}),null==o?r.send():r.send(o)})},v.Util.sha256=n,v.Util.getRandomBuf=function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())};var g=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function m(e,t){return e>>>t|e<<32-t}function p(e,t){v.Util.assert(8==e.length),v.Util.assert(64==t.length);for(var n=16;n<64;++n){var r=m(t[n-15],7)^m(t[n-15],18)^t[n-15]>>>3,i=m(t[n-2],17)^m(t[n-2],19)^t[n-2]>>>10;t[n]=t[n-16]+r+t[n-7]+i|0}var o=e[0],a=e[1],s=e[2],c=e[3],l=e[4],u=e[5],f=e[6],p=e[7];for(n=0;n<64;++n){var d=p+(i=m(l,6)^m(l,11)^m(l,25))+(l&u^~l&f)+g[n]+t[n]|0,h=o&a^o&s^a&s;p=f,f=u,u=l,l=c+d|0,c=s,s=a,o=d+((r=m(a=o,2)^m(o,13)^m(o,22))+h|0)|0}e[0]+=o,e[1]+=a,e[2]+=s,e[3]+=c,e[4]+=l,e[5]+=u,e[6]+=f,e[7]+=p}function t(e){var o=new Uint32Array(8);o[0]=1779033703,o[1]=3144134277,o[2]=1013904242,o[3]=2773480762,o[4]=1359893119,o[5]=2600822924,o[6]=528734635,o[7]=1541459225;var a=new Uint32Array(64),s=64;function t(e){for(var t=e.length-(s-1),n=0;n<t;n+=s){for(var r=0;r<16;r++){var i=(r<<2)+n;a[r]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]}p(o,a)}}t(e);var n=64-(e.length+9)%64;64==n&&(n=0);for(var r=e.length-e.length%s,i=new Uint8Array(e.length-r+1+n+8),c=0;r<e.length;)i[c++]=e[r++];for(i[c++]=128;0<n--;)i[c++]=0;var l=8*e.length;for(c=i.length;0<l;)i[--c]=255&l,l>>=8;t(i);for(var u="",f=0;f<o.length;++f)u+=("000000000"+o[f].toString(16)).slice(-8);return u.toLowerCase()}function n(e){return t(v.Util.stringToUint8Array(v.Util.toUTF8(e)))}e.sha256buffer=t,e.sha256string=n})((v=e.pxtc||(e.pxtc={})).BrowserImpl||(v.BrowserImpl={}))}(ts||(ts={})),function(e){e.perf||(e.perf={})}(pxt||(pxt={})),pxt.perf.report||(pxt.perf.report=function(){}),pxt.perf.recordMilestone||(pxt.perf.recordMilestone=function(){}),pxt.perf.measureStart||(pxt.perf.measureStart=function(){}),pxt.perf.measureEnd||(pxt.perf.measureEnd=function(){}),function(s){var r;s.U=pxtc.Util,s.Util=pxtc.Util;var p,o,c={};function i(e,t){/^csv-/.test(e)?s.setAppTargetVariant(e.replace(/^csv-*/,"")):s.appTarget&&(c[e]=t,s.U.jsonCopyFrom(s.appTarget.compile.switches,c),s.U.jsonCopyFrom(r.compile.switches,c))}function a(){var e=s.appTarget.compile;e||(e=s.appTarget.compile={isNative:!1,hasHex:!1,switches:{}}),e.hasHex&&(e.nativeType||(e.nativeType=pxtc.NATIVE_TYPE_THUMB)),e.switches||(e.switches={}),s.U.jsonCopyFrom(e.switches,c),e.jsRefCounting=!1,e.useUF2||e.useELF||null!=e.noSourceInFlash||(e.noSourceInFlash=!0),void 0===e.utf8&&(e.utf8=!0),s.appTarget.appTheme||(s.appTarget.appTheme={}),s.appTarget.appTheme.embedUrl||(s.appTarget.appTheme.embedUrl=s.appTarget.appTheme.homeUrl);var t=s.appTarget.compileService;t&&t.yottaTarget&&!t.yottaBinary&&(t.yottaBinary="pxt-microbit-app-combined.hex");var n=s.appTarget.appTheme;n&&Object.keys(n).filter(function(e){return/(logo|hero)$/i.test(e)&&/^@cdnUrl@/.test(n[e])}).forEach(function(e){return n[e]=s.BrowserUtils.patchCdn(n[e])});var r=s.appTarget.simulator;if(r&&r.boardDefinition&&r.boardDefinition.visual){var i=r.boardDefinition.visual;i.image&&(i.image=s.BrowserUtils.patchCdn(i.image),i.outlineImage&&(i.outlineImage=s.BrowserUtils.patchCdn(i.outlineImage)))}if(Object.keys(s.appTarget.bundledpkgs).forEach(function(e){var t=s.appTarget.bundledpkgs[e],n=JSON.parse(t[s.CONFIG_NAME]);n.icon&&(n.icon=s.BrowserUtils.patchCdn(n.icon)),t[s.CONFIG_NAME]=s.Package.stringifyConfig(n)}),"undefined"!=typeof window){var o={"lockededitor=1":{appTheme:{lockedEditor:!0}},"hidemenu=1":{appTheme:{hideMenuBar:!0}}};s.appTarget.queryVariants&&s.Util.jsonCopyFrom(o,s.appTarget.queryVariants);var a=window.location.href;Object.keys(o).forEach(function(e){if(new RegExp(e,"i").exec(a)){var t=o[e];t&&s.U.jsonMergeFrom(s.appTarget,t)}})}}function n(e){void 0===e&&(e=!1),s.perf.measureStart("reloadAppTargetVariant");var t=e?"":JSON.stringify(s.appTarget);if(s.appTarget=s.U.clone(r),s.appTargetVariant){var n=s.appTarget.variants&&s.appTarget.variants[s.appTargetVariant];n?s.U.jsonMergeFrom(s.appTarget,n):s.U.userError(lf("Variant '{0}' not defined in pxtarget.json",s.appTargetVariant))}a(),!e&&s.onAppTargetChanged&&t!=JSON.stringify(s.appTarget)&&s.onAppTargetChanged(),s.perf.measureEnd("reloadAppTargetVariant")}s.setAppTarget=function(e){s.appTarget=e||{},a(),r=s.U.clone(s.appTarget)},s.setBundledApiInfo=function(e){for(var t=0,n=Object.keys(e);t<n.length;t++)for(var r=e[n[t]].apis.byQName,i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=r[a],c=a.lastIndexOf("."),l=s.pyQName,u=r[a]={kind:Math.abs(s.kind||7),qName:a,namespace:a.slice(0,c<0?0:c),name:a.slice(c+1),pyQName:l,pyName:l?l.slice(l.lastIndexOf(".")+1):void 0,fileName:"",attributes:s.attributes||{},retType:s.retType||"void",parameters:s.parameters?s.parameters.map(function(e){return{name:e.name,description:e.description||"",type:e.type||"number",initializer:e.initializer,default:e.default,options:e.options||{},isEnum:!!e.isEnum,handlerParameters:e.handlerParameters}}):null,extendsTypes:s.extendsTypes,snippet:s.kind&&s.kind<0?null:void 0,isInstance:!!s.isInstance,isReadOnly:!!s.isReadOnly},f=u.attributes;f.paramDefl||(f.paramDefl={}),f.callingConvention||(f.callingConvention=0),f.paramHelp||(f.paramHelp={}),f.jsDoc||(f.jsDoc=""),f._name=u.name.replace(/@.*/,"")}p=e},s.getBundledApiInfo=function(){return p},s.savedAppTheme=function(){return r?r.appTheme:void 0},s.setCompileSwitch=i,s.setCompileSwitches=function(e){if(e)for(var t=0,n=e.split(/[\s,;:]+/);t<n.length;t++){var r=n[t];r&&("-"==r[0]?i(r.slice(1),!1):i(r,!0))}},s.bundledSvg=function(e){if(e){var t=o&&o[e];if(t)return t;if(s.appTarget.simulator&&s.appTarget.simulator.dynamicBoardDefinition){o||(o={});var n=s.appTarget.bundledpkgs[e];if(n){if(JSON.parse(n["pxt.json"]).core&&n["board.json"]){var r=JSON.parse(n["board.json"]);if(r&&r.visual&&r.visual.image){var i=r.visual.image;/^pkg:\/\//.test(i)&&(i=n[i.slice(6)]),o[e]="data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(s.Util.toUTF8(i))}}return o[e]}}}},s.reloadAppTargetVariant=n,s.setAppTargetVariant=function(e,t){void 0===t&&(t={}),s.debug("app variant: "+e),(t.force||s.appTargetVariant!==e&&(s.appTargetVariant||e))&&(s.appTargetVariant=e,n(t.temporary))},s.setHwVariant=function(e,t){e=e.replace(/.*---/,""),/^[\w\-]+$/.test(e)?(s.hwVariant=e,s.hwName=t||e):(s.hwVariant=null,s.hwName=null)},s.hasHwVariants=function(){return!!s.appTarget.variants&&Object.keys(s.appTarget.bundledpkgs).some(function(e){return/^hw---/.test(e)})},s.getHwVariants=function(){return s.appTarget.variants?Object.keys(s.appTarget.bundledpkgs).filter(function(e){return/^hw---/.test(e)}).map(function(e){return JSON.parse(s.appTarget.bundledpkgs[e][s.CONFIG_NAME])}).filter(function(e){return!!s.appTarget.appTheme.experimentalHw||!e.experimentalHw}):[]},s.options={},s.debug="undefined"!=typeof console&&console.debug?function(e){s.options.debug&&console.debug(e)}:function(){},s.log="undefined"!=typeof console&&console.log?function(e){console.log(e)}:function(){},s.reportException=function(e,t){if(console&&(console.error(e),t))try{console.log(t)}catch(e){}},s.reportError=function(e,t,n){if(console&&(console.error(e+": "+t),n))try{s.log(JSON.stringify(n,null,2))}catch(e){}};var l={},u=s.Util.debounce(function(){s.tickEvent("activity",l),l={}},1e4,!1);function t(){return{relprefix:"/--",workerjs:"/worker.js",monacoworkerjs:"/monacoworker.js",gifworkerjs:"/gifjs/gif.worker.js",serviceworkerjs:"/serviceworker.js",pxtVersion:"local",pxtRelId:"",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:s.appTarget?s.appTarget.id:"",simUrl:"/sim/simulator.html",simserviceworkerUrl:"/simulatorserviceworker.js",simworkerconfigUrl:"/sim/workerConfig.js",partsUrl:"/sim/siminstructions.html"}}s.tickActivity=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.filter(function(e){return!!e}).map(function(e){return e.slice(0,64)}).forEach(function(e){return l[e]=(l[e]||0)+1}),u()},s.localWebConfig=t,s.getOnlineCdnUrl=function(){if(!s.webConfig)return null;var e=/^(https:\/\/[^\/]+)/.exec(s.webConfig.commitCdnUrl);return e?e[1]:null},s.setupWebConfig=function(e){e?s.webConfig=e:s.webConfig||(s.webConfig=t())},s.getEmbeddedScript=function(e){return s.U.lookup(s.appTarget.bundledpkgs||{},e)};var e=void 0;function f(){return e||(e=s.Cloud.downloadTargetConfigAsync().then(function(e){return e||{}},function(e){return{}})),e}function d(e){return void 0===e&&(e=null),e||(e=s.appTarget.compile),e.nativeType==ts.pxtc.NATIVE_TYPE_VM?ts.pxtc.BINARY_PXT64:e.useUF2&&!e.switches.rawELF?ts.pxtc.BINARY_UF2:e.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}s.targetConfigAsync=f,s.packagesConfigAsync=function(){return f().then(function(e){return e?e.packages:void 0})},s.CONFIG_NAME="pxt.json",s.SIMSTATE_JSON=".simstate.json",s.SERIAL_EDITOR_FILE="serial.txt",s.README_FILE="README.md",s.GITIGNORE_FILE=".gitignore",s.CLOUD_ID="pxt/",s.BLOCKS_PROJECT_NAME="blocksprj",s.JAVASCRIPT_PROJECT_NAME="tsprj",s.PYTHON_PROJECT_NAME="pyprj",s.DEFAULT_GROUP_NAME="other",s.TILEMAP_CODE="tilemap.g.ts",s.TILEMAP_JRES="tilemap.g.jres",s.outputName=d,s.isOutputText=function(e){return void 0===e&&(e=null),d(e)==ts.pxtc.BINARY_HEX}}(pxt||(pxt={})),function(i){!function(o){var t,v="this";function n(){if((t={device_while:{name:i.Util.lf("a loop that repeats while the condition is true"),tooltip:i.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:i.Util.lf("while %1"),appendField:i.Util.lf("{id:while}do")}},pxt_controls_for:{name:i.Util.lf("a loop that repeats the number of times you say"),tooltip:i.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:i.Util.lf("for %1 from 0 to %2"),variable:i.Util.lf("{id:var}index"),appendField:i.Util.lf("{id:for}do")}},controls_simple_for:{name:i.Util.lf("a loop that repeats the number of times you say"),tooltip:i.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:i.Util.lf("for %1 from 0 to %2"),variable:i.Util.lf("{id:var}index"),appendField:i.Util.lf("{id:for}do")}},pxt_controls_for_of:{name:i.Util.lf("a loop that repeats for each value in an array"),tooltip:i.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:i.Util.lf("for element %1 of %2"),variable:i.Util.lf("{id:var}value"),appendField:i.Util.lf("{id:for_of}do")}},controls_for_of:{name:i.Util.lf("a loop that repeats for each value in an array"),tooltip:i.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:i.Util.lf("for element %1 of %2"),variable:i.Util.lf("{id:var}value"),appendField:i.Util.lf("{id:for_of}do")}},math_op2:{name:i.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:i.Util.lf("smaller value of 2 numbers"),max:i.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:i.Util.lf("absolute number"),tooltip:i.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:i.Util.lf("absolute of %1")}},math_number:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.appTarget&&i.appTarget.compile?i.Util.lf("a decimal number"):i.Util.lf("an integer number")},math_integer:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.Util.lf("an integer number")},math_whole_number:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.Util.lf("a whole number")},math_number_minmax:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_arithmetic:{name:i.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:i.Util.lf("Return the sum of the two numbers."),MINUS:i.Util.lf("Return the difference of the two numbers."),MULTIPLY:i.Util.lf("Return the product of the two numbers."),DIVIDE:i.Util.lf("Return the quotient of the two numbers."),POWER:i.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:i.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:i.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:i.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:i.Util.lf("{id:op}÷"),MATH_POWER_SYMBOL:i.Util.lf("{id:op}**")}},math_modulo:{name:i.Util.lf("division remainder"),tooltip:i.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:i.Util.lf("remainder of %1 ÷ %2")}},math_js_op:{name:i.Util.lf("math function"),tooltip:{sqrt:i.Util.lf("Returns the square root of the argument"),sin:i.Util.lf("Returns the sine of the argument"),cos:i.Util.lf("Returns the cosine of the argument"),tan:i.Util.lf("Returns the tangent of the argument"),atan2:i.Util.lf("Returns the arctangent of the quotient of the two arguments"),idiv:i.Util.lf("Returns the integer portion of the division operation on the two arguments"),imul:i.Util.lf("Returns the integer portion of the multiplication operation on the two arguments")},url:"/blocks/math",operators:{OP:["sqrt","sin","cos","tan","atan2","idiv","imul"]},category:"math",block:{sqrt:i.Util.lf("{id:op}square root"),sin:i.Util.lf("{id:op}sin"),cos:i.Util.lf("{id:op}cos"),tan:i.Util.lf("{id:op}tan"),atan2:i.Util.lf("{id:op}atan2"),idiv:i.Util.lf("{id:op}integer ÷"),imul:i.Util.lf("{id:op}integer ×")}},math_js_round:{name:i.Util.lf("rounding functions"),tooltip:{round:i.Util.lf("Increases the argument to the next higher whole number if its fractional part is more than one half"),ceil:i.Util.lf("Increases the argument to the next higher whole number"),floor:i.Util.lf("Decreases the argument to the next lower whole number"),trunc:i.Util.lf("Removes the fractional part of the argument")},url:"/blocks/math",operators:{OP:["round","ceil","floor","trunc"]},category:"math",block:{round:i.Util.lf("{id:op}round"),ceil:i.Util.lf("{id:op}ceiling"),floor:i.Util.lf("{id:op}floor"),trunc:i.Util.lf("{id:op}truncate")}},variables_change:{name:i.Util.lf("update the value of a number variable"),tooltip:i.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:i.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:i.Util.lf("a loop that repeats and increments an index"),tooltip:i.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:i.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:i.Util.lf("{id:repeat}do")}},variables_get:{name:i.Util.lf("get the value of a variable"),tooltip:i.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:i.Util.lf("Create 'set %1'")}},variables_get_reporter:{name:i.Util.lf("get the value of a variable"),tooltip:i.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:i.Util.lf("Create 'set %1'")}},variables_set:{name:i.Util.lf("assign the value of a variable"),tooltip:i.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:i.Util.lf("set %1 to %2")}},controls_if:{name:i.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:i.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:i.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:i.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:i.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:i.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:i.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:i.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:i.Util.lf("{id:logic}else if")}},lists_create_with:{name:i.Util.lf("create an array"),tooltip:i.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:i.Util.lf("empty array"),LISTS_CREATE_WITH_INPUT_WITH:i.Util.lf("array of"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:i.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:i.Util.lf("value")}},lists_length:{name:i.Util.lf("array length"),tooltip:i.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:i.Util.lf("length of array %1")}},lists_index_get:{name:i.Util.lf("get a value in an array"),tooltip:i.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:i.Util.lf("%1 get value at %2")}},lists_index_set:{name:i.Util.lf("set a value in an array"),tooltip:i.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:i.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:i.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:i.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:i.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:i.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:i.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:i.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:i.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:i.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:i.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:i.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:i.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:i.Util.lf("{id:op}or")}},logic_negate:{name:i.Util.lf("logical negation"),tooltip:i.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:i.Util.lf("not %1")}},logic_boolean:{name:i.Util.lf("a `true` or `false` value"),tooltip:i.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:i.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:i.Util.lf("{id:boolean}false")}},text:{name:i.Util.lf("a piece of text"),tooltip:i.Util.lf("A letter, word, or line of text."),url:"types/string",category:"text",block:{search:i.Util.lf("a piece of text")}},text_length:{name:i.Util.lf("number of characters in the string"),tooltip:i.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:i.Util.lf("length of %1")}},text_join:{name:i.Util.lf("join items to create text"),tooltip:i.Util.lf("Create a piece of text by joining together any number of items."),url:"reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:i.Util.lf("join")}},procedures_defnoreturn:{name:i.Util.lf("define the function"),tooltip:i.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:i.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:i.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:i.Util.lf("call the function"),tooltip:i.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:i.Util.lf("call function")}},function_return:{name:i.Util.lf("return a value from within a function"),tooltip:i.Util.lf("Return a value from within a user-defined function."),url:"types/function/return",category:"functions",block:{message_with_value:i.Util.lf("return %1"),message_no_value:i.Util.lf("return")}},function_definition:{name:i.Util.lf("define the function"),tooltip:i.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{FUNCTIONS_EDIT_OPTION:i.Util.lf("Edit Function")}},function_call:{name:i.Util.lf("call the function"),tooltip:i.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{FUNCTIONS_CALL_TITLE:i.Util.lf("call")}},function_call_output:{name:i.Util.lf("call the function with a return value"),tooltip:i.Util.lf("Call the user-defined function with a return value."),url:"types/function/call",category:"functions",block:{}}})[pxtc.ON_START_TYPE]={name:i.Util.lf("on start event"),tooltip:i.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:i.Util.lf("on start %1 %2")}},t[pxtc.PAUSE_UNTIL_TYPE]={name:i.Util.lf("pause until"),tooltip:i.Util.lf("Pause execution of code until the given boolean expression is true"),url:"/blocks/pause-until",category:"loops",block:{message0:i.Util.lf("pause until %1")}},t[pxtc.TS_BREAK_TYPE]={name:i.Util.lf("break"),tooltip:i.Util.lf("Break out of the current loop or switch"),url:"/blocks/loops/break",category:"loops",block:{message0:i.Util.lf("break")}},t[pxtc.TS_CONTINUE_TYPE]={name:i.Util.lf("continue"),tooltip:i.Util.lf("Skip current iteration and continues with the next iteration in the loop"),url:"/blocks/loops/continue",category:"loops",block:{message0:i.Util.lf("continue")}},i.Util.isTranslationMode()){var r=Blockly.Msg;i.Util.values(t).filter(function(e){return e.block}).forEach(function(n){var e=Object.keys(n.block);n.translationIds=i.Util.values(n.block),e.forEach(function(t){return i.crowdin.inContextLoadAsync(n.block[t]).done(function(e){n.block[t]=e,/^[A-Z_]+$/.test(t)&&(r[t]=e)})})})}}o.MATH_FUNCTIONS={unary:["sqrt","sin","cos","tan"],binary:["atan2"],infix:["idiv","imul"]},o.ROUNDING_FUNCTIONS=["round","ceil","floor","trunc"],o.builtinFunctionInfo={"Math.abs":{blockId:"math_op3",params:["x"]},"Math.min":{blockId:"math_op2",params:["x","y"]},"Math.max":{blockId:"math_op2",params:["x","y"]}},o.normalizeBlock=function(e,t){if(void 0===t&&(t=i.log),!e)return e;var n=e.replace(/[^\\]%\s+/g,"%");return n!=e?(t("block has extra spaces: "+e),e):((n=(e=n).replace(/(%\w+)\s*=\s*(\w+)/,"$1=$2"))!=e&&(t("block has space between %name and = : "+e),e=n),n=n.replace(/\s*\|\s*/g,"|"))},o.compileInfo=function(n){var a={parameters:[],actualNameToParam:{},definitionNameToParam:{},handlerArgs:[]},e=(1==n.kind||2==n.kind)&&!n.attributes.defaultInstance,s=!!n.attributes._def,c=s?n.attributes._def.parameters.slice(0):void 0,l=s?c.length:n.parameters?n.parameters.length:0,u=o.builtinFunctionInfo[n.qName];s&&n.attributes._expandedDef&&c.push.apply(c,n.attributes._expandedDef.parameters);var f={},p=c?c.filter(function(e){return!e.ref||(f[e.name]=e,!1)}):[];if(e&&s&&c.length){var t=f[v]||c[0],r=t.name,i=void 0;(!t.shadowBlockId||"variables_get"===t.shadowBlockId)&&(i=t.varName||n.attributes.paramDefl[r]||n.attributes.paramDefl.this),a.thisParameter={actualName:v,definitionName:r,shadowBlockId:t.shadowBlockId,type:n.namespace,defaultValue:i,fieldEditor:h(r,v),fieldOptions:g(r,v),shadowOptions:m(r,v)}}if(n.parameters){var d=e&&!f[v]?1:0;n.parameters.forEach(function(e,t){var n;if(f[e.name]?n=f[e.name]:d<p.length&&(n=p[d],++d),n||!s){var r=void 0;e.options&&e.options.min&&e.options.max&&(r={min:e.options.min.value,max:e.options.max.value});var i=n?n.name:u?u.params[d++]:e.name,o=n&&("variables_get"===n.shadowBlockId||"lists_create_with"==n.shadowBlockId);a.parameters.push({actualName:e.name,type:e.type,defaultValue:o&&n.varName||e.default,definitionName:i,shadowBlockId:n&&n.shadowBlockId,isOptional:!!c&&c.indexOf(n)>=l,fieldEditor:h(i,e.name),fieldOptions:g(i,e.name),shadowOptions:m(i,e.name),range:r})}e.handlerParameters&&e.handlerParameters.forEach(function(t){a.handlerArgs.push({name:t.name,type:t.type,inBlockDef:!!c&&c.some(function(e){return e.ref&&e.name===t.name})})})})}return a.parameters.forEach(function(e){a.actualNameToParam[e.actualName]=e,a.definitionNameToParam[e.definitionName]=e}),a;function h(e,t){return n.attributes.paramFieldEditor&&(n.attributes.paramFieldEditor[e]||n.attributes.paramFieldEditor[t])}function g(e,t){return n.attributes.paramFieldEditorOptions&&(n.attributes.paramFieldEditorOptions[e]||n.attributes.paramFieldEditorOptions[t])}function m(e,t){return n.attributes.paramShadowOptions&&(n.attributes.paramShadowOptions[e]||n.attributes.paramShadowOptions[t])}},o.hasHandler=function(e){return e.parameters&&e.parameters.some(function(e){var t,n;return"() => void"==e.type||"Action"==e.type||!!(null===(t=e.properties)||void 0===t?void 0:t.length)||!!(null===(n=e.handlerParameters)||void 0===n?void 0:n.length)})},o.reporterTypeForArgType=function(e){var t="argument_reporter_custom";return"boolean"!==e&&"number"!==e&&"string"!==e||(t="argument_reporter_"+e),t},o.defaultIconForArgType=function(e){switch(void 0===e&&(e=""),e){case"number":return"calculator";case"string":return"text width";case"boolean":return"random";default:return"align justify"}},o.parseFields=function(e){return e.split("|").map(function(e,t){var n=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!n)return{n:e,ni:t};var r=n[1];return r&&(r=r.trim()),{n:e,ni:t,pre:r,p:n[2]}})},o.blockDefinitions=function(){return t||n(),t},o.getBlockDefinition=function(e){return t||n(),t[e]}}(i.blocks||(i.blocks={}))}(pxt||(pxt={})),function(W){!function(f){function t(){return"undefined"!=typeof navigator}function e(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function p(){return t()&&/mobi/i.test(navigator.userAgent)}function n(){return t()&&/Mac/i.test(navigator.platform)}function d(){return!!navigator&&/Linux/i.test(navigator.platform)}function h(){return t()&&/arm/i.test(navigator.platform)}function g(){return t()&&/Edge/i.test(navigator.userAgent)}function r(){return t()&&/Trident/i.test(navigator.userAgent)}function m(){return!g()&&!r()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function v(){return!m()&&!g()&&!!navigator&&/(Macintosh|Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function y(){return!v()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function b(){return t()&&/Opera|OPR/i.test(navigator.userAgent)}function w(){return t()&&/Midori/i.test(navigator.userAgent)}function k(){return t()&&/Epiphany/i.test(navigator.userAgent)}function i(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function o(){return"undefined"!=typeof window&&!!window.pxtElectron}function a(){return"undefined"!=typeof window&&!!window.ipcRenderer}function s(){return o()||a()}function c(e){var t,n;try{return"undefined"!=typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&(e||!/nolocalhost=1/.test(window.location.href))&&!(null===(n=null===(t=W)||void 0===t?void 0:t.webConfig)||void 0===n?void 0:n.isStatic)}catch(e){return!1}}function l(){return"undefined"!=typeof window&&!!window.PointerEvent}function x(){return e()?"windows":n()?"mac":d()&&h()?"rpi":d()?"linux":"unknown"}function A(){return g()?"edge":k()?"epiphany":w()?"midori":b()?"opera":r()?"ie":m()?"chrome":v()?"safari":y()?"firefox":"unknown"}function T(){if(!t())return null;var e=[];return b()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),k()?e=/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):w()?e=/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):v()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||(e=/(Macintosh|iPod|iPhone|iPad); (CPU|Intel).*?OS (X )?(\d+)/i.exec(navigator.userAgent)):e=m()?/(Chrome|Chromium)\/([0-9\.]+)/i.exec(navigator.userAgent):g()?/Edge\/([0-9\.]+)/i.exec(navigator.userAgent):r()?/(MSIE |rv:)([0-9\.]+)/i.exec(navigator.userAgent):/(Firefox|Seamonkey)\/([0-9\.]+)/i.exec(navigator.userAgent),e&&0!=e.length?e[e.length-1]:null}f.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},f.hasNavigator=t,f.isWindows=e,f.isWindows10=function(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},f.isMobile=p,f.isIOS=function(){return t()&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints)},f.isAndroid=function(){return t()&&/android/i.test(navigator.userAgent)},f.isMac=n,f.isLinux=d,f.isARM=h,f.isUwpEdge=function(){return"undefined"!=typeof window&&!!window.Windows},f.isEdge=g,f.isIE=r,f.isChrome=m,f.isSafari=v,f.isFirefox=y,f.isOpera=b,f.isMidori=w,f.isEpiphany=k,f.isTouchEnabled=i,f.isPxtElectron=o,f.isIpcRenderer=a,f.isElectron=s,f.isWinRT=function(){return!1},f.isLocalHost=c,f.isLocalHostDev=function(){return c()&&!s()},f.hasPointerEvents=l,f.hasSaveAs=function(){return g()||r()||y()},f.os=x,f.browser=A,f.browserVersion=T;var C=!1;function E(){return p()&&v()&&!/downloadWindowOpen=0/i.test(window.location.href)}function u(e,t,n){var r=E(),i=T(),o=parseInt(i||"0");if(r)n?n.location.href=e:window.open(e,"_self");else if(W.BrowserUtils.isSafari()&&(o<10||0==i.indexOf("10.0")||p())){var a=document.getElementById("downloader");a||(W.debug("injecting downloader iframe"),(a=document.createElement("iframe")).id="downloader",a.style.position="absolute",a.style.right="0",a.style.bottom="0",a.style.zIndex="-1",a.style.width="1px",a.style.height="1px",document.body.appendChild(a)),a.src=e}else if(W.BrowserUtils.isEdge()||W.BrowserUtils.isIE()){var s=atob(e.split(",")[1]),c=W.Util.stringToUint8Array(s),l=new Blob([c],{type:"img/png"});window.navigator.msSaveOrOpenBlob(l,t)}else{var u=window.document.createElement("a");"string"==typeof u.download?(u.href=e,u.download=t,document.body.appendChild(u),u.click(),document.body.removeChild(u)):document.location.href=e}}function _(e,t){var n="data";p()&&v()&&W.appTarget.appTheme.mobileSafariDownloadProtocol&&(n=W.appTarget.appTheme.mobileSafariDownloadProtocol);var r=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);return r&&(n=r[1]),n+":"+t+";base64,"+e}function U(e,t,n,r,i){void 0===n&&(n="application/octet-stream"),W.debug("trigger download");var o=window.navigator.msSaveOrOpenBlob&&!W.BrowserUtils.isMobile(),a=_(e,t);try{if(o){var s=new Blob([W.Util.stringToUint8Array(atob(e))],{type:n});window.navigator.msSaveOrOpenBlob(s,t)}else u(a,t,r)}catch(e){i&&i(e),W.debug("saving failed")}return a}function S(n){var r=document.createElement("img");return new Promise(function(e,t){r.onload=function(){return e(r)},r.onerror=function(){return e(void 0)},r.crossOrigin="anonymous",r.src=n})}function P(e){if(/^https?:\/\//i.test(e))return e;var t=(window.MonacoPaths||{})[e];return t||(W.U.startsWith(e,W.webConfig.commitCdnUrl)?e:W.webConfig.commitCdnUrl+e)}f.isBrowserSupported=function(){var e,t,n;if(!navigator)return!0;if(/bot|crawler|spider|crawling/i.test(navigator.userAgent))return!0;if(null===(n=(null===(e=W.appTarget)||void 0===e?void 0:e.unsupportedBrowsers)||(null===(t=window.pxtTargetBundle)||void 0===t?void 0:t.unsupportedBrowsers))||void 0===n?void 0:n.some(function(e){return e.id==A()}))return!1;var r=T(),i=parseInt(r||"0"),o=m()&&38<=i,a=y()&&31<=i,s=g(),c=v()&&9<=i,l=b()&&m()&&21<=i,u=o||a||s||c||l,f=w()||d()&&h()&&k();return u=(u=u&&!f)||/anybrowser=(true|1)/.test(window.location.href),C||(W.log("Browser: "+A()+" "+r+" on "+x()),u||W.tickEvent("browser.unsupported",{useragent:navigator.userAgent}),C=!0),u},f.devicePixelRatio=function(){if("undefined"==typeof window||!window.screen)return 1;var e=window.screen.systemXDPI,t=window.screen.logicalXDPI;return void 0!==e&&void 0!==t&&t<e?e/t:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1},f.browserDownloadBinText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),U(ts.pxtc.encodeBase64(e),t,n,r,i)},f.browserDownloadText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),U(ts.pxtc.encodeBase64(W.Util.toUTF8(e)),t,n,r,i)},f.isBrowserDownloadInSameWindow=E,f.isBrowserDownloadWithinUserContext=function(){var e=T(),t=parseInt(e||"0");return p()&&v()&&11<=t||/downloadUserContext=1/i.test(window.location.href)},f.browserDownloadDataUri=u,f.browserDownloadUInt8Array=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),U(ts.pxtc.encodeBase64(W.Util.uint8ArrayToString(e)),t,n,r,i)},f.toDownloadDataUri=_,f.browserDownloadBase64=U,f.loadImageAsync=S,f.loadCanvasAsync=function(e){return S(e).then(function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t})},f.imageDataToPNG=function(e){if(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t.toDataURL("image/png")}},f.resolveCdnUrl=P,f.loadStyleAsync=function(e,t){t&&(e="rtl"+e);var r="style-"+e;if(document.getElementById(r))return Promise.resolve();var i=P(e),n=W.Util.toArray(document.head.getElementsByTagName("link")).filter(function(e){return e.getAttribute("href")==i})[0];return n?(n.id||(n.id=r),Promise.resolve()):new Promise(function(e,t){var n=document.createElement("link");n.href=i,n.rel="stylesheet",n.type="text/css",n.id=r,n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){return t(e)}),document.head.appendChild(n)})};var O,N={};function I(e,t){return e?t?(e.indexOf("/")==e.length-1?e.substring(0,e.length-1):e)+"/"+(0==t.indexOf("/")?t.substring(1):t):e:t}function L(){var e=t()&&window.navigator;return e&&e.storage&&e.storage.estimate?e.storage.estimate():Promise.resolve({})}f.loadScriptAsync=function(e){var r=P(e),t=N[r];return t||(t=N[r]=new Promise(function(e,t){W.debug("script: loading "+r);var n=document.createElement("script");n.type="text/javascript",n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){delete N[r],t(e)}),n.src=r,n.async=!0,document.body.appendChild(n)})),t},f.loadAjaxAsync=function(r){return new Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200==n.status?e(n.responseText):t(n.status))},n.open("GET",r,!0),n.send()})},f.loadBlocklyAsync=function(){if(!O){W.debug("blockly: delay load");var e=W.BrowserUtils.loadStyleAsync("blockly.css",ts.pxtc.Util.isUserLanguageRtl());"undefined"==typeof Blockly&&(e=e.then(function(){return W.BrowserUtils.loadScriptAsync("pxtblockly.js")})),e=e.then(function(){W.debug("blockly: loaded")}),O=e}return O},f.patchCdn=function(e){if(!e)return e;var t=W.getOnlineCdnUrl();return t?e.replace("@cdnUrl@",t):e.replace(/@cdnUrl@\/(blob|commit)\/[a-f0-9]{40}\//,"./")},f.initTheme=function(){var e=W.appTarget.appTheme;if(e&&e.accentColor){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(".ui.accent { color: "+e.accentColor+"; }\n                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: "+e.accentColor+"; }")),document.getElementsByTagName("head")[0].appendChild(t)}if(W.Util.isUserLanguageRtl()){W.debug("rtl layout"),W.BrowserUtils.addClass(document.body,"rtl"),document.body.style.direction="rtl";var n=W.Util.toArray(document.head.getElementsByTagName("link")),r=n.filter(function(e){return W.Util.endsWith(e.getAttribute("href"),"semantic.css")})[0];if(r){var i=r.getAttribute("data-rtl");i&&(W.debug("swapping to "+i),r.setAttribute("href",i))}var o=n.filter(function(e){return W.Util.endsWith(e.getAttribute("href"),"blockly.css")})[0];if(o){var a=o.getAttribute("data-rtl");a&&(W.debug("swapping to "+a),o.setAttribute("href",a),o.removeAttribute("data-rtl"))}}},f.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)},f.urlJoin=I,f.joinURLs=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(t)for(var r=0;r<t.length;r++)e=I(e,t[r]);return e},f.storageEstimateAsync=L,f.scheduleStorageCleanup=t()&&navigator.storage&&navigator.storage.estimate?ts.pxtc.Util.throttle(function(){L().then(function(e){return W.debug("storage estimate: "+(e.usage/e.quota*100>>0)+"%, "+(e.usage/1e6>>0)+"/"+(e.quota/1e6>>0)+"Mb"),e.quota&&e.usage&&1e6<e.quota&&.9<e.usage/e.quota?(W.log("quota usage exceeded, clearing translations"),W.tickEvent("storage.cleanup"),j()):Promise.resolve()}).catch(function(e){W.reportException(e)})},1e4,!1):function(){},f.stressTranslationsAsync=function t(){for(var n="...",e=0;e<16;++e)n+=n+Math.random();return console.log("adding entry "+2*n.length+" bytes"),Promise.delay(1).then(function(){return B()}).then(function(e){return e.setAsync("foobar",Math.random().toString(),"",null,void 0,n)}).then(function(){return W.BrowserUtils.storageEstimateAsync()}).then(function(e){return!e.quota||e.usage/e.quota<.8?t():Promise.resolve()})};var D=function(){function e(){this.translations={}}return e.prototype.key=function(e,t,n){return e+"|"+t+"|"+(n||"master")},e.prototype.get=function(e,t,n){return this.translations[this.key(e,t,n)]},e.prototype.getAsync=function(e,t,n){return Promise.resolve(this.get(e,t,n))},e.prototype.set=function(e,t,n,r,i,o,a){this.translations[this.key(e,t,n)]={etag:r,time:i,strings:o,md:a}},e.prototype.setAsync=function(e,t,n,r,i,o){return this.set(e,t,n,r,W.Util.now(),i),Promise.resolve()},e.prototype.clearAsync=function(){return this.translations={},Promise.resolve()},e}(),R=function(){function e(e,t,n,r){this.name=e,this.version=t,this.upgradeHandler=n,this.quotaExceededHandler=r}return e.prototype.throwIfNotOpened=function(){if(!this._db)throw new Error("Database not opened; call IDBWrapper.openAsync() first")},e.prototype.errorHandler=function(e,t,n){console.error(new Error(this.name+" IDBWrapper error for "+t+": "+e.message)),n(e),"QuotaExceededError"==e.name&&(W.log("storage quota exceeded..."),W.tickEvent("storage.quotaexceedederror"),this.quotaExceededHandler&&this.quotaExceededHandler())},e.prototype.getObjectStore=function(e,t){return void 0===t&&(t="readonly"),this.throwIfNotOpened(),this._db.transaction([e],t).objectStore(e)},e.deleteDatabaseAsync=function(r){return new Promise(function(e,t){var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(r);n.onsuccess=function(){return e()},n.onerror=function(){return t(n.error)}})},e.prototype.openAsync=function(){var r=this;return new Promise(function(e,t){var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(r.name,r.version);n.onsuccess=function(){r._db=n.result,e()},n.onerror=function(){return r.errorHandler(n.error,"open",t)},n.onupgradeneeded=function(e){return r.upgradeHandler(e,n)}})},e.prototype.getAsync=function(r,i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(r).get(i);n.onsuccess=function(){return e(n.result)},n.onerror=function(){return o.errorHandler(n.error,"get",t)}})},e.prototype.getAllAsync=function(i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(i).openCursor(),r=[];n.onsuccess=function(){n.result?(r.push(n.result.value),n.result.continue()):e(r)},n.onerror=function(){return o.errorHandler(n.error,"getAll",t)}})},e.prototype.setAsync=function(i,o){var a=this;return new Promise(function(e,t){var n,r=a.getObjectStore(i,"readwrite");(n=void 0!==o.id&&null!==o.id?r.put(o):r.add(o)).onsuccess=function(){return e()},n.onerror=function(){return a.errorHandler(n.error,"set",t)}})},e.prototype.deleteAsync=function(r,i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(r,"readwrite").delete(i);n.onsuccess=function(){return e()},n.onerror=function(){return o.errorHandler(n.error,"delete",t)}})},e.prototype.deleteAllAsync=function(r){var i=this;return new Promise(function(e,t){var n=i.getObjectStore(r,"readwrite").clear();n.onsuccess=function(){return e()},n.onerror=function(){return i.errorHandler(n.error,"deleteAll",t)}})},e}();f.IDBWrapper=R;var F,M=function(){function u(e){this.db=e,this.mem=new D}return u.dbName=function(){return"__pxt_translations_"+(W.appTarget.id||"")},u.createAsync=function(){function t(){var e=new R(u.dbName(),2,function(e,t){t.result.createObjectStore(u.TABLE,{keyPath:u.KEYPATH})},function(){j().catch(function(e){})});return e.openAsync().then(function(){return new u(e)})}return t().catch(function(e){return console.log("db: failed to open database, try delete entire store..."),R.deleteDatabaseAsync(u.dbName()).then(function(){return t()})})},u.prototype.getAsync=function(t,n,r){var i=this;t=(t||"en-US").toLowerCase();var e=this.mem.key(t,n,r),o=this.mem.get(t,n,r);return o?Promise.resolve(o):this.db.getAsync(u.TABLE,e).then(function(e){return e?(i.mem.set(t,n,r,e.etag,e.time,e.strings),Promise.resolve(e)):Promise.resolve(void 0)}).catch(function(e){return Promise.resolve(void 0)})},u.prototype.setAsync=function(e,t,n,r,i,o){var a=this;e=(e||"en-US").toLowerCase();var s=this.mem.key(e,t,n),c=W.Util.now();this.mem.set(e,t,n,r,c,i,o),i&&Object.keys(i).filter(function(e){return!i[e]}).forEach(function(e){return delete i[e]});var l={id:s,etag:r,time:c,strings:i,md:o};return this.db.setAsync(u.TABLE,l).finally(function(){return f.scheduleStorageCleanup()}).catch(function(e){return console.log("db: set failed ("+e.message+"), recycling..."),a.clearAsync()})},u.prototype.clearAsync=function(){return this.db.deleteAllAsync(u.TABLE).then(function(){return console.debug("db: all clean")}).catch(function(e){console.error("db: failed to delete all")})},u.TABLE="files",u.KEYPATH="id",u}();function B(){return W.Util.isNodeJS?Promise.resolve(new D):(F||(F=M.createAsync().catch(function(){return new D})),F)}function j(){function t(){var t=M.dbName();return R.deleteDatabaseAsync(t).then(function(){F=void 0}).catch(function(e){W.log("db: failed to delete "+t),F=void 0})}return F?F.then(function(e){return e.clearAsync()}).catch(function(e){return t().done()}):t()}function H(e){var t=JSON.stringify(e)+W.appTarget.versions.pxt+"_"+W.appTarget.versions.target;return pxtc.U.sha256(t)}function G(e,t){return e+"|"+(t||"master")}f.translationDbAsync=B,f.clearTranslationDbAsync=j;var z,V=function(){function o(e){this.db=e}return o.dbName=function(){return"__pxt_tutorialinfo_"+(W.appTarget.id||"")},o.createAsync=function(){function t(){var e=new W.BrowserUtils.IDBWrapper(o.dbName(),2,function(e,t){t.result.createObjectStore(o.TABLE,{keyPath:o.KEYPATH})},function(){W.BrowserUtils.IDBWrapper.deleteDatabaseAsync(o.dbName())});return e.openAsync().then(function(){return new o(e)})}return t().catch(function(e){return console.log("db: failed to open tutorial info database, try delete entire store..."),W.BrowserUtils.IDBWrapper.deleteDatabaseAsync(o.dbName()).then(function(){return t()})})},o.prototype.getAsync=function(e,t,n){var r=G(e,n),i=H(t);return this.db.getAsync(o.TABLE,r).then(function(e){if(e&&e.hash==i)return e})},o.prototype.setAsync=function(e,t,n,r){W.perf.measureStart("tutorial info db setAsync");var i={id:G(e,r),hash:H(n),blocks:t};return this.db.setAsync(o.TABLE,i).then(function(){W.perf.measureEnd("tutorial info db setAsync")})},o.TABLE="info",o.KEYPATH="id",o}();function J(e){return e.split(/\s+/).filter(function(e){return!!e})}function q(){var e=new RegExp(W.Util.escapeForRegex(W.Util.pxtLangCookieId)+"=(.*?)(?:;|$)").exec(document.cookie);return e&&e[1]||null}f.tutorialInfoDbAsync=function(){return z||(z=V.createAsync()),z},f.pointerEvents=l()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:i()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},f.getPageX=function(e){return"pageX"in e?e.pageX:e.changedTouches[0].pageX},f.getPageY=function(e){return"pageY"in e?e.pageY:e.changedTouches[0].pageY},f.getClientX=function(e){return"clientX"in e?e.clientX:e.changedTouches[0].clientX},f.getClientY=function(e){return"clientY"in e?e.clientY:e.changedTouches[0].clientY},f.popupWindow=function(t,e,n,r){try{var i=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,c=a/2-n/2+i,l=s/2-r/2+o,u=window.open(t,e,"width="+n+", height="+r+", top="+l+", left="+c);return u.focus&&u.focus(),u}catch(e){return W.tickEvent("pxt.popupError",{url:t,msg:e.message}),null}},f.containsClass=function(t,e){return J(e).every(function(e){return function(e,t){if(e.classList)return e.classList.contains(t);var n=(e.className+"").split(/\s+/);return!(n.indexOf(t)<0)}(t,e)})},f.addClass=function(t,e){J(e).forEach(function(e){return function(e,t){if(e.classList)e.classList.add(t);else{var n=(e.className+"").split(/\s+/);n.indexOf(t)<0&&(e.className.baseVal+=" "+t)}}(t,e)})},f.removeClass=function(r,e){J(e).forEach(function(e){return n=e,void((t=r).classList?t.classList.remove(n):t.className.baseVal=(t.className+"").split(/\s+/).filter(function(e){return e!=n}).join(" "));var t,n})},f.getCookieLang=q,f.setCookieLang=function(e,t){if(void 0===t&&(t=!1),W.Util.allLanguages[e]&&e!==q()){W.tickEvent("menu.lang.setcookielang",{lang:e,docs:""+t});var n=new Date;n.setTime(n.getTime()+24*W.Util.langCookieExpirationDays*60*60*1e3),document.cookie=W.Util.pxtLangCookieId+"="+e+"; expires="+n.toUTCString()+"; path=/"}},f.cacheBustingUrl=function(e){return e?/[?&]rnd=/.test(e)?e:e+(0<e.indexOf("?")?"&":"?")+"rnd="+Math.random():e}}(W.BrowserUtils||(W.BrowserUtils={}))}(pxt||(pxt={})),function(e){var n;(n=e.commands||(e.commands={})).deployCoreAsync=void 0,n.deployFallbackAsync=void 0,n.hasDeployFn=function(){return n.deployCoreAsync||n.deployFallbackAsync},n.deployAsync=function(e,t){return(n.deployCoreAsync||n.deployFallbackAsync)(e,t)},n.patchCompileResultAsync=void 0,n.browserDownloadAsync=void 0,n.saveOnlyAsync=void 0,n.renderBrowserDownloadInstructions=void 0,n.renderUsbPairDialog=void 0,n.showUploadInstructionsAsync=void 0,n.saveProjectAsync=void 0,n.electronDeployAsync=void 0,n.webUsbPairDialogAsync=void 0,n.onTutorialCompleted=void 0}(pxt||(pxt={})),function(i){function e(){var e;return e||(e=i.U.isNodeJS?Promise.resolve(require("lzma")):Promise.resolve(window.LZMA)).then(function(e){return e||i.reportError("lzma","failed to load"),e}),e}i.lzmaDecompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.decompress(r,function(e,t){t&&i.debug("lzma decompression failed"),n(t?void 0:e)})}catch(e){e&&i.debug("lzma decompression failed"),n(void 0)}})})},i.lzmaCompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.compress(r,7,function(e,t){t&&i.reportException(t),n(t?void 0:new Uint8Array(e))})}catch(e){i.reportException(e),n(void 0)}})})}}(pxt||(pxt={})),function(Oe){!function(e){var Te=pxtc.Util,Ce=Te.lf;var Ee={"pxt::mkAction":1,"pxt::dumpPerfCounters":1,"pxt::deepSleep":1,"pxt::getConfig":1,"pxtrt::mkMap":1,"pxtrt::mapSet":1,"pxtrt::stclo":1,"pxtrt::mklocRef":1,"pxtrt::stlocRef":1,"pxtrt::ldlocRef":1,"pxtrt::panic":1};function _e(n){void 0===n&&(n="namespace");var r="",i="",e=function(e,t){void 0===t&&(t=""),i!=e&&(i&&(r+="}\n"),e&&(r+=t||n+" "+e+" {\n"),i=e)},t="    ";return{setNs:e,clear:function(){i=r=""},write:function(e){e.trim()?(e=e.trim().replace(/^\s*/gm,t).replace(/^(\s*)\*/gm,function(e,t){return t+" *"}),r+=e+"\n"):r+="\n"},incrIndent:function(){t+="    "},decrIndent:function(){t=t.slice(4)},finish:function(){return e(""),r}}}function Ue(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}e.nsWriter=_e,e.parseCppInt=Ue;var Se={},Pe=function(n){function e(e){var t=n.call(this,e)||this;return t.isUserError=!0,t.message=e,t}return __extends(e,n),e}(Error);function l(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e[n];t+=37==r||127<r?"%"+r.toString(16):String.fromCharCode(r)}return decodeURIComponent(t)}function u(e){for(var t="",n=0;n<e.length;n+=2)t=e[n]+e[n+1]+t;return Oe.Util.assert(n==e.length),t}function o(e){var t=[65,20,14,47,184,47,162,187];e:for(var n=0;n<e.length;n+=16)if(e[n]==t[0]){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;var i=e[n+8]|e[n+9]<<8,o=e[n+10]|e[n+11]<<8|e[n+12]<<16|e[n+13]<<24,a=(n+=16)+i+o;if(!(a>e.length)){var s=e.slice(n,n+i),c=e.slice(n+i,a);return{meta:l(s),text:c}}}return null}function t(e){function t(e){return Oe.debug(e),Promise.reject(new Error(e))}var n;if(Oe.HF2.read32(e,0)==ts.pxtc.UF2.UF2_MAGIC_START0){var r=ts.pxtc.UF2.toBin(e);r&&(n=o(r.buf))}(1179403647==Oe.HF2.read32(e,0)&&(n=o(e)),58==e[0])&&(n=function(e){if(e){var r,i=0,o=0,a=0,s=0;if(e.split(/\r?\n/).forEach(function(e){var t=/^:10....0[0E]41140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(t)i=parseInt(u(t[1]),16),o=parseInt(u(t[2]),16),a=i+o,r=new Uint8Array(a);else if(0<a){if(!(t=/^:10....0[0E](.*)(..)$/.exec(e)))return;for(var n=t[1];0<a&&0<n.length;)r[s++]=parseInt(n[0]+n[1],16),n=n.slice(2),a--}}),r&&0==a&&s==r.length){for(var t=new Uint8Array(i),n=new Uint8Array(o),c=0;c<i;++c)t[c]=r[c];for(c=0;c<o;++c)n[c]=r[i+c];return{meta:l(t),text:n}}}}(l(e)||""));if(!n||!n.meta||!n.text)return t("This .hex file doesn't contain source.");var i=JSON.parse(n.meta);return i?"LZMA"==i.compression?Oe.lzmaDecompressAsync(n.text).then(function(e){if(!e)return null;var t=e.slice(0,i.headerSize||i.metaSize||0),n=e.slice(t.length);return t&&Oe.Util.jsonCopyFrom(i,JSON.parse(t)),{meta:i,source:n}}):i.compression?t("Compression type "+i.compression+" not supported."):Promise.resolve({source:l(n.text)}):t("This .hex file is not valid.")}e.PkgConflictError=Pe,e.getExtensionInfo=function(c){for(var e={__appVariant:Oe.appTargetVariant||""},t="dal.d.ts",l="/source/",n="",r=[],i=0,o=c.sortedDeps(!0).sort(function(e,t){return"this"==e.id?1:"this"==t.id?-1:Te.strcmp(e.id,t.id)});i<o.length;i++)(ae=o[i]).disablesVariant(Oe.appTargetVariant)||ae.resolvedDependencies().some(function(e){return e.disablesVariant(Oe.appTargetVariant)})?("this"!=ae.id&&(n&&(n+=", "),n+=ae.id),Oe.debug("disable variant "+Oe.appTargetVariant+" due to "+ae.id)):(r.push(ae),ae.addSnapshot(e,[t,".h",".cpp"]));var a=JSON.stringify(e),s=Se[a];if(s){Oe.debug("Using cached extinfo");var u=Te.flatClone(s);return u.disabledDeps=n,u}Oe.debug("Generating new extinfo");var U=pxtc.emptyExtInfo();U.disabledDeps=n;var f=Oe.appTarget.compileService;f||(f={gittag:"none",serviceId:"nocompile"}),f=Te.clone(f);var p=c.getTargetOptions();p||(p={isNative:!1,hasHex:!1,switches:{}});var d=!!f.platformioIni,h="codal"==f.buildEngine||"dockercodal"==f.buildEngine,g="dockermake"==f.buildEngine||"dockercross"==f.buildEngine,S=!d&&!h&&!g,P=p.nativeType==pxtc.NATIVE_TYPE_VM;d?l="/src/":(h||g)&&(l="/pxtapp/");var m="// Configuration defines\n",O="\nPXT_SHIMS_BEGIN\n",N="",I="",v='#include "pxt.h"\n',y="",L=function(e){return y+="   "+b+"("+D+"): "+e+"\n"},D=0,b="",R=_e("namespace"),F=_e("declare namespace"),M=_e("declare namespace"),w="",B={},j={},H={true:"1",false:"0",null:"0",NULL:"0"};function G(e){return e.trim().replace(/[\_\*]$/,"")}for(var k="",x=0,A=r;x<A.length;x++){if(0<=(ae=A[x]).getFiles().indexOf(t)){var T=ae.host().readFile(ae,t);Oe.Util.assert(!!T,t+" not found in "+ae.id),T.split(/\r?\n/).forEach(function(e){var t=/^\s*(\w+) = (.*),/.exec(e);t&&(H[t[1]]=t[2])})}!k&&0<=ae.getFiles().indexOf("Makefile")&&(k=ae.host().readFile(ae,"Makefile"))}var z=["0","false","PXT_UTF8"],V={};function J(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}p.switches.boxDebug&&(V.PXT_BOX_DEBUG=1),p.utf8&&(V.PXT_UTF8=1),p.switches.profile&&(V.PXT_PROFILE=1),p.switches.gcDebug&&(V.PXT_GC_DEBUG=1),p.switches.numFloat&&(V.PXT_USE_FLOAT=1),p.nativeType==pxtc.NATIVE_TYPE_VM&&(V.PXT_VM=1);var q=0,W=!1,$="",Y="",K="",X=!1;function Q(){F.setNs(""),F.write(""),F.write(""),(K||Y)&&(F.write(Y),F.write(K),Y=K="")}function C(e,x){var A;K=Y=$="",X=!1;var T=-1;function C(){var e=$.replace(/Methods$/,"");return e==$?null:e}function E(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return p.shortPointers&&L("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral_":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return G(e)}}function _(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":case"ramint_t":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";case"ImageLiteral_":return"T";case"String":return"S";default:return Te.lookup(B,e)?"I":"_"+e.replace(/[\*_]+$/,"")}}e=e.replace(/^(\s*#\s*if\s+(\w+)\s*$)([^]*?)(^\s*#\s*(elif|else|endif)\s*$)/gm,function(e,t,n,r,i){return 0<=z.indexOf(n)&&!V[n]?t+r.replace(/[^\n]/g,"")+i:e}),W=!1,q=D=0,M.setNs(""),F.setNs(""),e.split(/\r?\n/).forEach(function(e){++D;var t=J(e);!function(e){var t=J(e);if(W&&0<=t.indexOf("}")&&(W=!1,M.write("}")),W){var n=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(t);if(n){var r=n[1],i=n[3],o="";if(i){i=i.trim();var a=Te.lookup(H,i);null!=a&&(o="  // "+i,i=a),null==(q=Ue(i))&&L("cannot determine value of "+t)}else i=++q+"";M.write("    "+G(r)+" = "+i+","+o)}else M.write(e)}}(e);var n,r,i=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(t);if(i&&(n=i[2],r=i[3],W=!0,q=-1,M.write(""),M.write(""),(K||Y)&&(M.write(Y),M.write(K),Y=K=""),M.write("declare const enum "+G(n)+" "+r),B[n]=!0,x||(R.setNs($),R.write("enum "+i[2]+" : int;"))),o=e,!W&&!(/^\s*\/\*\*/.test(o)?(X=!0,Y=o+"\n",/\*\//.test(o)&&(X=!1),1):X?(Y+=o+"\n",/\*\//.test(o)&&(X=!1),1):/^\s*\/\/%/.test(o)&&(K+=o+"\n",1))){var o;/^typedef.*;\s*$/.test(e)&&(R.setNs($),R.write(e));var a=/^\s*namespace\s+(\w+)/.exec(e);if(a)if($=a[1],C()){Q();var s=C();F.setNs($,"declare interface "+s+" {")}else(K||Y)&&(Q(),F.setNs(G($)),M.setNs(G($)));else{if((a=/^PXT_ABI\((\w+)\)/.exec(e))&&!P&&(O+="PXT_FNPTR(::"+a[1]+"),\n",I+='extern "C" void '+a[1]+"();\n",U.functions.push({name:a[1],argsFmt:[],value:0})),(a=/^#define\s+PXT_COMM_BASE\s+([0-9a-fx]+)/.exec(e))&&(U.commBase=parseInt(a[1])),a=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),!K||!a){if(a=/^\s*extern const (\w+) (\w+);/.exec(e),K&&a)return y={name:$+"::"+a[2],argsFmt:[],value:null},U.functions.push(y),P||(O+="PXT_FNPTR(&::"+y.name+"),\n"),void(K="");if(a=/^\s*(\w+)\s+(\w+)\s*;/.exec(e),K&&a){var c=pxtc.parseCommentString(K);c.indexedInstanceNS&&(A=c,F.setNs(c.indexedInstanceNS),T=0);var l=a[1],u=a[2];if(A)return K=K.trim(),K+=" fixedInstance shim="+A.indexedInstanceShim+"("+T+++")",F.write(""),F.write(Y),F.write(K),F.write("const "+u+": "+E(l)+";"),void(K=Y="")}return K&&e.trim()?(L("declaration not understood: "+e),void(Y=K="")):void 0}A=null;var f=pxtc.parseCommentString(K);$||L("missing namespace declaration");var p=(a[1]+a[2]).replace(/\s+/g,""),d=a[3],h=a[4];K=K.trim().replace(/ \w+\.defl=\w+/g,"");var g=[_(p)],m=[],v=h.split(/,/).filter(function(e){return!!e}).map(function(e){var t=function(e,t){t=t.trim();var n=/(.*)=\s*(-?\w+)$/.exec(t),r="",i="";if(n&&(r=n[2],i="?",t=n[1].trim()),!(n=/^(.*?)(\w+)$/.exec(t)))return L("invalid argument: "+t),{name:"???",type:"int"};var o=n[2];e.paramDefl[o]&&(r=e.paramDefl[o],i="?");var a=r?Te.lookup(H,r):null;return null!=a&&(r=a),r&&(null==Ue(r)&&L("Invalid default value (non-integer): "+r),K+=" "+o+".defl="+r),{name:o+i,type:n[1]}}(f,e);return g.push(_(t.type)),m.push(t.type.replace(/ /g,"")),t.name+": "+E(t.type)}),y={name:$+"::"+d,argsFmt:g,value:null};if(Y)if(F.setNs(G($)),F.write(""),F.write(Y),/ImageLiteral/.test(a[4])&&!/imageLiteral=/.test(K)&&(K+=" imageLiteral=1"),K+=" shim="+y.name,F.write(K),d=G(d),C()){var b=(v[0]||"").replace(/^.*:\s*/,"").trim();b.toLowerCase()!=C().toLowerCase()&&L(Ce("Invalid first argument; should be of type '{0}', but is '{1}'",C(),b)),v.shift(),0==v.length&&/\bproperty\b/.test(K)?F.write(d+": "+E(p)+";"):F.write(d+"("+v.join(", ")+"): "+E(p)+";")}else F.write("function "+d+"("+v.join(", ")+"): "+E(p)+";");if(K=Y="",x||(R.setNs($),R.write(p+" "+d+"("+h+");")),U.functions.push(y),S)O+="(uint32_t)(void*)::"+y.name+",\n";else if(P){if(Te.startsWith(y.name,"pxt::op_")||Ee[y.name]||f.expose||!Te.startsWith(y.name,"pxt::")&&!Te.startsWith(y.name,"pxtrt::")){var w=function(e,t){if("FiberContext*"==t[0])return"::"+e.name;var n="_wrp_"+e.name.replace(/:/g,"_");if(j[e.name])return n;j[e.name]=!0,N+="\nvoid "+n+"(FiberContext *ctx) {\n";for(var r=t.length,i=[],o=!1,a="",s=0;s<r;++s){var c=e.argsFmt[s+1],l=t[s],u="I"==c?"toInt":"B"==c?"numops::toBool":"",f=s==r-1?"ctx->r0":"ctx->sp["+(r-s-2)+"]",p="";switch(l){case"TValue":case"TNumber":break;case"Action":u="asRefAction";break;case"String":u="convertToString",p="ctx, ",o=!0;break;default:u||(u="as"+l.replace(/\*/g,""))}a+="  "+l+" a"+s+" = ("+l+") "+u+"("+p+f+");\n",i.push("a"+s)}o&&(N+="  auto prevSP = ctx->sp;\n"),N+=a,o&&(N+="  if (panicCode) { ctx->sp = prevSP; return; }\n");var d="::"+e.name+"("+i.join(", ")+")";return"V"==e.argsFmt[0]?(N+="  "+d+";\n",N+="  ctx->r0 = NULL;\n"):"I"==e.argsFmt[0]?N+="  ctx->r0 = fromInt("+d+");\n":"B"==e.argsFmt[0]?N+="  ctx->r0 = fromBool("+d+");\n":N+="  ctx->r0 = (TValue)"+d+";\n",o&&(N+="  ctx->sp = prevSP;\n"),1<r&&(N+="  ctx->sp += "+(r-1)+";\n"),N+="}\n",n}(y,m),k=y.argsFmt.length-1;O+='{ "'+y.name+'", (OpFun)'+w+", "+k+" },\n"}}else O+="PXT_FNPTR(::"+y.name+"),\n"}}})}var E=Te.clone(f.yottaConfig||{}),_={},Z={};if(S&&p.hasHex){var ee=f;Te.assert(!!ee.yottaCorePackage),Te.assert(!!ee.githubCorePackage),Te.assert(!!ee.gittag);var te=ee.githubCorePackage+"#"+f.gittag;U.yotta.dependencies[ee.yottaCorePackage]=te}if(c)for(var ne=!1,re=function(e){y="",function(e){var t=e.config.platformio;t&&t.dependencies&&Te.jsonCopyFrom(U.platformio.dependencies,t.dependencies),U.npmDependencies&&e.config.npmDependencies&&Te.jsonCopyFrom(U.npmDependencies,e.config.npmDependencies);var n=e.config.yotta;if(n){if(n.dependencies&&Te.jsonCopyFrom(U.yotta.dependencies,n.dependencies),n.config)for(var r=Te.jsonFlatten(n.config),i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=Te.lookup(Z,a),c=r[a];if(!s||s.config.yotta.configIsJustDefaults)Z[a]=e,E[a]=c;else if(E[a]===c);else if(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts){var l=new Pe(Ce("conflict on yotta setting {0} between extensions {1} and {2}",a,e.id,s.id));throw l.pkg0=s,l.pkg1=e,l.settingName=a,l}}if(n.optionalConfig){r=Te.jsonFlatten(n.optionalConfig);for(var u=0,f=Object.keys(r);u<f.length;u++)c=r[a=f[u]],_[a]=c}}}(e),e==c?(ne=!0,F.clear(),M.clear()):Te.assert(!ne);for(var t=function(e){return Te.endsWith(e,".h")},n=0,r=e.getFiles().filter(t).concat(e.getFiles().filter(function(e){return!t(e)}));n<r.length;n++){var i=r[n],o=t(i);if(o||Te.endsWith(i,".cpp")){var a=e.config.name+"/"+i;("base"==e.config.name||/^core($|---)/.test(e.config.name))&&o&&(a=i),o&&(v+='#include "'+(S?l.slice(1):"")+a+'"\n'),null==(s=e.readFile(i))&&Te.userError(Ce("C++ file {0} is missing in extension {1}.",i,e.config.name)),b=a,C(s,o),U.extensionFiles[l+a]=s,0==e.level&&(U.onlyPublic=!1),e.verProtocol()&&"pub"!=e.verProtocol()&&"embed"!=e.verProtocol()&&(U.onlyPublic=!1)}if(Te.endsWith(i,".c")||Te.endsWith(i,".S")||Te.endsWith(i,".s")){var s=e.readFile(i);U.extensionFiles[l+e.config.name+"/"+i.replace(/\.S$/,".s")]=s}}y&&(w+=Ce("Extension {0}:\n",e.id)+y)},ie=0,oe=r;ie<oe.length;ie++){var ae;re(ae=oe[ie])}w&&Te.userError(w),Te.jsonCopyFrom(_,E),Te.iterMap(_,function(e,t){null===t&&delete _[e]}),Object.keys(_).filter(function(e){return/-/.test(e)}).forEach(function(e){var t=_[e];delete _[e],_[e.replace(/-/g,"_")]=t}),!S&&f.yottaConfigCompatibility&&Object.keys(_).forEach(function(e){return _["YOTTA_CFG_"+e]=_[e]});var se=Te.jsonUnFlatten(_);if(g){var ce={name:"pxt-app",private:!0,dependencies:U.npmDependencies};U.generatedFiles["/package.json"]=JSON.stringify(ce,null,4)+"\n"}else if(h){ee=f;var le=Te.clone(ee.codalDefinitions)||{},ue=ee.codalTarget;"string"==typeof ue&&(ue+=".json");var fe={target:ue,definitions:le,config:le,application:"pxtapp",output_folder:"build",pxt_gitrepo:ee.githubCorePackage,pxt_gittag:ee.gittag};Te.iterMap(Te.jsonFlatten(se),function(e,t){e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),le[e]=t}),U.generatedFiles["/codal.json"]=JSON.stringify(fe,null,4)+"\n",Oe.debug("codal.json: "+U.generatedFiles["/codal.json"])}else if(d){var pe=f.platformioIni.slice();pe.push("lib_deps ="),Te.iterMap(U.platformio.dependencies,function(e,t){var n=/[@#\/]/.test(t)?t:e+"@"+t;pe.push("  "+n)}),U.generatedFiles["/platformio.ini"]=pe.join("\n")+"\n"}else{U.yotta.config=se;var de="pxt-app";f.yottaBinary&&(de=f.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""));var he={name:de,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:U.yotta.dependencies,targetDependencies:{},bin:"./source"};U.generatedFiles["/module.json"]=JSON.stringify(he,null,4)+"\n",Oe.debug("module.json: "+U.generatedFiles["/module.json"])}for(var ge=0,me=Object.keys(V);ge<me.length;ge++){var ve=me[ge];m+="#define "+ve+" "+V[ve]+"\n"}if(p.uf2Family&&(m+="#define PXT_UF2_FAMILY "+p.uf2Family+"\n"),U.generatedFiles[l+"pointers.cpp"]=v+R.finish()+I+N+O+"\nPXT_SHIMS_END\n",U.generatedFiles[l+"pxtconfig.h"]=m,Oe.debug("pxtconfig.h: "+U.generatedFiles[l+"pxtconfig.h"]),S&&(U.generatedFiles["/config.json"]=JSON.stringify(se,null,4)+"\n",Oe.debug("yotta config.json: "+U.generatedFiles["/config.json"])),U.generatedFiles[l+"main.cpp"]='\n#include "pxt.h"\n#ifdef PXT_MAIN\nPXT_MAIN\n#else\nint main() {\n    uBit.init();\n    pxt::start();\n    release_fiber();\n    return 0;   // your program will never reach this line.\n}\n#endif\n',k){var ye=Object.keys(U.extensionFiles).concat(Object.keys(U.generatedFiles)),be="",we=function(e,t){var n=ye.filter(function(e){return Te.endsWith(e,t)}).map(function(e){return e.slice(1)});be+=e+" = "+n.join(" ")+"\n"};we("PXT_C",".c"),we("PXT_CPP",".cpp"),we("PXT_S",".s"),we("PXT_HEADERS",".h"),be+="PXT_SOURCES := $(PXT_C) $(PXT_S) $(PXT_CPP)\n",be+="PXT_OBJS := $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",U.generatedFiles["/Makefile"]=k,U.generatedFiles["/Makefile.inc"]=be}U.generatedFiles["/functions.json"]=JSON.stringify(U.functions,null,1);var ke=U.extensionFiles;Te.jsonCopyFrom(ke,U.generatedFiles);var xe={config:f.serviceId,tag:f.gittag,replaceFiles:ke,dependencies:S?U.yotta.dependencies:null},Ae=JSON.stringify(xe);return U.sha=Te.sha256(Ae),U.skipCloudBuild=!!f.skipCloudBuild,U.compileData=ts.pxtc.encodeBase64(Te.toUTF8(Ae)),U.shimsDTS=F.finish(),U.enumsDTS=M.finish(),10<Object.keys(Se).length&&(Se={}),Se[a]=U},e.unpackSourceFromHexFileAsync=function(e){if(e)return Oe.Util.fileReadAsBufferAsync(e).then(function(e){return t(new Uint8Array(e))})},e.unpackSourceFromHexAsync=t}(Oe.cpp||(Oe.cpp={}))}(pxt||(pxt={})),function(h){!function(a){var s,c={},o={};function l(e){var t,o,n,r,i;return c.hasOwnProperty(e.sha)||(c[e.sha]=(t=e,o="",a.showLoading(h.U.lf("Compiling (this may take a minute)...")),(n=t,n.skipCloudBuild?Promise.resolve({hex:["SKIP"]}):h.webConfig&&h.webConfig.isStatic?h.Util.requestAsync({url:h.webConfig.cdnUrl+"hexcache/"+n.sha+".hex"}).then(function(e){if(e.text){var t={enums:[],functions:[],hex:e.text.split(/\r?\n/)};return Promise.resolve(t)}return h.log("Hex info not found in bundled hex cache"),Promise.resolve()}).catch(function(e){return h.log("Error fetching hex info from bundled hex cache"),Promise.resolve()}):h.Cloud.localToken&&window&&h.BrowserUtils.isLocalHost()?(r="compile/"+n.sha,h.Cloud.localRequestAsync(r,i).then(function(e){return e.json})).then(function(e){return e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve(void 0)}).catch(function(e){return Promise.resolve(void 0)}):Promise.resolve(void 0)).then(function(e){return e||function(){if(s)return s;var e=h.getOnlineCdnUrl();if(e)return s=Promise.resolve(e);var t=h.webConfig&&h.webConfig.isStatic;return s=h.Cloud.privateGetAsync("clientconfig",t).then(function(e){return e.primaryCdnUrl})}().then(function(e){return o=e+"/compile/"+t.sha,h.U.httpGetTextAsync(o+".hex")}).then(function(e){return e},function(e){return h.Cloud.privatePostAsync("compile/extension",{data:t.compileData}).then(function(i){return new Promise(function(n,e){var r=function(){var t=i.hex.replace(/\.hex/,".json");return h.log("polling C++ build "+t),h.Util.httpGetJsonAsync(t).then(function(e){h.log("build log "+t.replace(/\.json$/,".log")),e.success?(h.log("fetching "+o+".hex"),n(h.U.httpGetTextAsync(o+".hex"))):(h.log("build failed"),e.mbedresponse&&e.mbedresponse.result&&e.mbedresponse.result.exception&&h.log(e.mbedresponse.result.exception),n(null))},function(e){return setTimeout(r,1e3),null})};r()})})}).then(function(e){return a.hideLoading(),{hex:e&&e.split(/\r?\n/)}})}).finally(function(){a.hideLoading()}))),c[e.sha]}function u(r,i,o,e,a){return void 0===a&&(a=10),r.cacheStoreAsync(o,e).then(function(){return r.cacheGetAsync(i)}).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){console.error("invalid cache entry, clearing entry"),t=[]}(t=t.filter(function(e){return e!=o})).unshift(o);var n=t.slice(a);return t=t.slice(0,a),Promise.map(n,function(e){return r.cacheStoreAsync(e,null)}).then(function(){return r.cacheStoreAsync(i,JSON.stringify(t))})})}function f(n,r,i){return n.cacheGetAsync(r).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){return console.error("invalid cache entry, clearing entry"),n.cacheStoreAsync(r,"[]")}return t[0]!=i?((t=t.filter(function(e){return e!=i})).unshift(i),n.cacheStoreAsync(r,JSON.stringify(t))):null})}a.showLoading=function(e){},a.hideLoading=function(){},a.storeWithLimitAsync=u,a.recordGetAsync=f,a.getHexInfoAsync=function(r,n,e){if(!n.sha)return Promise.resolve(null);var t=o[n.sha];if(t)return Promise.resolve(t);h.debug("get hex info: "+n.sha);var i="hex-"+n.sha;return r.cacheGetAsync(i).then(function(e){var t;try{t=e?JSON.parse(e):null}catch(e){console.log("invalid cache entry, clearing entry"),t=null}return t&&t.hex?(h.debug("cache hit, size="+e.length),t.hex=function(e){for(var t=[],n=0;n<e.length;n++){var r=/^([@!])(....)$/.exec(e[n]);if(r){var i=parseInt(r[2],16),o=e[++n],a="";if("@"==r[1]){a="";for(var s=parseInt(o,16);0<s--;)a+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else a=ts.pxtc.decodeBase64(o);h.Util.assert(0<a.length),h.Util.assert(a.length%16==0);for(var c=0;c<a.length;){var l=[16,i>>8&255,255&i,0];i+=16;for(var u=0;u<16;++u)l.push(a.charCodeAt(c++));for(var f=0,u=0;u<l.length;++u)f+=l[u];l.push(255&-f);for(var p=":",u=0;u<l.length;++u){var d=255&l[u];d<=15&&(p+="0"),p+=d.toString(16)}t.push(p.toUpperCase())}}else t.push(e[n])}return t}(t.hex),f(r,"hex-keys",i).then(function(){return t})):l(n).then(function(e){var t=e.hex;e.hex=function(e){for(var t=[],n=0,r=0;r<e.length;r+=n){var i=-1,o="";n=0;for(var a=!1;n<500;){var s=/^:10(....)00(.{32})(..)$/.exec(e[r+n]);if(!s)break;var c=s[2],l=/^0+$/.test(c),u=parseInt(s[1],16);if(-1==i)a=l,t.push((a?"@":"!")+s[1]),i=u-16;else{if(l!=a)break;if(i+16!=u)break}a||(o+=c),i=u,n++}if(0==n)t.push(e[r]),n=1;else if(a)t.push(n.toString(16));else{for(var f="",p=0;p<o.length;p+=2)f+=String.fromCharCode(parseInt(o.slice(p,p+2),16));t.push(ts.pxtc.encodeBase64(f))}}return t}(e.hex);var n=JSON.stringify(e);return e.hex=t,u(r,"hex-keys",i,n).then(function(){return e})}).catch(function(e){return h.reportException(e,{sha:n.sha}),Promise.resolve(null)})}).then(function(e){return e&&(20<Object.keys(o).length&&(o={}),o[n.sha]=e),e})}}(h.hexloader||(h.hexloader={}))}(pxt||(pxt={})),function(h){!function(a){function n(e,t,n,r,i){if(void 0===n&&(n={}),void 0===r&&(r=null),void 0===i&&(i=null),a.testMode||e==a.TEST_KEY){var o={success:!0};return Promise.resolve({statusCode:200,headers:{},text:JSON.stringify(o),json:o})}return h.Util.multipartPostAsync(t,n,r,i)}function p(e,t,n,r,i){h.Util.assert(!!t&&!!n&&!!r);var o="https://api.crowdin.com/api/project/"+t+"/";return i=i||{},a.testMode?delete i.key:i.key=n,e&&(i.branch=e),o+r+"?"+Object.keys(i).map(function(e){return e+"="+encodeURIComponent(i[e])}).join("&")}function e(e){var t=0;return function(){if(10<t++)throw new Error("Too many API calls for "+e)}}function d(r,i,o,a,s){return a=t(a),h.debug("create directory "+(r||"")+"/"+a),s||(s=e(a)),n(o,p(r,i,o,"add-directory"),{json:"true",name:a}).then(function(e){if(h.debug("crowdin resp: "+e.statusCode),200==e.statusCode||400==e.statusCode)return Promise.resolve();if(500==e.statusCode&&e.text&&50===JSON.parse(e.text).error.code)return h.log("directory already exists"),Promise.resolve();var t=e.json||JSON.parse(e.text)||{error:{}};if(404==e.statusCode&&17==t.error.code){h.log("parent directory missing for "+a);var n=a.replace(/\/[^\/]+$/,"");if(n!=a)return d(r,i,o,n,s).then(function(){return d(r,i,o,a,s)})}throw new Error("cannot create directory "+(r||"")+"/"+a+": "+e.statusCode+" "+JSON.stringify(t))})}function t(e){return e.replace(/\\/g,"/")}function i(e,t){var n=h.appTarget.versions.pxtCrowdinBranch||"",r=h.appTarget.versions.targetCrowdinBranch||"",i=[];if(e.forEach(function(e){return function t(n,r,i,o){var e=r.name,a=i?i+"/"+e:e;switch(r.fullName=a,r.branch=o||"",r.node_type){case"file":n.push(r);break;case"directory":(r.files||[]).forEach(function(e){return t(n,e,a,o)});break;case"branch":(r.files||[]).forEach(function(e){return t(n,e,i,r.name)})}}(i,e,"")}),i=i.filter(function(e){return e.fullName.indexOf("/")<0?e.branch==n:e.branch==r}),t&&(i=i.filter(function(e){return 0==e.fullName.indexOf(t)})),"core"!=h.appTarget.id){var o=h.appTarget.id+"/";i=i.filter(function(e){return e.fullName.indexOf("/")<0||e.fullName.substr(0,o.length)==o||0<=e.fullName.indexOf("common-docs")})}return i}function r(e,t){var n=p("",e,t,"info",{json:"true"});return h.Util.httpGetTextAsync(n).then(function(e){return JSON.parse(e)})}a.KEY_VARIABLE="CROWDIN_KEY",a.testMode=!1,a.TEST_KEY="!!!testmode!!!",a.setTestMode=function(){h.crowdin.testMode=!0,h.log("CROWDIN TEST MODE - files will NOT be uploaded")},a.downloadTranslationsAsync=function(a,s,c,l,u){void 0===u&&(u={});var e=p(a,s,c,"info",{json:"true"}),f={};return l=t(l),h.Util.httpGetTextAsync(e).then(function(e){var t=JSON.parse(e);if(!t)throw new Error("info failed");var i=t.languages.filter(function(e){return"en"!=e.code});h.appTarget&&h.appTarget.appTheme&&h.appTarget.appTheme.availableLocales&&(i=i.filter(function(e){return-1<h.appTarget.appTheme.availableLocales.indexOf(e.code)})),h.log("languages: "+i.map(function(e){return e.code}).join(", "));var o=function(){var n=i.pop();if(!n)return Promise.resolve();var r=p(a,s,c,"export-file",{file:l,language:n.code,export_translated_only:u.translatedOnly?"1":"0",export_approved_only:u.validatedOnly?"1":"0"});return h.log("downloading "+n.name+" - "+n.code+" ("+i.length+" more)"),h.Util.httpGetTextAsync(r).then(function(e){try{var t=JSON.parse(e);t&&(f[n.code]=t)}catch(e){h.log(r+" "+e)}return o()}).delay(1e3)};return o()}).then(function(){return f})},a.createDirectoryAsync=d,a.uploadTranslationAsync=function r(i,o,a,s,c){h.Util.assert(!!o),h.Util.assert(!!a);var l=e(s=t(s));function u(){return f("update-file",{update_option:"update_as_unapproved"})}function f(e,t){return t.type="auto",t.json="",t.escape_quotes="0",l(),n(a,p(i,o,a,e),t,s,c).then(function(e){return function(e){var t=e.statusCode,n=h.Util.jsonTryParse(e.text)||{};if(h.debug("upload result: "+t),404==t&&n.error&&8==n.error.code)return h.log("create new translation file: "+s),f("add-file",{});if(404==t&&n.error&&17==n.error.code)return d(i,o,a,s.replace(/\/[^\/]+$/,""),l).then(function(){return u()});if(!n.success&&n.error&&53==n.error.code)return h.log(s+" being updated, waiting 5s and retry..."),Promise.delay(5e3).then(function(){return r(i,o,a,s,c)});if(200==t||n.success)return Promise.resolve();throw new Error("Error, upload translation: "+s+", "+t+", "+e.text)}(e)})}return u()},a.projectInfoAsync=r,a.listFilesAsync=function(e,t,n){return h.log("crowdin: listing files under "+n),r(e,t).then(function(e){if(!e)throw new Error("info failed");var t=i(e.files,n);return h.debug("crowdin: found "+t.length+" under "+n),t.map(function(e){return{fullName:e.fullName,branch:e.branch||""}})})},a.languageStatsAsync=function(e,t,n){var r=p("",e,t,"language-status",{language:n,json:"true"});return h.Util.httpGetJsonAsync(r).then(function(e){return i(e.files)})},a.inContextLoadAsync=function(r){var i=document.createElement("input");i.type="text",i.setAttribute("class","hidden"),i.value=r;var e=new Promise(function(t,e){var n=new MutationObserver(function(){if(r!=i.value){var e=h.Util.rlf(i.value);i.remove(),n.disconnect(),t(e)}});n.observe(i,{attributes:!0})});return document.body.appendChild(i),e}}(h.crowdin||(h.crowdin={}))}(pxt||(pxt={})),function(w){!function(e){function B(e){return e?e.split(/\r?\n/):[]}function y(e,t,a){void 0===a&&(a={}),a.ignoreWhitespace&&(e=e.replace(/[\r\n]+$/,""),t=t.replace(/[\r\n]+$/,""));var n=B(e),r=B(t),o=Math.min(a.maxDiffSize||1024,n.length+r.length);if(0==o)return[];var s=65520<n.length?Uint32Array:Uint16Array,c={},l=0,u=i(n),f=i(r);function i(e){for(var t=new s(e.length),n=0,r=0,i=e;r<i.length;r++){var o=i[r];a.ignoreWhitespace&&(o=o.replace(/\s+$/g,"").replace(/^\s+/g,"")),c.hasOwnProperty(o)?t[n]=c[o]:(++l,t[n]=l,c[o]=l),n++}return t}for(var p=new s(2*o+1),d=-1,h=0;h<=o;h++)null!=M(h,p)&&(d=h);if(-1==d)return null;var g=[],m=null;for(h=0;h<=d;h++){var v=g.length?g[g.length-1].slice(0):new s(2*d+1);if(g.push(v),null!=(m=M(h,v)))break}var y=[],b=m;for(h=g.length-1;0<=h;h--){for(var w=g[h],k=0,x=0,A=(k=b==-h||b!=h&&w[o+b-1]<w[o+b+1]?w[o+(x=b+1)]:w[o+(x=b-1)]+1)-b,T=w[o+b]-k-1;0<=T;--T)y.push("  "+r[A+T]);x==b-1?y.push("- "+n[k-1]):0<A&&y.push("+ "+r[A-1]),b=x}if(y.reverse(),a.context==1/0||a.full)return y;for(var C=1,E=1,_=0,U=[],S=a.context||3;_<y.length;){for(var P=_;P<y.length&&" "==y[P][0];)P++;if(P==y.length)break;var O=P-S,N=O-_;0<N&&(C+=N,E+=N,_=O);var I=U.length,L=C,D=E;U.push("@@");for(var R=_,F=0;R<y.length;){if(" "==y[R][0]){if(2*S+2<++F){R-=S+2;break}}else F=0;R++}for(;_<R;){switch(U.push(y[_]),y[_][0]){case"-":C++;break;case"+":E++;break;case" ":C++,E++}_++}U[I]="@@ -"+L+","+(C-L)+" +"+D+","+(E-D)+" @@"}return U;function M(e,t){for(var n=-e;n<=e;n+=2){for(var r=0,i=(r=n==-e||n!=e&&t[o+n-1]<t[o+n+1]?t[o+n+1]:t[o+n-1]+1)-n;r<u.length&&i<f.length&&u[r]==f[i];)r++,i++;if((t[o+n]=r)>=u.length&&i>=f.length)return n}return null}}function o(e){return B(e).map(function(e){return e.replace(/;\s*$/,"")}).join("\n")}function b(e){var t=/^@@ -(\d+),(\d+) \+(\d+),(\d+)/.exec(e);return t&&{oldStart:parseInt(t[1])-1,oldLength:parseInt(t[2]),newStart:parseInt(t[3])-1,newLength:parseInt(t[4])}}e.toLines=B,e.compute=y,e.diff3=function(e,c,t,n,r){var i=v(e),o=v(t);if(i&&o){for(var a=B(e),s=B(t),l=0,u=[],f=0,p=0,d=0;d<i.length-1;)if(i[d]==f&&o[d]==p)u.push(a[f]),f++,p++,d++;else{for(var h=!0,g=!0,m=d;m<i.length&&(i[m]!=f+m-d&&(h=!1),o[m]!=p+m-d&&(g=!1),null==i[m]||null==o[m]);)m++;if(w.U.assert(m<i.length),h)for(;p<o[m];)u.push(s[p++]);else if(g)for(;f<i[m];)u.push(a[f++]);else if(a.slice(f,i[m]).join("\n")==s.slice(p,o[m]).join("\n"))for(;f<i[m];)u.push(a[f++]);else{for(l++,u.push("<<<<<<< "+n);f<i[m];)u.push(a[f++]);for(u.push("=======");p<o[m];)u.push(s[p++]);u.push(">>>>>>> "+r)}f=i[d=m],p=o[m]}return{merged:u.join("\n"),numConflicts:l}}function v(e){var t=y(c,e,{context:1/0});if(t){for(var n=[],r=0,i=0,o=0,a=t;o<a.length;o++){var s=a[o];"+"==s[0]?r++:"-"==s[0]?(n[i]=null,i++):" "==s[0]?(n[i]=r,r++,i++):w.U.oops()}return n.push(r+1),n}}},e.removeTrailingSemiColumns=o,e.split=function(e,t){var n=e.split(/-{10,}/,2);if(n.length<2)return{fileA:e,fileB:void 0};var r=n[0].replace(/\n$/,""),i=n[1].replace(/^\n/,"");return t&&t.removeTrailingSemiColumns&&(r=o(r),i=o(i)),{fileA:r,fileB:i}},e.parseDiffMarker=b,e.render=function(e,t,u){void 0===u&&(u={});var f=y(e,t,u);if(!f)return w.dom.el("div",null,pxtc.Util.lf("Too many differences to render diff."));var p={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},d=0,h=0,g="",m=w.dom.el("tbody"),n=w.dom.el("table",{class:"diffview "+(u.update?"update":"")},m),v=null;return f.forEach(function(e,t){var n=b(e);n?(d=n.oldStart,h=n.newStart):("+"!=e[0]&&d++,"-"!=e[0]&&h++);var r=f[t+1]?f[t+1][0]:"",i=f[t+2]?f[t+2][0]:"",o=e.slice(2),a=w.dom.el("code",null,o);if(v)a=v,v=null;else if(!("-"!=e[0]||" "!=g&&"@"!=g||"+"!=r||" "!=i&&"@"!=i&&""!=i)){var s=function(e,t){var n=y(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!n)return{a:w.dom.el("div",{class:"inline-diff"},w.dom.el("code",null,e)),b:w.dom.el("div",{class:"inline-diff"},w.dom.el("code",null,t))};for(var r=[],i=[],o=0;o<n.length;){for(var a=o,s=n[o][0];n[a]&&n[a][0]==s;)a++;var c=n.slice(o,a).map(function(e){return e.slice(2)}).join("");" "==s?(r.push(w.dom.el("code",{class:"ch-common"},c)),i.push(w.dom.el("code",{class:"ch-common"},c))):"-"==s?r.push(w.dom.el("code",{class:"ch-removed"},c)):"+"==s?i.push(w.dom.el("code",{class:"ch-added"},c)):w.Util.oops(),o=a}return{a:w.dom.el("div",{class:"inline-diff"},r),b:w.dom.el("div",{class:"inline-diff"},i)}}(e.slice(2),f[t+1].slice(2));a=s.a,v=s.b}if(g=e[0],!(u.hideMarkerLine&&"@"==g||u.hideRemoved&&"-"==g)){var c="@"==g,l=""+p[g];m.appendChild(w.dom.el("tr",{class:l},[!u.hideLineNumbers&&w.dom.el("td",{class:"line-a","data-content":d}),!u.hideLineNumbers&&w.dom.el("td",{class:"line-b","data-content":h}),c&&w.dom.el("td",{colspan:2,class:"change"},w.dom.el("code",null,e)),!u.hideMarker&&!c&&w.dom.el("td",{class:"marker","data-content":g}),!c&&w.dom.el("td",{class:"change"},a)]))}}),n},e.resolveMergeConflictMarker=function(e,t,n,r){for(var i=w.diff.toLines(e),o=t;o<i.length&&!/^<<<<<<<[^<]/.test(i[o]);)o++;for(var a=o+1;a<i.length&&!/^=======$/.test(i[a]);)a++;for(var s=a+1;s<i.length&&!/^>>>>>>>[^>]/.test(i[s]);)s++;if(s>=i.length)return w.debug("diff marker mistmatch: "+i.length+" -> "+o+" "+a+" "+s),e;if(i[o]=void 0,i[a]=void 0,i[s]=void 0,!n)for(var c=o;c<=a;++c)i[c]=void 0;if(!r)for(c=a;c<=s;++c)i[c]=void 0;return i.filter(function(e){return void 0!==e}).join("\n")},e.mergeDiff3Config=function(e,t,n){var r=w.Util.jsonTryParse(e),i=w.Util.jsonTryParse(t),o=w.Util.jsonTryParse(n);if(r&&!o)return e;if(!r)return n||t;if(!i&&o&&(i=o),r&&i&&o){delete r.installedVersion,delete i.installedVersion,delete o.installedVersion;for(var a={},s=0,c=w.U.unique(Object.keys(i).concat(Object.keys(r)).concat(Object.keys(o)),function(e){return e});s<c.length;s++){var l=c[s],u=r[l],f=i[l],p=o[l];if(JSON.stringify(u)==JSON.stringify(p))void 0!==u&&(a[l]=u);else switch(l){case"name":a[l]=(m=p,(h=u)==(g=f)?m:m==g?h:h==lf("Untitled")?m:h);break;case"version":a[l]=0<w.semver.strcmp(u,p)?u:p;break;case"languageRestriction":case"preferredEditor":case"targetVersion":a[l]=u;break;case"public":a[l]=u&&p;break;case"files":case"testFiles":if(!(d=v(u||[],f||[],p||[])))return;a[l]=d.length?d:void 0;break;case"dependencies":case"testDependencies":var d=y(u||{},f||{},p||{});if(Object.keys(d).length)return;a[l]=d;break;case"description":if(u&&!p)a[l]=u;else{if(u||!p)return;a[l]=p}break;default:return}}return w.Package.stringifyConfig(a)}var h,g,m;function v(e,t,n){for(var r=[],i=0,o=w.U.unique(t.concat(e).concat(n),function(e){return e});i<o.length;i++){var a=o[i],s=-1<e.indexOf(a),c=-1<n.indexOf(a),l=-1<t.indexOf(a);s==c?s&&r.push(a):c==l?s&&r.push(a):c&&r.push(a)}return r}function y(e,t,n){for(var r={},i=0,o=w.U.unique(Object.keys(t).concat(Object.keys(e)).concat(Object.keys(n)),function(e){return e});i<o.length;i++){var a=o[i],s=e[a],c=n[a],l=t[a];if(s==c)s&&(r[a]=s);else{var u=w.github.parseRepoId(s),f=w.github.parseRepoId(c);if(u&&f&&w.semver.tryParse(u.tag)&&w.semver.tryParse(f.tag)&&u.owner&&u.project&&u.owner==f.owner&&u.project==f.project){var p=0<w.semver.strcmp(u.tag,f.tag)?u.tag:f.tag;r[a]="github:"+u.owner+"/"+u.project+"#"+p}else c==l?s&&(r[a]=s):c&&(r[a]=c)}}return r}},e.hasMergeConflictMarker=function(e){return e&&/^(<<<<<<<[^<]|>>>>>>>[^>])/m.test(e)},e.reconstructConfig=function(t,e,n){var r={},i=e.tree.tree.map(function(e){return e.path}).filter(function(e){return/\.(ts|blocks|md|jres|asm|json)$/.test(e)}).filter(function(e){return e!=w.CONFIG_NAME});return i.find(function(e){return/\.ts$/.test(e)})||(n.config.files.filter(function(e){return i.indexOf(e)<0}).forEach(function(e){i.push(e),t[e]=n.files[e]}),w.Util.jsonCopyFrom(r,n.config.dependencies)),Object.keys(r).length||(r[w.appTarget.corepkg]="*"),{name:"",files:i,dependencies:r,preferredEditor:i.find(function(e){return/.blocks$/.test(e)})?w.BLOCKS_PROJECT_NAME:w.JAVASCRIPT_PROJECT_NAME}}}(w.diff||(w.diff={}))}(pxt||(pxt={})),function(r){var e;(e=r.discourse||(r.discourse={})).extractSharedIdFromPostUrl=function(e){return r.Util.httpGetJsonAsync(e+".json").then(function(e){return e.post_stream&&e.post_stream.posts&&e.post_stream.posts[0]&&e.post_stream.posts[0].link_counts.map(function(e){return r.Cloud.parseScriptId(e.url)}).filter(function(e){return!!e})[0]})},e.topicsByTag=function(n,e){var t=(n=n.replace(/\/$/,""))+"/tags/"+e+".json";return r.Util.httpGetJsonAsync(t).then(function(e){var t=r.Util.toDictionary(e.users,function(e){return e.id.toString()});return e.topic_list.topics.map(function(e){return{id:e.id,title:e.title,url:n+"/t/"+e.slug+"/"+e.id,imageUrl:e.image_url,author:t[e.posters[0].user_id].username,cardType:"forumUrl"}})})}}(pxt||(pxt={})),function(l){!function(E){var _,P=pxtc.Util,O={},N={},e="\x3c!-- @CMD@ @ARGS@ --\x3e",I={parent:e,short:e,description:"\x3c!-- desc --\x3e",activities:"\x3c!-- activities --\x3e",explicitHints:"\x3c!-- hints --\x3e",flyoutOnly:"\x3c!-- flyout --\x3e",hideIteration:"\x3c!-- iter --\x3e",codeStart:"\x3c!-- start --\x3e",codeStop:"\x3c!-- stop --\x3e",autoOpen:"\x3c!-- autoOpen --\x3e"};function t(e,t,n){return e.split(t).join(n)}function n(e){return e=t(e=t(e=t(e=t(e=t(e,"&","&amp;"),"<","&lt;"),">","&gt;"),'"',"&quot;"),"'","&#39;")}function L(e){return e?n(e.replace(/\&([#a-z0-9A-Z]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}})):e}E.htmlQuote=n,E.html2Quote=L;var U=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}];E.requireMarked=function(){return"undefined"!=typeof marked?marked:"undefined"!=typeof require?require("marked"):void 0},E.requireDOMSanitizer=function(){return"undefined"!=typeof DOMPurify?DOMPurify.sanitize:"undefined"!=typeof require?require("DOMPurify").sanitize:void 0};var D=function(e){return"<div class='ui negative message'>"+n(e)+"</div>"};function S(i){var o=P.clone(O),a=P.clone(N),s=P.clone(I),c={},l={},e=i.params,t=i.theme;i.boxes=o,i.macros=a,i.settings=s,i.html=i.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,function(e,t,n){var r=function(e){for(var t={};e.trim();){var n=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(e);if(n){var r=n[3]||n[4]||n[5]||"";t[n[1].toLowerCase()]=r}else t[(n=/^\s*(\S+)/.exec(e))[1]]="true";e=e.slice(n[0].length)}return t}(t),i=r["data-name"]||r.id;return i?(/box/.test(r.class)?o[i]=n:/aside/.test(r.class)?o[i]="\x3c!-- BEGIN-ASIDE "+i+" --\x3e"+n+"\x3c!-- END-ASIDE --\x3e":/setting/.test(r.class)?s[i]=n:/menu/.test(r.class)?c[i]=n:/toc/.test(r.class)?l[i]=n:a[i]=n,"\x3c!-- macro "+i+" --\x3e"):D("id or data-name missing on macro")});var u=function(e,t){var n=c.item,r={NAME:e.name};if(e.subitems)n=c["toc-dropdown"]?c["toc-dropdown"]:0==t?c["top-dropdown"]:c["inner-dropdown"],r.ITEMS=e.subitems.map(function(e){return u(e,t+1)}).join("\n");else{if(/^-+$/.test(e.name)&&(n=c.divider),e.path&&!/^(https?:|\/)/.test(e.path))return D("Invalid link: "+e.path);r.LINK=e.path}return M(n,r,["ITEMS"])},f=[{name:lf("Docs"),href:"/docs"}],n=i.TOC||t.TOC||[],p=[],d=function(e){for(var t=0,n=e.subitems||[];t<n.length;t++){var r=n[t];if(d(r))return p.push(e),!0}return!(!i.filepath||!e.path||0!=i.filepath.indexOf(e.path))&&(p.push(e),!0)};n.forEach(d);var h=function(e,t){var n=l.item,r={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?D("Invalid link: "+e.path):(/^\//.test(e.path)&&i.versionPath&&(e.path="/"+i.versionPath+e.path),r.LINK=e.path,0<=p.indexOf(e)?(r.ACTIVE="active",r.EXPANDED="true",f.push({name:e.name,href:e.path})):r.EXPANDED="false",e.subitems&&0<e.subitems.length?(n=l["toc-dropdown"]?""!==e.name?l["toc-dropdown"]:l["toc-dropdown-noLink"]:0==t?""!==e.name?l["top-dropdown"]:l["top-dropdown-noHeading"]:1==t?l["inner-dropdown"]:l["nested-dropdown"],r.ITEMS=e.subitems.map(function(e){return h(e,t+1)}).join("\n")):/^-+$/.test(e.name)&&(n=l.divider),M(n,r,["ITEMS"]))};e.menu=(t.docMenu||[]).map(function(e){return u(e,0)}).join("\n"),e.TOC=n.map(function(e){return h(e,0)}).join("\n"),t.appStoreID&&(e.appstoremeta='<meta name="apple-itunes-app" content="app-id='+P.htmlEscape(t.appStoreID)+'"/>');var r="";1<f.length&&(r='\n            <nav class="ui breadcrumb" aria-label="'+lf("Breadcrumb")+'">\n                '+f.map(function(e,t){return'<a class="'+(t==f.length-1?"active":"")+' section"\n                        href="'+L(e.href)+'" aria-current="'+(t==f.length-1?"page":"")+'">'+L(e.name)+"</a>"}).join('<i class="right chevron icon divider"></i>')+"\n            </nav>"),e.breadcrumb=r,t.boardName&&(e.boardname=L(t.boardName)),t.boardNickname&&(e.boardnickname=L(t.boardNickname)),t.driveDisplayName&&(e.drivename=L(t.driveDisplayName)),t.homeUrl&&(e.homeurl=L(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.docsheader=t.docsHeader||"Documentation",e.targetlogo=t.docsLogo?'<img aria-hidden="true" role="presentation" class="ui '+(t.logoWide?"small":"mini")+' image" src="'+t.docsLogo+'" />':"";var g=i.ghEditURLs||[];if(g.length){for(var m='<p style="margin-top:1em">\n',v=lf("Edit this page on GitHub"),y=0,b=g;y<b.length;y++){m+='<a href="'+b[y]+'"><i class="write icon"></i>'+v+"</a><br>\n",v=lf("Edit template of this page on GitHub")}m+="</p>\n",e.github=m}else e.github="";var w='\n            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">'+lf("Skip to main content")+"</a>\n        ";e.accMenu=w;var k=lf("Print this page"),x='\n            <button id="printbtn" class="circular ui icon right floated button hideprint" title="'+k+'" aria-label="'+k+'">\n                <i class="icon print"></i>\n            </button>\n        ';e.printBtn=x;var A='\n            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="'+lf("Side menu")+'" role="menuitem" aria-expanded="false">\n                <i class="content icon"></i>\n            </a>\n        ';e.sidebarToggle=A;var T=["tocsearch1","tocsearch2"].map(function(e){return'\n                <input type="search" name="q" placeholder="'+lf("Search...")+'" aria-label="'+lf("Search Documentation")+'">\n                <i onclick="document.getElementById(\''+e+'\').submit();" tabindex="0" class="search link icon" aria-label="'+lf("Search")+'" role="button"></i>\n            '});e.searchBar1=T[0],e.searchBar2=T[1];var C="";t.accentColor&&(C+="\n.ui.accent { color: "+t.accentColor+"; }\n.ui.inverted.accent { background: "+t.accentColor+"; }\n"),e.targetstyle=C,e.tocclass=t.lightToc?"lighttoc":"inverted";for(var E=0,_=Object.keys(t);E<_.length;E++){var U=_[E],S=t[U];void 0===e[U]&&"string"==typeof S&&(e[U]=S)}i.finish=function(){return M(i.html,e,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}}function R(e){e.image=function(e,t,n){var r='<img class="ui image" src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=' loading="lazy"',r+=this.options.xhtml?"/>":">"},e.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?'<li class="'+(" "==t[1]?"unchecked":"checked")+'">'+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"},e.heading=function(e,t,n){var r=/(.*)#([\w\-]+)\s*$/.exec(e),i="";return r?(e=r[1],i=r[2]):i=n.toLowerCase().replace(/[^\w]+/g,"-"),e&&(e=e.replace(/@(fullscreen|unplugged)/g,"")),"<h"+t+' id="'+this.options.headerPrefix+i+'">'+e+"</h"+t+">"}}function F(e,i){return e.replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,function(e,t,n,r){return"ifdef"==t&&i[n]||"ifndef"==t&&!i[n]?"\x3c!-- "+t+" "+n+" --\x3e"+r+"\x3c!-- endif --\x3e":"\x3c!-- "+t+" "+n+" endif --\x3e"})}function M(e,r,i){return void 0===i&&(i=[]),e?e.replace(/@(\w+)@/g,function(e,t){var n=P.lookup(r,t)||"";return n+="",i.indexOf(t)<0&&(n=L(n)),n}):""}E.prepTemplate=S,E.setupRenderer=R,E.renderConditionalMacros=F,E.renderMarkdown=function(p){var e=!0;p.pubinfo||(e=!1,p.pubinfo={});var d=p.pubinfo;if(p.theme||(p.theme={}),delete p.pubinfo.private,d.time){var t=parseInt(d.time);d.timems||(d.timems=1e3*t+""),d.humantime||(d.humantime=P.isoTime(t))}d.name&&(d.dirname=d.name.replace(/[^A-Za-z0-9_]/g,"-"),d.title=d.name),e&&(d.JSON=JSON.stringify(d,null,4).replace(/</g,"\\u003c"));var n=p.template;n=F(n=n.replace(/<!--\s*@include\s+(\S+)\s*-->/g,function(e,t){return"\x3c!-- include "+t+" --\x3e\n"+((p.theme.htmlDocIncludes||{})[t]||"")+"\n\x3c!-- end include --\x3e\n"}),d),p.locale&&(n=B(n,p.locale).text);var h={html:n,theme:p.theme,filepath:p.filepath,versionPath:p.versionPath,ghEditURLs:p.ghEditURLs,params:d,TOC:p.TOC};S(h),_||(_=E.requireMarked());var o=new _.Renderer;R(o);var a=o.link;o.link=function(e,t,n){var r=new RegExp("^[/#]").test(e),i=r?"":"_blank";return r&&h.versionPath&&(e="/"+h.versionPath+e),a.call(o,e,t,n).replace(/^<a /,"<a "+(i?'target="'+i+'"':"")+' rel="nofollow noopener" ')};var r=E.requireDOMSanitizer();_.setOptions({renderer:o,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:r,smartLists:!0,smartypants:!0});var i=p.markdown;p.repo&&(i+="\n```package\n"+p.repo.name.replace(/^pxt-/,"")+"=github:"+p.repo.fullName+"#"+(p.repo.tag||"master")+"\n```\n"),i=(i=i.replace(/^\s*https?:\/\/(\S+)\s*$/gm,function(e,t){for(var n=function(e){var n=e.rx.exec(t);if(n)return{value:e.cmd.replace(/\$(\d+)/g,function(e,t){return n[parseInt(t)]||""})+"\n"}},r=0,i=U;r<i.length;r++){var o=n(i[r]);if("object"==typeof o)return o.value}return e})).replace(/@([a-z]+)@/gi,function(e,t){var n=d[t];return!n&&p.throwOnError&&P.userError("unknown macro "+t),n||"unknown macro"});var s=_(i);s=(s=s.replace(/&lt;br\s*\/&gt;/gi,"<br/>")).replace(/(<img [^>]* src=")\/docs\/static\/([^">]+)"/g,function(e,t,n){return t+"/static/"+n+'"'});var g="",m=0;function v(e,t,n){var r=n;return e<=m&&(r=g+r,g="",m=0),r}if(s=s.replace(/<h(\d)[^>]+>\s*([~@])?\s*(.*?)<\/h\d>/g,function(e,t,n,r){var i=/^(\w+)\s+(.*)/.exec(r),o=i?i[1]:r,a=i?i[2]:"";if(a=L(a),o=L(o),t=parseInt(t),n){if("@"==n){var s=P.lookup(h.settings,o);if(null!=s)d[o]=a;else if(null==(s=P.lookup(h.macros,o)))return p.throwOnError&&P.userError("Unknown command: @"+o),D("Unknown command: @"+o);return v(t,0,M(s,{ARGS:a,CMD:o},["ARGS","CMD"]))}if(!o){var c=g;return g="",c}var l=P.lookup(h.boxes,o);if(l){var u=l.split("@BODY@");c=v(t,0,u[0].replace("@ARGS@",a)),g=u[1];var f=l.match(/data-[^>\s]+/gi);return f&&0<=f.indexOf("data-inferred")&&(m=t),c}return p.throwOnError&&P.userError("Unknown box: ~ "+o),D("Unknown box: ~ "+o)}return v(t,0,e)}),g&&(s+=g),!d.title){var c=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(s);c&&(d.title=L(c[1]))}if(!d.description){var l=/<p>([^]+?)<\/p>/.exec(s);l&&(d.description=L(l[1]))}var u=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(s)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(s);u&&(d.cardLogo=L(u[1])),d.twitter=L(p.theme.twitter||"@msmakecode");var f,y,b={main:""};s=(s=s.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,function(e,t,n){var r=P.lookup(b,t);return b[t]=(r||"")+n,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),b.main=s,s="";for(var w=0,k=Object.keys(b);w<k.length;w++){var x=k[w];s+=(f=x+"-container",y=b[x],M(h.boxes[f]||"@BODY@",{BODY:y},["BODY"]))}d.body=s,d.name=d.title||"";for(var A=0,T=Object.keys(p.theme);A<T.length;A++){x=T[A];var C=p.theme[x];"string"==typeof C&&(d["theme_"+x]=C)}return h.finish()},E.embedUrl=function(e,t,n,r){return'<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"#"+t+":"+n+'" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>'},E.runUrl=function(e,t,n){return'<div style="position:relative;height:0;padding-bottom:'+t+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"?id="+encodeURIComponent(n)+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>'},E.codeEmbedUrl=function(e,t,n){var r=e+"---codeembed#pub:"+t;return'<div style="position:relative;height:calc('+(n=Math.ceil(n||300))+'px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+r+'" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-scripts allow-same-origin"></iframe></div>'};var c={b:1,strong:1,em:1};function B(e,i){var o={};function a(e){var t=/^(\s*)([^]*?)(\s*)$/.exec(e),n=t[2].replace(/\s+/g," ");if(""==n||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(n))return null;var r=P.lookup(i,n);return r?n=r:o[n]="",t[1]+n+t[3]}function s(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}return{text:e=(e=(e=(e="<start>"+(e=e.replace(/<([\/\w]+)([^<>]*)>/g,function(e,t,n){var r=t.replace(/^\//,"").toLowerCase();return 1===c[r]?"&llt;"+t+n+"&ggt;":e}))).replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,function(e,t,n,r,i){if("script"==n||"style"==n)return s(e);var o=a(s(i));return null==o?s(e):t+o})).replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,function(e,t,n,r){return null==a(r)?e:t+n+'="'+r.replace(/"/g,"''")+'"'})).replace(/^<start>/g,""),missing:o}}function v(e,a){for(var s=0,c=[{level:0,id:"",title:"",start:s,text:"",children:[]}],t=(e=e.replace(/\r/g,"")).split(/\n/),l={},n=function(e){var t=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(e),n=null;if(a&&t)if(t[4])if(l[t[4]])t=null;else{n=function e(t,n){if(t.id==n)return t;for(var r=0,i=t.children;r<i.length;r++){var o=e(i[r],n);if(o)return o}return null}(a,t[4]);var r=function(e){e.id&&(l[e.id]=!0),e.children.forEach(r)};n&&r(n)}else t=null;if(t){var i={level:a?1:t[1].length,title:t[2].trim(),id:t[4]||"",start:s,text:"",children:[]};if(n){e="";for(var o=0;o<n.level;++o)e+="#";e+=" ",e+=i.title||n.title,e+=" #"+i.id}for(;c[c.length-1].level>=i.level;)c.pop();c[c.length-1].children.push(i),c.push(i)}c[c.length-1].text+=e+"\n",s++},r=0,i=t;r<i.length;r++){n(i[r])}return c[0]}E.translate=B,E.buildTOC=function(e){if(!e)return null;var t=l.docs.requireMarked(),n=E.requireDOMSanitizer(),r={renderer:new t.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:n,smartLists:!1,smartypants:!1},i={name:"dummy",subitems:[]},o=[];o.push(i);var a=t.lexer(e,r),s=!1;a.forEach(function(e){switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":return s=!0,void o.push({name:"",path:"",subitems:[]});case"text":var r=o[o.length-1];0<=e.text.indexOf("[")?e.text.replace(/\[(.*?)\]\((.*?)\)/i,function(e,t,n){r.name=t,r.path=n.replace(".md","")}):s&&(r.name=e.text);break;case"list_item_end":case"loose_item_end":var t=o.pop();o[o.length-1].subitems.push(t)}s=!1});var c=i.subitems;return c&&0!=c.length?c:null};var y=!(E.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})});function b(e,t){if(y||function(){function e(e,t,n){var r=b(e,t).trim();if(n=n.trim(),r!=n)throw console.log("*** Template:\n"+e+"\n*** Input:\n"+t+"\n*** Expected:\n"+n+"\n*** Output:\n"+r),new Error("augment docs test fail")}y=!0;var t="\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nTEx2\n### Example 3\nTEx3\n\n## See also #also\nTAlso\n";e(t,"",t),e(t," ",t),e(t,"\n# @extends\n# #ex2\nMy example\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nMy example\n### Example 3\nTEx3\n\n## See Also These! #also\nMy links\n"),e(t,"\n# @extends\n### #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n")}(),!t)return e;for(var n=v(e,null),r=v(t,n),i={},o={},a=0,s=r.children;a<s.length;a++){var c=s[a];P.assert(0==c.children.length),P.assert(!!c.id),i[c.id]=c.text}var l=function(e){e.id&&void 0!==i[e.id]&&(o[e.id]=!0,e.text=i[e.id],e.children=[]),e.children.forEach(l)};l(n);var u="",f=function(e){u+=e.text,e.children.forEach(f)};f(n);var p="",d=r.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");d.trim()&&(p+=d.trim()+"\n");for(var h=0,g=r.children;h<g.length;h++){var m=g[h];o[m.id]||(p+=m.text)}return p&&(u+="## Couldn't apply replacement logic to:\n"+p),u}E.augmentDocs=b}(l.docs||(l.docs={}))}(pxt||(pxt={})),function(e){(e.dom||(e.dom={})).el=function(e,t,n){var r=document.createElement(e);return t&&Object.keys(t).forEach(function(e){return r.setAttribute(e,t[e]+"")}),function t(e){Array.isArray(e)?e.forEach(function(e){return t(e)}):"string"==typeof e?r.appendChild(document.createTextNode(e)):e instanceof HTMLElement&&r.appendChild(e)}(n),r}}(pxt||(pxt={})),function(d){!function(e){function u(e){var t=/```package\s+((.|\s)+?)\s*```/i.exec(e),n=void 0;return t&&(n={},t[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).forEach(function(e){return n[e[0]]=e[1]||"*"})),n}function f(e){var t=/```config\s+((.|\s)+?)\s*```/i.exec(e),n=[];return t&&t[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).filter(function(e){return"feature"==e[0]&&!!e[1]}).forEach(function(e){return n.push(e[1])}),n.length?n:void 0}function p(e){var t=/```jres\s+((.|\s)+?)\s*```/i.exec(e);if(t){var n=t[1],r=JSON.parse(n);return{jres:n,ts:d.emitTilemapsFromJRes(r)}}}function t(e){if(!e)return[];var n=[],r=!1,i=void 0,o="";return e.split(/\r?\n/).forEach(function(e){if(/^##/.test(e))i=e.substr(2).trim();else if(/^```codecard$/.test(e))r=!0;else if(/^```$/.test(e)){if(r=!1,i&&o)try{var t=JSON.parse(o);t&&0<t.length&&n.push({name:i,cards:t})}catch(e){d.log("invalid card format in gallery")}o="",i=void 0}else r&&(o+=e+"\n")}),n.forEach(function(e){return e.cards.forEach(function(t){if(t.otherActions&&!t.otherActions.length&&("tutorial"==t.cardType||"example"==t.cardType)){var e=["js"];d.appTarget.appTheme.python&&e.unshift("py"),t.otherActions=e.map(function(e){return{url:t.url,cardType:t.cardType,editor:e}})}})}),n}e.parsePackagesFromMarkdown=u,e.parseFeaturesFromMarkdown=f,e.parseJResFromMarkdown=p,e.parseExampleMarkdown=function(e,t){var n;if(t){var r=/```(blocks?|typescript|python|spy|sim)\s+((.|\s)+?)\s*```/i.exec(t);if(r){var i=u(t),o=r[1],a=r[2],s=f(t),c=p(t),l={name:e,filesOverride:(n={"main.blocks":'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>'},n["python"===r[1]?"main.py":"main.ts"]=a,n),dependencies:i,features:s,snippetType:o,source:a};return c&&(l.filesOverride[d.TILEMAP_JRES]=c.jres,l.filesOverride[d.TILEMAP_CODE]=c.ts),l}}},e.parseGalleryMardown=t,e.loadGalleryAsync=function(e){return d.Cloud.markdownAsync(e).then(function(e){return t(e)})}}(d.gallery||(d.gallery={}))}(pxt||(pxt={})),function(c){var e=function(){function e(e){var t=this;this.io=e,this.q=new c.U.PromiseQueue,this.dataBuf="",this.numSent=0,this.pktSize=400,this.trace=!1,this.bmpMode=!0,this.targetInfo="",this.onEvent=function(e){},this.io.onData=function(e){return t.onData(e)}}return e.prototype.onData=function(e){for(this.dataBuf+=c.U.uint8ArrayToString(e);0<this.dataBuf.length;){var t=this.dataBuf[0];if("+"==t)this.dataBuf=this.dataBuf.slice(1);else if("$"==t||"%"==t){var n=this.decodeResp(this.dataBuf.slice(1));if(null==n)break;"$"==t?(this.io.sendPacketAsync(this.buildCmd("+")).done(),this.onResponse?this.onResponse(n):0<this.numSent&&this.io.error("unexpected response: "+n)):this.onEvent(n)}else this.io.error("invalid character: "+t)}},e.prototype.buildCmd=function(e){if("+"==e)return c.U.stringToUint8Array(e);for(var t="",n=0;n<e.length;++n){var r=e.charAt(n);"}"==r||"#"==r||"$"==r?(t+="}",t+=String.fromCharCode(32^r.charCodeAt(0))):t+=r}var i=0;e=t;for(n=0;n<e.length;++n)i=i+e.charCodeAt(n)&255;return t="$"+e+"#"+("0"+i.toString(16)).slice(-2),c.U.stringToUint8Array(t)},e.prototype.decodeResp=function(e){for(var t="",n=0;n<e.length;++n){var r=e[n];if("}"==r)++n,t+=String.fromCharCode(32^e.charCodeAt(n));else if("*"==r){++n;for(var i=e.charCodeAt(n)-29,o=t.charAt(t.length-1);0<i--;)t+=o}else{if("#"==r)return 2==e.slice(n+1,n+3).length?(this.dataBuf=e.slice(n+3),t):null;t+=r}}return null},e.prototype.sendCmdOKAsync=function(e){return this.sendCmdAsync(e,function(e){return"OK"==e})},e.prototype.error=function(e){this.io.error(e),this.io.disconnectAsync().done()},e.prototype.sendCmdAsync=function(n,r){var i=this;this.numSent++;var e=this.buildCmd(n);return this.q.enqueue("one",function(){return null===r?i.io.sendPacketAsync(e).then(function(){return null}):new Promise(function(t){i.onResponse=function(e){i.onResponse=null,i.trace&&c.log("GDB: '"+n+"' -> '"+e+"'"),void 0===r||r(e)||i.error("Invalid GDB command response: '"+n+"' -> '"+e+"'"),t(e)},i.io.sendPacketAsync(e).done()})})},e.prototype.sendRCmdAsync=function(e){return this.sendMCmdAsync("qRcmd,"+(t=e,c.U.toHex(c.U.stringToUint8Array(t))));var t},e.prototype.sendMCmdAsync=function(r){var i=this;this.numSent++;var e=this.buildCmd(r),o="";return this.q.enqueue("one",function(){return new Promise(function(n){i.onResponse=function(e){var t;"OK"!=e&&"O"==e[0]?o+=(t=e.slice(1),c.U.uint8ArrayToString(c.U.fromHex(t))):("OK"!=e&&(o+=" - "+e),i.onResponse=null,i.trace&&c.log("Final GDB: '"+r+"' -> '"+o+"'"),n(o))},i.io.sendPacketAsync(e).done()})})},e.prototype.write32Async=function(e,t){var n=new Uint8Array(4);return c.HF2.write32(n,0,t),this.writeMemAsync(e,n)},e.prototype.writeMemAsync=function(e,t){var n=this.pktSize/2-10;return c.U.assert(t.length<n),this.sendCmdOKAsync("M"+e.toString(16)+","+t.length.toString(16)+":"+c.U.toHex(t)).then(function(e){console.log(e)})},e.prototype.readMemAsync=function(e,r){var i=this,o=this.pktSize/2-6;if(o<r){var a=new Uint8Array(r),s=function(t){var n=Math.min(r-t,o);return 0==n?Promise.resolve(a):i.readMemAsync(e+t,n).then(function(e){return c.U.memcpy(a,t,e),s(t+n)})};return s(0)}return this.sendCmdAsync("m"+e.toString(16)+","+r.toString(16)).then(function(e){return c.U.fromHex(e)})},e.prototype.initBMPAsync=function(){var t=this;return Promise.resolve().then(function(){return t.sendRCmdAsync("swdp_scan")}).then(function(e){return t.targetInfo=e,t.sendCmdAsync("vAttach;1",function(e){return"T"==e[0]})}).then(function(){})},e.prototype.initAsync=function(){var t=this;return Promise.delay(1e3).then(function(){return t.sendCmdAsync("!")}).then(function(){return t.sendCmdAsync("qSupported")}).then(function(e){var r={};return e=(e=";"+e+";").replace(/;([^;]+)[=:]([^:;]+)/g,function(e,t,n){return r[t]=n,";"}),t.pktSize=parseInt(r.PacketSize)||1024,c.log("GDB-server caps: "+JSON.stringify(r)+" "+e.replace(/;+/g,";")),t.bmpMode?t.initBMPAsync():t.sendCmdAsync("c").then(function(){})})},e}();c.GDBServer=e}(pxt||(pxt={})),function(N){!function(l){function u(){var e,t,n;return!!l.forceProxy||!N.U.isNodeJS&&(null===(n=null===(t=null===(e=N)||void 0===e?void 0:e.appTarget)||void 0===t?void 0:t.cloud)||void 0===n?!0:!n.noGithubProxy)}l.token=null,l.forceProxy=!1;var i={};function o(i){var e;return i.method=null!=(e=i.method)?e:"GET",function n(e){var t;var r=N.U.clone(i);l.token&&(r.headers||(r.headers={}),r.url==P?r.headers.Authorization="bearer "+l.token:(r.url=N.BrowserUtils.cacheBustingUrl(r.url),r.headers.Authorization="token "+l.token));r.allowHttpErrors=(t=r.allowHttpErrors,null!=t&&t);return N.U.requestAsync(r).catch(function(e){if(N.tickEvent("github.error",{statusCode:e.statusCode}),l.handleGithubNetworkError){var t=l.handleGithubNetworkError(r,e);if(t)return n(!1)}throw e})}(l.token)}function f(e){return o({url:e,method:"GET"}).then(function(e){return e.json})}function s(e){return N.Cloud.apiRequestWithCdnAsync({url:"gh/"+e,forceLiveEndpoint:!0}).then(function(e){return e.json})}function c(e){N.log("github proxy error: "+e.message),N.debug(e)}l.isOrgAsync=function(e){return f("https://api.github.com/orgs/"+e).then(function(e){return 200==e.statusCode})};var p,e,t=function(){function e(){this.configs={},this.packages={}}return e.prototype.proxyWithCdnLoadPackageAsync=function(e,t){var n=this,r=e+"/"+t,i=this.packages[r];return i?(N.debug("github cache "+e+"/"+t+"/text"),Promise.resolve(i)):s(e+"/"+t+"/text").then(function(e){return n.packages[r]={files:e}})},e.prototype.cacheConfig=function(e,t){var n=N.Package.parseAndValidConfig(t);return this.configs[e]=n,N.U.clone(n)},e.prototype.loadConfigAsync=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:if(a||(a="master"),t=o+"/"+a,n=this.configs[t])return N.debug("github cache "+o+"/"+a+"/config"),[2,N.U.clone(n)];if(!u())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.proxyWithCdnLoadPackageAsync(o,a)];case 2:return r=e.sent(),[2,this.cacheConfig(t,r.files[N.CONFIG_NAME])];case 3:return c(e.sent()),[3,4];case 4:return[4,d(o,a,N.CONFIG_NAME)];case 5:return i=e.sent(),[2,this.cacheConfig(t,i)]}})})},e.prototype.loadPackageAsync=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(n||(n="master"),!u())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.proxyWithCdnLoadPackageAsync(t,n).then(function(e){return N.U.clone(e)})];case 2:return[2,e.sent()];case 3:return c(e.sent()),[3,4];case 4:return[4,this.githubLoadPackageAsync(t,n)];case 5:return[2,e.sent()]}})})},e.prototype.githubLoadPackageAsync=function(o,t){var a=this;return y(o,t).then(function(r){var i=o+"/"+r,e=a.packages[i];return e?(N.debug("github cache "+o+"/"+t+"/text"),Promise.resolve(N.U.clone(e))):(N.log("Downloading "+o+"/"+t+" -> "+r),d(o,r,N.CONFIG_NAME).then(function(e){var n={files:{}};n.files[N.CONFIG_NAME]=e;var t=JSON.parse(e);return Promise.map(N.allPkgFiles(t).slice(1),function(t){return d(o,r,t).then(function(e){n.files[t]=e})}).then(function(){return a.packages[i]=n,N.U.clone(n)})}))})},e}();function a(n,e,t){return o({url:"https://api.github.com/repos/"+n+"/contents/"+t+"?ref="+e,method:"GET"}).then(function(e){var t=e.json;return i[n]=!0,t&&"base64"==t.encoding&&null!=t.content?atob(t.content):N.U.httpGetTextAsync(t.download_url)})}function d(t,n,r){return i[t]?a(t,n,r):N.U.requestAsync({url:"https://raw.githubusercontent.com/"+t+"/"+n+"/"+r,allowHttpErrors:!0}).then(function(e){return 200==e.statusCode?e.text:a(t,n,r)})}function h(e,t,n,r){return o({url:/^https:/.test(e)?e:"https://api.github.com/repos/"+e,headers:n,method:r||"POST",data:t,successCodes:[200,201,202,204]}).then(function(e){return e.json})}function g(e,t){for(var n=1;e.refs[t+n];)n++;return t+n}function m(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,h(t+"/git/refs",{ref:"refs/heads/"+n,sha:r})];case 1:return e.sent(),[2,n]}})})}function v(e,n,t,r){void 0===n&&(n="tags");var i,o=(i=t,!!l.forceProxy||!(l.token&&!i)&&u()),a=null,s=o?N.U.httpGetJsonAsync(N.BrowserUtils.cacheBustingUrl(N.Cloud.apiRoot+"gh/"+e+"/refs"+(r?"?nocache=1":""))).then(function(t){var e=Object.keys(t.refs).filter(function(e){return N.U.startsWith(e,"refs/"+n+"/")}).map(function(e){return{ref:e,object:{sha:t.refs[e]}}});return a=t.refs.HEAD,e}):f("https://api.github.com/repos/"+e+"/git/refs/"+n+"/?per_page=100"),c=function(e){return e.replace(/^refs\/[^\/]+\//,"")};return s.then(function(e){e.sort(function(e,t){return N.semver.strcmp(c(e.ref),c(t.ref))});for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[c(i.ref)]=i.object.sha}return{refs:t,head:a}},function(e){return 404==e.statusCode?{refs:{}}:Promise.reject(e)})}function r(e){return"commit"==e.object.type?Promise.resolve(e.object.sha):"tag"==e.object.type?f(e.object.url).then(function(e){return"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))}):Promise.reject(new Error("Bad type "+e.object.type))}function y(t,n){return/^[a-f0-9]{40}$/.test(n)?Promise.resolve(n):f("https://api.github.com/repos/"+t+"/git/refs/tags/"+n).then(r,function(e){return f("https://api.github.com/repos/"+t+"/git/refs/heads/"+n).then(r)})}function b(r,i){var e=C(r);return e?x(e,i)?(N.tickEvent("github.download.banned"),N.log("Github repo is banned"),Promise.resolve(void 0)):l.db.loadPackageAsync(e.fullName,e.tag).then(function(e){var t=S(i,r);if(t){var n=N.Package.parseAndValidConfig(e.files[N.CONFIG_NAME]);n&&(N.log("auto-disable "+t.join(",")+" due to targetconfig entry for "+r),n.disablesVariants=t,e.files[N.CONFIG_NAME]=N.Package.stringifyConfig(n))}return e}):(N.log("Unknown GitHub syntax"),Promise.resolve(void 0))}function n(e){return N.Cloud.cdnApiUrl("gh/"+e.fullName+"/icon")}function w(e,t,n){if(e){var r={owner:e.owner.login.toLowerCase(),fullName:e.full_name.toLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:n,updatedAt:Math.round(new Date(e.updated_at).getTime()/1e3),fork:e.fork,private:e.private};return r.status=k(r,t),r}}function k(e,t){return x(e,t)?p.Banned:(o=r=t,(i=n=e)&&o&&i.owner&&o.approvedOrgs&&o.approvedOrgs.some(function(e){return e.toLowerCase()==i.owner.toLowerCase()})||n&&r&&n.fullName&&r.approvedRepos&&r.approvedRepos.some(function(e){return e.toLowerCase()==n.fullName.toLowerCase()})?p.Approved:p.Unknown);var n,r,i,o}function x(t,e){return n=t,!(!(r=e)||n&&n.owner&&(!r.bannedOrgs||!r.bannedOrgs.some(function(e){return e.toLowerCase()==n.owner.toLowerCase()})))||!!e&&(!t||!t.fullName||!(!e.bannedRepos||!e.bannedRepos.some(function(e){return e.toLowerCase()==t.fullName.toLowerCase()})));var n,r}function A(o,a){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(e){switch(e.label){case 0:if(!(r=C(o)))return[2,void 0];if((i=k(r,a))==p.Banned)return[2,void 0];if(!u())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=r,n=i,s(""+t.fullName).then(function(e){if(e)return{github:!0,owner:t.owner,fullName:t.fullName,name:e.name,description:e.description,defaultBranch:"master",tag:t.tag,status:n}}).catch(function(e){N.reportException(e)}))];case 2:return[2,e.sent()];case 3:return c(e.sent()),[3,4];case 4:return[4,f("https://api.github.com/repos/"+r.fullName)];case 5:return[2,w(e.sent(),a,r.tag)]}var t,n})})}function T(e){if(e){e=e.trim();var t=/^((https:\/\/)?github.com\/)?([^/]+\/[^/#]+)\/?(#(\w+))?$/i.exec(e);if(t){var n={repo:t?t[3].toLowerCase():null,tag:t?t[5]:null};return n.path=n.repo+(n.tag?"#"+n.tag:""),n}}}function C(e){if(e){e=(e=e.trim()).replace(/\/$/,"");var t=/^https:\/\/([^./#]+)\.github\.io\/([^/#]+)\/?$/i.exec(e);t&&(e="github:"+t[1]+"/"+t[2]),e=(e=(e=e.replace(/^github:/i,"")).replace(/^https:\/\/github\.com\//i,"")).replace(/\.git\b/i,"");var n=/^([^#\/:]+)\/([^#\/:]+)(\/([^#]+))?(#([^\/:]*))?$/.exec(e);if(n){var r=n[1],i=n[2],o=n[4];return{owner:r,project:i,fullName:r+"/"+i,tag:n[6],fileName:o}}}}function E(e){return!!e&&"github:"==e.slice(0,7)}function _(e){return e?"github:"+e.fullName.toLowerCase()+"#"+(e.tag||"master"):void 0}function U(e,t){if(!e||!e.upgrades)return null;var n=C(t);return n?N.U.lookup(e.upgrades,n.fullName.toLowerCase()):null}function S(e,t){var n=U(e,t),r=/^dv:(.*)/.exec(n);if(r){var i=r[1].split(/,/);return i.some(function(e){return!/^\w+$/.test(e)})?null:i}return null}l.MemoryGithubDb=t,l.downloadTextAsync=d,l.db=new t,l.authenticatedUserAsync=function(){return l.token?f("https://api.github.com/user"):Promise.resolve(void 0)},l.getCommitsAsync=function(e,t){return f("https://api.github.com/repos/"+e+"/commits?sha="+t).then(function(e){return e.map(function(e){var t=e.commit;return t.url=e.url,t.sha=e.sha,t})})},l.getCommitAsync=function(e,t){return f("https://api.github.com/repos/"+e+"/git/commits/"+t).then(function(t){return f(t.tree.url+"?recursive=1").then(function(e){return t.tree=e,t})})},l.createObjectAsync=function(e,t,n){return h(e+"/git/"+t+"s",n).then(function(e){return e.sha})},l.postCommitComment=function(e,t,n,r,i){return h(e+"/commits/"+t+"/comments",{body:n,path:r,position:i}).then(function(e){return e.id})},l.fastForwardAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,o({url:"https://api.github.com/repos/"+t+"/git/refs/heads/"+n,method:"PATCH",allowHttpErrors:!0,data:{sha:r,force:!1}})];case 1:return[2,200==e.sent().statusCode]}})})},l.putFileAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,o({url:"https://api.github.com/repos/"+t+"/contents/"+n,method:"PUT",allowHttpErrors:!0,data:{message:lf("Initialize empty repo"),content:btoa(N.U.toUTF8(r)),branch:"master"},successCodes:[201]})];case 1:return e.sent(),[2]}})})},l.createTagAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,h(t+"/git/refs",{ref:"refs/tags/"+n,sha:r})];case 1:return e.sent(),[2]}})})},l.createReleaseAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,h(t+"/releases",{tag_name:n,target_commitish:r,name:n,draft:!1,prerelease:!1})];case 1:return e.sent(),[2]}})})},l.createPRFromBranchAsync=function(n,r,i,o,a){var s;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,h(n+"/pulls",{title:o,body:a||lf("Automatically created from MakeCode."),head:i,base:r,maintainer_can_modify:!0})];case 1:return t=e.sent(),[2,null===(s=t)||void 0===s?void 0:s.html_url]}})})},l.mergeAsync=function(t,e,n,r){return o({url:"https://api.github.com/repos/"+t+"/merges",method:"POST",successCodes:[201,204,409],data:{base:e,head:n,commit_message:r}}).then(function(e){if(201==e.statusCode||204==e.statusCode)return e.json.sha;if(409==e.statusCode)return null;throw N.U.userError(lf("Cannot merge in github.com/{1}; code: {2}",t,e.statusCode))})},l.getRefAsync=function(e,t){return f("https://api.github.com/repos/"+e+"/git/refs/heads/"+(t=t||"master")).then(r).catch(function(e){404!=e.statusCode&&Promise.reject(e)})},l.getNewBranchNameAsync=function(t,n){return void 0===n&&(n="patch-"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,v(t,"heads")];case 1:return[2,g(e.sent(),n)]}})})},l.createNewBranchAsync=m,l.forkRepoAsync=function(a,s,c){return void 0===c&&(c="pr-"),__awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:return[4,h(a+"/forks",{})];case 1:t=e.sent(),n=w(t,null),r=Date.now()+3e5,i=null,e.label=2;case 2:return!i&&Date.now()<r?[4,Promise.delay(1e3)]:[3,8];case 3:e.sent(),e.label=4;case 4:return e.trys.push([4,6,,7]),[4,v(n.fullName,"heads")];case 5:return i=e.sent(),[3,7];case 6:return e.sent(),[3,7];case 7:return[3,2];case 8:if(!i)throw new Error(lf("Timeout waiting for fork"));return o=g(i,c),[4,m(n.fullName,o,s)];case 9:return e.sent(),[2,n.fullName+"#"+o]}})})},l.listRefsAsync=function(e,t,n,r){return void 0===t&&(t="tags"),v(e,t,n,r).then(function(e){return Object.keys(e.refs)})},l.listRefsExtAsync=v,l.pkgConfigAsync=function(e,t){return void 0===t&&(t="master"),l.db.loadConfigAsync(e,t)},l.downloadPackageAsync=b,l.cacheProjectDependenciesAsync=function(o){var n;return __awaiter(this,void 0,void 0,function(){var t,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return(t=null===(n=Object.keys(o.dependencies))||void 0===n?void 0:n.filter(function(e){return E(o.dependencies[e])})).length?[4,N.packagesConfigAsync()]:[3,3];case 1:return r=e.sent(),[4,Promise.all(t.map(function(n){return __awaiter(i,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,b(t=o.dependencies[n],r)];case 1:if(!e.sent())throw new Error(lf("Cannot load extension {0} from {1}",n,t));return[2]}})})}))];case 2:e.sent(),e.label=3;case 3:return[2]}})})},(e=p=l.GitRepoStatus||(l.GitRepoStatus={}))[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned",l.listUserReposAsync=function(){return O('{\n  viewer {\n    repositories(first: 100, affiliations: [OWNER, COLLABORATOR], orderBy: {field: PUSHED_AT, direction: DESC}) {\n      nodes {\n        name\n        description\n        full_name: nameWithOwner\n        private: isPrivate\n        fork: isFork\n        updated_at: updatedAt\n        owner {\n          login\n        }\n        defaultBranchRef {\n          name\n        }\n        pxtjson: object(expression: "master:pxt.json") {\n          ... on Blob {\n            text\n          }\n        }\n        readme: object(expression: "master:README.md") {\n          ... on Blob {\n            text\n          }\n        }\n      }\n    }\n  }\n}').then(function(e){return e.data.viewer.repositories.nodes.filter(function(e){return e.pxtjson}).filter(function(e){e.default_branch=e.defaultBranchRef.name;var t=N.Package.parseAndValidConfig(e.pxtjson&&e.pxtjson.text),n=e.readme&&e.readme.text;return!!t&&(t.supportedTargets?-1<t.supportedTargets.indexOf(N.appTarget.id):n&&-1<n.indexOf("PXT/"+N.appTarget.id))}).map(function(e){return w(e,null)})})},l.createRepoAsync=function(e,t,n){return h("https://api.github.com/user/repos",{name:e,description:t,private:!!n,has_issues:!0,has_projects:!1,has_wiki:!1,allow_rebase_merge:!1,allow_merge_commit:!0,delete_branch_on_merge:!1}).then(function(e){return w(e,null)})},l.enablePagesAsync=function(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:t=void 0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,f("https://api.github.com/repos/"+a+"/pages")];case 2:return(n=e.sent())&&(t=n.html_url),[3,4];case 3:return e.sent(),[3,4];case 4:if(t)return[3,8];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,h("https://api.github.com/repos/"+a+"/pages",{source:{branch:"master",path:"/"}},{Accept:"application/vnd.github.switcheroo-preview+json"})];case 6:return r=e.sent(),t=r.html_url,[3,8];case 7:return i=e.sent(),N.tickEvent("github.pages.error"),N.reportException(i),[3,8];case 8:return t?[4,f("https://api.github.com/repos/"+a)]:[3,13];case 9:if(!(o=e.sent())||o.homepage)return[3,13];e.label=10;case 10:return e.trys.push([10,12,,13]),[4,h("https://api.github.com/repos/"+a,{homepage:t},void 0,"PATCH")];case 11:return e.sent(),[3,13];case 12:return e.sent(),N.tickEvent("github.homepage.error"),[3,13];case 13:return[2]}})})},l.repoIconUrl=function(e){if(e.status==p.Approved)return n(e)},l.mkRepoIconUrl=n,l.repoStatus=k,l.repoAsync=A,l.searchAsync=function(e,t){if(!t)return Promise.resolve([]);var n=e.split("|").map(T).filter(function(e){return!!e});return 0<n.length?Promise.all(n.map(function(e){return A(e.path,t)})).then(function(e){return e.filter(function(e){return e&&e.status!=p.Banned})}):N.U.httpGetJsonAsync(N.Cloud.apiRoot+"ghsearch/"+N.appTarget.id+"/"+(N.appTarget.platformid||N.appTarget.id)+"?q="+encodeURIComponent(e)).then(function(e){return e.items.map(function(e){return w(e,t)}).filter(function(e){return e.status==p.Approved||t.allowUnapproved&&e.status==p.Unknown}).filter(function(e){return!N.appTarget.appTheme.githubUrl||"https://github.com/"+e.fullName!=N.appTarget.appTheme.githubUrl.toLowerCase()})}).catch(function(e){return[]})},l.parseRepoId=C,l.toGithubDependencyPath=function(e){var t="github:"+e.fullName;return e.tag&&(t+="#"+e.tag),t},l.isGithubId=E,l.stringifyRepo=_,l.normalizeRepoId=function(e){var t=C(e);if(t)return t.tag=t.tag||"master",_(t)},l.upgradedPackageReference=function(e,t){var n=U(e,t);if(!n)return null;var r=/^min:(.*)/.exec(n),i=r&&N.semver.tryParse(r[1]);if(i){var o=C(t),a=N.semver.tryParse(o.tag);return a&&N.semver.cmp(a,i)<0?(o.tag=r[1],N.debug("upgrading "+t+" to "+r[1]),_(o)):(a||N.log("not upgrading "+t+" - cannot parse version"),null)}return S(e,t)||N.log("invalid upgrade rule: "+t+" -> "+n),t},l.upgradedPackageId=function(e,t){var n=S(e,t);return n?t+"?dv="+n.join(","):t},l.latestVersionAsync=function(e,o,t,n){var a=C(e);return a?A(a.fullName,o).then(function(i){if(i)return v(i.fullName,"tags",t,n).then(function(e){var t=Object.keys(e.refs);t=N.semver.sortLatestTags(t);var n=N.appTarget.versions&&N.semver.tryParse(N.appTarget.versions.target);if(n&&o.releases&&o.releases["v"+n.major]){var r=o.releases["v"+n.major].map(function(e){return N.github.parseRepoId(e)}).filter(function(e){return e&&e.fullName.toLowerCase()==a.fullName.toLowerCase()})[0];if(r){if(t.some(function(e){return e==r.tag}))return N.debug("approved release "+r.fullName+"#"+r.tag+" for v"+n.major),Promise.resolve(r.tag);N.reportError("packages","approved release "+r.fullName+"#"+r.tag+" for v"+n.major+" not found anymore",{repo:i.fullName})}}return t[0]?Promise.resolve(t[0]):e.head||y(i.fullName,i.defaultBranch)})}):Promise.resolve(null)},l.GIT_JSON=".git.json";var P="https://api.github.com/graphql";function O(e){var t=JSON.stringify({query:e});return h(P,t)}l.lookupFile=function(e,t){return e?e.tree.tree.find(function(e){return e.path==t}):null},l.ghGraphQLQueryAsync=O,l.findPRNumberforBranchAsync=function(e,t){var n=C(e);return O("\n{\n    repository(owner: "+JSON.stringify(n.owner)+", name: "+JSON.stringify(n.project)+") {\n        pullRequests(last: 1, states: [OPEN, MERGED], headRefName: "+JSON.stringify(t)+") {\n            edges {\n                node {\n                    number\n                    state\n                    mergeable\n                    baseRefName\n                    url\n                    isDraft\n                }\n            }\n        }\n    }\n}\n").then(function(e){var t=e.data.repository.pullRequests.edges[0];if(t&&t.node){var n=t.node;return{number:n.number,mergeable:n.mergeable,state:n.state,title:n.title,url:n.url,base:n.baseRefName}}return{number:-1}})},l.getPagesStatusAsync=function(e){return f("https://api.github.com/repos/"+e+"/pages").catch(function(e){return{status:null}})}}(N.github||(N.github={}))}(pxt||(pxt={})),function(e){var t;e.REFCNT_FLASH="0xfffe",e.VTABLE_MAGIC=249,e.ValTypeObject=4,(t=e.BuiltInType||(e.BuiltInType={}))[t.BoxedString=1]="BoxedString",t[t.BoxedNumber=2]="BoxedNumber",t[t.BoxedBuffer=3]="BoxedBuffer",t[t.RefAction=4]="RefAction",t[t.RefImage=5]="RefImage",t[t.RefCollection=6]="RefCollection",t[t.RefRefLocal=7]="RefRefLocal",t[t.RefMap=8]="RefMap",t[t.RefMImage=9]="RefMImage",t[t.MMap=10]="MMap",t[t.User0=16]="User0"}(pxt||(pxt={})),function(m){!function(g){function c(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function l(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function u(e,t){return e[t]|e[t+1]<<8}function n(e){for(var t=new Uint8Array(4*e.length),n=0;n<e.length;++n)c(t,4*n,e[n]);return t}g.HF2_CMD_BININFO=1,g.HF2_MODE_BOOTLOADER=1,g.HF2_MODE_USERSPACE=2,g.HF2_CMD_INFO=2,g.HF2_CMD_RESET_INTO_APP=3,g.HF2_CMD_RESET_INTO_BOOTLOADER=4,g.HF2_CMD_START_FLASH=5,g.HF2_CMD_WRITE_FLASH_PAGE=6,g.HF2_CMD_CHKSUM_PAGES=7,g.HF2_CMD_READ_WORDS=8,g.HF2_CMD_WRITE_WORDS=9,g.HF2_CMD_DMESG=16,g.HF2_FLAG_SERIAL_OUT=128,g.HF2_FLAG_SERIAL_ERR=192,g.HF2_FLAG_CMDPKT_LAST=64,g.HF2_FLAG_CMDPKT_BODY=0,g.HF2_FLAG_MASK=192,g.HF2_SIZE_MASK=63,g.HF2_STATUS_OK=0,g.HF2_STATUS_INVALID_CMD=1,g.HF2_STATUS_EXEC_ERR=2,g.HF2_STATUS_EVENT=128,g.HF2_EV_MASK=8388608,g.write32=c,g.write16=l,g.read32=o,g.read16=u,g.encodeU32LE=n;var t=!(g.decodeU32LE=function(e){for(var t=[],n=0;n<e.length;n+=4)t.push(o(e,n));return t});function f(e){t?m.log("HF2: "+e):m.debug("HF2: "+e)}g.enableLog=function(){t=!0};var r=function(){function e(p){var d=this;this.io=p,this.cmdSeq=m.U.randomUint32(),this.lock=new m.U.PromiseQueue,this.flashing=!1,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.icon="usb",this.msgs=new m.U.PromiseBuffer,this.eventHandlers={},this.onSerial=function(e,t){};var h=[];p.onDeviceConnectionChanged=function(e){return d.disconnectAsync().then(function(){return e&&d.reconnectAsync()})},p.onSerial=function(e,t){return d.onSerial(e,t)},p.onData=function(e){var t=e[0]&g.HF2_FLAG_MASK,n=63&e[0],r=new Uint8Array(n);if(m.U.memcpy(r,0,e,1,n),t&g.HF2_FLAG_SERIAL_OUT)d.onSerial(r,t==g.HF2_FLAG_SERIAL_ERR);else if(h.push(r),t!=g.HF2_FLAG_CMDPKT_BODY){m.U.assert(t==g.HF2_FLAG_CMDPKT_LAST);for(var i=0,o=0,a=h;o<a.length;o++){i+=(f=a[o]).length}for(var s=new Uint8Array(i),c=0,l=0,u=h;l<u.length;l++){var f=u[l];m.U.memcpy(s,c,f),c+=f.length}h=[],s[2]&g.HF2_STATUS_EVENT?p.onEvent(s):d.msgs.push(s)}},p.onEvent=function(e){var t=o(e,0),n=m.U.lookup(d.eventHandlers,t+"");n?n(e.slice(4)):f("unhandled event: "+t.toString(16))},p.onError=function(e){f("recv error: "+e.message),d.autoReconnect&&(d.autoReconnect=!1,d.reconnectAsync().then(function(){d.autoReconnect=!0},function(e){f("reconnect error: "+e.message)}))}}return e.prototype.resetState=function(){this.lock=new m.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()},e.prototype.onEvent=function(e,t){m.U.assert(!!(e&g.HF2_EV_MASK)),this.eventHandlers[e+""]=t},e.prototype.reconnectAsync=function(){var t=this;return this.resetState(),f("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(function(){return t.initAsync()}).catch(function(e){if(t.reconnectTries<5)return t.reconnectTries++,f("error "+e.message+"; reconnecting attempt #"+t.reconnectTries),Promise.delay(500).then(function(){return t.reconnectAsync()});throw e})},e.prototype.disconnectAsync=function(){return f("disconnect"),this.io.disconnectAsync()},e.prototype.error=function(e){return this.io.error(e)},e.prototype.talkAsync=function(e,t){var n=this;if(this.io.talksAsync)return this.io.talksAsync([{cmd:e,data:t}]).then(function(e){return e[0]});var r=8;t&&(r+=t.length);var i=new Uint8Array(r),o=65535&++this.cmdSeq;c(i,0,e),l(i,4,o),l(i,6,0),t&&m.U.memcpy(i,8,t,0,t.length);var a=0,s=function(){return n.msgs.shiftAsync(1e3).then(function(e){if(u(e,0)!=o){if(a<3)return a++,f("message out of sync, ("+o+" vs "+u(e,0)+"); will re-try"),s();n.error("out of sync")}var t="";switch(e[3]&&(t="; info="+e[3]),e[2]){case g.HF2_STATUS_OK:return e.slice(4);case g.HF2_STATUS_INVALID_CMD:n.error("invalid command"+t);break;case g.HF2_STATUS_EXEC_ERR:n.error("execution error"+t);break;default:n.error("error "+e[2]+t)}return null})};return this.sendMsgAsync(i).then(s)},e.prototype.sendMsgAsync=function(e){return this.sendMsgCoreAsync(e)},e.prototype.sendSerialAsync=function(e,t){return void 0===t&&(t=!1),this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)},e.prototype.sendMsgCoreAsync=function(r,i){var o=this;void 0===i&&(i=0);var a=new Uint8Array(64),s=function(e){var t=r.length-e;if(t<=0)return Promise.resolve();63<t?(t=63,a[0]=g.HF2_FLAG_CMDPKT_BODY):a[0]=g.HF2_FLAG_CMDPKT_LAST,i&&(a[0]=1==i?g.HF2_FLAG_SERIAL_OUT:g.HF2_FLAG_SERIAL_ERR),a[0]|=t;for(var n=0;n<t;++n)a[n+1]=r[e+n];return o.io.sendPacketAsync(a).then(function(){return s(e+t)})};return this.lock.enqueue("out",function(){return s(0)})},e.prototype.switchToBootloaderAsync=function(){var t=this;return this.bootloaderMode?Promise.resolve():(f("Switching into bootloader mode"),this.io.isSwitchingToBootloader&&this.io.isSwitchingToBootloader(),this.maybeReconnectAsync().then(function(){return t.talkAsync(g.HF2_CMD_START_FLASH).then(function(){},function(e){return t.talkAsync(g.HF2_CMD_RESET_INTO_BOOTLOADER).then(function(){},function(e){}).then(function(){return t.reconnectAsync().catch(function(e){throw"devicenotfound"===e.type&&(e.type="repairbootloader"),e})})})}).then(function(){return t.initAsync()}).then(function(){t.bootloaderMode||t.error("cannot switch into bootloader mode")}))},e.prototype.isFlashing=function(){return!!this.flashing},e.prototype.reflashAsync=function(e){var t=this;f("reflash"),m.U.assert(m.appTarget.compile.useUF2);var n=e.outfiles[pxtc.BINARY_UF2],r=pxtc.UF2.parseFile(m.Util.stringToUint8Array(atob(n)));return this.flashing=!0,this.io.reconnectAsync().then(function(){return t.flashAsync(r)}).then(function(){return Promise.delay(100)}).finally(function(){return t.flashing=!1})},e.prototype.writeWordsAsync=function(e,t){return m.U.assert(t.length<=64),this.talkAsync(g.HF2_CMD_WRITE_WORDS,n([e,t.length].concat(t))).then(function(){})},e.prototype.readWordsAsync=function(e,t){var n=new Uint8Array(8);return c(n,0,e),c(n,4,t),m.U.assert(t<=64),this.talkAsync(g.HF2_CMD_READ_WORDS,n)},e.prototype.pingAsync=function(){return this.rawMode?Promise.resolve():this.talkAsync(g.HF2_CMD_BININFO).then(function(e){})},e.prototype.maybeReconnectAsync=function(){var t=this;return this.pingAsync().catch(function(e){return t.reconnectAsync().then(function(){return t.pingAsync()})})},e.prototype.flashAsync=function(r){var i=this,o=Date.now(),a=0,s=function(e){if(e>=r.length)return Promise.resolve();var t=r[e],n=new Uint8Array(4+t.payloadSize);return c(n,0,t.targetAddr),m.U.memcpy(n,4,t.data,0,t.payloadSize),i.talkAsync(g.HF2_CMD_WRITE_FLASH_PAGE,n).then(function(){return s(e+1)})};return this.switchToBootloaderAsync().then(function(){var e=256*r.length;return f("Starting flash ("+Math.round(e/1024)+"kB)."),a=Date.now(),16384<i.pageSize?r:p(r,function(e,t){return i.readWordsAsync(e,t)})}).then(function(e){if(e.length!=r.length){var t=256*(r=e).length;f("Performing partial flash ("+Math.round(t/1024)+"kB).")}}).then(function(){return s(0)}).then(function(){var e=Date.now(),t=e-o,n=e-a;f("Flashing done at "+Math.round(256*r.length/n*1e3/1024)+" kB/s in "+t+"ms (reset "+(t-n)+"ms). Resetting.")}).then(function(){return i.talkAsync(g.HF2_CMD_RESET_INTO_APP).catch(function(e){})}).then(function(){})},e.prototype.initAsync=function(){var n=this;return this.rawMode?Promise.resolve():Promise.resolve().then(function(){return n.talkAsync(g.HF2_CMD_BININFO)}).then(function(e){return n.bootloaderMode=e[0]==g.HF2_MODE_BOOTLOADER,n.pageSize=o(e,4),n.flashSize=o(e,8)*n.pageSize,n.maxMsgSize=o(e,12),n.familyID=o(e,16),f("Connected; msgSize "+n.maxMsgSize+"B; flash "+n.flashSize/1024+"kB; "+(n.bootloaderMode?"bootloader":"application")+" mode; family=0x"+n.familyID.toString(16)),n.talkAsync(g.HF2_CMD_INFO)}).then(function(e){n.infoRaw=m.U.fromUTF8(m.U.uint8ArrayToString(e)),m.debug("Info: "+n.infoRaw);var r={};("Header: "+n.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,function(e,t,n){return r[t.replace(/-/g,"")]=n,""}),n.info=r;var t=/v(\d\S+)(\s+(\S+))?/.exec(n.info.Header);n.info.Parsed=t?{Version:t[1],Features:t[3]||""}:{Version:"?",Features:""},f("Board-ID: "+n.info.BoardID+" v"+n.info.Parsed.Version+" f"+n.info.Parsed.Features)}).then(function(){n.reconnectTries=0})},e}();function p(r,e){if(!m.appTarget.compile.flashChecksumAddr)return Promise.resolve(r);var n,t=pxtc.UF2.readBytes(r,m.appTarget.compile.flashChecksumAddr,48),i=pxtc.parseChecksumBlock(t);return i?(n=e,m.appTarget.compile.flashChecksumAddr?n(m.appTarget.compile.flashChecksumAddr,12).then(function(e){var t=pxtc.parseChecksumBlock(e);return t?n(t.endMarkerPos,1).then(function(e){return o(e,0)!=t.endMarker?(m.log("end-marker mismatch"),null):t}):null}):Promise.resolve(null)).then(function(e){if(!e)return r;var n=e.regions.filter(function(t){return i.regions.some(function(e){return t.checksum==e.checksum&&t.length==e.length&&t.start==e.start})});if(0==n.length)return r;f("skipping flash at: "+n.map(function(e){return pxtc.assembler.tohex(e.start)+" ("+e.length/1024+"kB)"}).join(", "));var t=function(t){return n.some(function(e){return e.start<=t&&t<e.start+e.length})};return r.filter(function(e){return!(t(e.targetAddr)&&t(e.targetAddr+e.payloadSize-1))})}):Promise.resolve(r)}g.Wrapper=r,g.mkHF2PacketIOWrapper=function(e){return m.debug("packetio: wrapper hf2"),new r(e)},g.onlyChangedBlocksAsync=p}(m.HF2||(m.HF2={}))}(pxt||(pxt={})),function(S){!function(t){var g,e,f,n,m,v,a,p,y=S.Util,d=S.HF2,r=1409050336,i=665147697,o=287358355,h=1888490768,s=915601917,c=d.read32,b=!1;function l(e){return e<<2|2}function w(e){return 1&e?e>>1:0!=e?2&e?e==t.taggedNull?null:e!=t.taggedFalse&&(e==t.taggedTrue||{tagged:e>>2}):{ptr:e}:void 0}function u(e,t){if(y.assert(!(3&e)),y.assert(0<=e),e<2097152){var n=new Uint8Array(t);return e-=a.start,y.memcpy(n,0,a.buf,e,t),Promise.resolve(n)}var r=p.maxMsgSize-32;if(r<t){for(var i=[];0<t;){var o=Math.min(r,t);i.push(u(e,o)),t-=o,e+=o}return Promise.all(i).then(y.uint8ArrayConcat)}return p.readWordsAsync(e,Math.ceil(t/4)).then(function(e){return e.length>t?e.slice(0,t):e})}function k(n){if("object"!=typeof n||!n)return Promise.resolve(n);if("number"==typeof n.ptr){if(3&n.ptr)return Promise.resolve({unalignedPtr:n.ptr});var r=0;return u(n.ptr,56).then(function(t){r=d.read16(t,2);var e=t.length;return r==S.BuiltInType.BoxedString||r==S.BuiltInType.BoxedBuffer?e=d.read16(t,4)+6:r==S.BuiltInType.BoxedNumber&&(e=12),e>t.length?u(n.ptr+t.length,e-t.length).then(function(e){return y.uint8ArrayConcat([t,e])}):e<t.length?t.slice(0,e):t}).then(function(e){return r==S.BuiltInType.BoxedString?y.uint8ArrayToString(e.slice(6)):r==S.BuiltInType.BoxedBuffer?{type:"buffer",data:e.slice(6)}:r==S.BuiltInType.BoxedNumber?new Float64Array(e.buffer.slice(4))[0]:{type:"unknown",tag:r,refcnt:d.read16(e,0),data:e.slice(4)}})}return Promise.resolve(n)}function x(n){for(var e=[],t=function(t){e.push(k(n[t]).then(function(e){n[t]=e}))},r=0,i=Object.keys(n);r<i.length;r++){t(i[r])}return Promise.all(e).then(function(){})}function A(e){for(var t=g.breakpoints,n=t[0],r=1/0,i=0,o=t;i<o.length;i++){var a=o[i],s=e-a.binAddr;0<=s&&s<r&&(r=s,n=a)}return n}function T(l){return b?Promise.resolve():(b=!0,U().then(function(e){for(var t,n,r,i=d.decodeU32LE(l)[0],o={},a=0,s=g.procDebugInfo[0].locals;a<s.length;a++){var c=s[a];t=c,r=void 0,n=e.globals,null===(r=function(){switch(t.type){case"uint32":return d.read32(n,t.index);case"int32":return 0|d.read32(n,t.index);case"uint16":return d.read16(n,t.index);case"int16":return d.read16(n,t.index)<<16>>16;case"uint8":return n[t.index];case"int8":return n[t.index]<<24>>24;default:return null}}())&&(y.assert(0==(3&t.index)),r=w(d.read32(n,t.index))),o[t.name]=r}return m=A(i),u={type:"debugger",subtype:"breakpoint",breakpointId:m.id,globals:o,stackframes:[]},f(),p.talkAsync(h)}).then(function(e){!function(e,t){for(var n=m.binAddr,r=0,i=g.procDebugInfo.filter(function(e){return e.codeStartLoc<=n&&n<=e.codeEndLoc})[0];i&&i!=g.procDebugInfo[0];){var o=A(n),a=y.clone(o);a.functionName=i.name,a.argumentNames=i.args&&i.args.map(function(e){return e.name}),t.stackframes.push({locals:{},funcInfo:a,breakpointId:o.id});for(var s=t.stackframes[t.stackframes.length-1],c=0,l=0,u=i.locals;l<u.length;l++){var f=u[l];y.assert(f.index==c++),s.locals[f.name]=w(e[r++])}n=2147483646&e[r++];for(var p=v[n+""],d=0,h=i.args;d<h.length;d++)f=h[d],s.locals[f.name]=w(e[r+(i.args.length-1-f.index)]);if(!p)break;i=p.from,r+=p.stack-i.localsMark}}(d.decodeU32LE(e),u);var t=[u.globals].concat(u.stackframes.map(function(e){return e.locals}));return Promise.map(t,x)}).then(function(){return t.postMessage(u)}));var u}function C(){b=!1,e=new Promise(function(e,t){f=e})}function E(e){return void 0===e&&(e=!1),Promise.resolve().then(function(){return p.talkAsync(i,d.encodeU32LE([e?1:3]))}).then(C)}function _(){return e||(e=Promise.resolve()),e}function U(){return(n?Promise.resolve(n):p.talkAsync(r).then(function(e){return n={numGlobals:c(e,0),globalsPtr:c(e,4)}})).then(function(e){return p.readWordsAsync(e.globalsPtr,e.numGlobals)}).then(function(e){return{staticState:n,globals:e}})}t.taggedUndefined=0,t.taggedNull=l(1),t.taggedFalse=l(2),t.taggedTrue=l(16),t.postMessage=function(e){return console.log(e)},t.decodeValue=w,t.heapExpandAsync=k,t.heapExpandMapAsync=x,t.startDebugAsync=function(l,e){return(p=e).onEvent(s,T),(b=!1,n=g=null,Promise.resolve()).then(function(){v={};for(var e=[],t=0,n=(g=l).procDebugInfo;t<n.length;t++)e[(o=n[t]).idx]=o;for(var r=0,i=l.procDebugInfo;r<i.length;r++)for(var o,a=0,s=(o=i[r]).calls;a<s.length;a++){var c=s[a];v[c.addr+""]={from:o,to:e[c.procIndex],stack:c.stack}}}).then(function(){var e=g.outfiles[pxtc.BINARY_UF2],t=y.stringToUint8Array(atob(e));return a=pxtc.UF2.toBin(t),p.reflashAsync(g).then(function(){return p.reconnectAsync()})}).then(function(){return p.talkAsync(o).catch(function(e){})}).then(function(){return Promise.delay(200)}).then(function(){return p.reconnectAsync()}).then(C).then(_)},t.handleMessage=function(e){if(console.log("HWDBGMSG",e),"debugger"==e.type){var t=!1;switch(e.subtype){case"stepinto":t=!0;case"stepover":E(t)}}},t.resumeAsync=E,t.waitForHaltAsync=_,t.getHwStateAsync=U}(S.HWDBG||(S.HWDBG={}))}(pxt||(pxt={})),function(y){var e=function(){function e(){}return e.prototype.logTime=function(){if(this.start){var e=Date.now()-this.start;y.debug("Icon creation: "+e+"ms")}},e.prototype.convert=function(e){this.start||(this.start=Date.now());var t=atob(e.slice(e.indexOf(",")+1)),n=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2);if(135===n&&(n=224|t.charCodeAt(1),r=t.charCodeAt(2)|t.charCodeAt(3)<<8,i=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4)),225!=n&&228!=n)return null;if(!this.palette){var o=y.appTarget.runtime.palette.map(function(e){var t=parseInt(e.replace(/#/,""),16);return[t>>0&255,t>>8&255,t>>16&255,255]});o[0][3]=0,this.palette=new Uint8Array(4*o.length);for(var a=0;a<o.length;++a)this.palette[4*a+0]=o[a][0],this.palette[4*a+1]=o[a][1],this.palette[4*a+2]=o[a][2],this.palette[4*a+3]=o[a][3]}if(225==n)return this.genMonochrome(t,r,i);var s=(y.BrowserUtils.isEdge()||y.BrowserUtils.isIE())&&r<100&&i<100?3:1;return this.genColor(t,r,i,s)},e.prototype.genMonochrome=function(e,t,n){var r=t+3&-4,i=54+this.palette.length,o=i+r*n,a=new Uint8Array(o);a[0]=66,a[1]=77,y.HF2.write32(a,2,o),y.HF2.write32(a,10,i),y.HF2.write32(a,14,40),y.HF2.write32(a,18,t),y.HF2.write32(a,22,-n),y.HF2.write16(a,26,1),y.HF2.write16(a,28,8),y.HF2.write32(a,38,2835),y.HF2.write32(a,42,2835),y.HF2.write32(a,46,this.palette.length>>2),a.set(this.palette,54);for(var s=4,c=i,l=1,u=e.charCodeAt(s++),f=0;f<t;++f){c=i+f;for(var p=0;p<n;++p)a[c]=u&l?1:0,c+=r,256==(l<<=1)&&(l=1,u=e.charCodeAt(s++))}return"data:image/bmp;base64,"+btoa(y.U.uint8ArrayToString(a))},e.prototype.genColor=function(e,t,n,r){var i=t*(r=Math.max(1,0|r)),o=n*r,a=i<<2,s=138+a*o,c=new Uint8Array(s);c[0]=66,c[1]=77,y.HF2.write32(c,2,s),y.HF2.write32(c,10,138),y.HF2.write32(c,14,124),y.HF2.write32(c,18,i),y.HF2.write32(c,22,-o),y.HF2.write16(c,26,1),y.HF2.write16(c,28,32),y.HF2.write16(c,30,3),y.HF2.write32(c,38,2835),y.HF2.write32(c,42,2835),y.HF2.write32(c,54,16711680),y.HF2.write32(c,58,65280),y.HF2.write32(c,62,255),y.HF2.write32(c,66,4278190080),c[70]=66,c[71]=71,c[72]=82,c[73]=115;for(var l=4,u=138,f=!0,p=0;p<i;p++){var d=!1;u=138+(p<<2);for(var h=l,g=e.charCodeAt(l++),m=d?(g>>4&15)<<2:(15&g)<<2,v=0;v<o;v++)g&&(f=!1),c[u]=this.palette[m],c[u+1]=this.palette[m+1],c[u+2]=this.palette[m+2],c[u+3]=this.palette[m+3],u+=a,v%r==r-1&&(d&&(g=e.charCodeAt(l++)),m=(d=!d)?(g>>4&15)<<2:(15&g)<<2);if(f&&(c[141]=1),p%r==r-1)for(n%2||--l;3&l;)l++;else l=h}return"data:image/bmp;base64,"+btoa(y.U.uint8ArrayToString(c))},e}();y.ImageConverter=e}(pxt||(pxt={})),function(c){!function(e){function s(){var t={"tsconfig.json":e.TS_CONFIG,"test.ts":"// "+lf("tests go here; this will not be compiled when this package is used as an extension.")+"\n","_config.yml":"makecode:\n  target: @TARGET@\n  platform: @PLATFORM@\n  home_url: @HOMEURL@\ntheme: jekyll-theme-slate\ninclude:\n  - assets\n  - README.md\n",Makefile:"all: deploy\n\nbuild:\n\tpxt build\n\ndeploy:\n\tpxt deploy\n\ntest:\n\tpxt test\n",Gemfile:"source 'https://rubygems.org'\ngem 'github-pages', group: :jekyll_plugins","README.md":"\n> "+lf("Open this page at {0}","[https://@REPOOWNER@.github.io/@REPONAME@/](https://@REPOOWNER@.github.io/@REPONAME@/)")+"\n\n## "+lf("Use as Extension")+"\n\n"+lf("This repository can be added as an **extension** in MakeCode.")+"\n\n* "+lf("open [@HOMEURL@](@HOMEURL@)")+"\n* "+lf("click on **New Project**")+"\n* "+lf("click on **Extensions** under the gearwheel menu")+"\n* "+lf("search for **https://github.com/@REPO@** and import")+"\n\n## "+lf("Edit this project")+" !["+lf("Build status badge")+"](https://github.com/@REPO@/workflows/MakeCode/badge.svg)\n\n"+lf("To edit this repository in MakeCode.")+"\n\n* "+lf("open [@HOMEURL@](@HOMEURL@)")+"\n* "+lf("click on **Import** then click on **Import URL**")+"\n* "+lf("paste **https://github.com/@REPO@** and click import")+"\n\n## "+lf("Blocks preview")+"\n\n"+lf("This image shows the blocks code from the last commit in master.")+"\n"+lf("This image may take a few minutes to refresh.")+"\n\n!["+lf("A rendered view of the blocks")+"](https://github.com/@REPO@/raw/master/.github/makecode/blocks.png)\n\n#### "+lf("Metadata (used for search, rendering)")+'\n\n* for PXT/@TARGET@\n<script src="https://makecode.com/gh-pages-embed.js"><\/script><script>makeCodeRender("{{ site.makecode.home_url }}", "{{ site.github.owner_name }}/{{ site.github.repository_name }}");<\/script>\n',".gitignore":"# MakeCode\nbuilt\nnode_modules\nyotta_modules\nyotta_targets\npxt_modules\n_site\n*.db\n*.tgz\n.header.json\n.simstate.json\n",".vscode/settings.json":'{\n    "editor.formatOnType": true,\n    "files.autoSave": "afterDelay",\n    "files.watcherExclude": {\n        "**/.git/objects/**": true,\n        "**/built/**": true,\n        "**/node_modules/**": true,\n        "**/yotta_modules/**": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules/**": true\n    },\n    "files.associations": {\n        "*.blocks": "html",\n        "*.jres": "json"\n    },\n    "search.exclude": {\n        "**/built": true,\n        "**/node_modules": true,\n        "**/yotta_modules": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules": true\n    }\n}',".github/workflows/makecode.yml":"name: MakeCode\n\non: [push]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [8.x]\n\n    steps:\n      - uses: actions/checkout@v1\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v1\n        with:\n          node-version: ${{ matrix.node-version }}\n      - name: npm install\n        run: |\n          npm install -g pxt\n          pxt target @TARGET@\n      - name: build\n        run: |\n          pxt install\n          pxt build --cloud\n        env:\n          CI: true\n",".vscode/tasks.json":'\n// A task runner that calls the MakeCode (PXT) compiler\n{\n    "version": "2.0.0",\n    "tasks": [{\n        "label": "pxt deploy",\n        "type": "shell",\n        "command": "pxt deploy --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt build",\n        "type": "shell",\n        "command": "pxt build --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt install",\n        "type": "shell",\n        "command": "pxt install",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt clean",\n        "type": "shell",\n        "command": "pxt clean",\n        "group": "test",\n        "problemMatcher": [ "$tsc" ]\n    }]\n}\n'},n=r();return n&&Object.keys(n).forEach(function(e){return t[e]=n[e]}),t}function r(){var e=c.appTarget.bundledpkgs[c.template.TEMPLATE_PRJ];if(e){var t=c.Util.clone(e);return delete t[c.CONFIG_NAME],t}}e.TS_CONFIG='{\n    "compilerOptions": {\n        "target": "es5",\n        "noImplicitAny": true,\n        "outDir": "built",\n        "rootDir": "."\n    },\n    "exclude": ["pxt_modules/**/*test.ts"]\n}\n',e.defaultFiles=s,e.targetTemplateFiles=r,e.TEMPLATE_PRJ="template",e.packageFiles=function(e){var t=c.appTarget.blocksprj||c.appTarget.tsprj,n=c.U.clone(t.config);delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths,n.preferredEditor=n.files.find(function(e){return/\.blocks$/.test(e)})?c.BLOCKS_PROJECT_NAME:c.JAVASCRIPT_PROJECT_NAME,n.name=e,n.public=!0,n.version||(n.version="0.0.0");var r={},i=s();for(var o in i)r[o]=i[o];for(var o in t.files)"README.md"!=o&&(r[o]=t.files[o]);var a=Object.keys(r).filter(function(e){return/\.(blocks|md|ts|asm|cpp|h|py)$/.test(e)});return n.files=a.filter(function(e){return!/test/.test(e)}),n.testFiles=a.filter(function(e){return/test/.test(e)}),n.supportedTargets=[c.appTarget.id],r[c.CONFIG_NAME]=c.Package.stringifyConfig(n),r},e.packageFilesFixup=function(n,e){var r=JSON.parse(n[c.CONFIG_NAME]);e&&c.Util.jsonMergeFrom(r,e),c.webConfig&&(Object.keys(c.webConfig).forEach(function(e){return r[e.toLowerCase()]=c.webConfig[e]}),r.platform=c.appTarget.platformid||c.appTarget.id,r.target=c.appTarget.id,r.docs=c.appTarget.appTheme.homeUrl||"./",r.homeurl=c.appTarget.appTheme.homeUrl||"???"),c.U.iterMap(n,function(e,t){t=t.replace(/@([A-Z]+)@/g,function(e,t){return r[t.toLowerCase()]||""}),n[e]=t})}}(c.template||(c.template={}))}(pxt||(pxt={})),function(x){!function(e){var v,t,y,n;(t=v=e.NT||(e.NT={}))[t.Prefix=0]="Prefix",t[t.Postfix=1]="Postfix",t[t.Infix=2]="Infix",t[t.Block=3]="Block",t[t.NewLine=4]="NewLine",(n=y=e.GlueMode||(e.GlueMode={}))[n.None=0]="None",n[n.WithSpace=1]="WithSpace",n[n.NoSpace=2]="NoSpace";var r,i=["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"];function o(e){return"`"+e.replace(/[\\`${}]/g,function(e){return"\\"+e})+"`"}function a(e){return 20<e.length&&/\n/.test(e)?o(e):JSON.stringify(e)}function s(e,t,n){return{type:e,op:t,children:n}}function c(){return s(v.NewLine,"",[])}function l(e,t){return s(v.Prefix,e,t)}function u(e,t,n){return s(v.Infix,t,null==e?[n]:[e,n])}function b(e){return l(e,[])}function f(e){return s(v.Block,"",e)}function w(e){return l("",e)}function p(e,t){void 0===t&&(t=!1);for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];t?(0<n.length&&n.push(b(",")),n.push(c())):0<n.length&&n.push(b(", ")),n.push(o)}return t&&n.push(c()),w(n)}e.backtickLit=o,e.stringLit=a,e.mkNode=s,e.mkNewLine=c,e.mkPrefix=l,e.mkPostfix=function(e,t){return s(v.Postfix,t,e)},e.mkInfix=u,e.mkText=b,e.mkBlock=f,e.mkGroup=w,e.mkStmt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return n&&n.type==v.Block||e.push(c()),w(e)},e.mkCommaSep=p,function(e){function i(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),w(r?[u(t[0],".",b(e)),b("("),p(t.slice(1),n),b(")")]:[b(e),b("("),p(t,n),b(")")])}function n(e,t,n,r){return i(e+"."+t,n,r)}function r(e,t){return x.U.assert(2==t.length),u(t[0],e,t[1])}e.mkArrayLiteral=function(e,t){return w([b("["),p(e,t),b("]")])},e.mkNumberLiteral=function(e){return b(e.toString())},e.mkBooleanLiteral=function(e){return b(e?"true":"false")},e.mkStringLiteral=function(e){return b(a(e))},e.mkPropertyAccess=function(e,t){return w([u(t,".",b(e))])},e.mkCall=i,e.stdCall=function(e,t,n){return i(e,t,n)},e.extensionCall=function(e,t,n){return i(e,t,n,!0)},e.namespaceCall=n,e.mathCall=function(e,t){return n("Math",e,t,!1)},e.mkGlobalRef=function(e){return b(e)},e.mkSimpleCall=r,e.mkWhile=function(e,t){return w([b("while ("),e,b(")"),f(t)])},e.mkComment=function(e){return b("// "+e)},e.mkMultiComment=function(e){var r=[b("/**"),c()];return e.split("\n").forEach(function(e,t,n){e&&(r.push(b(" * "+e)),r.push(c()),t<n.length-1&&(r.push(b(" * ")),r.push(c())))}),w(r.concat([b(" */"),c()]))},e.mkAssign=function(e,t){return r("=",[e,t])},e.mkParenthesizedExpression=function(e){return h(d([e]).output)?e:w([b("("),e,b(")")])}}(r=e.Helpers||(e.Helpers={})),e.H=r;var k={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};function d(e){var s=[],c={},l="",u="",f=[{}],p=0;function d(e){"string"==typeof e&&(p+=(e.match(/\n/g)||[]).length),l+=e}var t=w(e);return function e(t,n){if(t.type==v.Infix){var r=[],i=x.U.lookup(k,t.op);if(null==i&&x.U.oops("bad infix op: "+t.op),i<n&&c("("),1==t.children.length)c(t.op),e(t.children[0],i),r.push(t.children[0]);else{var o=3!=i&&"**"!=t.op;e(t.children[0],o?i:i+.1),r.push(t.children[0]),"."==t.op?c("."):c(" "+t.op+" "),e(t.children[1],o?i+.1:i),r.push(t.children[1])}i<n&&c(")"),t.type=v.Prefix,t.op="",t.children=r}else for(var a=0,s=t.children;a<s.length;a++)e(s[a],-1);function c(e){"P"==e[0]&&(e=e.slice(1)),r.push(b(e))}}(t,-1),h(t),l||d("\n"),{output:l,sourceMap:s};function h(e){e.glueToBlock&&(m(),e.glueToBlock==y.WithSpace&&d(" "));var t=p,n=l.length;switch(e.type){case v.Infix:x.U.oops("no infix should be left");break;case v.NewLine:d("\n"+u);break;case v.Block:!function(e){var t=e.noFinalNewline?"":"\n";if(0==e.children.length)return g(" {\n\t\n}"+t);var n=x.U.clone(f[f.length-1]||{});f.push(n),u+="    "," "!=l[l.length-1]&&g(" ");g("{\n");for(var r=0,i=e.children;r<i.length;r++){var o=i[r];h(o)}u=u.slice(4),m(),g("\n}"+t),f.pop()}(e);break;case v.Prefix:e.canIndentInside?d(e.op.replace(/\n/g,"\n"+u+"    ")):d(e.op),e.children.forEach(h);break;case v.Postfix:e.children.forEach(h),e.canIndentInside?d(e.op.replace(/\n/g,"\n"+u+"    ")):d(e.op)}var r=p,i=Math.max(l.length,1);if(e.id)if(c[e.id]){var o=c[e.id];o.startLine=Math.min(o.startLine,t),o.endLine=Math.max(o.endLine,r),o.startPos=Math.min(o.startPos,n),o.endPos=Math.max(o.endPos,i)}else{var a={id:e.id,startLine:t,startPos:n,endLine:r,endPos:i};c[e.id]=a,s.push(a)}}function g(e){d(e.replace(/\n/g,"\n"+u))}function m(){l=l.replace(/\n *$/,function(){return p--,""})}}function h(e){if("("!==e[0]||")"!==e[e.length-1])return!1;for(var t=1,n=1;n<e.length;n++){var r=e[n];if("("===r)t++;else if(")"===r&&0===--t)return n===e.length-1}return!1}e.flattenNode=d,e.isReservedWord=function(e){return-1!==i.indexOf(e)},e.isParenthesized=h}(x.blocks||(x.blocks={}))}(pxt||(pxt={})),function(k){!function(s){var c=[".","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];s.BLOCKLY_TILESET_TYPE="BLOCKLY_TILESET_TYPE",s.TILE_PREFIX="tile",s.TILE_NAMESPACE="myTiles";var f=function(){function s(e,t,n,r,i){void 0===n&&(n=0),void 0===r&&(r=0),this.width=e,this.height=t,this.x0=n,this.y0=r,this.buf=i||new Uint8ClampedArray(this.dataLength())}return s.fromData=function(e){return new s(e.width,e.height,e.x0,e.y0,e.data)},s.prototype.set=function(e,t,n){if(e<this.width&&t<this.height&&0<=e&&0<=t){var r=this.coordToIndex(e,t);this.setCore(r,n)}},s.prototype.get=function(e,t){if(e<this.width&&t<this.height&&0<=e&&0<=t){var n=this.coordToIndex(e,t);return this.getCore(n)}return 0},s.prototype.copy=function(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=this.width),void 0===r&&(r=this.height);var i=new s(n,r);i.x0=e,i.y0=t;for(var o=0;o<n;o++)for(var a=0;a<r;a++)i.set(o,a,this.get(e+o,t+a));return i},s.prototype.apply=function(e,t){var n;void 0===t&&(t=!1);for(var r=0;r<e.width;r++)for(var i=0;i<e.height;i++)!(n=e.get(r,i))&&t||this.set(e.x0+r,e.y0+i,n)},s.prototype.equals=function(e){if(this.width===e.width&&this.height===e.height&&this.x0===e.x0&&this.y0===e.y0&&this.buf.length===e.buf.length){for(var t=0;t<this.buf.length;t++)if(this.buf[t]!==e.buf[t])return!1;return!0}return!1},s.prototype.data=function(){return{width:this.width,height:this.height,x0:this.x0,y0:this.y0,data:this.buf}},s.prototype.resize=function(e,t){return n(this,e,t)},s.prototype.coordToIndex=function(e,t){return e+t*this.width},s.prototype.getCore=function(e){var t=Math.floor(e/2);return e%2==0?15&this.buf[t]:(240&this.buf[t])>>4},s.prototype.setCore=function(e,t){var n=Math.floor(e/2);this.buf[n]=e%2==0?240&this.buf[n]|15&t:15&this.buf[n]|(15&t)<<4},s.prototype.dataLength=function(){return Math.ceil(this.width*this.height/2)},s}(),o=function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return __extends(s,e),s.fromData=function(e){return new s(e.width,e.height,e.x0,e.y0,e.data)},s.prototype.copy=function(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=this.width),void 0===r&&(r=this.height);var i=new s(n,r);i.x0=e,i.y0=t;for(var o=0;o<n;o++)for(var a=0;a<r;a++)i.set(o,a,this.get(e+o,t+a));return i},s.prototype.resize=function(e,t){return a(this,e,t)},s.prototype.getCore=function(e){return this.buf[e]},s.prototype.setCore=function(e,t){this.buf[e]=t},s.prototype.dataLength=function(){return this.width*this.height},s}(s.Bitmap=f);s.Tilemap=o;var l=function(){function e(e,t,n){this.tilemap=e,this.tileset=t,this.layers=n,this.nextId=0}return e.prototype.cloneData=function(){return new e(this.tilemap.copy(),{tileWidth:this.tileset.tileWidth,tiles:this.tileset.tiles.map(function(e){return __assign(__assign({},e),{bitmap:f.fromData(e.bitmap).copy().data()})})},f.fromData(this.layers).copy().data())},e}();s.TilemapData=l;var e=function(){function e(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}return e.prototype.set=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;this.mask[r]|=1<<i},e.prototype.get=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;return this.mask[r]>>i&1},e}();function r(e){var t=atob(e.slice(e.indexOf(",")+1)),n=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2);135===n&&(n=224|t.charCodeAt(1),r=t.charCodeAt(2)|t.charCodeAt(3)<<8,i=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4));var o=new k.sprite.Bitmap(r,i),a=4;if(225===n)for(var s=1,c=t.charCodeAt(a++),l=0;l<r;++l)for(var u=0;u<i;++u)o.set(l,u,c&s?1:0),256==(s<<=1)&&(s=1,c=t.charCodeAt(a++));else for(l=0;l<r;l++){for(u=0;u<i;u+=2){c=t.charCodeAt(a++);o.set(l,u,15&c),u!=i-1&&o.set(l,u+1,c>>4&15)}for(;3&a;)a++}return o}function u(e,t){!(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:hex)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&t&&(e=t);var n=parseInt(e.substr(0,2),16)|parseInt(e.substr(2,2),16)<<8,r=parseInt(e.substr(4,2),16)|parseInt(e.substr(6,2),16)<<8,i=y(e.substring(8));return o.fromData({width:n,height:r,x0:0,y0:0,data:i})}function i(e){return""+t(e.width,2)+t(e.height,2)+b(e.data().data)}function t(e,t){var n=e.toString(16),r=t<<1;for(1&n.length&&(n="0"+n);n.length<r;)n+="0";return n}function n(e,t,n){var r=new f(t,n);return r.apply(e),r}function a(e,t,n){var r=new o(t,n);return r.apply(e),r}function p(e,t){!(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&t&&(e=t);for(var n=e.split("\n"),r=[],i=0,o=0;o<n.length;o++){for(var a=n[o],s=[],c=0;c<a.length;c++)switch(a[c]){case"0":case".":s.push(0);break;case"1":case"#":s.push(1);break;case"2":case"T":s.push(2);break;case"3":case"t":s.push(3);break;case"4":case"N":s.push(4);break;case"5":case"n":s.push(5);break;case"6":case"G":s.push(6);break;case"7":case"g":s.push(7);break;case"8":s.push(8);break;case"9":s.push(9);break;case"a":case"A":case"R":s.push(10);break;case"b":case"B":case"P":s.push(11);break;case"c":case"C":case"p":s.push(12);break;case"d":case"D":case"O":s.push(13);break;case"e":case"E":case"Y":s.push(14);break;case"f":case"F":case"W":s.push(15)}s.length&&(r.push(s),i=Math.max(i,s.length))}var l=r.length,u=new f(i,l);for(o=0;o<l;o++)for(a=r[o],c=0;c<i;c++)c<a.length?u.set(c,o,a[c]):u.set(c,o,0);return u}function d(e){var t="";switch(e){case"python":t='img("""';break;default:t="img`"}return t}function h(e){var t="";switch(e){case"python":t+='""")';break;default:t+="`"}return t}function g(e,t){var n=d(t);if(e)for(var r=300<e.width*e.height?"":" ",i=0;i<e.height;i++){n+="\n";for(var o=0;o<e.width;o++)n+=c[e.get(o,i)]+r}return n+="\n",n+=h(t)}function m(e){switch(e){case 8:return"TileScale.Eight";case 16:return"TileScale.Sixteen";case 32:return"TileScale.ThirtyTwo";default:return Math.floor(Math.log2(e)).toString()}}function v(e){switch(e=e.replace(/\s/g,"")){case"TileScale.Eight":return 8;case"TileScale.Sixteen":return 16;case"TileScale.ThirtyTwo":return 32;default:return Math.pow(2,parseInt(e))}}function y(e){for(var t=new Uint8ClampedArray(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t}function b(e){for(var t="0123456789abcdef",n="",r=0;r<e.length;++r)n+=t[e[r]>>4],n+=t[15&e[r]];return n}function w(e){var t,n,r,i=function(e){if(e){if(6===e.length)return parseInt("0x"+e);if(7===e.length)return parseInt("0x"+e.substr(1))}return 0}(e);return[(r=i,r>>16&255),(n=i,n>>8&255),(t=i,255&t)]}s.Bitmask=e,s.encodeTilemap=function(e,t){return e?"tiles.createTilemap("+((n=e.tilemap)?"hex`"+i(n)+"`":"hex``")+", "+g(f.fromData(e.layers),t)+", ["+e.tileset.tiles.map(function(e){return e.id})+"], "+m(e.tileset.tileWidth)+")":"null";var n},s.decodeTilemap=function(e,t,n){if(!(e=k.Util.htmlUnescape(e).trim()).trim())return null;var r,i,o=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),a=(e=e.substr(o.length+1)).substr(0,e.indexOf(",")),s=(e=e.substr(a.length+1)).substr(0,e.lastIndexOf("]")+1),c=e=e.substr(s.length+1);return new l(u(o),{tiles:(r=s,i=n,(r=r.replace(/[\[\]]/g,""))?r.split(",").filter(function(e){return!!e.trim()}).map(function(e){return function(e,t){if(0===(e=e.trim()).indexOf("img")){var n=p(e);return t.createNewTile(n.data())}return t.resolveTile(e)}(e,i)}):[]),tileWidth:v(c)},p(a).data())},s.trimTilemapTileset=function(e){var t=e.tileset.tiles.slice(),n=e.tilemap,r={};r[t[0].id]=!0;for(var i=0;i<n.width;i++)for(var o=0;o<n.height;o++)r[t[n.get(i,o)].id]=!0;var a=e.editedTiles||[],s=t.filter(function(e){return r[e.id]||"*"===e.id.charAt(0)||-1!==a.indexOf(e.id)});if(s.length!==t.length){for(var c=[],l=0;l<t.length;l++)c.push(s.indexOf(t[l]));for(i=0;i<n.width;i++)for(o=0;o<n.height;o++)n.set(i,o,c[n.get(i,o)]);e.tileset.tiles=s}},s.computeAverageColor=function(e,t){for(var n=t.map(w),r=[0,0,0],i=0,o=0;o<e.width;o++)for(var a=0;a<e.height;a++){var s=e.get(o,a);if(s){++i;var c=n[s];r[0]+=c[0],r[1]+=c[1],r[2]+=c[2]}}return i?"#"+function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t}(r.map(function(e){return Math.floor(e/i)})):"#00000000"},s.getBitmap=function(e,t){var n=e.apis.byQName[t];return n?r(n.attributes.jresURL):null},s.getBitmapFromJResURL=r,s.filterItems=function(e,t){var i=(t=t.filter(function(e){return!!e}).map(function(e){return e.toLowerCase()})).filter(function(e){return 0!==e.indexOf("!")}),o=t.filter(function(e){return 0===e.indexOf("!")&&1<e.length}).map(function(e){return e.substring(1)});return e.filter(function(e){return r=e,i.every(function(t){var n="?"+t;return r.tags.some(function(e){return e===t||e===n})})&&(n=e,o.every(function(t){return!n.tags.some(function(e){return e===t})}));var n,r})},s.getGalleryItems=function(e,t){var n,r,i,o,a=(n=e.apis,r=t,k.Util.values(n.byQName).filter(function(e){return 4===e.kind&&e.attributes.fixedInstance&&function(e,t,n){if(t==n)return!0;var r=e.byQName[t];return!(!r||!r.extendsTypes)&&0<=r.extendsTypes.indexOf(n)}(n,e.retType,r)}));return a=a.filter(function(e){return e.namespace!=s.TILE_NAMESPACE}),i=a,o=new k.ImageConverter,i.forEach(function(e){e.attributes.jresURL&&!e.attributes.iconURL&&0==e.attributes.jresURL.indexOf("data:image/x-mkcd-f")&&(e.attributes.iconURL=o.convert(e.attributes.jresURL))}),a.map(function(e){var t=(e.attributes.tags||"").split(" ").filter(function(e){return!!e}).map(function(e){return k.Util.startsWith(e,"category-")?e:e.toLowerCase()});return{qName:e.qName,src:e.attributes.iconURL,alt:e.qName,tags:t}})},s.base64EncodeBitmap=function(e){var n=f.fromData(e),t=pxtc.f4EncodeImg(e.width,e.height,4,function(e,t){return n.get(e,t)});return btoa(k.U.uint8ArrayToString(y(t)))},s.tilemapLiteralToTilemap=u,s.hexEncodeTilemap=i,s.formatByte=t,s.resizeBitmap=n,s.resizeTilemap=a,s.imageLiteralToBitmap=p,s.imageLiteralFromDimensions=function(e,t,n,r){for(var i=d(r),o=300<e*t?"":" ",a=0;a<t;a++){i+="\n";for(var s=0;s<e;s++)i+=c[n]+o}return i+="\n",i+=h(r)},s.bitmapToImageLiteral=g,s.tileWidthToTileScale=m,s.tileScaleToTileWidth=v,s.uint8ArrayToHex=b}(k.sprite||(k.sprite={}))}(pxt||(pxt={})),function(s){var c,e,l,u;c=s.sprite||(s.sprite={}),e=c.legacy||(c.legacy={}),l=new RegExp("^\\s*"+c.TILE_NAMESPACE+"\\s*\\.\\s*"+c.TILE_PREFIX+"(\\d+)\\s*$"),u=function(e,t,n){this.tilemap=e,this.tileset=t,this.layers=n,this.nextId=0},e.LegacyTilemapData=u,e.decodeTilemap=function(e,t){if(!(e=s.Util.htmlUnescape(e).trim()).trim())return new u(new c.Tilemap(16,16),{tileWidth:16,tiles:[]},new c.Bitmap(16,16).data());var n,r=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),i=(e=e.substr(r.length+1)).substr(0,e.indexOf(",")),o=(e=e.substr(i.length+1)).substr(0,e.lastIndexOf("]")+1),a=e=e.substr(o.length+1);return new u(c.tilemapLiteralToTilemap(r),{tiles:(n=o,(n=n.replace(/[\[\]]/g,""))?n.split(",").filter(function(e){return!!e.trim()}).map(function(e){return function(e){if(0===(e=e.trim()).indexOf("img")){var t=c.imageLiteralToBitmap(e);return{data:t.data()}}var n=l.exec(e);return n?{data:null,projectId:Number(n[1])}:{data:null,qualifiedName:e}}(e)}):[]),tileWidth:c.tileScaleToTileWidth(a)},c.imageLiteralToBitmap(i).data())},e.tileToBlocklyVariable=function(e){return e.projectId+";"+e.data.width+";"+e.data.height+";"+pxtc.Util.toHex(e.data.data)},e.blocklyVariableToTile=function(e){var t=e.split(";");return 4!==t.length?null:{projectId:parseInt(t[0]),data:{width:parseInt(t[1]),height:parseInt(t[2]),data:new Uint8ClampedArray(pxtc.Util.fromHex(t[3])),x0:0,y0:0}}}}(pxt||(pxt={})),function(E){var c=["name","version","description","license","dependencies","files","testFiles","testDependencies","fileDependencies","public","targetVersions","supportedTargets","preferredEditor","languageRestriction","additionalFilePath","additionalFilePaths"],e=function(){function h(e,t,n,r){this.id=e,this._verspec=t,this.parent=n,this.level=-1,this.isLoaded=!1,this.ignoreTests=!1,this.cppOnly=!1,r&&(this.level=r.level+1),this.addedBy=[r]}return h.stringifyConfig=function(e){for(var t=e,n={},r=0,i=c;r<i.length;r++){var o=i[r];t.hasOwnProperty(o)&&(n[o]=t[o])}for(var a=0,s=Object.keys(t);a<s.length;a++){o=s[a];n.hasOwnProperty(o)||(n[o]=t[o])}return JSON.stringify(n,null,4)+"\n"},h.parseAndValidConfig=function(e){var t=E.Util.jsonTryParse(e);return t&&void 0!==t.name&&"string"==typeof t.name&&t.files&&Array.isArray(t.files)&&t.files.every(function(e){return"string"==typeof e})&&t.dependencies&&Object.keys(t.dependencies).every(function(e){return"string"==typeof t.dependencies[e]})&&t},h.getConfigAsync=function(r,i,o){return Promise.resolve().then(function(){if(E.github.isGithubId(o)){var t=E.github.parseRepoId(o);return E.packagesConfigAsync().then(function(e){return E.github.repoAsync(t.fullName,e)}).then(function(e){return e?E.github.pkgConfigAsync(t.fullName,t.tag):null})}var e=E.patching.upgradePackageReference(r,i,o),n=E.appTarget.bundledpkgs[e];return JSON.parse(n[E.CONFIG_NAME])})},h.corePackages=function(){var t=E.appTarget.bundledpkgs;return Object.keys(t).map(function(e){return JSON.parse(t[e][E.CONFIG_NAME])}).filter(function(e){return!!e})},h.prototype.disablesVariant=function(e){return this.config&&this.config.disablesVariants&&0<=this.config.disablesVariants.indexOf(e)},h.prototype.invalid=function(){return/^invalid:/.test(this.version())},h.prototype.version=function(){return this.resolvedVersion||this._verspec},h.prototype.verProtocol=function(){var e=this.version().split(":");return 1<e.length?e[0]:""},h.prototype.verArgument=function(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()},h.prototype.targetVersion=function(){return this.parent&&this.parent!=this?this.parent.targetVersion():this.config.targetVersions?this.config.targetVersions.target:void 0},h.prototype.commonDownloadAsync=function(){var t=this,e=this.verProtocol();if("pub"==e)return E.Cloud.downloadScriptFilesAsync(this.verArgument());if("github"==e)return E.packagesConfigAsync().then(function(e){return E.github.downloadPackageAsync(t.verArgument(),e)}).then(function(e){return e.files});if("embed"==e){var n=E.getEmbeddedScript(this.verArgument());return Promise.resolve(n)}if("pkg"==e){var r=this.readFile(this.verArgument()),i=ts.pxtc.Util.jsonTryParse(r);return i||E.log("unable to find "+this.verArgument()),Promise.resolve(i)}return Promise.resolve(null)},h.prototype.host=function(){return this.parent._host},h.prototype.readFile=function(e){return this.host().readFile(this,e)},h.prototype.readGitJson=function(){var e=this.readFile(E.github.GIT_JSON);return E.Util.jsonTryParse(e)},h.prototype.resolveDep=function(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null},h.prototype.saveConfig=function(){var e=E.U.clone(this.config);delete e.additionalFilePaths;var t=E.Package.stringifyConfig(e);this.host().writeFile(this,E.CONFIG_NAME,t)},h.prototype.setPreferredEditor=function(e){this.config.preferredEditor!=e&&(this.config.preferredEditor=e,this.saveConfig())},h.prototype.getPreferredEditor=function(){var e=this.config.preferredEditor;if(!e){if(!(0<=this.getFiles().indexOf("main.blocks")))return E.JAVASCRIPT_PROJECT_NAME;var t=this.readFile("main.blocks"),n=this.readFile("main.ts");return!t&&n?E.JAVASCRIPT_PROJECT_NAME:E.BLOCKS_PROJECT_NAME}return e},h.prototype.parseJRes=function(e){void 0===e&&(e={});for(var t=0,n=this.getFiles();t<n.length;t++){var r=n[t];E.U.endsWith(r,".jres")&&i(JSON.parse(this.readFile(r)),e)}return e},h.prototype.resolveVersionAsync=function(){var e=this._verspec;return E.getEmbeddedScript(this.id)?this.resolvedVersion=e="embed:"+this.id:e&&"*"!=e||(this.configureAsInvalidPackage(lf("version not specified for {0}",this.id)),e=this._verspec),Promise.resolve(e)},h.prototype.downloadAsync=function(){var t=this;return this.resolveVersionAsync().then(function(e){if(t.invalid())E.debug("skip download of invalid package "+t.id);else if(/^embed:/.test(e)||t.installedVersion!=e)return E.debug("downloading "+e),t.host().downloadPackageAsync(t).then(function(){t.loadConfig(),E.debug("installed "+t.id+" /"+e)})})},h.prototype.loadConfig=function(){if(0==this.level||!this.invalid()){var e=this.readFile(E.CONFIG_NAME);e||E.U.userError("extension "+this.id+" is missing "+E.CONFIG_NAME),this.parseConfig(e),0!=this.level&&(this.installedVersion=this.version()),this.saveConfig()}},h.prototype.validateConfig=function(){this.config.dependencies||E.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||E.U.userError("Missing files in config of: "+this.id),"string"==typeof this.config.name&&this.config.name||(this.config.name=lf("Untitled")),this.config.targetVersions&&this.config.targetVersions.target&&0<E.semver.majorCmp(this.config.targetVersions.target,E.appTarget.versions.target)&&E.U.userError(lf("{0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,E.appTarget.versions.target))},h.prototype.isPackageInUse=function(n,e){void 0===e&&(e=this.readFile("main.ts"));var r=null,t=E.patching.computePatches(this.targetVersion(),"missingPackage");return t&&t.forEach(function(t){Object.keys(t.map).forEach(function(e){t.map[e]===n&&(r=new RegExp(e,"g"))})}),r||(r=new RegExp(n+"\\.","g")),r.test(e)},h.prototype.upgradePackagesAsync=function(){var a=this;return this.config||this.loadConfig(),E.packagesConfigAsync().then(function(r){var i=0,o={};return E.U.iterMap(a.config.dependencies,function(e,t){if(E.github.isGithubId(t)){var n=E.github.upgradedPackageReference(r,t);n&&n!=t&&(E.log("upgrading dep "+e+": "+t+" -> "+n),o[t]=n,a.config.dependencies[e]=n,i++)}}),i&&a.saveConfig(),i&&o})},h.prototype.getMissingPackages=function(i,o){var e=E.patching.computePatches(this.targetVersion(),"missingPackage"),a={};return o&&e&&e.forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp(e,"g"),n=r.map[e];o.replace(t,function(e){return i.dependencies[n]||(a[n]="*"),""})})}),a},h.prototype.findConflictsAsync=function(e,f){var p,n=this,d=[];return Promise.resolve().then(function(){return"string"==typeof e?h.getConfigAsync(n.targetVersion(),e,f):Promise.resolve(e)}).then(function(e){if(p=e){var u=p.yotta?E.U.jsonFlatten(p.yotta.config):null;n.parent.sortedDeps().forEach(function(e){if(p.core&&e.config.core&&p.name!=e.config.name)return(a=new E.cpp.PkgConflictError(lf("conflict between core extensions {0} and {1}",p.name,e.id))).pkg0=e,void d.push(a);var t=!1;if(u){var n=e.config||JSON.parse(e.readFile(E.CONFIG_NAME));if(!!n&&!!n.yotta&&!!e.config.yotta.config)for(var r=E.U.jsonFlatten(n.yotta.config),i=0,o=Object.keys(u);i<o.length;i++){var a,s=o[i],c=r[s],l=p.yotta.configIsJustDefaults||n.yotta.configIsJustDefaults;if(r.hasOwnProperty(s)&&c!==u[s]&&!l&&(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts))(a=new E.cpp.PkgConflictError(lf("conflict on yotta setting {0} between extensions {1} and {2}",s,p.name,e.id))).pkg0=e,a.settingName=s,d.push(a),t=!0}}t||p.name!==e.id||e._verspec==f||/^file:/.test(e._verspec)||/^file:/.test(f)||((a=new E.cpp.PkgConflictError(lf("version mismatch for extension {0} (installed: {1}, installing: {2})",e,e._verspec,f))).pkg0=e,a.isVersionConflict=!0,d.push(a))})}return Object.keys(p.dependencies).reduce(function(e,t){return e.then(function(){return n.findConflictsAsync(t,p.dependencies[t])}).then(function(e){return d.push.apply(d,e)})},Promise.resolve())}).then(function(){var r=function(e){var t=[];return e.addedBy.forEach(function(e){e.id!==n.id&&(t.push.apply(r(e)),t.push(e))}),t},e=[];return d.forEach(function(n){e.push.apply(e,r(n.pkg0).map(function(e){var t=new E.cpp.PkgConflictError(n.isVersionConflict?lf("a dependency of {0} has a version mismatch with extension {1} (installed: {1}, installing: {2})",e.id,p.name,n.pkg0._verspec,f):lf("conflict on yotta setting {0} between extensions {1} and {2}",n.settingName,p.name,n.pkg0.id));return t.pkg0=e,t}))}),d.push.apply(d,e),d=d.filter(function(e,t){for(var n=0;n<t;++n)if(e.pkg0.id===d[n].pkg0.id)return!1;return!0})})},h.prototype.configureAsInvalidPackage=function(e){E.log("invalid package "+this.id+": "+e),this._verspec="invalid:"+this.id,this.config={name:this.id,description:e,dependencies:{},files:[]}},h.prototype.parseConfig=function(e,t){try{var n=JSON.parse(e);this.config=n}catch(e){this.configureAsInvalidPackage(lf("Syntax error in pxt.json"))}var r=JSON.stringify(this.config);for(var i in this.config.dependencies){var o=E.patching.upgradePackageReference(this.targetVersion(),i,this.config.dependencies[i]);o!=i&&(delete this.config.dependencies[i],o&&(this.config.dependencies[o]="*"))}t&&(this.config.targetVersions={target:t}),JSON.stringify(this.config)!=r&&this.saveConfig(),this.validateConfig()},h.prototype.patchCorePackage=function(){var t=this;E.Util.assert(E.appTarget.simulator&&E.appTarget.simulator.dynamicBoardDefinition),E.Util.assert(0==this.level);var e=Object.keys(this.config.dependencies).filter(function(e){return!!e&&(e==E.BLOCKS_PROJECT_NAME||e==E.JAVASCRIPT_PROJECT_NAME||JSON.parse((E.appTarget.bundledpkgs[e]||{})[E.CONFIG_NAME]||"{}").core)});if(0==e.length){var n=E.Package.corePackages();n.length&&this.config.dependencies[n[0].name]}else 1<e.length&&(e.pop(),e.forEach(function(e){E.log("removing core package "+e),delete t.config.dependencies[e]}))},h.prototype.resolvedDependencies=function(){var t=this;return Object.keys(this.dependencies()).map(function(e){return t.resolveDep(e)})},h.prototype.dependencies=function(e){if(void 0===e&&(e=!1),!this.config)return{};var n=E.Util.clone(this.config.dependencies||{});return 0==this.level&&this.config.testDependencies&&E.Util.iterMap(this.config.testDependencies,function(e,t){("*"!=t||E.appTarget.bundledpkgs[e])&&(n[e]=t)}),e&&this.config.cppDependencies&&E.Util.jsonMergeFrom(n,this.config.cppDependencies),n},h.prototype.loadAsync=function(u,e){var f=this;if(void 0===u&&(u=!1),this.isLoaded)return Promise.resolve();var t=Promise.resolve();0!=this.level||E.appTarget.multiVariants||E.setAppTargetVariant(null),this.isLoaded=!0;var n=this.readFile(E.CONFIG_NAME);null==n?u||E.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):t=t.then(function(){return f.parseConfig(n)}),0!=this.level||u||(t=t.then(function(){return f.upgradePackagesAsync().then(function(){})})),u&&(t=t.then(function(){return f.downloadAsync()})),0==this.level&&u&&(t=t.then(function(){return f.upgradePackagesAsync()}).then(function(e){return e?(Object.keys(e).forEach(function(e){return E.tickEvent("package.doubleload",{extension:e})}),E.log("upgraded, downloading again"),E.debug(e),f.downloadAsync()):Promise.resolve()})),E.appTarget.simulator&&E.appTarget.simulator.dynamicBoardDefinition&&(0==this.level&&(t=t.then(function(){return f.patchCorePackage()})),t=t.then(function(){if(f.config.compileServiceVariant&&E.setAppTargetVariant(f.config.compileServiceVariant),!(f.config.files.indexOf("board.json")<0)){var e=E.appTarget.simulator.boardDefinition=JSON.parse(f.readFile("board.json"));e.id=f.config.name,E.appTarget.appTheme.boardName=e.boardName||lf("board"),E.appTarget.appTheme.driveDisplayName=e.driveDisplayName||lf("DRIVE");var t=function(e){var t=/^pkg:\/\/(.*)/.exec(e);if(t){var n=t[1],r=f.readFile(n);return E.U.toDataUri(r,E.U.getMime(n))}return e},n=E.appTarget.simulator.boardDefinition;if("object"==typeof n.visual){var r=n.visual;r.image=t(r.image),r.outlineImage=t(r.outlineImage)}}}));var s=function(s,c,l){return void 0===l&&(l=!1),__awaiter(f,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:s||(s=c.dependencies(l)),t=0,n=Object.keys(s),e.label=1;case 1:return t<n.length?(r=n[t],i=s[r]||"*","hw"==r&&E.hwVariant&&(r="hw---"+E.hwVariant),(o=c.resolveDep(r))?(o.invalid()?(o.level=Math.min(o.level,c.level+1),o.addedBy.push(c)):(o._verspec==i||/^file:/.test(o._verspec)||/^file:/.test(i)||E.U.userError("Version spec mismatch on "+r),l||(o.level=Math.min(o.level,c.level+1),o.addedBy.push(c))),[3,4]):[3,2]):[3,5];case 2:return a=new h(r,i,c.parent,c),l&&(a.cppOnly=!0),c.parent.deps[r]=a,[4,(c.parent.deps[r.replace(/---.*/,"")]=a).loadAsync(u)];case 3:e.sent(),e.label=4;case 4:return t++,[3,1];case 5:return[2]}})})};return t.then(function(){return s(null,f)}).then(function(){if(f.config.palette&&E.appTarget.runtime&&(E.appTarget.runtime.palette=E.U.clone(f.config.palette),f.config.paletteNames&&(E.appTarget.runtime.paletteNames=f.config.paletteNames)),f.config.screenSize&&E.appTarget.runtime&&(E.appTarget.runtime.screenSize=E.U.clone(f.config.screenSize)),0===f.level){var e=f.readFile("main.ts");if(!e)return Promise.resolve(null);var o=f.getMissingPackages(f.config,e),a=!1;return Object.keys(o).reduce(function(e,i){return e.then(function(){return f.findConflictsAsync(i,o[i])}).then(function(e){if(e.length){var t=e.map(function(e){return e.pkg0.id}).join(", "),n=e.map(function(e){return e.settingName}).filter(function(e){return!!e}).join(", ");return E.log("skipping missing package "+i+" because it conflicts with the following packages: "+t+" (conflicting settings: "+n+")"),Promise.resolve(null)}E.log("adding missing package "+i),a=!0,f.config.dependencies[i]="*";var r={};return r[i]=o[i],s(r,f)})},Promise.resolve(null)).then(function(){return a&&(f.saveConfig(),f.validateConfig()),Promise.resolve(null)})}return Promise.resolve(null)}).then(function(){return 0!=f.level?Promise.resolve():Promise.all(E.U.values(f.parent.deps).map(function(e){return s(null,e,!0)}))}).then(function(){E.debug("  installed "+f.id)})},h.prototype.getFiles=function(){var e,r=this;e=0!=this.level||this.ignoreTests?this.config.files.slice(0):this.config.files.concat(this.config.testFiles||[]);var i=this.config.fileDependencies;return this.config.fileDependencies&&(e=e.filter(function(e){var t=E.U.lookup(i,e);if(!t)return!0;if(!(t=t.trim()))return!0;if(/^[\w-]+$/.test(t)){var n=r.parent.resolveDep(t);return!(!n||n.cppOnly)}return h.depWarnings[t]||(h.depWarnings[t]=!0,E.log("invalid dependency expression: "+t+" in "+r.id+"/"+e)),!1})),e},h.prototype.addSnapshot=function(e,n){void 0===n&&(n=[""]);for(var t=function(t){n.some(function(e){return E.U.endsWith(t,e)})&&(e[r.id+"/"+t]=r.readFile(t))},r=this,i=0,o=this.getFiles();i<o.length;i++){t(o[i])}e[this.id+"/"+E.CONFIG_NAME]=this.readFile(E.CONFIG_NAME)},h.prototype.packageLocalizationStringsAsync=function(n){var r=this,i=E.appTarget.id,e=[this.config.name+"-jsdoc",this.config.name],o={},a=E.appTarget.appTheme||{};return this.config.skipLocalization?Promise.resolve(o):E.Util.localizeLive&&"this"!=this.id&&E.appTarget.bundledpkgs[this.id]?(E.debug("loading live translations for "+this.id),Promise.all(e.map(function(t){return E.Util.downloadLiveTranslationsAsync(n,i+"/"+t+"-strings.json",a.crowdinBranch).then(function(e){e&&Object.keys(e).length?E.Util.jsonMergeFrom(o,e):(E.tickEvent("translations.livetranslationsfailed",{filename:t}),E.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t)))}).catch(function(e){E.tickEvent("translations.livetranslationsfailed",{filename:t}),E.log("error while downloading "+i+"/"+t+"-strings.json"),E.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t))})})).then(function(){return o})):(e.map(function(e){return r.bundledStringsForFile(n,e)}).filter(function(e){return!!e}).forEach(function(e){return E.Util.jsonMergeFrom(o,e)}),Promise.resolve(o))},h.prototype.bundledStringsForFile=function(e,t){var n={},r=E.Util.normalizeLanguageCode(e),i=r[0],o=r[1],a=r[2],s=this.config.files,c="_locales/"+i+"/"+t+"-strings.json";return-1<s.indexOf(c)?n=JSON.parse(this.readFile(c)):a&&(c="_locales/"+a+"/"+t+"-strings.json",-1<s.indexOf(c)?n=JSON.parse(this.readFile(c)):o&&(c="_locales/"+o+"/"+t+"-strings.json",-1<s.indexOf(c)&&(n=JSON.parse(this.readFile(c))))),n},h.depWarnings={},h}(),t=function(n){function e(e){var t=n.call(this,"this","file:.",null,null)||this;return t._host=e,t.deps={},(t.parent=t).addedBy=[t],t.level=0,t.deps[t.id]=t}return __extends(e,n),e.prototype.installAllAsync=function(e){return this.loadAsync(!0,e)},e.prototype.sortedDeps=function(n){var r=this;void 0===n&&(n=!1);var i={},o=[],a=function(e){return e.config?Object.keys(e.config.cppDependencies||{}).length:0},s=function(e){if(e&&!E.U.lookup(i,e.id)){i[e.id]=!0;var t=Object.keys(e.dependencies(n)).map(function(e){return r.resolveDep(e)});t.sort(function(e,t){return a(t)-a(e)||E.U.strcmp(e.id,t.id)}),t.forEach(s),o.push(e.id)}};return s(this),o.map(function(e){return r.resolveDep(e)})},e.prototype.localizationStringsAsync=function(t){var n={};return Promise.all(E.Util.values(this.deps).map(function(e){return e.packageLocalizationStringsAsync(t).then(function(t){t&&Object.keys(t).forEach(function(e){n[e]||(n[e]=t[e])})})})).then(function(){var t=E.U.getLocalizedStrings();return Object.keys(n).forEach(function(e){(E.U.startsWith(e,"{id:subcategory}")||E.U.startsWith(e,"{id:group}"))&&(t[e]||(t[e]=n[e]))}),E.U.setLocalizedStrings(t),Promise.resolve(n)})},e.prototype.getTargetOptions=function(){var t=E.U.clone(E.appTarget.compile);return E.U.assert(!!t),t.utf8||this.sortedDeps(!0).forEach(function(e){e.config&&e.config.utf8&&(E.debug("forcing utf8 mode: pkg="+e.id),t.utf8=!0)}),t},e.prototype.getJRes=function(){if(!this._jres){this._jres={};for(var e=0,t=this.sortedDeps();e<t.length;e++){t[e].parseJRes(this._jres)}var n=(E.appTarget.runtime&&E.appTarget.runtime.palette?E.appTarget.runtime.palette:["#000000","#ffffff"]).map(function(e){return("000000"+parseInt(e.replace(/#/,""),16).toString(16)).slice(-6)}).join("");this._jres.__palette={id:"__palette",data:n,dataEncoding:"hex",mimeType:"application/x-palette"}}return this._jres},e.prototype.updateJRes=function(){this._jres&&this.parseJRes(this._jres)},e.prototype.resolveBannedCategories=function(){var t=this;if(void 0!==this._resolvedBannedCategories)return this._resolvedBannedCategories;var n=[];return E.appTarget&&E.appTarget.runtime&&E.appTarget.runtime.bannedCategories&&E.appTarget.runtime.bannedCategories.length&&(n=E.appTarget.runtime.bannedCategories.slice(),Object.keys(this.deps).map(function(e){return t.deps[e]}).filter(function(e){return!!e}).map(function(e){return E.Util.jsonTryParse(e.readFile(E.CONFIG_NAME))}).filter(function(e){return e&&e.requiredCategories}).forEach(function(e){return e.requiredCategories.forEach(function(e){var t=n.indexOf(e);-1<t&&n.splice(t,1)})}),this._resolvedBannedCategories=n),this._resolvedBannedCategories=n,this._resolvedBannedCategories.length||(this._resolvedBannedCategories=null),this._resolvedBannedCategories},e.prototype.getCompileOptionsAsync=function(C){return void 0===C&&(C=this.getTargetOptions()),__awaiter(this,void 0,void 0,function(){var t,s,c,n,r,i,o,a,l,u,f,p,d,h,g,m,v,y,b,w,k,x,A,T=this;return __generator(this,function(e){switch(e.label){case 0:return t={sourceFiles:[],fileSystem:{},target:C,name:this.config?this.config.name:""},c=!(s=function(e,t){T.config.files.indexOf(e)<0&&E.U.userError(lf("please add '{0}' to \"files\" in {1}",e,E.CONFIG_NAME)),t="// Auto-generated. Do not edit.\n"+t+"\n// Auto-generated. Do not edit. Really.\n",T.host().readFile(T,e,!0)!==t&&(E.debug("updating "+e+" (size="+t.length+")..."),T.host().writeFile(T,e,t,!0))}),n=function(a){return __awaiter(T,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:t={extinfo:null,target:null},n=E.appTargetVariant,a&&E.setAppTargetVariant(a,{temporary:!0}),e.label=1;case 1:return e.trys.push([1,,5,6]),r=E.cpp.getExtensionInfo(this),c||(c=!0,r.shimsDTS&&s("shims.d.ts",r.shimsDTS),r.enumsDTS&&s("enums.d.ts",r.enumsDTS)),C.isNative?[4,this.host().getHexInfoAsync(r)]:[3,3];case 2:return o=e.sent(),[3,4];case 3:o=null,e.label=4;case 4:return i=o,r=E.U.flatClone(r),C.keepCppFiles||(delete r.compileData,delete r.generatedFiles,delete r.extensionFiles),r.hexinfo=i,t.extinfo=r,t.target=E.appTarget.compile,[3,6];case 5:return a&&E.setAppTargetVariant(n,{temporary:!0}),[7];case 6:return[2,t]}})})},[4,this.loadAsync()];case 1:e.sent(),t.bannedCategories=this.resolveBannedCategories(),t.target.preferredEditor=this.getPreferredEditor(),E.debug("building: "+this.sortedDeps().map(function(e){return e.config.name}).join(", ")),r=E.appTarget.multiVariants?E.appTargetVariant?[E.appTargetVariant]:E.appTarget.alwaysMultiVariant||E.appTarget.compile.switches.multiVariant?E.appTarget.multiVariants:[E.appTarget.multiVariants[0]]:[null],i=null,o=0,a=r,e.label=2;case 2:return o<a.length?(l=a[o],i&&E.debug("building for "+l),[4,n(l)]):[3,5];case 3:u=e.sent(),(f=u.extinfo).appVariant=l,f.outputPrefix=1!=r.length&&l?l+"-":"",i?t.otherMultiVariants.push(u):(i=f,t.otherMultiVariants=[]),e.label=4;case 4:return o++,[3,2];case 5:return t.extinfo=i,E.appTarget.compile.shortPointers||"vm"==E.appTarget.compile.nativeType||this.config.binaryonly||!t.target.isNative?[3,8]:[4,this.filesToBePublishedAsync(!0)];case 6:return p=e.sent(),d=JSON.stringify({name:this.config.name,comment:this.config.description,status:"unpublished",scriptId:this.installedVersion,cloudId:E.CLOUD_ID+E.appTarget.id,editor:this.getPreferredEditor(),targetVersions:E.appTarget.versions}),h=JSON.stringify(p),[4,E.lzmaCompressAsync(d+h)];case 7:(g=e.sent())&&(t.embedMeta=JSON.stringify({compression:"LZMA",headerSize:d.length,textSize:h.length,name:this.config.name,eURL:E.appTarget.appTheme.embedUrl,eVER:E.appTarget.versions?E.appTarget.versions.target:"",pxtTarget:E.appTarget.id}),t.embedBlob=ts.pxtc.encodeBase64(E.U.uint8ArrayToString(g))),e.label=8;case 8:for(m=0,v=this.sortedDeps();m<v.length;m++)for(y=v[m],b=0,w=y.getFiles();b<w.length;b++)k=w[b],/\.(ts|asm|py)$/.test(k)&&(x=k,0<y.level&&(x="pxt_modules/"+y.id+"/"+k),t.sourceFiles.push(x),t.fileSystem[x]=y.readFile(k));return t.jres=this.getJRes(),A=E.appTarget.runtime&&E.appTarget.runtime.functionsOptions,t.allowedArgumentTypes=A&&A.extraFunctionEditorTypes&&A.extraFunctionEditorTypes.map(function(e){return e.typeName}).concat("number","boolean","string"),[2,t]}})})},e.prototype.prepareConfigToBePublished=function(){var i=this,o=E.U.clone(this.config);return delete o.installedVersion,delete o.additionalFilePath,delete o.additionalFilePaths,o.targetVersions||(o.targetVersions=E.Util.clone(E.appTarget.versions)),E.U.iterMap(o.dependencies,function(e,t){if(!t||/^(file|workspace):/.test(t)){t="*";try{var n=i.resolveDep(e).readGitJson();if(n&&n.repo){var r=E.github.parseRepoId(n.repo);r.tag=n.commit.tag||n.commit.sha,t=E.github.stringifyRepo(r)}}catch(e){}o.dependencies[e]=t}}),o},e.prototype.filesToBePublishedAsync=function(o){var a=this;void 0===o&&(o=!1);var s={};return this.loadAsync().then(function(){o||a.config.public||E.U.userError('Only packages with "public":true can be published');var e=a.prepareConfigToBePublished();s[E.CONFIG_NAME]=E.Package.stringifyConfig(e);for(var t=0,n=a.getFiles();t<n.length;t++){var r=n[t];if(r!=E.CONFIG_NAME){var i=a.readFile(r);null==i&&E.U.userError("referenced file missing: "+r),s[r]=i}}return E.U.sortObjectFields(s)})},e.prototype.saveToJsonAsync=function(){var t=this;return this.filesToBePublishedAsync(!0).then(function(e){return{meta:{cloudId:E.CLOUD_ID+E.appTarget.id,targetVersions:E.appTarget.versions,editor:t.getPreferredEditor(),name:t.config.name},source:JSON.stringify(e,null,2)}})},e.prototype.compressToFileAsync=function(){return this.saveToJsonAsync().then(function(e){return E.lzmaCompressAsync(JSON.stringify(e,null,2))})},e.prototype.computePartDefinitions=function(o){if(!o||!o.length)return{};var a={};return this.sortedDeps().forEach(function(r){var e=r.readFile("pxtparts.json");if(e)try{var i=JSON.parse(e);Object.keys(i).forEach(function(e){if(0<=o.indexOf(e)){var t=a[e]=i[e];if("string"==typeof t.visual.image&&/\.svg$/i.test(t.visual.image)){var n=r.readFile(t.visual.image);n||E.reportError("parts","invalid part definition",{error:"missing visual "+t.visual.image}),t.visual.image="data:image/svg+xml,"+encodeURIComponent(n)}}})}catch(e){E.reportError("parts","invalid pxtparts.json file")}}),a},e}(E.Package=e);function i(e,t){void 0===t&&(t={});for(var n=e["*"]||{},r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];if("*"!=o){var a=e[o];"string"==typeof a&&(a={data:a});var s=a.namespace||n.namespace||"";s&&(s+=".");var c=a.id||s+o,l=a.icon,u=a.mimeType||n.mimeType,f=a.dataEncoding||n.dataEncoding||"base64";l||"base64"!=f||"image/png"!=u&&"image/jpeg"!=u||(l="data:"+u+";base64,"+a.data),t[c]={id:c,data:a.data,dataEncoding:f,icon:l,namespace:s,mimeType:u,tilemapTile:a.tilemapTile,tileset:a.tileset}}}return t}E.MainPackage=t,E.inflateJRes=i,E.allPkgFiles=function(e){return[E.CONFIG_NAME].concat(e.files||[]).concat(e.testFiles||[])},E.isPkgBeta=function(e){return e&&/\bbeta\b/.test(e.description)}}(pxt||(pxt={})),function(l){!function(n){var r,i,o,a,s=function(){};function c(){if(a)return a;var e=Promise.resolve();if(r){l.debug("packetio: disconnect");var t=r;e=e.then(function(){return t.disconnectAsync()}).then(function(){return t.io.disposeAsync()}).catch(function(e){l.reportException(e)}).finally(function(){a=r=i=void 0}),s&&(e=e.then(function(){return s()})),a=e}return e}n.isActive=function(){return!!r},n.isConnected=function(){return!!r&&r.io.isConnected()},n.isConnecting=function(){return!!r&&r.io.isConnecting()},n.icon=function(){return!!r&&(r.icon||"usb")},n.disconnectAsync=c,n.configureEvents=function(e,t){s=e,o=t,r&&(r.io.onConnectionChanged=s,r.onSerial=o)},n.initAsync=function(e){if(void 0===e&&(e=!1),l.debug("packetio: init "+(e?"(force)":"")),!i){var t=Promise.resolve();e&&(t=t.then(function(){return c()})),i=t.then(function(){return r?Promise.resolve(r):n.mkPacketIOAsync?(l.debug("packetio: new wrapper"),n.mkPacketIOAsync().then(function(e){return e.onConnectionChanged=s,r=n.mkPacketIOWrapper(e),o&&(r.onSerial=o),s&&s(),r})):(l.debug("packetio: not defined, skipping"),Promise.resolve(void 0))}).finally(function(){i=void 0})}return i}}(l.packetio||(l.packetio={}))}(pxt||(pxt={})),function(o){var e;(e=o.patching||(o.patching={})).computePatches=function(e,t){var n=o.appTarget.compile?o.appTarget.compile.patches:void 0;if(n){var r=o.semver.tryParse(e||"0.0.0")||o.semver.tryParse("0.0.0"),i=[];return Object.keys(n).filter(function(e){return o.semver.inRange(e,r)}).forEach(function(e){return i=i.concat(n[e])}),t&&(i=i.filter(function(e){return e.type==t})),i.length?i:void 0}},e.upgradePackageReference=function(e,t,n){if("*"!=n)return t;var r=o.patching.computePatches(e,"package"),i=t;return r&&r.forEach(function(t){Object.keys(t.map).forEach(function(e){i==e&&(i=t.map[e])})}),i},e.patchJavaScript=function(e,t){var n=o.patching.computePatches(e),i=t;return n&&(n.filter(function(e){return"api"===e.type}).forEach(function(n){Object.keys(n.map).forEach(function(e){var t=new RegExp(e,"g");i=i.replace(t,n.map[e])})}),n.filter(function(e){return"userenum"===e.type}).forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp("enum\\s+"+e+"\\s*{","gm");i=i.replace(t,"enum "+r.map[e]+" {");var n=new RegExp("(^|[^_a-zA-Z0-9])"+e+"(\\s*\\.)","g");i=i.replace(n,"$1"+r.map[e]+"$2")})})),i}}(pxt||(pxt={})),function(e){e.react||(e.react={})}(pxt||(pxt={})),function(f){!function(n){function s(e,t){if(e){if(t){var n=e.major-t.major||e.minor-t.minor||e.patch-t.patch;if(n)return n;if(0==e.pre.length&&0<t.pre.length)return 1;if(0<e.pre.length&&0==t.pre.length)return-1;for(var r=0;r<e.pre.length+1;++r){var i=e.pre[r],o=t.pre[r];if(!i)return o?-1:0;if(!o)return 1;if(/^\d+$/.test(i)){if(!/^\d+$/.test(o))return-1;if(n=parseInt(i)-parseInt(o))return n}else{if(/^\d+$/.test(o))return 1;if(n=f.U.strcmp(i,o))return n}}return 0}return-1}return t?1:0}function a(e,t){var n=c(e)||c(t);return n||f.U.userError(f.U.lf("'{0}' doesn't look like a semantic version number",e)),n}function c(e){if(!e)return null;if("*"===e)return{major:Number.MAX_SAFE_INTEGER,minor:Number.MAX_SAFE_INTEGER,patch:Number.MAX_SAFE_INTEGER,pre:[],build:[]};/^v\d/i.test(e)&&(e=e.slice(1));var t=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return t?{major:parseInt(t[1]),minor:parseInt(t[2]),patch:parseInt(t[3]),pre:t[5]?t[5].split("."):[],build:t[7]?t[7].split("."):[]}:null}function l(e){var t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}function r(e,t){var n=c(e),r=c(t);return n||r?s(n,r):f.U.strcmp(e,t)}function u(e,t){var n=e.split(" - ");if(2!=n.length)return!1;var r=c(n[0]),i=c(n[1]);if(!r||!i)return!1;if(!t)return!0;var o=s(r,t),a=s(t,i);return o<=0&&a<0}n.cmp=s,n.parse=a,n.tryParse=c,n.normalize=function(e){return l(a(e))},n.stringify=l,n.majorCmp=function(e,t){var n=c(e),r=c(t);return n.major-r.major},n.strcmp=r,n.inRange=u,n.sortLatestTags=function(e){var t=e.filter(function(e){return!!n.tryParse(e)});return t.sort(r),t.reverse(),t},n.test=function(){console.log("Test semver");for(var e=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"],t=0;t<e.length;++t){var n=a(e[t]);console.log(e[t],n),f.U.assert(l(n)==e[t]);for(var r=0;r<e.length;++r){var i=s(n,a(e[r]));console.log(e[t],e[r],i),t<r?f.U.assert(i<0):r<t?f.U.assert(0<i):f.U.assert(0==i)}}var o=c("1.2.3");f.U.assert(u("0.1.2 - 2.2.3",o)),f.U.assert(u("1.2.3 - 2.2.3",o)),f.U.assert(!u("0.0.0 - 1.2.3",o)),f.U.assert(!u("1.2.4 - 4.2.3",o)),f.U.assert(!u("0.0.0 - 0.0.1",o))}}(f.semver||(f.semver={}))}(pxt||(pxt={})),function(e){!function(O){function t(e){return O.Util.values(e.byQName).filter(function(e){return e.attributes.block&&/^{[^:]+:[^}]+}/.test(e.attributes.block)}).forEach(function(e){e.attributes.block=e.attributes.block.replace(/^{[^:]+:[^}]+}/,"")}),e}O.assert=O.Util.assert,O.oops=O.Util.oops,O.U=O.Util,O.ON_START_TYPE="pxt-on-start",O.ON_START_COMMENT="on start",O.HANDLER_COMMENT="code goes here",O.TS_STATEMENT_TYPE="typescript_statement",O.TS_DEBUGGER_TYPE="debugger_keyword",O.TS_BREAK_TYPE="break_keyword",O.TS_CONTINUE_TYPE="continue_keyword",O.TS_OUTPUT_TYPE="typescript_expression",O.TS_RETURN_STATEMENT_TYPE="function_return",O.PAUSE_UNTIL_TYPE="pxt_pause_until",O.COLLAPSED_BLOCK="pxt_collapsed_block",O.FUNCTION_DEFINITION_TYPE="function_definition",O.BINARY_JS="binary.js",O.BINARY_ASM="binary.asm",O.BINARY_HEX="binary.hex",O.BINARY_UF2="binary.uf2",O.BINARY_ELF="binary.elf",O.BINARY_PXT64="binary.pxt64",O.NATIVE_TYPE_THUMB="thumb",O.NATIVE_TYPE_VM="vm",O.BuildSourceMapHelpers=function(i,t,n){var e=function(e){var t=e.split("\n").map(function(e){return e.length}),n=t.reduce(function(e,t){var n=e.lens,r=e.sum;return{lens:__spreadArrays(n,[r+t+1]),sum:r+t+1}},{lens:[],sum:0}).lens;return{posToLineCol:function(r){var e=n.reduce(function(e,t,n){return r<t?e:n+1},0);return[e,t[e]-(n[e]-r)+1]},lineColToPos:function(e,t){return(n[e-1]||0)+t}}},u={ts:e(t),py:e(n)},f=function(e){return e.endPos-e.startPos},r=function(e,t){var n=e.startPos,r=e.endPos;return i.filter(function(e){return e[t].startPos<=n&&r<=e[t].endPos})},p=function(e,n){var t=r(e,n);return t.reduce(function(e,t){return f(t[n])<f(e[n])?t:e},t[0])},o={ts:{allOverlaps:function(e){return r(e,"ts")},smallestOverlap:function(e){return p(e,"ts")}},py:{allOverlaps:function(e){return r(e,"py")},smallestOverlap:function(e){return p(e,"py")}}},a=function(c,l){return function(e){var t,n=(t=e,[u[c].lineColToPos(t.line,t.column),t.length]),r=n[0],i=p({startPos:r,endPos:r+n[1]},c);if(i){var o=u[l].posToLineCol(i[l].startPos),a=o[0],s=o[1];return{fileName:"main."+l,start:i[l].startPos,length:f(i[l]),line:a,column:s}}}},s=a("ts","py"),c=a("py","ts");return{ts:__assign(__assign(__assign({},u.ts),o.ts),{locToLoc:s,getText:function(e){return t.substring(e.startPos,e.endPos)}}),py:__assign(__assign(__assign({},u.py),o.py),{locToLoc:c,getText:function(e){return n.substring(e.startPos,e.endPos)}})}},O.computeUsedParts=function(r,e){if(void 0===e&&(e=!1),!r.usedSymbols||!pxt.appTarget.simulator||!pxt.appTarget.simulator.parts)return[];var i=[];if(Object.keys(r.usedSymbols).forEach(function(e){var t=r.usedSymbols[e];if(t&&t.attributes.parts){var n=t.attributes.parts;n&&n.split(/[ ,]+/).forEach(function(e){0<e.length&&i.indexOf(e)<0&&i.push(e)})}}),e){var t=pxt.appTarget.simulator.boardDefinition.onboardComponents;t&&(i=i.filter(function(e){return t.indexOf(e)<0}))}return i.sort(),i=i.reverse()},O.blocksCategory=function(e){var t=e?e.attributes.blockNamespace||e.namespace:void 0;return t?O.Util.capitalize(t.split(".")[0]):void 0},O.getBlocksInfo=function(e,t){var n,g=[],m={},v={},y={},r={},i={};function o(e,t){var n="get"==e,r="set"==e,i="number"==t.retType,o=n?v:r?m:y,a=t.namespace+"."+t.retType,s=O.U.lookup(o,a);if(!s){var c="@"+e+"@",l=void 0,u=void 0;if(t.attributes.blockCombineShadow){var f=t.attributes.blockCombineShadow,p=f.match(/^([^,.]*),?([^,.]*)$/);p&&3==p.length&&(l=p[1].trim(),0!=(u=p[2].trim()).length||O.Util.endsWith(f,",")||(u=l,l=""))}var d=(t.attributes.blockSetVariable||t.namespace.toLocaleLowerCase())+"="+(l||""),h="value="+(u||"");(s=o[a]={attributes:{blockId:(i?t.namespace:a)+"_blockCombine_"+e,callingConvention:0,group:t.attributes.group,paramDefl:{},jsDoc:n?O.U.lf("Read value of a property on an object"):O.U.lf("Update value of property on an object")},name:c,namespace:t.namespace,fileName:t.fileName,qName:a+"."+c,pkg:t.pkg,kind:2,parameters:[{name:"property",description:n?O.U.lf("the name of the property to read"):O.U.lf("the name of the property to change"),isEnum:!0,type:"@combined@"},{name:"value",description:r?O.U.lf("the new value of the property"):O.U.lf("the amount by which to change the property"),type:t.retType}].slice(0,n?1:2),retType:n?t.retType:"void",combinedProperties:[]}).attributes.block=n?O.U.lf("%{0} %property",d):r?O.U.lf("set %{0} %property to %{1}",d,h):O.U.lf("change %{0} %property by %{1}",d,h),N(s.attributes),g.push(s)}s.combinedProperties.push(t.qName)}for(var a=0,s=O.Util.values(e.byQName);a<s.length;a++){var c=s[a];if("ENUM_GET"===c.attributes.shim&&c.attributes.enumName&&c.attributes.blockId){var l=!1;if(r[c.attributes.enumName]&&(console.warn("Enum block "+c.attributes.blockId+" trying to overwrite enum "+c.attributes.enumName),l=!0),c.attributes.enumMemberName||(console.warn("Enum block "+c.attributes.blockId+" should specify enumMemberName"),l=!0),c.attributes.enumPromptHint||(console.warn("Enum block "+c.attributes.blockId+" should specify enumPromptHint"),l=!0),c.attributes.enumInitialMembers&&c.attributes.enumInitialMembers.length||(console.warn("Enum block "+c.attributes.blockId+" should specify enumInitialMembers"),l=!0),l)continue;var u=parseInt(c.attributes.enumStartValue);r[c.attributes.enumName]={blockId:c.attributes.blockId,name:c.attributes.enumName,memberName:c.attributes.enumMemberName,firstValue:isNaN(u)?void 0:u,isBitMask:c.attributes.enumIsBitMask,isHash:c.attributes.enumIsHash,initialMembers:c.attributes.enumInitialMembers,promptHint:c.attributes.enumPromptHint}}if("KIND_GET"===c.attributes.shim&&c.attributes.blockId){var f=c.attributes.kindNamespace||c.attributes.blockNamespace||c.namespace;if(i[f]){console.warn("More than one block defined for kind "+f);continue}var p=[];if(e.byQName[f])for(var d=0,h=O.Util.values(e.byQName);d<h.length;d++){var b=h[d];b.namespace===f&&b.attributes.isKind&&p.push(b.name)}i[f]={blockId:c.attributes.blockId,name:f,memberName:c.attributes.kindMemberName||f,initialMembers:p,promptHint:c.attributes.enumPromptHint||O.Util.lf("Create a new kind..."),createFunctionName:c.attributes.kindCreateFunction||"create"}}if(c.attributes.blockCombine)/@set/.test(c.name)||o("get",c),c.isReadOnly||("number"==c.retType&&o("change",c),o("set",c));else if(c.attributes.block&&!c.attributes.fixedInstance&&7!=c.kind&&5!=c.kind&&9!=c.kind&&8!=c.kind){if(c.attributes.blockId||(c.attributes.blockId=c.qName.replace(/\./g,"_")),"true"==c.attributes.block){var w=O.U.uncapitalize(c.name);1!=c.kind&&2!=c.kind||(w+=" %"+c.namespace.toLowerCase());for(var k=0,x=c.parameters||[];k<x.length;k++)w+=" %"+x[k].name;c.attributes.block=w,N(c.attributes)}g.push(c)}}for(var A=0,T=g;A<T.length;A++){w=T[A];var C=O.U.lookup(e.byQName,w.namespace);if(C)for(var E=C.attributes,_=w.attributes,U=0,S=["blockNamespace","color","blockGap"];U<S.length;U++){var P=S[U];void 0===_[P]&&E[P]&&(_[P]=E[P])}}return t&&(n=t).length&&(g=g.filter(function(e){var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];return-1===n.indexOf(t)})),{apis:e,blocks:g,blocksById:pxt.Util.toDictionary(g,function(e){return e.attributes.blockId}),enumsByName:r,kindsByName:i}},O.apiLocalizationStrings={},O.localizeApisAsync=function(l,e){var u=O.Util.userLanguage();if("en"==O.Util.userLanguage())return Promise.resolve(t(l));var f={},p=u.toLowerCase(),d=p+"|jsdoc",h=p+"|block";return e.localizationStringsAsync(u).then(function(c){return Promise.all(O.Util.values(l.byQName).map(function(n){O.apiLocalizationStrings&&O.Util.jsonMergeFrom(c,O.apiLocalizationStrings);var t=n.attributes.locs||{},e=c[n.qName]||t[d];e&&(n.attributes.jsDoc=e,n.parameters&&n.parameters.forEach(function(e){return e.description=c[n.qName+"|param|"+e.name]||t[p+"|param|"+e.name]||e.description}));var r=c["{id:category}"+O.Util.capitalize(n.qName)],i=c[n.qName+"|block"]||t[h];if(!i&&n.attributes.useLoc){var o=l.byQName[n.attributes.useLoc];if(o){var a=c[o.qName+"|block"];n.attributes.block===(o.attributes._untranslatedBlock||o.attributes.block)&&a&&(i=a)}}var s=Promise.resolve();return i&&pxt.Util.isTranslationMode()&&(n.attributes.translationId=i,s=s.then(function(){return pxt.crowdin.inContextLoadAsync(i)}).then(function(e){i=e})),s.then(function(){if(r)n.attributes.block?n.attributes.block=i||n.attributes.block:n.attributes.block=r,N(n.attributes);else if(n.attributes.block&&i){var e=pxt.blocks.compileInfo(n),t=n.attributes.block;n.attributes.block=pxt.blocks.normalizeBlock(i,function(e){return f[n.attributes.blockId+"."+u]=1}),(n.attributes._untranslatedBlock=t)!=n.attributes.block&&(N(n.attributes),function(e,t){if(e.parameters.length!=t.parameters.length)return pxt.debug("Localized block has extra or missing parameters"),!1;for(var n=0,r=e.parameters;n<r.length;n++){var i=r[n],o=t.actualNameToParam[i.actualName];if(!o||i.type!=o.type||i.shadowBlockId!=o.shadowBlockId)return pxt.debug("Parameter "+i.actualName+" type or shadow block does not match after localization"),!1}return!0}(e,pxt.blocks.compileInfo(n))||(pxt.log("block has non matching arguments: "+t+" vs "+n.attributes.block),f[n.attributes.blockId+"."+u]=2,n.attributes.block=t,N(n.attributes)))}else N(n.attributes)})}))}).then(function(){return t(l)}).finally(function(){Object.keys(f).length&&pxt.reportError("loc.errors","invalid translation",f)})},O.emptyExtInfo=function(){var e=pxt.appTarget.compileService;e||(e={});var t=!!e.platformioIni,n="dockermake"==e.buildEngine||"dockercross"==e.buildEngine,r={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?r.platformio={dependencies:{}}:n?r.npmDependencies={}:r.yotta={config:{},dependencies:{}},r};var a=["weight","imageLiteral","topblockWeight"],s=["advanced","handlerStatement","afterOnStart","optionalVariableArgs","blockHidden","constantShim","blockCombine","enumIsBitMask","enumIsHash","decompileIndirectFixedInstances","topblock","callInDebugger","duplicateShadowOnDrag","argsNullable"];function N(n){if(n.block){var e=n.block.split("||");n._def=t(r(e[0])),n._def||pxt.debug("Unable to parse block def for id: "+n.blockId),e[1]&&(n._expandedDef=t(r(e[1]))),e[1]&&!n._expandedDef&&pxt.debug("Unable to parse expanded block def for id: "+n.blockId)}function t(e){return n._shadowOverrides&&e.parameters.forEach(function(e){var t=n._shadowOverrides[e.name];"unset"===t?delete e.shadowBlockId:null!=t&&(e.shadowBlockId=t)}),e}}function r(f){for(var p,d=[],h=0,e=function(){var t=f[h],e=h,n=void 0;switch(t){case"*":case"_":var r=m(function(e){return e==t}),i="_"===t?2:0;1===r.length?n={kind:1<<i,content:r}:2===r.length?n={kind:2<<i,content:r}:3===r.length?n={kind:3<<i,content:r}:h=e;break;case"`":var o=v("`");if(void 0===o){h=e;break}n={kind:256,content:o};break;case"|":n={kind:32};break;case"\\":h<f.length-1&&(n={kind:16,content:f[1+h++]});break;case"[":var a=v("]");if(void 0!==a&&"("===f[1+h++]){var s=v(")");if(void 0!==s){n={kind:512,content:a,type:s};break}}h=e;break;case"$":case"%":var c=m(function(e){return/[a-zA-Z0-9_=]/.test(e)},!0).split("=");if(2<c.length){h=e;break}var l=void 0;if("("===f[h+1]){var u=h;++h,(l=v(")"))||(h=u)}n={kind:"$"===t?1024:64,content:c[0],type:c[1],name:l}}n?(p&&d.push({kind:128,content:p}),p=void 0,d.push(n)):p?p+=t:p=t};h<f.length;h++)e();p&&d.push({kind:128,content:p});for(var n=[],t=[],o=[],a=0,r="",s=[],i=0;i<d.length;i++){var c=d[i].kind,l=o[o.length-1];if(15&c)if(w(d[i].content),c&a)if(l&c){o.pop();var u=l&(a^=c)|c&a;u&&o.push(u)}else y();else a|=c,o.push(c);else 144&c?r+=d[i].content:1120&c&&b();if(64==c){var g={kind:"param",name:d[i].content,shadowBlockId:d[i].type,ref:!1};d[i].name&&(g.varName=d[i].name),n.push(g),t.push(g)}else if(1024==c){g={kind:"param",name:d[i].content,shadowBlockId:d[i].type,ref:!0};d[i].name&&(g.varName=d[i].name),n.push(g),t.push(g)}else 256==c?(w(),s.push({kind:"image",uri:d[i].content})):512==c?(w(),s.push({kind:"label",text:d[i].content,cssClass:d[i].type})):32==c&&n.push({kind:"break"})}return b(),{parts:n,parameters:t};function m(e,t){void 0===t&&(t=!1);var n="";for(t&&h++;h<f.length&&e(f[h]);)n+=f[h],++h;return n&&h--,n}function v(t){var e=m(function(e){return e!==t},!0);if(f[h+1]===t)return++h,e}function y(){for(var e="",t=[],n=0,r=s;n<r.length;n++){var i=r[n];k(i)?(t.push({content:e,styles:0}),t.push(i),e=""):(e+=i.content,i.endingToken&&(e+=i.endingToken))}s=t,e&&s.push({content:e,styles:0}),o=[],a=0}function b(){for(w(),a&&y();s.length;){var e=s.shift();if(k(e))n.push(e);else{if(!e.content)continue;var t=[];10&e.styles&&t.push("bold"),5&e.styles&&t.push("italics"),n.push({kind:"label",text:e.content,style:t})}}}function w(e){s.push({content:r,styles:a,endingToken:e}),r=""}}function k(e){return!!e.kind}O.parseCommentString=function(e){for(var p={paramDefl:{},callingConvention:0,_source:e},d=!0;d;)d=!1,e=e.replace(/\/\/%[ \t]*([\w\.]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,function(e,t,n,r,i,o,a){var s=i?JSON.parse(i):n?i||o||a:"true";if(s||(s=""),O.U.startsWith(t,"block.loc."))p.locs||(p.locs={}),p.locs[t.slice("block.loc.".length).toLowerCase()+"|block"]=s;else if(O.U.startsWith(t,"jsdoc.loc."))p.locs||(p.locs={}),p.locs[t.slice("jsdoc.loc.".length).toLowerCase()+"|jsdoc"]=s;else if(O.U.contains(t,".loc.")){p.locs||(p.locs={});var c=t.slice(0,t.indexOf(".loc.")),l=t.slice(t.indexOf(".loc.")+".loc.".length);p.locs[l+"|param|"+c]=s}else if(O.U.endsWith(t,".defl"))-1<s.indexOf(" ")?p.paramDefl[t.slice(0,t.length-5)]='"'+s+'"':p.paramDefl[t.slice(0,t.length-5)]=s,p.explicitDefaults||(p.explicitDefaults=[]),p.explicitDefaults.push(t.slice(0,t.length-5));else if(O.U.endsWith(t,".shadow"))p._shadowOverrides||(p._shadowOverrides={}),p._shadowOverrides[t.slice(0,t.length-7)]=s;else if(O.U.endsWith(t,".fieldEditor"))p.paramFieldEditor||(p.paramFieldEditor={}),p.paramFieldEditor[t.slice(0,t.length-12)]=s;else if(O.U.contains(t,".fieldOptions.")){p.paramFieldEditorOptions||(p.paramFieldEditorOptions={});var u=t.slice(0,t.indexOf(".fieldOptions.")),f=t.slice(t.indexOf(".fieldOptions.")+14,t.length);p.paramFieldEditorOptions[u]||(p.paramFieldEditorOptions[u]={}),p.paramFieldEditorOptions[u][f]=s}else O.U.contains(t,".shadowOptions.")?(p.paramShadowOptions||(p.paramShadowOptions={}),u=t.slice(0,t.indexOf(".shadowOptions.")),f=t.slice(t.indexOf(".shadowOptions.")+15,t.length),p.paramShadowOptions[u]||(p.paramShadowOptions[u]={}),p.paramShadowOptions[u][f]=s):O.U.endsWith(t,".min")?(p.paramMin||(p.paramMin={}),p.paramMin[t.slice(0,t.length-4)]=s):O.U.endsWith(t,".max")?(p.paramMax||(p.paramMax={}),p.paramMax[t.slice(0,t.length-4)]=s):p[t]=s;return d=!0,"//% "});for(var t=0,n=a;t<n.length;t++){var r=n[t];"string"==typeof p[r]&&(p[r]=parseInt(p[r]))}for(var i=0,o=s;i<o.length;i++)r=o[i],"string"==typeof p[r]&&(p[r]="true"==p[r]||"1"==p[r]);if(p.trackArgs&&(p.trackArgs=p.trackArgs.split(/[ ,]+/).map(function(e){return parseInt(e)||0})),p.enumInitialMembers&&(p.enumInitialMembers=p.enumInitialMembers.split(/[ ,]+/)),p.blockExternalInputs&&!p.inlineInputMode&&(p.inlineInputMode="external"),p.paramHelp={},p.jsDoc="",e=e.replace(/\/\*\*([^]*?)\*\//g,function(e,t){return t=(t=t.replace(/\n\s*(\*\s*)?/g,"\n")).replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,function(e,t,n){if(p.paramHelp[t]=n,!p.paramDefl[t]){var r=/\beg\.?:\s*(.+)/.exec(n);if(r&&r[1]){var i=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(r[1]);if(i){var o=i[1]||i[2]||i[3];o||(o=""),-1<o.indexOf(" ")?p.paramDefl[t]='"'+o+'"':p.paramDefl[t]=o}}}return""}),p.jsDoc+=t,""}),p.jsDoc=p.jsDoc.trim(),p.async&&(p.callingConvention=1),p.promise&&(p.callingConvention=2),p.jres&&(p.whenUsed=!0),p.subcategories)try{p.subcategories=JSON.parse(p.subcategories)}catch(e){p.subcategories=void 0}if(p.groups)try{p.groups=JSON.parse(p.groups)}catch(e){p.groups=void 0}if(p.groupIcons)try{p.groupIcons=JSON.parse(p.groupIcons)}catch(e){p.groupIcons=void 0}if(p.groupHelp)try{p.groupHelp=JSON.parse(p.groupHelp)}catch(e){p.groupHelp=void 0}return N(p),p},O.updateBlockDef=N,O.parseBlockDefinition=r,O.parseChecksumBlock=function(e,t){void 0===t&&(t=0);var n=pxt.HF2.read32(e,t);if(133083260!=(2147483647&n))return pxt.log("no checksum block magic"),null;var r=pxt.HF2.read32(e,t+4),i=pxt.HF2.read32(e,t+8);if(3&r)return pxt.log("invalid end marker position"),null;var o=1<<(255&i);if(o!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+o),null;for(var a={magic:n,endMarkerPos:r,endMarker:i,regions:[]},s=t+12;s<e.length-7;s+=8){var c={start:o*pxt.HF2.read16(e,s),length:o*pxt.HF2.read16(e,s+2),checksum:pxt.HF2.read32(e,s+4)};if(!c.length||!c.checksum)break;a.regions.push(c)}return a},function(d){function v(t){var e=function(e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0};if(!t||512!=t.length||e(0)!=d.UF2_MAGIC_START0||e(4)!=d.UF2_MAGIC_START1||e(t.length-4)!=d.UF2_MAGIC_END)return null;var n=e(8),r=e(16);476<r&&(r=256);var i=null,o=0,a=0;if(n&d.UF2_FLAG_FILE){var s=t.slice(32+r),c=s.indexOf(0);0<=c&&(s=s.slice(0,c)),i=O.U.fromUTF8(O.U.uint8ArrayToString(s)),a=e(28)}return n&d.UF2_FLAG_FAMILY_ID_PRESENT&&(o=e(28)),{flags:n,targetAddr:e(12),payloadSize:r,blockNo:e(20),numBlocks:e(24),fileSize:a,familyId:o,data:t.slice(32,32+r),filename:i}}function a(e,t){return!!e&&(e.targetAddr<=t&&t<e.targetAddr+e.payloadSize)}function h(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function s(e){return"string"==typeof e&&(e=parseInt(e)),{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0,familyId:e||0}}function c(e){for(var t=0;t<e.blocks.length;++t)h(e.blocks[t],20,t),h(e.blocks[t],24,e.blocks.length),e.filename&&h(e.blocks[t],28,e.filesize)}function g(e,t,n,r){void 0===r&&(r=0);var i=e.currBlock,o=t>>8,a=256-(255&t);if(n.length>a){var s=new Uint8Array(n);for(g(e,t,s.slice(0,a));a<n.length;){var c=Math.min(a+256,n.length);g(e,t+a,s.slice(a,c)),a=c}}else{if(o!=e.currPtr){var l=0;i=null;for(var u=0;u<e.ptrs.length;++u)if(e.ptrs[u]==o){i=e.blocks[u];break}if(!i){i=new Uint8Array(512),e.filename?r|=d.UF2_FLAG_FILE:e.familyId&&(r|=d.UF2_FLAG_FAMILY_ID_PRESENT),h(i,0,d.UF2_MAGIC_START0),h(i,4,d.UF2_MAGIC_START1),h(i,8,r),h(i,12,o<<8),h(i,16,256),h(i,20,e.blocks.length),h(i,28,e.familyId),h(i,508,d.UF2_MAGIC_END);for(var f=32;f<288;++f)i[f]=255;e.filename&&O.U.memcpy(i,288,O.U.stringToUint8Array(O.U.toUTF8(e.filename))),e.blocks.push(i),e.ptrs.push(o)}e.currPtr=o,e.currBlock=i}var p=32+(255&t);for(l=0;l<n.length;++l)i[p+l]=n[l];e.filesize=Math.max(e.filesize,n.length+t)}}d.UF2_MAGIC_START0=171066965,d.UF2_MAGIC_START1=2656915799,d.UF2_MAGIC_END=179400496,d.UF2_FLAG_NONE=0,d.UF2_FLAG_NOFLASH=1,d.UF2_FLAG_FILE=4096,d.UF2_FLAG_FAMILY_ID_PRESENT=8192,d.parseBlock=v,d.parseFile=function(e){for(var t=[],n=0;n<e.length;n+=512){var r=v(e.slice(n,n+512));r&&t.push(r)}return t},d.toBin=function(e,t){if(void 0===t&&(t=void 0),e.length<512)return null;for(var n=-1,r=-1,i=[],o=0;o<e.length;++o){var a=512*o,s=v(e.slice(a,a+512));if(s){if(t&&s.targetAddr+256>t)break;-1==n&&(r=n=s.targetAddr);var c=s.targetAddr-n;c<0||c%4||1048576<c||(0<c&&i.push(new Uint8Array(c)),i.push(e.slice(a+32,a+32+s.payloadSize)),n=s.targetAddr+s.payloadSize)}}for(var l=0,u=0,f=i;u<f.length;u++)l+=(m=f[u]).length;if(0==l)return null;for(var p=new Uint8Array(l),d=0,h=0,g=i;h<g.length;h++){var m=g[h];for(o=0;o<m.length;++o)p[d++]=m[o]}return{buf:p,start:r}},d.readBytes=function(e,t,n){for(var r,i=new Uint8Array(n),o=0;o<n;++o,++t)a(r,t)||(r=e.filter(function(e){return a(e,t)})[0]),r&&(i[o]=r.data[t-r.targetAddr]);return i},d.newBlockFile=s,d.finalizeFile=c,d.concatFiles=function(e){for(var t=0,n=e;t<n.length;t++)c(a=n[t]),a.filename=null;var r=s();r.blocks=O.U.concat(e.map(function(e){return e.blocks}));for(var i=0,o=e;i<o.length;i++){var a;(a=o[i]).blocks=[]}return r},d.serializeFile=function(e){c(e);for(var t="",n=0,r=e.blocks;n<r.length;n++){var i=r[n];t+=O.Util.uint8ArrayToString(i)}return t},d.readBytesFromFile=function e(t,n,r){var i,o=n>>8;if(o==t.currPtr)i=t.currBlock;else{for(var a=0;a<t.ptrs.length;++a)if(t.ptrs[a]==o){i=t.blocks[a];break}i&&(t.currPtr=o,t.currBlock=i)}if(!i)return null;var s=new Uint8Array(r),c=Math.min(r,256-(255&n));O.U.memcpy(s,0,i,32+(255&n),c);var l=r-c;if(0<l){var u=e(t,n+c,l);O.U.memcpy(s,c,u)}return s},d.writeBytes=g,d.writeHex=function(e,t){for(var n="0000",r=0;r<t.length;++r){var i=/:02000004(....)/.exec(t[r]);if(i&&(n=i[1]),i=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(t[r])){for(var o=parseInt(n+i[1],16),a=i[2],s=[],c=0;c<a.length;c+=2)s.push(parseInt(a[c]+a[c+1],16));g(e,o,s)}}}}(O.UF2||(O.UF2={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={})),function(n){var e;(e=n.streams||(n.streams={})).createStreamAsync=function(e,t){return n.Cloud.privatePostAsync("streams",{target:e,name:t||"data"}).then(function(e){return e})},e.postPayloadAsync=function(e,t){return n.Util.assert(!!e.privatekey),n.Cloud.privatePostAsync(e.id+"/data?privatekey="+e.privatekey,t)}}(pxt||(pxt={})),function(S){!function(n){var r,e,i,t;(e=r=n.PatternUnits||(n.PatternUnits={}))[e.userSpaceOnUse=0]="userSpaceOnUse",e[e.objectBoundingBox=1]="objectBoundingBox",(t=i=n.LengthUnit||(n.LengthUnit={}))[t.em=0]="em",t[t.ex=1]="ex",t[t.px=2]="px",t[t.in=3]="in",t[t.cm=4]="cm",t[t.mm=5]="mm",t[t.pt=6]="pt",t[t.pc=7]="pc",t[t.percent=8]="percent";var o=function(){function e(e){this.el=E(e)}return e.prototype.attr=function(t){var n=this;return Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),this},e.prototype.setAttribute=function(e,t){return this.el.setAttribute(e,t.toString()),this},e.prototype.setAttributeNS=function(e,t,n){return this.el.setAttributeNS(e,t,n.toString()),this},e.prototype.id=function(e){return this.setAttribute("id",e)},e.prototype.setClass=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.setAttribute("class",e.join(" "))},e.prototype.appendClass=function(e){return S.BrowserUtils.addClass(this.el,e),this},e.prototype.removeClass=function(e){S.BrowserUtils.removeClass(this.el,e)},e.prototype.title=function(e){this.titleElement||(this.titleElement=E("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=e},e.prototype.setVisible=function(e){return this.setAttribute("visibility",e?"visible":"hidden")},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.draw=function(e){var t=function(e){switch(e){case"text":return new d;case"circle":return new g;case"rect":return new h;case"line":return new m;case"polygon":return new b;case"polyline":return new y;case"path":return new w;default:return new p(e)}}(e);return this.el.appendChild(t.el),t},t.prototype.element=function(e,t){return t(this.draw(e)),this},t.prototype.group=function(){var e=new c;return this.el.appendChild(e.el),e},t.prototype.appendChild=function(e){this.el.appendChild(e.el)},t.prototype.onDown=function(e){return n.events.down(this.el,e),this},t.prototype.onUp=function(e){return n.events.up(this.el,e),this},t.prototype.onMove=function(e){return n.events.move(this.el,e),this},t.prototype.onEnter=function(e){return n.events.enter(this.el,e),this},t.prototype.onLeave=function(e){return n.events.leave(this.el,e),this},t.prototype.onClick=function(e){return n.events.click(this.el,e),this},t}(n.BaseElement=o),s=function(n){function e(e){var t=n.call(this,"svg")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.define=function(e){return this.defs||(this.defs=new u(this.el)),e(this.defs),this},e}(n.DrawContext=a);n.SVG=s;var c=function(n){function e(e){var t=n.call(this,"g")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.translate=function(e,t){return this.left=e,this.top=t,this.updateTransform()},e.prototype.scale=function(e){return this.scaleFactor=e,this.updateTransform()},e.prototype.def=function(){return new u(this.el)},e.prototype.style=function(){return new f(this.el)},e.prototype.updateTransform=function(){var e="";return null!=this.left&&(e+="translate("+this.left+" "+this.top+")"),null!=this.scaleFactor&&(e+=" scale("+this.scaleFactor+")"),this.setAttribute("transform",e),this},e}(a);n.Group=c;var l=function(e){function t(){return e.call(this,"pattern")||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("patternUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.contentUnits=function(e){return this.setAttribute("patternContentUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.size=function(e,t){return this.setAttribute("width",e),this.setAttribute("height",t),this},t}(a);n.Pattern=l;var u=function(n){function e(e){var t=n.call(this,"defs")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.create=function(e,t){var n;switch(e){case"path":n=new w;break;case"pattern":n=new l;break;case"radialGradient":n=new T;break;case"linearGradient":n=new A;break;case"clipPath":n=new C;break;default:n=new o(e)}return n.id(t),this.el.appendChild(n.el),n},e}(o);n.DefsElement=u;var f=function(n){function e(e){var t=n.call(this,"style")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.content=function(e){this.el.textContent=e},e}(o);n.StyleElement=f;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("x",e),this.setAttribute("y",t),this},t.prototype.moveTo=function(e,t){return this.at(e,t)},t.prototype.fill=function(e,t){return this.setAttribute("fill",e),null!=t&&this.opacity(t),this},t.prototype.opacity=function(e){return this.setAttribute("fill-opacity",e)},t.prototype.stroke=function(e,t){return this.setAttribute("stroke",e),null!=t&&this.strokeWidth(t),this},t.prototype.strokeWidth=function(e){return this.setAttribute("stroke-width",e)},t.prototype.strokeOpacity=function(e){return this.setAttribute("stroke-opacity",e)},t.prototype.clipPath=function(e){return this.setAttribute("clip-path",e)},t}(a),d=function(n){function e(e){var t=n.call(this,"text")||this;return null!=e&&t.text(e),t}return __extends(e,n),e.prototype.text=function(e){return this.el.textContent=e,this},e.prototype.fontFamily=function(e){return this.setAttribute("font-family",e)},e.prototype.fontSize=function(e,t){return this.setAttribute("font-size",U(e,t))},e.prototype.offset=function(e,t,n){return 0!==e&&this.setAttribute("dx",U(e,n)),0!==t&&this.setAttribute("dy",U(t,n)),this},e.prototype.anchor=function(e){return this.setAttribute("text-anchor",e)},e}(n.Drawable=p);n.Text=d;var h=function(e){function t(){return e.call(this,"rect")||this}return __extends(t,e),t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",U(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",U(e,t))},t.prototype.corner=function(e){return this.corners(e,e)},t.prototype.corners=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(p);n.Rect=h;var g=function(e){function t(){return e.call(this,"circle")||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(p);n.Circle=g;!function(e){function t(){return e.call(this,"ellipse")||this}__extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this}}(p);var m=function(e){function t(){return e.call(this,"line")||this}return __extends(t,e),t.prototype.at=function(e,t,n,r){return this.from(e,t),null!=n&&null!=r&&this.to(n,r),this},t.prototype.from=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.to=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(p);n.Line=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.points=function(e){return this.setAttribute("points",e)},t.prototype.with=function(e){return this.points(e.map(function(e){return e.x+" "+e.y}).join(","))},t}(p),y=function(e){function t(){return e.call(this,"polyline")||this}return __extends(t,e),t}(n.PolyElement=v);n.Polyline=y;var b=function(e){function t(){return e.call(this,"polygon")||this}return __extends(t,e),t}(v);n.Polygon=b;var w=function(t){function e(){var e=t.call(this,"path")||this;return e.d=new _,e}return __extends(e,t),e.prototype.update=function(){return this.setAttribute("d",this.d.toAttribute())},e.prototype.path=function(e){return e(this.d),this.update()},e}(p);n.Path=w;var k=function(e){function t(){return e.call(this,"image")||this}return __extends(t,e),t.prototype.src=function(e){return this.setAttributeNS("http://www.w3.org/1999/xlink","href",e)},t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",U(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",U(e,t))},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(p);n.Image=k;var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("gradientUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.stop=function(e,t,n){var r=E("stop");return r.setAttribute("offset",e+"%"),null!=t&&r.setAttribute("stop-color",t),null!=n&&r.setAttribute("stop-opacity",n),this.el.appendChild(r),this},t}(o),A=function(e){function t(){return e.call(this,"linearGradient")||this}return __extends(t,e),t.prototype.start=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.end=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(n.Gradient=x);n.LinearGradient=A;var T=function(e){function t(){return e.call(this,"radialGradient")||this}return __extends(t,e),t.prototype.center=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.focus=function(e,t,n){return this.setAttribute("fx",e),this.setAttribute("fy",t),this.setAttribute("fr",n),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(x);n.RadialGradient=T;var C=function(e){function t(){return e.call(this,"clipPath")||this}return __extends(t,e),t.prototype.clipPathUnits=function(e){return e?this.setAttribute("clipPathUnits","objectBoundingBox"):this.setAttribute("clipPathUnits","userSpaceOnUse")},t}(a);function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}n.ClipPath=C;var _=function(){function e(){this.ops=[]}return e.prototype.clear=function(){this.ops=[]},e.prototype.moveTo=function(e,t){return this.op("M",e,t)},e.prototype.moveBy=function(e,t){return this.op("m",e,t)},e.prototype.lineTo=function(e,t){return this.op("L",e,t)},e.prototype.lineBy=function(e,t){return this.op("l",e,t)},e.prototype.cCurveTo=function(e,t,n,r,i,o){return this.op("C",e,t,n,r,i,o)},e.prototype.cCurveBy=function(e,t,n,r,i,o){return this.op("c",e,t,n,r,i,o)},e.prototype.qCurveTo=function(e,t,n,r){return this.op("Q",e,t,n,r)},e.prototype.qCurveBy=function(e,t,n,r){return this.op("q",e,t,n,r)},e.prototype.sCurveTo=function(e,t,n,r){return this.op("S",e,t,n,r)},e.prototype.sCurveBy=function(e,t,n,r){return this.op("s",e,t,n,r)},e.prototype.tCurveTo=function(e,t){return this.op("T",e,t)},e.prototype.tCurveBy=function(e,t){return this.op("t",e,t)},e.prototype.arcTo=function(e,t,n,r,i,o,a){return this.op("A",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.arcBy=function(e,t,n,r,i,o,a){return this.op("a",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.close=function(){return this.op("z")},e.prototype.toAttribute=function(){return this.ops.map(function(e){return e.op+" "+e.args.join(" ")}).join(" ")},e.prototype.op=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.ops.push({op:e,args:t}),this},e}();function U(e,t){switch(t){case i.em:return e+"em";case i.ex:return e+"ex";case i.px:return e+"px";case i.in:return e+"in";case i.cm:return e+"cm";case i.mm:return e+"mm";case i.pt:return e+"pt";case i.pc:return e+"pc";case i.percent:return e+"%";default:return e.toString()}}n.PathContext=_}(S.svgUtil||(S.svgUtil={}))}(pxt||(pxt={})),function(e){var t;(function(e){function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}e.isTouchEnabled=n,e.hasPointerEvents=r,e.down=function(e,t){r()?e.addEventListener("pointerdown",t):n()?(e.addEventListener("mousedown",t),e.addEventListener("touchstart",t)):e.addEventListener("mousedown",t)},e.up=function(e,t){r()?e.addEventListener("pointerup",t):(n(),e.addEventListener("mouseup",t))},e.enter=function(e,t){r()?e.addEventListener("pointerover",function(e){t(!!(1&e.buttons))}):n()?e.addEventListener("touchstart",function(e){t(!0)}):e.addEventListener("mouseover",function(e){t(!!(1&e.buttons))})},e.leave=function(e,t){r()?e.addEventListener("pointerleave",t):n()?e.addEventListener("touchend",t):e.addEventListener("mouseleave",t)},e.move=function(e,t){r()?e.addEventListener("pointermove",t):n()?e.addEventListener("touchmove",t):e.addEventListener("mousemove",t)},e.click=function(e,t){e.addEventListener("click",t)}})((t=e.svgUtil||(e.svgUtil={})).events||(t.events={}))}(pxt||(pxt={})),function(e){var t,n,r;t=e.svgUtil||(e.svgUtil={}),n=t.helpers||(t.helpers={}),r=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.at=function(e,t){return this.cx=e,this.cy=t,this.rePosition(),this},e.prototype.text=function(e,t){return void 0===t&&(t=12),n.prototype.text.call(this,e),this.fontSizePixels=t,this.setAttribute("font-size",t+"px"),this.rePosition(),this},e.prototype.rePosition=function(){null!=this.cx&&null!=this.cy&&null!=this.fontSizePixels&&(this.setAttribute("x",this.cx),this.setAttribute("y",this.cy),this.setAttribute("text-anchor","middle"),this.setAttribute("alignment-baseline","middle"))},e}(t.Text),n.CenteredText=r}(pxt||(pxt={})),function(g){var m="image/x-mkcd-f4",u="application/mkcd-tilemap",e=function(){function e(){this.needsRebuild=!0,this.nextID=0,this.state={revision:this.nextID++},this.undoStack=[],this.redoStack=[]}return e.prototype.getGalleryTiles=function(t){return this.extensionTileSets?this.extensionTileSets.map(function(e){return e.tileSets.find(function(e){return e.tileWidth===t})}).filter(function(e){var t;return null===(t=e)||void 0===t?void 0:t.tiles.length}):null},e.prototype.getProjectTiles=function(t,e){if(this.state.projectTileSet){var n=this.state.projectTileSet.tileSets.find(function(e){return e.tileWidth===t});return!n&&e?(this.createNewTile(new g.sprite.Bitmap(t,t).data()),this.getProjectTiles(t,!1)):n}return null},e.prototype.createNewTile=function(e,t){if(this.onChange(),!t||this.state.takenNames[t]){for(var n=g.sprite.TILE_NAMESPACE+"."+g.sprite.TILE_PREFIX,r=1;this.state.takenNames[n+r];)++r;t=n+r}this.state.takenNames[t]=!0;for(var i={id:t,data:g.sprite.base64EncodeBitmap(e),bitmap:e,isProjectTile:!0},o=0,a=this.state.projectTileSet.tileSets;o<a.length;o++){var s=a[o];if(s.tileWidth===e.width)return s.tiles.push(i),i}var c=this.createTileset(e.width);return c.tiles.push(i),this.state.projectTileSet.tileSets.push(c),i},e.prototype.updateTile=function(e,t){this.onChange();for(var n=0,r=this.state.projectTileSet.tileSets;n<r.length;n++)for(var i=0,o=r[n].tiles;i<o.length;i++){var a=o[i];if(a.id===e)return a.bitmap=t,a.data=g.sprite.base64EncodeBitmap(t),a}return null},e.prototype.deleteTile=function(t){this.onChange();for(var e=0,n=this.state.projectTileSet.tileSets;e<n.length;e++){var r=n[e];r.tiles=r.tiles.filter(function(e){return e.id!==t})}},e.prototype.getProjectTilesetJRes=function(){for(var e={},t=0,n=function(e){for(var t=[],n=0,r=e.tileSets;n<r.length;n++){var i=r[n];t.push.apply(t,i.tiles)}return t}(this.state.projectTileSet);t<n.length;t++){var r=n[t];e[r.id.substr(r.id.lastIndexOf(".")+1)]={data:r.data,mimeType:m,tilemapTile:!0}}for(var i=0,o=this.state.projectTilemaps;i<o.length;i++){var a=o[i],s=this.encodeTilemap(a.data,a.id);e[s.id]=s}return e["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:g.sprite.TILE_NAMESPACE},e},e.prototype.getTilemap=function(e){for(var t=0,n=this.state.projectTilemaps;t<n.length;t++){var r=n[t];if(r.id===e)return r.data.cloneData()}return null},e.prototype.getAllTilemaps=function(){var e;return(null===(e=this.state.projectTilemaps)||void 0===e?void 0:e.slice())||[]},e.prototype.updateTilemap=function(e,t){for(var n=0,r=this.state.projectTilemaps;n<r.length;n++){var i=r[n];i.id===e&&(this.onChange(),i.data=t.cloneData())}},e.prototype.createNewTilemap=function(e,t,n,r){return void 0===n&&(n=16),void 0===r&&(r=16),this.createNewTilemapFromData(this.blankTilemap(t,n,r),e)},e.prototype.blankTilemap=function(e,t,n){void 0===t&&(t=16),void 0===n&&(n=16);var r=new g.sprite.Tilemap(t,n),i=new g.sprite.Bitmap(t,n),o={tileWidth:e,tiles:[this.getTransparency(e)]};return new g.sprite.TilemapData(r,o,i.data())},e.prototype.resolveTile=function(e){for(var t=0,n=[this.state.projectTileSet].concat(this.extensionTileSets);t<n.length;t++){var r=i(n[t],e);if(r)return r}return null},e.prototype.resolveTileByBitmap=function(e){for(var t=[this.state.projectTileSet].concat(this.extensionTileSets),n=g.sprite.base64EncodeBitmap(e),r=0,i=t;r<i.length;r++)for(var o=0,a=i[r].tileSets;o<a.length;o++){var s=a[o];if(s.tileWidth===e.width)for(var c=0,l=s.tiles;c<l.length;c++){var u=l[c];if(n===u.data)return u}}return null},e.prototype.getTransparency=function(e){for(var t=0,n=this.state.projectTileSet.tileSets;t<n.length;t++){var r=n[t];if(r.tileWidth===e)return r.tiles[0]}var i=this.createTileset(e);return this.state.projectTileSet.tileSets.push(i),i.tiles[0]},e.prototype.createNewTilemapFromData=function(e,t){this.onChange(),t||(t=lf("level"));for(var n=0,r=t;this.state.takenNames[t];)t=r+"_"+n,++n;return this.state.takenNames[t]=!0,this.state.projectTilemaps.push({id:t,data:e}),[t,e]},e.prototype.cloneState=function(){return __assign(__assign({},this.state),{projectTileSet:__assign(__assign({},this.state.projectTileSet),{tileSets:this.state.projectTileSet.tileSets.map(function(e){return __assign(__assign({},e),{tiles:e.tiles.map(t)})})}),projectTilemaps:this.state.projectTilemaps.map(function(e){return __assign({},e)}),takenNames:__assign({},this.state.takenNames)})},e.prototype.undo=function(){if(this.undoStack.length){var e=this.undoStack.pop();this.redoStack.push(this.state),this.state=e,this.needsRebuild=!0}},e.prototype.redo=function(){if(this.redoStack.length){var e=this.redoStack.pop();this.undoStack.push(this.state),this.state=e,this.needsRebuild=!0}},e.prototype.pushUndo=function(){this.undoStack.length&&this.undoStack[this.undoStack.length-1].revision===this.state.revision||(this.redoStack=[],this.undoStack.push(this.state),this.state=this.cloneState())},e.prototype.revision=function(){return this.state.revision},e.prototype.encodeTilemap=function(e,t){var n=e.tilemap.data(),r=new Uint8ClampedArray(5+n.data.length+e.layers.data.length);return r[0]=e.tileset.tileWidth,r[1]=255&n.width,r[2]=n.width>>8&255,r[3]=255&n.height,r[4]=n.height>>8&255,r.set(n.data,5),r.set(e.layers.data,5+n.data.length),{id:t,mimeType:u,data:btoa(g.sprite.uint8ArrayToHex(r)),tileset:e.tileset.tiles.map(function(e){return e.id})}},e.prototype.forceUpdate=function(){this.onChange()},e.prototype.loadPackage=function(e){var t=this,n=e.sortedDeps();this.extensionTileSets=[];for(var r=0,i=n;r<i.length;r++){var o=i[r],a="this"===o.id,s=h(o.parseJRes(),o.id,a);s?a?this.state.projectTileSet=s:this.extensionTileSets.push(s):a&&(this.state.projectTileSet={extensionID:"this",tileSets:[]})}this.state.projectTilemaps=v(e.parseJRes()).map(function(e){return{id:e.id,data:y(e,function(e){return t.resolveTile(e)})}});var c=e.getJRes();this.state.takenNames={};for(var l=0,u=Object.keys(c);l<u.length;l++){var f=u[l];this.state.takenNames[f]=!0}},e.prototype.loadJres=function(e,t){var n,r=this;void 0===t&&(t=!1);var i=h(e=g.inflateJRes(e),"this",!0),o={};if(i)for(var a=0,s=i.tileSets;a<s.length;a++)for(var c=0,l=s[a].tiles;c<l.length;c++){var u=l[c];if(t){var f=this.resolveTileByBitmap(u.bitmap);if(f){o[u.id]=f.id;continue}}var p=this.createNewTile(u.bitmap,u.id);p.id!==u.id&&(o[u.id]=p.id)}var d=v(e).map(function(e){return{id:e.id,data:y(e,function(e){return o[e]&&(e=o[e]),r.resolveTile(e)})}});(n=this.state.projectTilemaps).push.apply(n,d),d.forEach(function(e){return r.state.takenNames[e.id]=!0})},e.prototype.createTileset=function(e){this.needsRebuild=!0;for(var t={tileWidth:e,tiles:[]},n=g.sprite.TILE_NAMESPACE+".transparency"+e,r=n,i=1;this.resolveTile(r);)r=n+"_"+i,++i;var o=new g.sprite.Bitmap(e,e).data();return t.tiles.push({id:r,bitmap:o,data:g.sprite.base64EncodeBitmap(o),isProjectTile:!0}),t},e.prototype.onChange=function(){this.needsRebuild=!0,this.state.revision=this.nextID++},e}();function h(e,t,n){void 0===n&&(n=!1);for(var r=[],i=0,o=Object.keys(e);i<o.length;i++){var a=e[o[i]];if(a.tilemapTile){var s={data:a.data,id:a.id,bitmap:g.sprite.getBitmapFromJResURL("data:"+m+";base64,"+a.data).data(),isProjectTile:n};r.push(s)}}for(var c=[],l=0,u=r;l<u.length;l++){s=u[l];for(var f=!1,p=0,d=c;p<d.length;p++){var h=d[p];if(h.tileWidth===s.bitmap.width){h.tiles.push(s),f=!0;break}}f||c.push({tileWidth:s.bitmap.width,tiles:[s]})}return c.length?{extensionID:t,tileSets:c}:null}function v(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=e[r[n]];i.mimeType===u&&t.push(i)}return t}function i(e,t){for(var n=0,r=e.tileSets;n<r.length;n++)for(var i=0,o=r[n].tiles;i<o.length;i++){var a=o[i];if(a.id===t)return a}return null}function t(e){return __assign(__assign({},e),{bitmap:g.sprite.Bitmap.fromData(e.bitmap).copy().data()})}function y(e,t){var n=atob(e.data),r=g.U.fromHex(n),i=r[1]|r[2]<<8,o=r[3]|r[4]<<8,a={tileWidth:r[0],tiles:e.tileset.map(function(e){return t&&t(e)||{id:e}})},s=r.slice(5,5+i*o),c=new g.sprite.Tilemap(i,o,0,0,new Uint8ClampedArray(s)),l=r.slice(5+s.length),u=new g.sprite.Bitmap(i,o,0,0,new Uint8ClampedArray(l)).data();return new g.sprite.TilemapData(c,a,u)}g.TilemapProject=e,g.emitTilemapsFromJRes=function(e){for(var t=Object.keys(e),n="",r=[],i=0,o=t;i<o.length;i++){var a=o[i];if("*"!==a){var s=e[a];if(s.tilemapTile&&(n+="    //% fixedInstance jres blockIdentity=images._tile\n",n+="    export const "+a+" = image.ofBuffer(hex``);\n"),s.mimeType===u){var c=y(s);r.push('case "'+a+'": return '+g.sprite.encodeTilemap(c,"typescript"))}}}r.length&&(n+="\n    helpers.registerTilemapFactory(function(name: string) {\n        switch(helpers.stringTrim(name)) {\n"+r.map(function(e){return"            "+e}).join("\n")+"\n        }\n        return null;\n    })\n");var l=lf("Auto-generated code. Do not edit.");return"// "+l+"\nnamespace "+g.sprite.TILE_NAMESPACE+" {\n"+n+"\n}\n// "+l+"\n"}}(pxt||(pxt={})),function(o){!function(e){e.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c",addpackage:"#717171",search:"#000",debug:"#e03030",default:"#dddddd",topblocks:"#aa8f00",recipes:"#717171"},e.blockIcons={loops:"",logic:"",math:"",variables:"",functions:"",text:"",arrays:"",advancedcollapsed:"",advancedexpanded:"",more:"",addpackage:"",search:"",debug:"",default:"",topblocks:"",recipes:""};var r="";function i(e){var t=function(e,t,n){var r=0,i=0,o=0;if(0==t)o=i=r=n;else{var a=Math.floor(e/60),s=e/60-a,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(a){case 1:r=l,i=n,o=c;break;case 2:r=c,i=n,o=u;break;case 3:r=c,i=l,o=n;break;case 4:r=u,i=c,o=n;break;case 5:r=n,i=c,o=l;break;case 6:case 0:r=n,i=u,o=c}}return[Math.floor(r),Math.floor(i),Math.floor(o)]}(e,.45,165.75);return"#"+n(t[0])+n(t[1])+n(t[2])}function n(e){var t=e.toString(16);return 1==t.length?"0"+t:t}e.appendToolboxIconCss=function(e,t){if(!(-1<r.indexOf(e)))if(1===t.length){var n=o.Util.unicodeToChar(t);r+="\n                .blocklyTreeIcon."+e+'::before {\n                    content: "'+n+'";\n                }\n            '}else r+="\n                .blocklyTreeIcon."+e+' {\n                    background-image: url("'+o.Util.pathJoin(o.webConfig.commitCdnUrl,encodeURI(t))+'")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }\n            '},e.getNamespaceColor=function(e){return e=e.toLowerCase(),o.appTarget.appTheme.blockColors&&o.appTarget.appTheme.blockColors[e]?o.appTarget.appTheme.blockColors[e]:o.toolbox.blockColors[e]?o.toolbox.blockColors[e]:""},e.getNamespaceIcon=function(e){return e=e.toLowerCase(),o.appTarget.appTheme.blockIcons&&o.appTarget.appTheme.blockIcons[e]?o.appTarget.appTheme.blockIcons[e]:o.toolbox.blockIcons[e]?o.toolbox.blockIcons[e]:""},e.advancedTitle=function(){return o.Util.lf("{id:category}Advanced")},e.addPackageTitle=function(){return o.Util.lf("{id:category}Extensions")},e.recipesTitle=function(){return o.Util.lf("{id:category}Tutorials")},e.convertColor=function(e){var t;e=(t=e)?"0x"==t.substring(0,2)?"#"+t.substring(2):t:"#000000";var n=parseInt(e);return isNaN(n)?e:i(n)},e.hueToRgb=i,e.fadeColor=function(e,t,n){(e=e.replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);for(var r="#",i=0;i<3;i++){var o=parseInt(e.substr(2*i,2),16),a=(o=Math.round(Math.min(Math.max(0,n?o+o*t:o-o*t),255))).toString(16);r+=("00"+a).substr(a.length)}return r}}(o.toolbox||(o.toolbox={}))}(pxt||(pxt={})),function(A){!function(e){var b=/^##[^#](.*)$([\s\S]*?)(?=^##[^#]|$(?![\r\n]))/gim,w=/^###[^#](.*)$([\s\S]*?)(?=^###[^#]|$(?![\r\n]))/gim;function k(e,t,s){var n=t||b,c=[];if(e.replace(n,function(e,t,n){var r=function(e,t){var n,r=e=x(e);if(t){var i=/#+ ~ tutorialhint([\s\S]*)/i;r=e.replace(i,function(e,t){return n=t,""})}else{var i=/(^[\s\S]*?\S)\s*((```|\!\[[\s\S]+?\]\(\S+?\))[\s\S]*)/im,o=e.match(i);o&&2<o.length&&(r=o[1].trim(),n=o[2].trim())}return{header:r,hint:n}}(n=n.trim(),s&&s.explicitHints),i=r.header,o=r.hint,a={contentMd:n,headerContentMd:i};return/@(fullscreen|unplugged)/.test(t)&&(a.fullscreen=!0),/@unplugged/.test(t)&&(a.unplugged=!0),/@tutorialCompleted/.test(t)&&(a.tutorialCompleted=!0),/@resetDiff/.test(t)&&(a.resetDiff=!0),o&&(a.hintContentMd=o),c.push(a),""}),0!=e.indexOf("# Not found"))return c;A.debug("tutorial not found")}function x(e){if(!e)return e;return e.replace(/```(filterblocks|package|ghost|config|template|jres)\s*\n([\s\S]*?)\n```/gim,"").trim()}e.parseTutorial=function(e){var t,n=(l=e,u={},f=l.replace(/### @(\S+) ([ \S]+)/gi,function(e,t,n){try{u[t]=JSON.parse(n)}catch(e){u[t]=n}return""}),p=u,void 0!==p.explicitHints&&A.appTarget.appTheme&&A.appTarget.appTheme.tutorialExplicitHints&&(p.explicitHints=!0),{metadata:p,body:f}),r=n.metadata,i=n.body,o=function(e,t){if(t&&t.activities)return o=t,a=[],s=[],e.replace(b,function(e,t,n){var r=s.length;s.push({name:t||lf("Activity {0}",r),step:a.length});var i=k(n,w,o);return i=i.map(function(e){return e.activity=r,e}),a=a.concat(i),""}),{steps:a,activities:s};var o,a,s,n=k(e,null,t);return(!n||n.length<1)&&(n=k(e,w,t)),{steps:n,activities:null}}(i,r),a=o.steps,s=o.activities,c=(t=i.match(/^#[^#](.*)$/im))&&1<t.length?t[1]:null;var l,u,f,p;if(a){var d=function(e){var r,i,o,t=void 0,a=[];return e.replace(/((?!.)\s)+/g,"\n").replace(/``` *(sim|block|blocks|filterblocks|spy|ghost|typescript|ts|js|javascript|template|python|jres)?\s*\n([\s\S]*?)\n```/gim,function(e,t,n){switch(t){case"block":case"blocks":case"filterblocks":if(!s(A.BLOCKS_PROJECT_NAME))return;break;case"spy":case"python":if(!s(A.PYTHON_PROJECT_NAME))return;"python"==t&&(o=t);break;case"typescript":case"ts":case"javascript":case"js":if(!s(A.JAVASCRIPT_PROJECT_NAME))return;break;case"template":i=n;break;case"jres":r=n}return a.push("python"==t?"\n"+n+"\n":"{\n"+n+"\n}"),""}),t=t||A.BLOCKS_PROJECT_NAME,{code:a,templateCode:i,editor:t,language:o,jres:r};function s(e){return t&&t!=e?(A.debug("tutorial ambiguous: contains snippets of different types"),!1):(t=e,!0)}}(i),h=d.code,g=d.templateCode,m=d.editor,v=d.language,y=d.jres;return(!0===r.diffs||!1!==r.diffs&&!0!==r.noDiffs&&(m==A.BLOCKS_PROJECT_NAME&&A.appTarget.appTheme.tutorialBlocksDiff||m!=A.BLOCKS_PROJECT_NAME&&A.appTarget.appTheme.tutorialTextDiff))&&function(e,r){var c=void 0;function i(e){var a={typescript:"diff",spy:"diffspy",blocks:"diffblocks",python:"diff"},s=/\s*(\/\/|#)\s*@highlight/gm;return e?e.replace(/```(typescript|spy|python|blocks|ghost|template)((?:.|[\r\n])+)```/,function(e,t,n){var r=c,i=/^(template|ghost)$/.test(t),o=s.test(n);return n=n.replace(/^\n+/,"").replace(/\n+$/,""),o&&(n=n.replace(s,"")),c=n,!r||o||i?e:"```"+a[t]+"\n"+r+"\n----------\n"+n+"\n```"}):e}e.forEach(function(e,t){if((e.resetDiff||r&&r.find(function(e){return e.step==t}))&&(c=void 0),e.hintContentMd){var n=i(e.hintContentMd);if(n&&n!=e.hintContentMd)return void(e.hintContentMd=n)}if(e.headerContentMd){var n=i(e.headerContentMd);if(n&&n!=e.headerContentMd)return void(e.headerContentMd=n)}})}(a,s),a.forEach(function(e){e.contentMd=x(e.contentMd),e.headerContentMd=x(e.headerContentMd),e.hintContentMd=x(e.hintContentMd)}),{editor:m,title:c,steps:a,activities:s,code:h,templateCode:g,metadata:r,language:v,jres:y}}},e.highlight=function(e){var t=e.textContent;if(t=(t=t.replace(/img\s*\(\s*"{3}(.|\n)*"{3}\s*\)/g,'img(""" """)')).replace(/img\s*\s*`(.|\n)*`\s*/g,"img` `"),/@highlight/.test(t)){e.textContent="";for(var n=t.split("\n"),r=0;r<n.length;++r){0<r&&r<n.length&&e.appendChild(document.createTextNode("\n"));var i=n[r];if(/@highlight/.test(i)){if(void 0!==(i=n[++r])){var o=document.createElement("span");o.className="highlight-line",o.textContent=i,e.appendChild(o)}}else e.appendChild(document.createTextNode(i))}}else e.textContent=t},e.getTutorialOptions=function(e,t,n,r,i){var o=A.tutorial.parseTutorial(e);if(!o)throw new Error(lf("Invalid tutorial format"));return{options:{tutorial:t,tutorialName:o.title||n,tutorialReportId:r,tutorialStep:0,tutorialReady:!0,tutorialHintCounter:0,tutorialStepInfo:o.steps,tutorialActivityInfo:o.activities,tutorialMd:e,tutorialCode:o.code,tutorialRecipe:!!i,templateCode:o.templateCode,autoexpandStep:!0,metadata:o.metadata,language:o.language,jres:o.jres},editor:o.editor}}}(A.tutorial||(A.tutorial={}))}(pxt||(pxt={})),function(u){!function(n){var r,e;n.flattenDiagnosticMessageText=function(e,t){if("string"==typeof e)return e;for(var n=e,r="",i=0;n;){if(i){r+=t;for(var o=0;o<i;o++)r+="  "}r+=n.messageText,i++,n=n.next}return r},(e=r=n.ScriptTarget||(n.ScriptTarget={}))[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest",n.isIdentifierStart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||36===e||95===e||127<e&&c(e,t)},n.isIdentifierPart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||36===e||95===e||127<e&&(n=e,t>=r.ES5?l(n,o):l(n,s));var n},n.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],n.keywordTypes=["boolean","number","string"],n.escapeIdentifier=function(e){if(!e)return"_";var t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,function(e){return u.pxtc.isIdentifierPart(e.charCodeAt(0),u.pxtc.ScriptTarget.ES5)?e:""});return t&&u.pxtc.isIdentifierStart(t.charCodeAt(0),u.pxtc.ScriptTarget.ES5)&&-1===n.reservedWords.indexOf(t)||(t="_"+t),t};var t,i=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],o=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],a=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],s=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];function c(e,t){return t>=r.ES5?l(e,i):l(e,a)}function l(e,t){if(e<t[0])return!1;for(var n,r=0,i=t.length;r+1<i;){if(n=r+(i-r)/2,t[n-=n%2]<=e&&e<=t[n+1])return!0;e<t[n]?i=n:r=n+2}return!1}n.isUnicodeIdentifierStart=c,(t=n.DiagnosticCategory||(n.DiagnosticCategory={}))[t.Warning=0]="Warning",t[t.Error=1]="Error",t[t.Message=2]="Message"}(u.pxtc||(u.pxtc={}))}(ts||(ts={})),function(d){!function(r){function i(){return!!navigator&&!!navigator.bluetooth&&"TextDecoder"in window&&d.appTarget.appTheme.bluetoothUartConsole&&d.appTarget.appTheme.bluetoothUartFilters&&0<d.appTarget.appTheme.bluetoothUartFilters.length}function o(){return!!navigator&&!!navigator.bluetooth&&!!d.appTarget.appTheme.bluetoothPartialFlashing}r.isAvailable=function(){return i()||o()},r.hasConsole=i,r.hasPartialFlash=o,r.isValidUUID=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(e)};var e=function(){function e(e,t){this.connectionTimeout=2e4,this.connectPromise=void 0,this.id=e,this.aliveToken=t}return e.prototype.debug=function(e){d.debug(this.id+": "+e)},e.prototype.alivePromise=function(e){var r=this;return new Promise(function(t,n){r.aliveToken.isCancelled()&&n(new Error),e.then(function(e){return t(e)},function(e){return n(e)})})},e.prototype.cancelConnect=function(){this.connectPromise=void 0},e.prototype.createConnectPromise=function(){return Promise.resolve()},e.prototype.connectAsync=function(){var t=this;return this.connectPromise||(this.connectPromise=this.alivePromise(this.createConnectPromise())),this.connectPromise.timeout(this.connectionTimeout,"connection timeout").then(function(){return t.aliveToken.throwIfCancelled()}).catch(function(e){throw t.connectPromise=void 0,e})},e.prototype.disconnect=function(){this.cancelConnect()},e.prototype.kill=function(){this.disconnect(),this.aliveToken.cancel()},e}(),t=function(i){function e(e,t,n){var r=i.call(this,e,t.aliveToken)||this;return r.device=t,r.autoReconnect=n,r.autoReconnectDelay=1e3,r.disconnectOnAutoReconnect=!1,r.reconnectPromise=void 0,r.failedConnectionServicesVersion=-1,r.handleDisconnected=r.handleDisconnected.bind(r),r.device.device.addEventListener("gattserverdisconnected",r.handleDisconnected),r}return __extends(e,i),e.prototype.handleDisconnected=function(e){var t=this;this.aliveToken.isCancelled()||(this.disconnect(),this.autoReconnect&&!this.reconnectPromise&&(this.reconnectPromise=Promise.delay(this.autoReconnectDelay).then(function(){return t.exponentialBackoffConnectAsync(8,500)}).finally(function(){return t.reconnectPromise=void 0})))},e.prototype.exponentialBackoffConnectAsync=function(t,n){var r=this;return this.debug("retry connect"),this.aliveToken.throwIfCancelled(),this.connectAsync().then(function(){r.aliveToken.throwIfCancelled(),r.debug("reconnect success"),r.reconnectPromise=void 0}).catch(function(e){return r.debug("reconnect error "+e.message),r.aliveToken.throwIfCancelled(),r.device.isPaired?r.autoReconnect?0==t?(r.debug("give up, max tries"),void(r.reconnectPromise=void 0)):r.failedConnectionServicesVersion==r.device.servicesVersion?(r.debug("services haven't changed, giving up"),void(r.reconnectPromise=void 0)):(r.debug("retry connect "+n+"ms... ("+t+" tries left)"),r.device.connected&&(r.failedConnectionServicesVersion=r.device.servicesVersion),r.disconnectOnAutoReconnect&&r.device.disconnect(),Promise.delay(n).then(function(){return r.exponentialBackoffConnectAsync(--t,1.8*n)})):(r.debug("autoreconnect disabled"),void(r.reconnectPromise=void 0)):(r.debug("give up, device unpaired"),void(r.reconnectPromise=void 0))})},e}(r.BLERemote=e),n=function(o){function e(e,t,n,r){var i=o.call(this,e,t,!0)||this;return i.device=t,i.serviceUUID=n,i.txCharacteristicUUID=r,i.handleValueChanged=i.handleValueChanged.bind(i),i}return __extends(e,o),e.prototype.createConnectPromise=function(){var t=this;return this.debug("connecting"),this.device.connectAsync().then(function(){return t.alivePromise(t.device.gatt.getPrimaryService(t.serviceUUID))}).then(function(e){return t.debug("service connected"),t.service=e,t.alivePromise(t.service.getCharacteristic(t.txCharacteristicUUID))}).then(function(e){return t.debug("tx characteristic connected"),t.txCharacteristic=e,t.txCharacteristic.addEventListener("characteristicvaluechanged",t.handleValueChanged),t.txCharacteristic.startNotifications()}).then(function(){d.tickEvent("webble.connected",{id:t.id})})},e.prototype.handlePacket=function(e){},e.prototype.handleValueChanged=function(e){var t=e.target.value;this.handlePacket(t)},e.prototype.disconnect=function(){if(o.prototype.disconnect.call(this),this.txCharacteristic&&this.device&&this.device.connected)try{this.txCharacteristic.stopNotifications(),this.txCharacteristic.removeEventListener("characteristicvaluechanged",this.handleValueChanged)}catch(e){d.log(this.id+": error "+e.message)}this.service=void 0,this.txCharacteristic=void 0},e}(r.BLEService=t),a=function(n){function o(e){var t=n.call(this,"hf2",e,o.SERVICE_UUID,o.CHARACTERISTIC_TX_UUID)||this;return t.device=e,t}return __extends(o,n),o.prototype.handlePacket=function(e){var t=e.getUint8(0);switch(192&t){case o.BLEHF2_FLAG_SERIAL_OUT:case o.BLEHF2_FLAG_SERIAL_ERR:for(var n=Math.min(e.byteLength-1,-193&t),r="",i=0;i<n;++i)r+=String.fromCharCode(e.getUint8(i+1));r&&window.postMessage({type:"serial",id:this.device.name||"hf2",data:r},"*")}},o.SERVICE_UUID="b112f5e6-2679-30da-a26e-0273b6043849",o.CHARACTERISTIC_TX_UUID="b112f5e6-2679-30da-a26e-0273b604384a",o.BLEHF2_FLAG_SERIAL_OUT=128,o.BLEHF2_FLAG_SERIAL_ERR=192,o}(r.BLETXService=n);r.HF2Service=a;var s,c,l=function(n){function r(e){var t=n.call(this,"uart",e,r.SERVICE_UUID,r.CHARACTERISTIC_TX_UUID)||this;return t.device=e,t}return __extends(r,n),r.prototype.handlePacket=function(e){var t=(new window.TextDecoder).decode(e);t&&window.postMessage({type:"serial",id:this.device.name||"uart",data:t},"*")},r.SERVICE_UUID="6e400001-b5a3-f393-e0a9-e50e24dcca9e",r.CHARACTERISTIC_TX_UUID="6e400002-b5a3-f393-e0a9-e50e24dcca9e",r}(n);r.UARTService=l,(c=s||(s={}))[c.Idle=1]="Idle",c[c.StatusRequested=2]="StatusRequested",c[c.PairingModeRequested=4]="PairingModeRequested",c[c.RegionDALRequested=8]="RegionDALRequested",c[c.RegionMakeCodeRequested=16]="RegionMakeCodeRequested",c[c.Flash=32]="Flash",c[c.EndOfTransmision=64]="EndOfTransmision",c[c.USBFlashRequired=128]="USBFlashRequired";var u=function(n){function a(e){var t=n.call(this,"partial flashing",e,!1)||this;return t.device=e,t.state=s.Idle,t.disconnectOnAutoReconnect=!0,t.handleCharacteristic=t.handleCharacteristic.bind(t),t}return __extends(a,n),a.prototype.clearFlashData=function(){this.version=0,this.mode=0,this.regions=[],this.chunkDelay=a.CHUNK_MIN_DELAY,this.hex=void 0,this.bin=void 0,this.magicOffset=void 0,this.dalHash=void 0,this.makeCodeHash=void 0,this.flashReject=void 0,this.flashResolve=void 0,this.flashOffset=void 0},a.prototype.createConnectPromise=function(){var t=this;return this.debug("connecting to partial flash service"),this.device.connectAsync().then(function(){return t.alivePromise(t.device.gatt.getPrimaryService(a.SERVICE_UUID))}).then(function(e){return t.debug("connecting to characteristic"),t.alivePromise(e.getCharacteristic(a.CHARACTERISTIC_UUID))}).then(function(e){return t.debug("starting notifications"),t.pfCharacteristic=e,t.pfCharacteristic.startNotifications(),t.pfCharacteristic.addEventListener("characteristicvaluechanged",t.handleCharacteristic),t.state==s.PairingModeRequested?(t.debug("checking pairing mode"),t.autoReconnect=!1,t.pfCharacteristic.writeValue(new Uint8Array([a.STATUS]))):Promise.resolve()})},a.prototype.disconnect=function(){if(n.prototype.disconnect.call(this),this.flashPacketToken&&this.flashPacketToken.cancel(),this.pfCharacteristic&&this.device.connected)try{this.pfCharacteristic.stopNotifications(),this.pfCharacteristic.removeEventListener("characteristicvaluechanged",this.handleCharacteristic)}catch(e){d.log("ble: partial flash disconnect error "+e.message)}this.pfCharacteristic=void 0},a.prototype.findMarker=function(e,t){if(!this.bin)return-1;for(;e+t.length<this.bin.length;e+=16){for(var n=!0,r=0;r<t.length;++r)if(t[r]!=this.bin[e+r]){n=!1;break}if(n)return e}return-1},a.prototype.flashAsync=function(e){var t=this;return this.hex?(this.debug("flashing already in progress"),Promise.resolve()):(this.device.pauseLog(),this.createFlashPromise(e).finally(function(){return t.device.resumeLogOnDisconnection()}))},a.prototype.createFlashPromise=function(e){var n=this;if(this.hex)return this.debug("flashing already in progress"),Promise.resolve();this.clearFlashData(),this.hex=e;var t=ts.pxtc.UF2.newBlockFile();ts.pxtc.UF2.writeHex(t,this.hex.split(/\r?\n/));var r=d.appTarget.compile.flashUsableEnd;this.bin=ts.pxtc.UF2.toBin(d.U.stringToUint8Array(ts.pxtc.UF2.serializeFile(t)),r).buf,this.debug("bin bytes "+this.bin.length),this.magicOffset=this.findMarker(0,a.MAGIC_MARKER),this.debug("magic block "+this.magicOffset.toString(16)),this.magicOffset<0&&(this.debug("magic block not found, not a valid HEX file"),d.U.userError(lf("Invalid file"))),this.debug("bytes to flash "+(this.bin.length-this.magicOffset));var i=this.magicOffset+a.MAGIC_MARKER.length;return this.dalHash=d.Util.toHex(this.bin.slice(i,i+8)),this.makeCodeHash=d.Util.toHex(this.bin.slice(i+8,i+16)),this.debug("DAL hash "+this.dalHash),this.debug("MakeCode hash "+this.makeCodeHash),this.connectAsync().then(function(){return new Promise(function(e,t){return n.flashResolve=e,n.flashReject=t,n.debug("check service version"),n.state=s.StatusRequested,n.pfCharacteristic.writeValue(new Uint8Array([a.STATUS]))})}).then(function(){},function(e){d.log("pf: error "+e.message),n.clearFlashData()})},a.prototype.checkStateTransition=function(e,t){return!!(this.state&t)||(this.debug("flash cmd "+e+" in state "+this.state.toString(16)+" "),this.flashReject(new Error),this.clearFlashData(),!1)},a.prototype.handleCharacteristic=function(e){var t=this;this.aliveToken.isCancelled()&&(this.flashReject(new Error),this.clearFlashData());var n=event.target.value,r=new Uint8Array(n.buffer),i=r[0];if(this.state!=s.Idle)switch(i){case a.STATUS:if(!this.checkStateTransition(i,s.StatusRequested|s.PairingModeRequested))return;this.version=r[1],this.mode=r[2],this.debug("flash service version "+this.version+" mode "+this.mode),this.debug("reading DAL region"),this.state=s.RegionDALRequested,this.pfCharacteristic.writeValue(new Uint8Array([a.REGION_INFO,a.REGION_DAL])).then(function(){});break;case a.REGION_INFO:if(!this.checkStateTransition(i,s.RegionDALRequested|s.RegionMakeCodeRequested))return;var o=this.regions[r[1]]={start:r[2]<<24|r[3]<<16|r[4]<<8|r[5],end:r[6]<<24|r[7]<<16|r[8]<<8|r[9],hash:d.Util.toHex(r.slice(10))};if(this.debug("read region "+r[1]+" start "+o.start.toString(16)+" end "+o.end.toString(16)+" hash "+o.hash),r[1]==a.REGION_DAL){if(o.hash!=this.dalHash)return d.tickEvent("webble.flash.DALrequired"),this.debug("DAL hash does not match, partial flashing not possible"),this.state=s.USBFlashRequired,this.flashReject(new Error("USB flashing required")),void this.clearFlashData();this.debug("DAL hash match, reading makecode region"),this.state=s.RegionMakeCodeRequested,this.pfCharacteristic.writeValue(new Uint8Array([a.REGION_INFO,a.REGION_MAKECODE])).then(function(){})}else if(r[1]==a.REGION_MAKECODE)if(o.start!=this.magicOffset&&(this.debug("magic offset and MakeCode region.start not matching"),d.U.userError(lf("Invalid file"))),o.hash==this.makeCodeHash)d.tickEvent("webble.flash.noop"),this.debug("MakeCode hash matches, same code!"),this.debug("restart application mode"),this.pfCharacteristic.writeValue(new Uint8Array([a.RESET,a.MODE_APPLICATION])).then(function(){t.state=s.Idle,t.flashResolve(),t.clearFlashData()});else{if(this.mode!=a.MODE_PAIRING)return this.debug("application mode, reset into pairing mode"),this.state=s.PairingModeRequested,this.autoReconnect=!0,void this.pfCharacteristic.writeValue(new Uint8Array([a.RESET,a.MODE_PAIRING])).then(function(){});this.flashOffset=o.start,this.flashPacketNumber=0,this.debug("starting to flash from address "+this.flashOffset.toString(16)),this.flashNextPacket()}break;case a.FLASH_DATA:if(!this.checkStateTransition(i,s.Flash))return;switch(r[1]){case a.PACKET_OUT_OF_ORDER:this.debug("packet out of order"),this.flashPacketToken.cancel(),this.flashPacketNumber+=4,this.chunkDelay=Math.min(this.chunkDelay+10,a.CHUNK_MAX_DELAY),this.flashNextPacket();break;case a.PACKET_WRITTEN:this.chunkDelay=Math.max(this.chunkDelay-1,a.CHUNK_MIN_DELAY),this.flashOffset+=64,this.flashPacketNumber+=4,this.flashOffset>=this.bin.length?(this.debug("end transmission"),this.state=s.EndOfTransmision,this.pfCharacteristic.writeValue(new Uint8Array([a.END_OF_TRANSMISSION])).finally(function(){t.flashResolve&&t.flashResolve(),t.clearFlashData()})):this.flashNextPacket()}break;default:this.debug("unknown message "+d.Util.toHex(r)),this.disconnect()}},a.prototype.flashNextPacket=function(){var r=this;this.state=s.Flash,this.flashPacketToken=new d.Util.CancellationToken,this.flashPacketToken.startOperation();var t=this.bin.slice(this.flashOffset,this.flashOffset+64);this.debug("flashing "+this.flashOffset.toString(16)+" / "+this.bin.length.toString(16)+" "+((this.flashOffset-this.magicOffset)/(this.bin.length-this.magicOffset)*100>>0)+"%");var i=new Uint8Array(20);Promise.delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=r.flashOffset>>8&255,i[2]=r.flashOffset>>0&255,i[3]=r.flashPacketNumber;for(var e=0;e<16;e++)i[4+e]=t[e];return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=r.flashOffset>>24&255,i[2]=r.flashOffset>>16&255,i[3]=r.flashPacketNumber+1;for(var e=0;e<16;e++)i[4+e]=t[16+e]||0;return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=r.flashPacketNumber+2;for(var e=0;e<16;e++)i[4+e]=t[32+e]||0;return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=r.flashPacketNumber+3;for(var e=0;e<16;e++)i[4+e]=t[48+e]||0;return r.pfCharacteristic.writeValue(i)}).then(function(){var t=r.flashOffset,n=function(){return Promise.delay(500).then(function(){if(t!=r.flashOffset||r.flashPacketToken.isCancelled()||r.aliveToken.isCancelled()||r.state!=s.Flash)return Promise.resolve();r.debug("packet transfer deadlock, force restart"),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=-1;for(var e=0;e<16;e++)i[4+e]=0;return r.pfCharacteristic.writeValue(i).then(function(){return n()})})};n().catch(function(e){r.flashReject&&(r.flashReject(new Error("failed packet transfer")),r.clearFlashData())})}).catch(function(){r.flashPacketToken.resolveCancel()})},a.SERVICE_UUID="e97dd91d-251d-470a-a062-fa1922dfa9a8",a.CHARACTERISTIC_UUID="e97d3b10-251d-470a-a062-fa1922dfa9a8",a.REGION_INFO=0,a.FLASH_DATA=1,a.PACKET_OUT_OF_ORDER=170,a.PACKET_WRITTEN=255,a.END_OF_TRANSMISSION=2,a.STATUS=238,a.RESET=255,a.MODE_PAIRING=0,a.MODE_APPLICATION=1,a.REGION_SOFTDEVICE=0,a.REGION_DAL=1,a.REGION_MAKECODE=2,a.MAGIC_MARKER=d.Util.fromHex("708E3B92C615A841C49866C975EE5197"),a.CHUNK_MIN_DELAY=0,a.CHUNK_MAX_DELAY=75,a}(t);r.PartialFlashingService=u;var f=function(n){function e(e){var t=n.call(this,"ble",new d.Util.CancellationToken)||this;return t.device=void 0,t.services=[],t.pendingResumeLogOnDisconnection=!1,t.servicesVersion=0,t.device=e,t.handleDisconnected=t.handleDisconnected.bind(t),t.handleServiceAdded=t.handleServiceAdded.bind(t),t.handleServiceChanged=t.handleServiceChanged.bind(t),t.handleServiceRemoved=t.handleServiceRemoved.bind(t),t.device.addEventListener("gattserverdisconnected",t.handleDisconnected),t.device.addEventListener("serviceadded",t.handleServiceAdded),t.device.addEventListener("servicechanged",t.handleServiceChanged),t.device.addEventListener("serviceremoved",t.handleServiceRemoved),i()&&(t.services.push(t.uartService=new l(t)),t.services.push(t.hf2Service=new a(t))),o()&&t.services.push(t.partialFlashingService=new u(t)),t.aliveToken.startOperation(),t}return __extends(e,n),e.prototype.startServices=function(){this.services.filter(function(e){return e.autoReconnect}).forEach(function(e){return e.connectAsync().catch(function(){})})},e.prototype.pauseLog=function(){this.uartService&&(this.uartService.autoReconnect=!1,this.uartService.disconnect()),this.hf2Service&&(this.hf2Service.autoReconnect=!1,this.hf2Service.disconnect())},e.prototype.resumeLogOnDisconnection=function(){this.pendingResumeLogOnDisconnection=!0},e.prototype.resumeLog=function(){this.uartService&&(this.uartService.autoReconnect=!0,this.uartService.connectAsync().catch(function(){})),this.hf2Service&&(this.hf2Service.autoReconnect=!0,this.hf2Service.connectAsync().catch(function(){}))},Object.defineProperty(e.prototype,"isPaired",{get:function(){return this===r.bleDevice},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.device.name||"?"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this.device&&this.device.gatt&&this.device.gatt.connected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gatt",{get:function(){return this.device.gatt},enumerable:!0,configurable:!0}),e.prototype.createConnectPromise=function(){var e=this;return this.debug("connecting gatt server"),this.alivePromise(this.device.gatt.connect().then(function(){return e.debug("gatt server connected")}))},e.prototype.handleServiceAdded=function(e){this.debug("service added"),this.servicesVersion++},e.prototype.handleServiceRemoved=function(e){this.debug("service removed"),this.servicesVersion++},e.prototype.handleServiceChanged=function(e){this.debug("service changed"),this.servicesVersion++},e.prototype.handleDisconnected=function(e){var t=this;this.debug("disconnected"),this.disconnect(),this.pendingResumeLogOnDisconnection&&(this.pendingResumeLogOnDisconnection=!1,Promise.delay(500).then(function(){return t.resumeLog()}))},e.prototype.disconnect=function(){if(n.prototype.disconnect.call(this),this.services.forEach(function(e){return e.disconnect()}),this.connected){this.debug("disconnect");try{this.device.gatt&&this.device.gatt.connected&&this.device.gatt.disconnect()}catch(e){this.debug("gatt disconnect error "+e.message)}}},e}(e);function p(){if(r.bleDevice)return Promise.resolve();d.log("ble: requesting device");var e=[];return i()&&(e.push(l.SERVICE_UUID),e.push(a.SERVICE_UUID)),o()&&e.push(u.SERVICE_UUID),navigator.bluetooth.requestDevice({filters:d.appTarget.appTheme.bluetoothUartFilters,optionalServices:e}).then(function(e){return d.log("ble: received device "+e.name),r.bleDevice=new f(e),r.bleDevice.startServices(),r.bleDevice.connectAsync()})}r.BLEDevice=f,r.bleDevice=void 0,r.isPaired=function(){return!!r.bleDevice},r.pairAsync=function(){return r.bleDevice&&(r.bleDevice.kill(),r.bleDevice=void 0),p().catch(function(e){r.bleDevice&&r.bleDevice.aliveToken&&r.bleDevice.aliveToken.resolveCancel(),d.log("ble: error "+e.message)})},r.flashAsync=function(e,t){d.tickEvent("webble.flash");var n=e.outfiles[ts.pxtc.BINARY_HEX];return p().then(function(){return r.bleDevice.partialFlashingService.flashAsync(n)}).then(function(){return d.tickEvent("webble.flash.success")}).catch(function(e){throw d.tickEvent("webble.fail.fail",{message:e.message}),e})}}(d.webBluetooth||(d.webBluetooth={}))}(pxt||(pxt={})),function(c){!function(o){var t=function(n){function e(e){var t=n.call(this,e)||this;return t.message=e,t}return __extends(e,n),e}(Error);o.USBError=t;o.filters=[{classCode:255,subclassCode:42}];var r=!0;o.setFilters=function(e){r=!1,o.filters=e};var e,n=function(){function e(){this.ready=!1,this.connecting=!1,this.readLoopStarted=!1,this.onDeviceConnectionChanged=function(e){},this.onConnectionChanged=function(){},this.onData=function(e){},this.onError=function(e){},this.onEvent=function(e){},this.enabled=!1,this.handleUSBConnected=this.handleUSBConnected.bind(this),this.handleUSBDisconnected=this.handleUSBDisconnected.bind(this)}return e.prototype.enable=function(){this.enabled||(this.enabled=!0,this.log("registering webusb events"),navigator.usb.addEventListener("disconnect",this.handleUSBDisconnected,!1),navigator.usb.addEventListener("connect",this.handleUSBConnected,!1))},e.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.log("unregistering webusb events"),navigator.usb.removeEventListener("disconnect",this.handleUSBDisconnected),navigator.usb.removeEventListener("connect",this.handleUSBConnected))},e.prototype.disposeAsync=function(){return this.disable(),Promise.resolve()},e.prototype.handleUSBDisconnected=function(e){this.log("device disconnected"),e.device==this.dev&&(this.log("clear device"),this.clearDev(),this.onDeviceConnectionChanged&&this.onDeviceConnectionChanged(!1))},e.prototype.handleUSBConnected=function(e){var t=e.device;this.log("device connected "+t.serialNumber),this.dev||this.connecting||(this.log("attach device"),this.onDeviceConnectionChanged&&this.onDeviceConnectionChanged(!0))},e.prototype.clearDev=function(){this.dev&&(this.dev=null,this.epIn=null,this.epOut=null,this.onConnectionChanged&&this.onConnectionChanged())},e.prototype.error=function(e){throw new t(c.U.lf("USB error on device {0} ({1})",this.dev.productName,e))},e.prototype.log=function(e){c.debug("webusb: "+e)},e.prototype.disconnectAsync=function(){var e=this;return this.ready=!1,this.dev?(this.log("close device"),this.dev.close().catch(function(e){}).then(function(){return e.clearDev(),Promise.delay(500)})):Promise.resolve()},e.prototype.reconnectAsync=function(){var t=this;return this.log("reconnect"),this.setConnecting(!0),this.disconnectAsync().then(i).then(function(e){return t.connectAsync(e)}).finally(function(){return t.setConnecting(!1)})},e.prototype.setConnecting=function(e){e!=this.connecting&&(this.connecting=e,this.onConnectionChanged&&this.onConnectionChanged())},e.prototype.isConnecting=function(){return this.connecting},e.prototype.isConnected=function(){return!!this.dev&&this.ready},e.prototype.connectAsync=function(s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(e){switch(e.label){case 0:if(this.log("trying to connect ("+s.length+" devices)"),0==s.length)throw(o=new Error("Device not found.")).type="devicenotfound",o;this.setConnecting(!0),e.label=1;case 1:return e.trys.push([1,,11,12]),this.lastKnownDeviceSerialNumber?(t=s.find(function(e){return e.serialNumber===a.lastKnownDeviceSerialNumber}))?(this.log("last known device spotted"),s.splice(s.indexOf(t),1),s.unshift(t),[3,4]):[3,2]:[3,4];case 2:return this.log("delay for last known device"),[4,Promise.delay(2e3)];case 3:e.sent(),e.label=4;case 4:n=0,e.label=5;case 5:if(!(n<s.length))return[3,10];r=s[n],this.dev=r,this.log("connect device: "+r.manufacturerName+" "+r.productName),this.log("serial number: "+r.serialNumber+" "+(this.lastKnownDeviceSerialNumber===r.serialNumber?"(last known device)":"")+" "),e.label=6;case 6:return e.trys.push([6,8,,9]),[4,this.initAsync()];case 7:return e.sent(),[2];case 8:return i=e.sent(),this.dev=void 0,this.log("connection failed, "+i.message),[3,9];case 9:return++n,[3,5];case 10:throw(o=new Error(c.U.lf("Device in use or not found."))).type="devicelocked",o;case 11:return this.setConnecting(!1),[7];case 12:return[2]}})})},e.prototype.sendPacketAsync=function(e){var t=this;return this.dev?(c.Util.assert(e.length<=64),this.epOut?this.dev.transferOut(this.epOut.endpointNumber,e).then(function(e){"ok"!=e.status&&t.error("USB OUT transfer failed")}):this.dev.controlTransferOut({requestType:"class",recipient:"interface",request:9,value:512,index:this.iface.interfaceNumber},e).then(function(e){"ok"!=e.status?t.error("USB CTRL OUT transfer failed"):r||t.recvOne()})):Promise.reject(new Error("Disconnected"))},e.prototype.recvOne=function(){var t=this;this.recvPacketAsync().then(function(e){t.onData(e)},function(e){t.onError(e)})},e.prototype.readLoop=function(){var t=this;if(!this.readLoopStarted){this.readLoopStarted=!0,this.log("start read loop");var n=function(){t.ready?t.recvPacketAsync().then(function(e){e[0]?(t.onData(e),n()):Promise.delay(500).then(n)},function(e){t.dev&&t.onError(e),Promise.delay(300).then(n)}):Promise.delay(300).then(n)};n()}},e.prototype.recvPacketAsync=function(){var n=this,e=function(e){"ok"!=e.status&&n.error("USB IN transfer failed");var t=new Uint8Array(e.data.buffer);return 0==t.length?n.recvPacketAsync():t};return this.dev?this.epIn?this.dev.transferIn(this.epIn.endpointNumber,64).then(e):this.dev.controlTransferIn({requestType:"class",recipient:"interface",request:1,value:256,index:this.iface.interfaceNumber},64).then(e):Promise.reject(new Error("Disconnected"))},e.prototype.initAsync=function(){var t=this;if(!this.dev)return Promise.reject(new Error("Disconnected"));var n=this.dev;return this.log("open device"),n.open().then(function(){return t.log("select configuration"),n.selectConfiguration(1)}).then(function(){t.log("got "+n.configurations[0].interfaces.length+" interfaces");var e=n.configurations[0].interfaces.filter(function(e){for(var t=e.alternates[0],n=0,r=o.filters;n<r.length;n++){var i=r[n];if((null==i.classCode||t.interfaceClass===i.classCode)&&!(null!=i.subclassCode&&t.interfaceSubclass!==i.subclassCode||null!=i.protocolCode&&t.interfaceProtocol!==i.protocolCode)){if(0==t.endpoints.length)return!0;if(2==t.endpoints.length&&t.endpoints.every(function(e){return 64==e.packetSize}))return!0}}return!1})[0];return e||t.error("cannot find supported USB interface"),t.altIface=e.alternates[0],t.iface=e,t.altIface.endpoints.length&&(t.epIn=t.altIface.endpoints.filter(function(e){return"in"==e.direction})[0],t.epOut=t.altIface.endpoints.filter(function(e){return"out"==e.direction})[0],c.Util.assert(64==t.epIn.packetSize),c.Util.assert(64==t.epOut.packetSize)),t.log("claim interface"),n.claimInterface(e.interfaceNumber)}).then(function(){t.log("device ready"),t.lastKnownDeviceSerialNumber=t.dev.serialNumber,t.ready=!0,(t.epIn||r)&&t.readLoop(),t.onConnectionChanged&&t.onConnectionChanged()})},e}();function i(){return c.log("webusb: get devices"),navigator.usb.getDevices().then(function(e){return e=e||[]})}function a(){if(c.BrowserUtils.isElectron()||c.BrowserUtils.isWinRT())return!1;if(navigator.usb){var e=/Windows NT (\d+\.\d+)/.exec(navigator.userAgent);return!(e&&parseFloat(e[1])<6.3)}return!1}o.pairAsync=function(){return navigator.usb.requestDevice({filters:o.filters}).then(function(e){return!!e}).catch(function(e){if("NotFoundError"!=e.name)throw e})},o.mkWebUSBHIDPacketIOAsync=function(){return c.debug("packetio: mk webusb io"),e||(e=new n),e.enable(),Promise.resolve(e)},o.isEnabled=!1,o.setEnabled=function(e){a()||(e=!1),o.isEnabled=e},o.isAvailable=a}(c.usb||(c.usb={}))}(pxt||(pxt={})),function(s){!function(e){var n=s.Util,r={};function a(o){var a={},s=0,e=new n.PromiseQueue,t=new Promise(function(e,t){a.ready=e});e.enqueue("main",function(){return t});return{opAsync:function(r,i){return e.enqueue("main",function(){return new Promise(function(t,n){var e=""+s++;a[e]=function(e){e?e.errorMessage?n(new Error(e.errorMessage)):t(e):n(new Error("no response"))},o({id:e,op:r,arg:i})})})},recvHandler:function(e){if(a.hasOwnProperty(e.id)){var t=a[e.id];delete a[e.id],t(e.result)}}}}function i(e){var t=new Worker(e),n=a(function(e){return t.postMessage(e)});return t.onmessage=function(e){s.perf.measureStart("webworker recvHandler"),n.recvHandler(e.data),s.perf.measureEnd("webworker recvHandler")},n}e.getWorker=function(e){var t=r[e];return t||(t=r[e]=i(e)),t},e.wrap=a,e.makeWebWorker=i,e.makeWebSocket=function(e,n){void 0===n&&(n=null);var i=new WebSocket(e),o=[],r=a(function(e){var t=JSON.stringify(e);o?o.push(t):i.send(t)});return i.onmessage=function(e){var t=JSON.parse(e.data);n&&null==t.id?n(t):r.recvHandler(t)},i.onopen=function(e){s.debug("socket opened");for(var t=0,n=o;t<n.length;t++){var r=n[t];i.send(r)}o=null},i.onclose=function(e){s.debug("socket closed")},i.onerror=function(e){s.debug("socket errored")},r}}(s.worker||(s.worker={}))}(pxt||(pxt={})),function(c){!function(a){function s(){a.apiKey||c.U.userError("YouTube API key missing")}a.apiKey=void 0,a.playlistItemToCodeCard=function(e){return{name:e.snippet.title.replace(/[^-]*-/,"").trim(),description:(r=e.snippet.description,r.split(/\n\s+/,1)[0].trim()),youTubeId:e.snippet.resourceId.videoId,youTubePlaylistId:e.snippet.playlistId,imageUrl:(t=e.snippet.thumbnails,t&&(null===(n=t.medium||t.high||t.standard||t.default)||void 0===n?void 0:n.url)||"")};var t,n,r},a.playlistInfoAsync=function(e){s();var t="https://www.googleapis.com/youtube/v3/playlists?part=snippet&id="+e+"&key="+a.apiKey;return c.Util.httpGetJsonAsync(t).then(function(e){return e.items[0]})},a.listPlaylistVideosAsync=function(o){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:s(),t=[],n=void 0,e.label=1;case 1:return r="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId="+o+"&key="+a.apiKey,n&&(r+="&pageToken="+n),[4,c.Util.httpGetJsonAsync(r)];case 2:i=e.sent(),t=t.concat(i.items),n=i.nextPageToken,e.label=3;case 3:if(n)return[3,1];e.label=4;case 4:return c.options.debug&&c.debug(JSON.stringify(t,null,2)),[2,t]}})})},a.watchUrl=function(e,t){var n=void 0;return e?(n="https://www.youtube.com/watch?v="+e,t&&(n+="&list="+t)):t&&(n="https://www.youtube.com/playlist?list="+t),n}}(c.youtube||(c.youtube={}))}(pxt||(pxt={})),function(e){var b;(function(m){function v(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return e.replace(/{(\d+)}/g,function(e,t){return n[+t]})}m.debug=!1,m.lf=v;var g=y("opcode name doesn't match","<name>"),a=function(){function e(e,t,n,r,i){var o=this;this.opcode=n,this.mask=r,this.is32bit=i,this.canBeShared=!1,b.assert((n&r)==n),this.ei=e,this.code=t.replace(/\s+/g," "),this.friendlyFmt=t.replace(/\$\w+/g,function(e){return o.ei.encoders[e]?o.ei.encoders[e].pretty:e});var a=u(t);this.name=a[0],this.args=a.slice(1)}return e.prototype.emit=function(e){var t=e.words;if(t[0]!=this.name)return g;for(var n=this.opcode,r=1,i=0,o=[],a=null,s=null,c=null,l=0;l<this.args.length;++l){var u=this.args[l],f=t[r++];if("$"==u[0]){var p=this.ei.encoders[u],d=null;if(p.isRegister){if(null==(d=this.ei.registerNo(f)))return y("expecting register name",f);this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--}else if(p.isImmediate){if(f=f.replace(/^#/,""),null==(d=e.bin.parseOneInt(f)))return y("expecting number",f);this.ei.isAddSP(this.opcode)?i=-d/this.ei.wordSize():this.ei.isSubSP(this.opcode)&&(i=d/this.ei.wordSize())}else if(p.isRegList){if("{"!=f)return y("expecting {",f);for(d=0;"}"!=t[r];){if(!(f=t[r++]))return y("expecting }",t[r-2]);var h=this.ei.registerNo(f);if(null==h)return y("expecting register name",f);if(d&1<<h)return y("duplicate register name",f);d|=1<<h,this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--,","==t[r]&&r++}f=t[r++]}else if(p.isLabel){if(f=f.replace(/^#/,""),/^[+-]?\d+$/.test(f))a="rel"+(d=parseInt(f,10));else if(/^0x[0-9a-fA-F]+$/.test(f))a="abs"+(d=parseInt(f,16));else if(a=f,null==(d=this.ei.getAddressFromLabel(e.bin,this,f,p.isWordAligned))){if(e.bin.finalEmit)return y("unknown label",f);d=8}if(this.ei.is32bit(this)){s=d,c=f;continue}}else b.oops();if(null==d)return y("didn't understand it",f);if(o.push(d),null==(d=p.encode(d)))return y("argument out of range or mis-aligned",f);b.assert(0==(n&d)),n|=d}else if(u!=f)return y("expecting "+u,f)}return t[r]?y("trailing tokens",t[r]):this.ei.is32bit(this)?this.ei.emit32(n,s,e.bin.normalizeExternalLabel(c)):{stack:i,opcode:n,numArgs:o,labelName:e.bin.normalizeExternalLabel(a)}},e.prototype.toString=function(){return this.friendlyFmt},e}();m.Instruction=a;var l=function(){function e(e,t){this.bin=e,this.text=t}return e.prototype.getOpExt=function(){return this.instruction?this.instruction.code:""},e.prototype.getOp=function(){return this.instruction?this.instruction.name:""},e.prototype.update=function(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),e="    "+e,this.text=e+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=u(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")},e}();m.Line=l;var s=function(){function e(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=function(e){return e},this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.equs={},this.stackpointers={},this.stack=0,this.commPtr=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.currLine=new l(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}return e.prototype.emitShort=function(e){b.assert(0<=e&&e<=65535),this.buf.push(e)},e.prototype.emitOpCode=function(e){this.emitShort(e)},e.prototype.location=function(){return 2*this.buf.length},e.prototype.pc=function(){return this.location()+this.baseOffset},e.prototype.parseOneInt=function(e){if(!e)return null;if(/^\d+$/.test(e))return parseInt(e,10);var t=e.indexOf("-");if(0<t)return this.parseOneInt(e.slice(0,t))-this.parseOneInt(e.slice(t+1));var n=1;if(0<=e.indexOf("*"))for(var r=null;r=/^([^\*]*)\*(.*)$/.exec(e);){var i=this.parseOneInt(r[1]);if(null==i)return null;n*=i,e=r[2]}if("-"==e[0]?(n*=-1,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1)),/^\d+$/.test(e))return n*parseInt(e,10);if(b.U.endsWith(e,"|1"))return 1|this.parseOneInt(e.slice(0,e.length-2));if(b.U.endsWith(e,"-1"))return this.parseOneInt(e.slice(0,e.length-2))-1;if(b.U.endsWith(e,"+1"))return this.parseOneInt(e.slice(0,e.length-2))+1;var o=/(.*)>>(\d+)$/.exec(e);if(o){var a=this.parseOneInt(o[1]);return(a&=~(-16777216&this.baseOffset))>>parseInt(o[2])}var s=null;return"0"==e[0]&&("x"==e[1]||"X"==e[1]?(r=/^0x([a-f0-9]+)$/i.exec(e))&&(s=parseInt(r[1],16)):"b"!=e[1]&&"B"!=e[1]||(r=/^0b([01]+)$/i.exec(e))&&(s=parseInt(r[1],2))),0<=e.indexOf("@")&&((r=/^(\w+)@(-?\d+)$/.exec(e))&&(1!=n&&this.directiveError(v("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(r[1])?s=this.ei.wordSize()*this.ei.computeStackOffset(r[1],this.stack-this.stackpointers[r[1]]+parseInt(r[2])):this.directiveError(v("saved stack not found"))),(r=/^(.*)@(hi|lo|fn)$/.exec(e))&&this.looksLikeLabel(r[1])&&null!=(s=this.lookupLabel(r[1],!0))&&("fn"==r[2]?s=this.ei.toFnPtr(s,this.baseOffset,r[1]):0<=(s>>=1)&&s<=65535?"hi"==r[2]?s=s>>8&255:"lo"==r[2]?s&=255:b.oops():(this.directiveError(v("@hi/lo out of range")),s=null))),null==s&&this.looksLikeLabel(e)&&null!=(s=this.lookupLabel(e,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(s+=this.baseOffset),null==s||isNaN(s)?null:s*n},e.prototype.looksLikeLabel=function(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)},e.prototype.scopedName=function(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e},e.prototype.lookupLabel=function(e,t){void 0===t&&(t=!1);var n=null,r=this.scopedName(e);return this.labels.hasOwnProperty(r)?(n=this.labels[r],n=this.ei.postProcessRelAddress(this,n)):this.lookupExternalLabel&&null!=(n=this.lookupExternalLabel(e))&&(n=this.ei.postProcessAbsAddress(this,n)),null==n&&this.equs.hasOwnProperty(r)&&(n=this.equs[r]),null==n&&t&&(this.finalEmit?this.directiveError(v("unknown label: {0}",e)):n=11111),n},e.prototype.align=function(e){for(b.assert(2==e||4==e||8==e||16==e);this.location()%e!=0;)this.emitOpCode(0)},e.prototype.pushError=function(e,t){void 0===t&&(t="");var n={scope:this.scope,message:v("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(n),this.throwOnError)throw new Error(n.message)},e.prototype.directiveError=function(e){this.pushError(e)},e.prototype.emitString=function(e,t){function n(e,t){return 255&(e.charCodeAt(t)||0)}void 0===t&&(t=!1);var r,i=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);if(i&&null!=(r=function(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,function(e,t){return t}).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,function(e,t){return"\\u00"+t}).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}(i[2])))if(this.align(2),t)for(var o=0;o<r.length;o++)this.emitShort(r.charCodeAt(o));else for(o=0;o<r.length+1;o+=2)this.emitShort(n(r,o+1)<<8|n(r,o));else this.directiveError(v("expecting string"))},e.prototype.parseNumber=function(e){var t=this.parseOneInt(e.shift());return null==t?null:t},e.prototype.parseNumbers=function(e){e=e.slice(1);for(var t=[];;){var n=this.parseNumber(e);if(null==n){this.directiveError(v("cannot parse number at '{0}'",e[0]));break}if(t.push(n),","!=e[0]){if(null==e[0])break;this.directiveError(v("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t},e.prototype.emitSpace=function(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(v("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(v("only even space supported"));else{var n=255&t[1];n|=n<<8;for(var r=0;r<t[0];r+=2)this.emitShort(n)}},e.prototype.emitBytes=function(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];0<=r&&i<=255&&0<=i&&r<=255?this.emitShort(255&r|(255&i)<<8):this.directiveError(v("expecting uint8"))}},e.prototype.emitHex=function(e){var r=this;e.slice(1).forEach(function(e){if(","!=e)if(e.length%4!=0)r.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(e))for(var t=0;t<e.length;t+=4){var n=parseInt(e.slice(t,t+4),16);n=(255&n)<<8|n>>8&255,r.emitShort(n)}else r.directiveError(".hex needs a hex number")})},e.prototype.handleDirective=function(e){var t,n=this,r=e.words,i=function(){2!=r.length&&n.directiveError(v("expecting one argument"))};switch(r[0]){case".ascii":case".asciz":case".string":this.emitString(e.text);break;case".utf16":this.emitString(e.text,!0);break;case".align":if(i(),null!=(t=this.parseOneInt(r[1]))){if(0==t)return;t<=4?this.align(1<<t):this.directiveError(v("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(v("expecting number"));break;case".balign":if(i(),null!=(t=this.parseOneInt(r[1]))){if(1==t)return;2==t||4==t||8==t||16==t?this.align(t):this.directiveError(v("expecting 2, 4, 8, or 16"))}else this.directiveError(v("expecting number"));break;case".p2align":i(),null!=(t=this.parseOneInt(r[1]))?this.align(1<<t):this.directiveError(v("expecting number"));break;case".byte":this.emitBytes(r);break;case".hex":this.emitHex(r);break;case".hword":case".short":case".2bytes":this.parseNumbers(r).forEach(function(e){-32768<=e&&e<=65535?n.emitShort(65535&e):n.directiveError(v("expecting int16"))});break;case".word":case".4bytes":case".long":this.parseNumbers(r).forEach(function(e){-2147483648<=e&&e<=4294967295?(n.emitShort(65535&e),n.emitShort(e>>16&65535)):n.directiveError(v("expecting int32"))});break;case".skip":case".space":this.emitSpace(r);break;case".set":case".equ":/^\w+$/.test(r[1])||this.directiveError(v("expecting name"));var o=this.parseNumbers(r.slice(","==r[2]||"="==r[2]?2:1));1!=o.length&&this.directiveError(v("expecting one value")),void 0!==this.equs[r[1]]&&this.equs[r[1]]!=o[0]&&this.directiveError(v("redefinition of {0}",r[1])),this.equs[r[1]]=o[0];break;case".startaddr":this.location()&&this.directiveError(v(".startaddr can be only be specified at the beginning of the file")),i(),this.baseOffset=this.parseOneInt(r[1]);break;case"@stackmark":i(),this.stackpointers[r[1]]=this.stack;break;case"@stackempty":this.checkStack&&(null==this.stackpointers[r[1]]?this.directiveError(v("no such saved stack")):this.stackpointers[r[1]]!=this.stack&&this.directiveError(v("stack mismatch")));break;case"@scope":this.scope=r[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case".syntax":case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":i(),this.stack+=this.parseOneInt(r[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".comm":(r=r.filter(function(e){return","!=e})).shift();var a=this.parseOneInt(r[1]),s=0;if(s=r[2]?this.parseOneInt(r[2]):4,null==this.lookupLabel(r[0])){for(this.commPtr||(this.commPtr=this.lookupExternalLabel("_pxt_comm_base")||0,this.commPtr||this.directiveError(v("PXT_COMM_BASE not defined")));this.commPtr&s-1;)this.commPtr++;this.labels[this.scopedName(r[0])]=this.commPtr-this.baseOffset,this.commPtr+=a}break;case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case".fnstart":case".save":case".size":case".fnend":case".pad":case".globl":case".local":case"@":break;default:/^\.cfi_/.test(r[0])||this.directiveError(v("unknown directive"))}},e.prototype.handleOneInstruction=function(e,t){var n=t.emit(e);return!n.error&&(this.stack+=n.stack,this.checkStack&&this.stack<0&&this.pushError(v("stack underflow")),e.location=this.location(),e.opcode=n.opcode,e.stack=n.stack,this.emitOpCode(n.opcode),null!=n.opcode2&&this.emitOpCode(n.opcode2),null!=n.opcode3&&this.emitOpCode(n.opcode3),e.instruction=t,e.numArgs=n.numArgs,!0)},e.prototype.handleInstruction=function(n){var t=this;if(!n.instruction||!this.handleOneInstruction(n,n.instruction)){var e=function(e){return t.ei.instructions.hasOwnProperty(e)?t.ei.instructions[e]:[]};if(!n.instruction)for(var r=e(n.words[0]),i=0;i<r.length;++i)if(this.handleOneInstruction(n,r[i]))return;var o=n.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,""),a="",s=e(o).concat(e(o+"s"));0<s.length&&s.forEach(function(e){var t=e.emit(n);a+=v("   Maybe: {0} ({1} at '{2}')\n",e.toString(),t.error,t.errorAt)}),this.pushError(v("assembly error"),a)}},e.prototype.buildLine=function(e,n){var r=this,t=function(e){var t=new l(r,e);return t.scope=r.scope,t.lineNo=r.currLineNo,n.push(t),t},i=t(e),o=u(i.text)||[],a=(i.words=o)[0]||"";if(":"==a.charAt(a.length-1)){var s=/^([\.\w]+):$/.exec(o[0]);if(s){if(i.type="label",i.text=s[1]+":",i.words=[s[1]],!(1<o.length))return;o.shift(),a=((i=t(e.replace(/^[^:]*:/,""))).words=o)[0]||""}}var c=a.charAt(0);"."==c||"@"==c?(i.type="directive","@scope"==i.words[0]&&this.handleDirective(i)):0==i.words.length?i.type="empty":i.type="instruction"},e.prototype.prepLines=function(e){var t=this;this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(function(e){10<t.errors.length||(t.currLineNo++,t.realCurrLineNo++,t.buildLine(e,t.lines))})},e.prototype.iterLines=function(){var r=this;this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(function(e){if(!(10<r.errors.length)&&0!=(r.currLine=e).words.length)if("label"==e.type){var t=r.scopedName(e.words[0]);if(r.prevLabel=t,r.finalEmit){null!=r.equs[t]&&r.directiveError(v(".equ redefined as label"));var n=r.labels[t];null==n&&b.oops(),0==r.errors.length&&n!=r.location()&&b.oops("invalid location: "+r.location()+" != "+n+" at "+t),b.assert(0<r.errors.length||n==r.location()),r.reallyFinalEmit&&(r.stackAtLabel[t]=r.stack)}else r.labels.hasOwnProperty(t)?r.directiveError(v("label redefinition")):r.inlineMode&&/^_/.test(t)?r.directiveError(v("labels starting with '_' are reserved for the compiler")):r.labels[t]=r.location();e.location=r.location()}else"directive"==e.type?r.handleDirective(e):"instruction"==e.type?r.handleInstruction(e):"empty"==e.type||b.oops()})},e.prototype.getSource=function(r,e,t){var i=this;void 0===e&&(e=1),void 0===t&&(t=0);var o=0,n=function(e){var t=i.labels[e]||o,n=t-o;return o=t,n},a=this.buf?this.location():0,s=n("_code_end"),c=n("_helpers_end"),l=n("_vtables_end"),u=n("_literals_end"),f=o,p=a+this.baseOffset&16777215;t&&t<p&&b.U.userError(v("program too big by {0} bytes!",p-t));var d=v("; total bytes: {0} ({1}% of {2}k flash with {3} free)",p,(100*p/(t=t||131072)).toFixed(1),(t/1024).toFixed(1),t-p),h=v("; generated code sizes (bytes): {0} (incl. {1} user, {2} helpers, {3} vtables, {4} lits); src size {5}\n",f,s,c,l,u,a-f)+v("; assembly: {0} lines; density: {1} bytes/stmt; ({2} stmts)\n",this.lines.length,Math.round(100*s/e)/100,e)+d+"\n"+this.stats+"\n\n",g=!1;return this.lines.forEach(function(e,t){if("_stored_program"==e.words[0])return h+='_stored_program: .string "..."\n',void(g=!0);if(g)g=!1;else{var n=e.text;if(r){if("@stackempty"==e.words[0]&&i.lines[t-1].text==e.text)return;if(!(n=n.replace(/; WAS: .*/,"")).trim())return}m.debug&&("label"!=e.type&&"instruction"!=e.type||(n+=" \t; 0x"+(e.location+i.baseOffset).toString(16))),h+=n+"\n"}}),h},e.prototype.peepHole=function(){for(var e=this.lines.filter(function(e){return"empty"!=e.type}),t=0;t<e.length;++t){var n=e[t];if(!/^user/.test(n.scope)){var r=e[t+1];if(r){var i=e[t+2];"instruction"==n.type&&this.ei.peephole(n,r,i)}}}},e.prototype.clearLabels=function(){this.labels={},this.commPtr=0},e.prototype.peepPass=function(e){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.clearLabels(),this.iterLines(),b.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=e||0==this.peepOps,this.iterLines(),this.stats+=v("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))},e.prototype.getLabels=function(){var n=this;return this.userLabelsCache||(this.userLabelsCache=b.U.mapMap(this.labels,function(e,t){return t+n.baseOffset})),this.userLabelsCache},e.prototype.emit=function(e){if(b.assert(null==this.buf),this.prepLines(e),!(0<this.errors.length||(this.clearLabels(),this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(v("stack misaligned at the end of the file")),0<this.errors.length||(this.ei.expandLdlit(this),this.clearLabels(),this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),0<this.errors.length)))){for(var t=0;t<5&&(pxt.debug("Peephole OPT, pass "+t),this.peepPass(5==t),0!=this.peepOps);++t);pxt.debug("emit done")}},e}(),e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(m.File=s);m.VMFile=e;var t=function(){function e(){var o=this;this.file=null,this.addEnc=function(e,t,n){var r={name:e,pretty:t,encode:n,isRegister:/^\$r\d/.test(e),isImmediate:/^\$i\d/.test(e),isRegList:/^\$rl\d/.test(e),isLabel:/^\$l[a-z]/.test(e)};return o.encoders[e]=r},this.inrange=function(e,t,n){return Math.floor(t)!=t?null:t<0?null:e<t?null:n},this.inminmax=function(e,t,n,r){return Math.floor(n)!=n?null:n<e?null:t<n?null:r},this.inseq=function(e,t){var n=e.indexOf(t);return n<0?null:n},this.inrangeSigned=function(e,t,n){return Math.floor(t)!=t?null:t<-(e+1)?null:e<t?null:n&(e<<1|1)},this.addInst=function(e,t,n,r){var i=new a(o,e,t,n,r);return o.instructions.hasOwnProperty(i.name)||(o.instructions[i.name]=[]),o.instructions[i.name].push(i),i},this.encoders={},this.instructions={}}return e.prototype.toFnPtr=function(e,t,n){return e},e.prototype.wordSize=function(){return-1},e.prototype.computeStackOffset=function(e,t){return t},e.prototype.is32bit=function(e){return!1},e.prototype.emit32=function(e,t,n){return null},e.prototype.postProcessRelAddress=function(e,t){return t},e.prototype.postProcessAbsAddress=function(e,t){return t},e.prototype.peephole=function(e,t,n){},e.prototype.registerNo=function(e){return null},e.prototype.getAddressFromLabel=function(e,t,n,r){return void 0===r&&(r=!1),null},e.prototype.isPop=function(e){return!1},e.prototype.isPush=function(e){return!1},e.prototype.isAddSP=function(e){return!1},e.prototype.isSubSP=function(e){return!1},e.prototype.testAssembler=function(){b.assert(!1)},e.prototype.expandLdlit=function(e){},e}();function u(e){var t=[],n="";e:for(var r=0;r<e.length;++r)switch(e[r]){case"[":case"]":case"!":case"{":case"}":case",":n&&(t.push(n),n=""),t.push(e[r]);break;case" ":case"\t":case"\r":case"\n":n&&(t.push(n),n="");break;case";":break e;default:n+=e[r]}return n&&(t.push(n),n=""),t[0]?t:null}function y(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function c(e){return e<0||65535<e?("0x"+e.toString(16)).toLowerCase():("0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}m.AbstractProcessor=t,m.emitErr=y,m.expectError=function(e,t){var n=new s(e);n.emit(t),0==n.errors.length&&b.oops("ASMTEST: expecting error for: "+t)},m.tohex=c,m.expect=function(e,t){var n=[],r=t.replace(/^([0-9a-fA-F]{4,8})\s/gm,function(e,t){return n.push(parseInt(t.slice(0,4),16)),8==t.length&&n.push(parseInt(t.slice(4,8),16)),""}),i=new s(e);i.throwOnError=!0,i.disablePeepHole=!0,i.emit(r),0<i.errors.length&&(console.debug(i.errors[0].message),b.oops("ASMTEST: not expecting errors")),i.buf.length!=n.length&&b.oops("ASMTEST: wrong buf len");for(var o=0;o<n.length;++o)i.buf[o]!=n[o]&&b.oops("ASMTEST: wrong buf content at "+o+" , exp:"+c(n[o])+", got: "+c(i.buf[o]))}})((b=e.pxtc||(e.pxtc={})).assembler||(b.assembler={}))}(ts||(ts={})),function(m){!function(r){var a=pxtc.Util;r.apiRoot=m.BrowserUtils.isLocalHost()||a.isNodeJS?"https://www.makecode.com/api/":"/api/",r.accessToken="";var n=!(r.localToken="");function i(e){var t=new Error(a.lf("Cannot access {0} while offline",e));return t.isOffline=!0,Promise.delay(1e3).then(function(){return Promise.reject(t)})}function p(e,t){return m.U.requestAsync({url:"/api/"+e,headers:{Authorization:r.localToken},method:t?"POST":"GET",data:t||void 0,allowHttpErrors:!0})}function d(){return m.webConfig&&!m.webConfig.isStatic&&!m.BrowserUtils.isLocalHost()&&!!m.webConfig.cdnUrl}function e(e){if(e=e.replace(/^\//,""),!d())return r.apiRoot+e;var t=new Date,n=t.getUTCFullYear()+("0"+(t.getUTCMonth()+1)).slice(-2)+("0"+t.getUTCDate()).slice(-2);return e.indexOf("?")<0?e+="?":e+="&",e+="cdn="+n,m.webConfig.cdnUrl+"/api/"+e}function h(t){return d()?(t.url=e(t.url),a.requestAsync(t).catch(function(e){return o(t,e)})):g(t)}function o(e,t){return 0==t.statusCode?(n&&(n=!1,r.onOffline()),i(e.url)):Promise.reject(t)}function g(t){var e;return t.url=(null===(e=m.webConfig)||void 0===e?void 0:e.isStatic)&&!t.forceLiveEndpoint?m.webConfig.relprefix+t.url:r.apiRoot+t.url,t.allowGzipPost=!0,r.isOnline()||m.BrowserUtils.isPxtElectron()?(t.headers||(t.headers={}),m.BrowserUtils.isLocalHost()?r.localToken&&(t.headers.Authorization=r.localToken):r.accessToken&&(t.headers["x-td-access-token"]=r.accessToken),a.requestAsync(t).catch(function(e){return o(t,e)})):i(t.url)}r.onOffline=function(){},r.hasAccessToken=function(){return!!r.accessToken},r.localRequestAsync=p,r.useCdnApi=d,r.cdnApiUrl=e,r.apiRequestWithCdnAsync=h,r.privateRequestAsync=g,r.privateGetTextAsync=function(e,t){return g({url:e,headers:t}).then(function(e){return e.text})},r.privateGetAsync=function(e,t){return void 0===t&&(t=!1),g({url:e,forceLiveEndpoint:t}).then(function(e){return e.json})},r.downloadTargetConfigAsync=function(){if(!r.isOnline())return Promise.resolve(void 0);var e=m.appTarget.versions&&m.appTarget.versions.target,t=m.webConfig&&m.webConfig.isStatic?"targetconfig.json":"config/"+m.appTarget.id+"/targetconfig"+(e?"/v"+e:"");return m.BrowserUtils.isLocalHost()?p(t).then(function(e){return e?e.json:void 0}):h({url:t}).then(function(e){return e.json})},r.downloadScriptFilesAsync=function(e){return g({url:e+"/text",forceLiveEndpoint:!0}).then(function(e){return JSON.parse(e.text)})};var s=m.BrowserUtils.isLocalHostDev()?1:36e5;function c(e,t,n,r){var i,o,a=null===(i=m.webConfig)||void 0===i?void 0:i.isStatic,s=m.appTarget.versions&&m.appTarget.versions.target||"?";if(a){var c=/\/?docs\//.test(o=e),l=/\.\w+$/.test(o);if(!c){var u="/"===o[0];o="docs"+(u?"":"/")+o}l||(o+=".md")}else o="md/"+m.appTarget.id+"/"+e.replace(/^\//,"")+"?targetVersion="+encodeURIComponent(s);if(a||"en"==t||(o+="&lang="+encodeURIComponent(t),n&&(o+="&live=1")),m.BrowserUtils.isLocalHost()&&!n)return p(o).then(function(e){return 404==e.statusCode?g({url:o,method:"GET"}).then(function(e){return{md:e.text,etag:e.headers.etag}}):{md:e.text,etag:void 0}});var f=r&&!d()?{"If-None-Match":r}:void 0;return h({url:o,method:"GET",headers:f}).then(function(e){return{md:e.text,etag:e.headers.etag}})}function t(){return navigator&&navigator.onLine}r.markdownAsync=function(r,i){i=i||m.Util.userLanguage();var e=m.Util.localizeLive;return m.BrowserUtils.translationDbAsync().then(function(n){return n.getAsync(i,r,"").then(function(t){return t&&Date.now()-t.time>s&&c(r,i,e,t.etag).then(function(e){return n.setAsync(i,r,"",e.etag,void 0,e.md||t.md)}).catch(function(){}).done(),t&&t.md?t.md:c(r,i,e).then(function(e){return n.setAsync(i,r,"",e.etag,void 0,e.md).then(function(){return e.md})}).catch(function(){return""})})})},r.privateDeleteAsync=function(e){return g({url:e,method:"DELETE"}).then(function(e){return e.json})},r.privatePostAsync=function(e,t,n){return void 0===n&&(n=!1),g({url:e,data:t||{},forceLiveEndpoint:n}).then(function(e){return e.json})},r.isLoggedIn=function(){return!!r.accessToken},r.isNavigatorOnline=t,r.isOnline=function(){return"undefined"!=typeof navigator&&t()&&(n=!0),n},r.getServiceUrl=function(){return r.apiRoot.replace(/\/api\/$/,"")},r.getUserId=function(){var e=/^0(\w+)\./.exec(r.accessToken);return e?e[1]:null},r.parseScriptId=function(e){var t=m.appTarget;if(e&&t.appTheme&&t.cloud&&t.cloud.sharing){var n=["makecode.com"];t.appTheme.embedUrl&&n.push(t.appTheme.embedUrl),t.appTheme.shareUrl&&n.push(t.appTheme.shareUrl);var r="^((https://)?(?:"+(n=a.unique(n,function(e){return e}).map(function(e){return a.escapeForRegex(a.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase()})).join("|")+")/)?(?:v[0-9]+/)?(api/oembed?url=.*%2F([^&]*)&.*?|([a-z0-9-_]+))$",i=new RegExp(r,"i").exec(e.trim()),o=i&&(!i[1]||0<=n.indexOf(a.escapeForRegex(i[1].replace(/https:\/\//,"").replace(/\/$/,"")).toLowerCase()))&&(i[3]||i[4])?i[3]?i[3]:i[4]:null;if(o)return"_"==o[0]&&13==o.length?o:23==o.length&&/^[0-9\-]+$/.test(o)?o:void 0}}}(m.Cloud||(m.Cloud={}))}(pxt||(pxt={})),function(e){(e.pxtc||(e.pxtc={})).f4EncodeImg=function(e,t,n,r){for(var i=[135,n,255&e,e>>8,255&t,t>>8,0,0].map(f).join(""),o=4,a=0,s=0,c=function(e){a|=e<<s,s==8-n?(i+=f(a),o++,s=a=0):s+=n},l=0;l<e;++l){for(var u=0;u<t;++u)c(r(l,u));for(;0!=s;)c(0);if(1<n)for(;3&o;)c(0)}return i;function f(e){return("0"+e.toString(16)).slice(-2)}}}(ts||(ts={})),function(e){var t=function(){function e(e){this.numCols=8,this.numRows=8,this.polyphonic=!1,e&&(this.tempo=e),this.resetMelody()}return e.prototype.setTempo=function(e){this.tempo=e},e.prototype.getArray=function(){return this.melody},e.prototype.setArray=function(e){this.melody=e},e.prototype.getColor=function(e){return 0},e.prototype.getValue=function(e,t){return this.melody[e][t]},e.prototype.getWidth=function(){return this.numCols},e.prototype.getHeight=function(){return this.numRows},e.prototype.updateMelody=function(e,t){var n=!this.melody[e][t];if(n&&!this.polyphonic)for(var r=0;r<this.numRows;r++)this.melody[r][t]=!1;this.melody[e][t]=n},e.prototype.getStringRepresentation=function(){for(var e="",t=new Array(this.numCols),n=0,r=0;r<this.numRows;r++){var i=0;t[r]=[];for(var o=0;o<this.numCols;o++)this.melody[o][r]&&(t[r].push(a(o)),i++);n<i&&(n=i)}if(0==n)return"- - - - - - - - ";for(o=0;o<n;o++)for(r=0;r<this.numCols;r++)t[r]&&0<t[r].length?e+=t[r].shift()+" ":e+="- ";return e},e.prototype.parseNotes=function(e){for(var t=(e=e.trim()).split(" "),n=0;n<t.length;n++){for(var r=0;r<this.numRows;r++)this.melody[r][n]=!1;"-"!=t[n]&&(this.melody[i(t[n])][n]=!0)}},e.prototype.setPolyphonic=function(e){this.polyphonic=e},e.prototype.isPolyphonic=function(){return this.polyphonic},e.prototype.resetMelody=function(){this.melody=new Array(this.numCols);for(var e=0;e<this.numCols;e++)this.melody[e]=new Array(this.numRows).fill(!1)},e}();function a(e){var t="";switch(e){case 0:t="C5";break;case 1:t="B";break;case 2:t="A";break;case 3:t="G";break;case 4:t="F";break;case 5:t="E";break;case 6:t="D";break;case 7:t="C"}return t}function i(e){var t=-1;switch(e){case"C5":t=0;break;case"B":t=1;break;case"A":t=2;break;case"G":t=3;break;case"F":t=4;break;case"E":t=5;break;case"D":t=6;break;case"C":t=7}return t}e.MelodyArray=t,e.rowToNote=a,e.noteToRow=i,e.getColorClass=function(e){var t="melody-default";switch(e){case 0:t="melody-red";break;case 1:t="melody-orange";break;case 2:t="melody-yellow";break;case 3:t="melody-green";break;case 4:t="melody-teal";break;case 5:t="melody-blue";break;case 6:t="melody-purple";break;case 7:t="melody-violet"}return t}}(pxtmelody||(pxtmelody={})),function(a){var e=function(){function e(){var e=this;this.value=null,this.visible=!1,this.timeouts=[],this.numSamples=a.SampleMelodies.length,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("id","melody-editor-gallery-outer"),this.contentDiv=document.createElement("div"),this.contentDiv.setAttribute("id","melody-editor-gallery"),this.itemBackgroundColor="#DCDCDC",this.itemBorderColor="white",this.initStyles(),this.containerDiv.appendChild(this.contentDiv),this.containerDiv.style.display="none",this.contentDiv.addEventListener("animationend",function(){e.visible||(e.containerDiv.style.display="none")}),this.contentDiv.addEventListener("wheel",function(e){e.stopPropagation()},!0)}return e.prototype.getElement=function(){return this.containerDiv},e.prototype.getValue=function(){return this.value},e.prototype.show=function(e){this.pending=e,this.containerDiv.style.display="block",this.buildDom(),this.visible=!0,pxt.BrowserUtils.removeClass(this.contentDiv,"hidden-above"),pxt.BrowserUtils.addClass(this.contentDiv,"shown")},e.prototype.hide=function(){this.visible=!1,pxt.BrowserUtils.removeClass(this.contentDiv,"shown"),pxt.BrowserUtils.addClass(this.contentDiv,"hidden-above"),this.value=null,this.stopMelody()},e.prototype.clearDomReferences=function(){this.contentDiv=null,this.containerDiv=null},e.prototype.layout=function(e,t,n){this.containerDiv.style.left=e+"px",this.containerDiv.style.top=t+"px",this.containerDiv.style.height=n+"px"},e.prototype.buildDom=function(){for(;this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild);var e=a.SampleMelodies;this.buttons=[];for(var t=0;t<e.length;t++)this.mkButton(e[t],t,"255px","45px")},e.prototype.initStyles=function(){var e=document.createElement("style");e.textContent="\n            #melody-editor-gallery {\n                margin-top: -100%;\n            }\n\n            #melody-editor-gallery.hidden-above {\n                margin-top: -100%;\n                animation: slide-up 0.2s 0s ease;\n            }\n\n            #melody-editor-gallery.shown {\n                margin-top: 0px;\n                animation: slide-down 0.2s 0s ease;\n            }\n\n            @keyframes slide-down {\n                0% {\n                    margin-top: -100%;\n                }\n                100% {\n                    margin-top: 0px;\n                }\n            }\n\n            @keyframes slide-up {\n                0% {\n                    margin-top: 0px;\n                }\n                100% {\n                    margin-top: -100%;\n                }\n            }\n            ",this.containerDiv.appendChild(e)},e.prototype.mkButton=function(e,t,n,r){var i=this,o=p("div",{className:"melody-gallery-button melody-editor-card",role:"menuitem",id:":"+t}),a=p("i",{className:"music icon melody-icon"}),s=p("div",{className:"melody-editor-text"});s.innerText=e.name;var c=this.createColorBlock(e),l=p("div",{className:"melody-editor-button left-button",role:"button",title:e.name},function(){return i.handleSelection(e)});l.appendChild(a),l.appendChild(s),l.appendChild(c),o.appendChild(l);var u=p("div",{className:"melody-editor-button right-button",role:"button",title:lf("Preview {0}",e.name)},function(){return i.togglePlay(e,t)}),f=p("i",{className:"play icon"});this.buttons[t]=f,u.appendChild(f),o.appendChild(u),this.contentDiv.appendChild(o)},e.prototype.handleSelection=function(e){if(this.pending){var t=this.pending;this.pending=void 0,t(e.notes)}},e.prototype.playNote=function(e,t,n){var r=0;switch(e){case"C5":r=523;break;case"B":r=494;break;case"A":r=440;break;case"G":r=392;break;case"F":r=349;break;case"E":r=330;break;case"D":r=294;break;case"C":r=262}this.timeouts.push(setTimeout(function(){pxt.AudioContextManager.tone(r)},t*this.getDuration(n))),this.timeouts.push(setTimeout(function(){pxt.AudioContextManager.stop()},(t+1)*this.getDuration(n)))},e.prototype.getDuration=function(e){return 6e4/e},e.prototype.previewMelody=function(e){this.stopMelody();for(var t=e.notes.split(" "),n=0;n<t.length;n++)this.playNote(t[n],n,e.tempo)},e.prototype.togglePlay=function(e,t){var n=this.buttons[t];pxt.BrowserUtils.containsClass(n,"play icon")?(this.resetPlayIcons(),pxt.BrowserUtils.removeClass(n,"play icon"),pxt.BrowserUtils.addClass(n,"stop icon"),this.previewMelody(e),this.timeouts.push(setTimeout(function(){pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon")},e.notes.split(" ").length*this.getDuration(e.tempo)))):(pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon"),this.stopMelody())},e.prototype.stopMelody=function(){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop()},e.prototype.resetPlayIcons=function(){for(var e=0;e<this.numSamples;e++){var t=this.buttons[e];if(pxt.BrowserUtils.containsClass(t,"stop icon")){pxt.BrowserUtils.removeClass(t,"stop icon"),pxt.BrowserUtils.addClass(t,"play icon");break}}},e.prototype.createColorBlock=function(e){var t=document.createElement("div");pxt.BrowserUtils.addClass(t,"melody-color-block");for(var n=e.notes.split(" "),r=0;r<n.length;r++){var i=a.getColorClass(a.noteToRow(n[r])),o=document.createElement("div");0==r?pxt.BrowserUtils.addClass(o,"left-edge sliver "+i):r==n.length-1?pxt.BrowserUtils.addClass(o,"right-edge sliver "+i):pxt.BrowserUtils.addClass(o,"sliver "+i),t.appendChild(o)}return t},e}();function p(e,t,n){return function(e,t,n){if(t)for(var r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];"className"===o?e.setAttribute("class",t[o]+""):e.setAttribute(o,t[o]+"")}n&&e.addEventListener("click",n);return e}(document.createElement(e),t,n)}a.MelodyGallery=e}(pxtmelody||(pxtmelody={})),function(e){var t=function(e,t,n){this.name=e,this.notes=t,this.tempo=n};e.MelodyInfo=t,e.SampleMelodies=[new t(lf("Scale"),"C5 B A G F E D C",120),new t(lf("Reverse"),"C D E F G A B C5",120),new t(lf("Mystery"),"E B C5 A B G A F",120),new t(lf("Gilroy"),"A F E F D G E F",120),new t(lf("Falling"),"C5 A B G A F G E",120),new t(lf("Hopeful"),"G B A G C5 B A B",120),new t(lf("Tokyo"),"B A G A G F A C5",120),new t(lf("Paris"),"G F G A - F E D",120),new t(lf("Rising"),"E D G F B A C5 B",120),new t(lf("Sitka"),"C5 G B A F A C5 B",120)]}(pxtmelody||(pxtmelody={}));