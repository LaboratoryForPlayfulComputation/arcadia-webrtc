var pxt;!function(i){!function(e){e.startDebuggerAsync=function(e){new n(e).start()};var n=function(){function n(e){this.container=e,this.pkgLoaded=!1,this.intervalRunning=!1}return n.prototype.start=function(){var e=this;this.initializeWebsocket(),this.intervalRunning||(this.intervalRunning=!0,this.intervalId=setInterval(function(){if(!e.ws)try{e.initializeWebsocket()}catch(e){console.warn("Connection to server failed, retrying in "+n.RETRY_MS+" ms")}},n.RETRY_MS)),this.session=new pxsim.SimDebugSession(this.container),this.session.start(this)},n.prototype.initializeWebsocket=function(){var t=this;i.BrowserUtils.isLocalHost()&&i.Cloud.localToken&&(i.debug("initializing debug pipe"),this.ws=new WebSocket("ws://localhost:3234/"+i.Cloud.localToken+"/simdebug"),this.ws.onopen=function(e){i.debug("debug: socket opened")},this.ws.onclose=function(e){i.debug("debug: socket closed"),t.closeListener&&t.closeListener(),t.session.stopSimulator(),t.ws=void 0},this.ws.onerror=function(e){i.debug("debug: socket closed due to error"),t.errorListener&&t.errorListener(e.type),t.session.stopSimulator(),t.ws=void 0},this.ws.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(e){i.debug("debug: could not parse message")}n&&("runner"===n.type?t.handleRunnerMessage(n):("request"===n.type&&"launch"===n.command&&t.sendRunnerMessage("configure",{projectDir:n.arguments.projectDir}),t.dataListener(n)))})},n.prototype.send=function(e){this.ws.send(e)},n.prototype.onData=function(e){this.dataListener=e},n.prototype.onError=function(e){this.errorListener=e},n.prototype.onClose=function(e){this.closeListener=e},n.prototype.close=function(){this.session&&this.session.stopSimulator(!0),this.intervalRunning&&(clearInterval(this.intervalId),this.intervalId=void 0),this.ws&&this.ws.close()},n.prototype.handleRunnerMessage=function(e){switch(e.subtype){case"ready":this.sendRunnerMessage("ready");break;case"runcode":this.runCode(e)}},n.prototype.runCode=function(e){var n=[];e.breakpoints.forEach(function(e){n.push([e.id,{verified:!0,line:e.line,column:e.column,endLine:e.endLine,endColumn:e.endColumn,source:{path:e.fileName}}])}),this.session.runCode(e.code,e.usedParts,e.usedArguments,new pxsim.BreakpointMap(n),i.appTarget.simulator.boardDefinition)},n.prototype.sendRunnerMessage=function(e,n){void 0===n&&(n={}),n.subtype=e,n.type="runner",this.send(JSON.stringify(n))},n.RETRY_MS=2500,n}();e.DebugRunner=n}(i.runner||(i.runner={}))}(pxt||(pxt={})),function(O){!function(e){var P="icon xicon js",S="icon xicon python",A="icon xicon blocks",E="main.py",T="main.blocks";function a(){return{blocksAspectRatio:window.innerHeight<window.innerWidth?1.62:1/1.62,snippetClass:"lang-blocks",signatureClass:"lang-sig",blocksClass:"lang-block",blocksXmlClass:"lang-blocksxml",diffBlocksXmlClass:"lang-diffblocksxml",diffClass:"lang-diff",diffStaticPythonClass:"lang-diffspy",diffBlocksClass:"lang-diffblocks",staticPythonClass:"lang-spy",simulatorClass:"lang-sim",linksClass:"lang-cards",namespacesClass:"lang-namespaces",apisClass:"lang-apis",codeCardClass:"lang-codecard",packageClass:"lang-package",jresClass:"lang-jres",projectClass:"lang-project",snippetReplaceParent:!0,simulator:!0,showEdit:!0,hex:!0,tutorial:!1,showJavaScript:!1,hexName:O.appTarget.id}}function s(e){"undefined"!=typeof hljs&&(e.hasClass("highlight")?hljs.highlightBlock(e[0]):e.find("code.highlight").each(function(e,n){hljs.highlightBlock(n)}),r(e))}function r(e){e.find("span.hljs-comment:contains(@highlight)").each(function(e,n){try{!function(e){var n=$(e),t=document.createElement("span");t.className="highlight-line";var i=e.nextSibling;if(!i||i.nodeType!=Node.TEXT_NODE)return;var o=i.textContent,a=o.indexOf("\n");if(a<0)return;i.textContent=o.substring(0,a+1),$(document.createTextNode(o.substring(a+1).replace(/^\s+/,""))).insertAfter($(i)),i=i.nextSibling;for(;i;){var r=i.nextSibling;if(i.nodeType==Node.TEXT_NODE){var s=(o=i.textContent).indexOf("\n");if(!(s<0)){t.appendChild(document.createTextNode(o.substring(0,s))),i.textContent=o.substring(s+1);break}t.appendChild(i),i=r}else t.appendChild(i),i=r}$(t).insertAfter(n),n.remove()}(n)}catch(e){O.reportException(e)}})}function R(e,n){e.append($('<div class="ui content blocks"/>').append(n))}function j(e,n,t){e.append($('<div class="ui content js"><div class="subheading"><i class="ui icon xicon js"></i>JavaScript</div></div>').append(n)),s(n)}function B(e,n,t){e.append($('<div class="ui content py"><div class="subheading"><i class="ui icon xicon python"></i>Python</div></div>').append(n)),s(n)}function I(e,n){var t=$('<a class="item" role="button" tabindex="0"><i role="presentation" aria-hidden="true"></i><span class="ui desktop only"></span></a>');return t.attr("aria-label",e),t.attr("title",e),t.find("i").attr("class",n),t.find("span").text(e),t.keypress(function(e){var n="number"==typeof e.which?e.which:e.keyCode;13!==n&&32!==n||(e.preventDefault(),e.currentTarget.click())}),t}function b(a,e,r,n,t,i,o){void 0===o&&(o={});var s=$('<div class="ui bottom attached tabular icon small compact menu hideprint"> <div class="right icon menu"></div></div>'),c=$('<div class="ui top attached segment codewidget"></div>'),l=s.find(".right.menu"),d=O.appTarget.appTheme||{};if(o.showEdit&&!d.hideDocsEdit&&i){var p=I(lf("Edit"),"edit icon"),u=i.package,f=i.compileBlocks,m=i.compilePython,g=u.host();t&&f?(u.setPreferredEditor(O.BLOCKS_PROJECT_NAME),g.writeFile(u,T,f.outfiles[T])):n&&m?(u.setPreferredEditor(O.PYTHON_PROJECT_NAME),g.writeFile(u,E,f.outfiles[E])):u.setPreferredEditor(O.JAVASCRIPT_PROJECT_NAME),a.jres&&(g.writeFile(u,O.TILEMAP_JRES,a.jres),g.writeFile(u,O.TILEMAP_CODE,O.emitTilemapsFromJRes(JSON.parse(a.jres))),u.config.files.push(O.TILEMAP_JRES),u.config.files.push(O.TILEMAP_CODE));var h=u.compressToFileAsync();p.click(function(){O.tickEvent("docs.btn",{button:"edit"}),h.done(function(e){window.open((a.pxtUrl||O.appTarget.appTheme.homeUrl||"").replace(/\/$/,"")+"/#project:"+ts.pxtc.encodeBase64(O.Util.uint8ArrayToString(e)),"pxt")})}),l.append(p)}if(a.showJavaScript||!t&&!n?(c.append(r),y(),w()):t?(c.append(t),x(),w()):n&&(c.append(n),y(),x()),o.run&&!d.hideDocsSimulator){var v=I(lf("Run"),"play icon").click(function(){if(O.tickEvent("docs.btn",{button:"sim"}),c.find(".sim")[0])c.find(".sim").remove(),C(c);else{var e="81.97%";O.appTarget.simulator&&(e=100/O.appTarget.simulator.aspectRatio+"%");var n=a.package?"&deps="+encodeURIComponent(a.package):"",t=N(a)+"#nofooter=1"+n,i=encodeURIComponent(r.text()),o=$('<div class="ui card sim"><div class="ui content"><div style="position:relative;height:0;padding-bottom:'+e+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+t+'" data-code="'+i+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div></div></div>');c.append(o),C(o)}});l.append(v)}if(o.hexname&&o.hex){var k=I(lf("Download"),"download icon").click(function(){O.tickEvent("docs.btn",{button:"hex"}),O.BrowserUtils.browserDownloadBinText(o.hex,o.hexname,O.appTarget.compile.hexMimeType)});l.append(k)}var b=$("<div class=codesnippet></div>");function y(){if(t){var e=I(lf("Blocks"),A).click(function(){O.tickEvent("docs.btn",{button:"blocks"}),c.find(".blocks")[0]?(c.find(".blocks").remove(),C(c)):(R(r?r.parent():c,t),C(t))});l.append(e)}}function x(){if(r)if(o.showJs)j(c,r);else{var e=I("JavaScript",P).click(function(){O.tickEvent("docs.btn",{button:"js"}),c.find(".js")[0]?(c.find(".js").remove(),C(c)):(j(t?t.parent():c,r),C(r))});l.append(e)}}function w(){if(n)if(o.showPy)B(c,n);else{var e=I("Python",S).click(function(){O.tickEvent("docs.btn",{button:"py"}),c.find(".py")[0]?(c.find(".py").remove(),C(c)):(B(t?t.parent():c,n),C(n))});l.append(e)}}function C(e){var n;null===(n=e[0])||void 0===n||n.scrollIntoView({behavior:"smooth",block:"center"})}l.children().length&&b.append(s),b.append(c),e.replaceWith(b)}e.defaultClientRenderOptions=a;var n,l=[];function p(e,n,t){if(!e)return Promise.resolve();var i=$("."+e).first();return i[0]?(t.emPixels||(t.emPixels=18),t.layout||(t.layout=O.blocks.BlockLayout.Align),t.splitSvg=!0,l.push({el:i,source:i.text(),options:t,render:n}),i.addClass("lang-shadow"),i.removeClass(e),p(e,n,t)):Promise.resolve()}function y(e){if(!e||e.kind!=ts.SyntaxKind.ExpressionStatement)return null;var n=e;if(!n.expression||n.expression.kind!=ts.SyntaxKind.CallExpression)return null;var t=n.expression;return pxtc.pxtInfo(t).callInfo}function d(e){return n||(n=O.runner.decompileSnippetAsync("",e)),n}function m(e,n){if(n){var t=/^\/(v\d+)/.exec(n.url),i=/^\/(v\d+)/.exec(window.location.pathname),o=/#doc/i.test(window.location.href);n.url&&!t&&i&&!o&&(n.url="/"+i[1]+"/"+n.url),e.append(O.docs.codeCard.render(n,{hideHeader:!0,shortName:!0}))}}function g(e,n,t){var i,o=n.attributes,a=!o.blockHidden&&Blockly.Blocks[o.blockId];if(null===(i=a)||void 0===i?void 0:i.codeCard){var r=O.U.clone(a.codeCard);t&&(r.style=t),m(e,r)}else m(e,{name:n.qName,description:o.jsDoc,url:o.help||void 0,style:t})}function u(e,n,i,f){return p(n,function(e,p){var n=p.compileProgram;if(n){var t=n.getSourceFile("main.ts").statements.slice(0),u=$("<div />").addClass("ui cards");u.attr("role","listbox"),t.forEach(function(e){var n=e.kind,t=y(e);if(t&&p.apiInfo&&p.apiInfo.byQName[t.qName]){var i=p.apiInfo.byQName[t.qName],o=i.attributes,a=Blockly.Blocks[o.blockId];if(f){var r=i,s=p.compileBlocks.blocksInfo.apis.byQName[r.namespace];m(u,{name:s.attributes.blockNamespace||s.name,url:s.attributes.help||"reference/"+(s.attributes.blockNamespace||s.name).toLowerCase(),description:s.attributes.jsDoc,blocksXml:a&&a.codeCard?a.codeCard.blocksXml:o.blockId?'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="'+o.blockId+'"></block></xml>':void 0})}else g(u,i)}else switch(n){case ts.SyntaxKind.ExpressionStatement:var c=e;switch(c.expression.kind){case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:m(u,{name:"Boolean",url:"blocks/logic/boolean",description:lf("True or false values"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="logic_boolean"><field name="BOOL">TRUE</field></block></xml>'});break;default:O.debug("card expr kind: "+c.expression.kind)}break;case ts.SyntaxKind.IfStatement:m(u,{name:f?"Logic":"if",url:"blocks/logic"+(f?"":"/if"),description:f?lf("Logic operators and constants"):lf("Conditional statement"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_if"></block></xml>'});break;case ts.SyntaxKind.WhileStatement:m(u,{name:f?"Loops":"while",url:"blocks/loops"+(f?"":"/while"),description:f?lf("Loops and repetition"):lf("Repeat code while a condition is true."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="device_while"></block></xml>'});break;case ts.SyntaxKind.ForOfStatement:m(u,{name:f?"Loops":"for of",url:"blocks/loops"+(f?"":"/for-of"),description:f?lf("Loops and repetition"):lf("Repeat code for each item in a list."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_for_of"></block></xml>'});break;case ts.SyntaxKind.BreakStatement:m(u,{name:f?"Loops":"break",url:"blocks/loops"+(f?"":"/break"),description:f?lf("Loops and repetition"):lf("Break out of the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="break_keyword"></block></xml>'});break;case ts.SyntaxKind.ContinueStatement:m(u,{name:f?"Loops":"continue",url:"blocks/loops"+(f?"":"/continue"),description:f?lf("Loops and repetition"):lf("Skip iteration and continue the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="continue_keyboard"></block></xml>'});break;case ts.SyntaxKind.ForStatement:var l=e,d=!0;3==l.condition.getChildCount()&&(d=!("0"==l.condition.getChildAt(0).getText()||l.condition.getChildAt(1).kind==ts.SyntaxKind.LessThanToken)),m(u,d?{name:f?"Loops":"for",url:"blocks/loops"+(f?"":"/for"),description:f?lf("Loops and repetition"):lf("Repeat code for a given number of times using an index."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_simple_for"></block></xml>'}:{name:f?"Loops":"repeat",url:"blocks/loops"+(f?"":"/repeat"),description:f?lf("Loops and repetition"):lf("Repeat code for a given number of times."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_repeat_ext"></block></xml>'});break;case ts.SyntaxKind.VariableStatement:m(u,{name:f?"Variables":"variable declaration",url:"blocks/variables"+(f?"":"/assign"),description:f?lf("Variables"):lf("Assign a value to a named variable."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="variables_set"></block></xml>'});break;default:O.debug("card kind: "+n)}}),i&&(e=e.parent()),e.replaceWith(u)}},{package:e.package,aspectRatio:e.blocksAspectRatio,jres:e.jres})}function f(e,n){if(!e)return Promise.resolve();var t,i=$("."+e).first();if(!i[0])return Promise.resolve();i.removeClass(e);try{var o=JSON.parse(i.text());Array.isArray(o)||(o=[o]),t=o}catch(e){O.reportException(e),i.append($("<div/>").addClass("ui segment warning").text(e.messageText))}return n.snippetReplaceParent&&(i=i.parent()),function(e,n,r){if(!n||0==n.length)return Promise.resolve();if(0==n.length){var t=O.docs.codeCard.render(n[0],r);e.replaceWith(t)}else{var s=document.createElement("div");s.className="ui cards",s.setAttribute("role","listbox"),n.forEach(function(n){var e=/^\/(v\d+)/.exec(n.url),t=/^\/(v\d+)/.exec(window.location.pathname),i=/#doc/i.test(window.location.href);n.url&&!e&&t&&!i&&(n.url="/"+t[1]+n.url);var o=O.docs.codeCard.render(n,r);if(s.appendChild(o),"package"==n.cardType){var a=O.github.parseRepoId((n.url||"").replace(/^\/pkg\//,""));a&&O.packagesConfigAsync().then(function(e){switch(O.github.repoStatus(a,e)){case O.github.GitRepoStatus.Banned:o.remove();break;case O.github.GitRepoStatus.Approved:n.imageUrl=O.github.mkRepoIconUrl(a),s.insertBefore(O.docs.codeCard.render(n,r),o),o.remove()}}).catch(function(e){O.reportException(e),O.debug("failed to load repo "+n.url)})}}),e.replaceWith(s)}return Promise.resolve()}(i,t,{hideHeader:!0}).then(function(){return Promise.delay(1,f(e,n))})}function N(e){return e.pxtUrl?e.pxtUrl+"/--run":O.webConfig&&O.webConfig.runUrl?O.webConfig.runUrl:"/--run"}function h(i){var o={showEdit:!!i.showEdit,run:!!i.simulator};$("code.lang-python").each(function(e,n){!function(e,n){"undefined"!=typeof hljs&&($(e).text($(e).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(e),r($(e)));var t=O.U.clone(o);n&&(t.run=!1,t.showEdit=!1),b(i,$(e).parent(),$(e),void 0,void 0,void 0,t)}(n,!1),$(n).removeClass("lang-python")})}e.renderAsync=function(n){var o,i,e,t,c;return O.analytics.enable(),n||(n=a()),n.pxtUrl&&(n.pxtUrl=n.pxtUrl.replace(/\/$/,"")),n.showEdit&&(n.showEdit=!O.BrowserUtils.isIFrame()),(o=n).packageClass&&($("."+o.packageClass).each(function(e,n){var t=$(n),i=t.text().split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).join(",");o.package=o.package?o.package+","+i:i,o.snippetReplaceParent&&(t=t.parent()),t.remove()}),$(".lang-config").each(function(e,n){var t=$(n);o.snippetReplaceParent&&(t=t.parent()),t.remove()})),(i=n).jresClass&&$("."+i.jresClass).each(function(e,n){var t=$(n);i.jres=t.text(),t.remove()}),l=[],e=n,t=$("code.lang-ghost"),e.snippetReplaceParent&&(t=t.parent()),t.remove(),(c=n).simulatorClass&&$("."+c.simulatorClass).each(function(e,n){var t=$(n),i="81.97%";O.appTarget.simulator&&(i=100/O.appTarget.simulator.aspectRatio+"%");var o=$('<div class="ui card"><div class="ui content">\n                    <div style="position:relative;height:0;padding-bottom:'+i+';overflow:hidden;">\n                    <iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe>\n                    </div>\n                    </div></div>'),a=c.package?"&deps="+encodeURIComponent(c.package):"",r=N(c)+"#nofooter=1"+a,s=encodeURIComponent(t.text().trim());o.find("iframe").attr("src",r),o.find("iframe").attr("data-code",s),c.snippetReplaceParent&&(t=t.parent()),t.replaceWith(o)}),function(i){var o={showEdit:!!i.showEdit,run:!!i.simulator};function t(e,n){"undefined"!=typeof hljs&&($(e).text($(e).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(e),r($(e)));var t=O.U.clone(o);n&&(t.run=!1,t.showEdit=!1),b(i,$(e).parent(),$(e),void 0,void 0,void 0,t)}$("code.lang-typescript").each(function(e,n){t(n,!1),$(n).removeClass("lang-typescript")}),$("code.lang-typescript-ignore").each(function(e,n){$(n).removeClass("lang-typescript-ignore"),$(n).addClass("lang-typescript"),t(n,!0),$(n).removeClass("lang-typescript")}),$("code.lang-typescript-invalid").each(function(e,n){$(n).removeClass("lang-typescript-invalid"),$(n).addClass("lang-typescript"),t(n,!0),$(n).removeClass("lang-typescript"),$(n).parent("div").addClass("invalid"),$(n).parent("div").prepend($("<i>",{class:"icon ban"})),$(n).addClass("invalid")}),$("code.lang-typescript-valid").each(function(e,n){$(n).removeClass("lang-typescript-valid"),$(n).addClass("lang-typescript"),t(n,!0),$(n).removeClass("lang-typescript"),$(n).parent("div").addClass("valid"),$(n).parent("div").prepend($("<i>",{class:"icon check"})),$(n).addClass("valid")})}(n),h(n),Promise.resolve().then(function(){return f(n.codeCardClass,n)}).then(function(){return e=n,"core"==O.appTarget.id?Promise.resolve():d(e).then(function(e){var i={},o=e.compileBlocks.blocksInfo;o.blocks.forEach(function(e){var n=(e.attributes.blockNamespace||e.namespace).split(".")[0];if(!i[n]){var t=o.apis.byQName[n];t&&t.attributes.color&&(i[n]=t.attributes.color)}});var t="";return Object.keys(i).forEach(function(e){var n=i[e]||"#dddddd";t+="\n                        span.docs."+e.toLowerCase()+" {\n                            background-color: "+n+" !important;\n                            border-color: "+O.toolbox.fadeColor(n,.1,!1)+" !important;\n                        }\n                    "}),t}).then(function(t){return Object.keys(O.toolbox.blockColors).forEach(function(e){var n=O.toolbox.getNamespaceColor(e);t+="\n                        span.docs."+e.toLowerCase()+" {\n                            background-color: "+n+" !important;\n                            border-color: "+O.toolbox.fadeColor(n,.1,!1)+" !important;\n                        }\n                    "}),t}).then(function(e){var n=document.createElement("style");n.id="namespaceColors",n.type="text/css",(document.head||document.getElementsByTagName("head")[0]).appendChild(n),n.appendChild(document.createTextNode(e))});var e}).then(function(){return function(d){(d=O.Util.clone(d)).emPixels=18,d.snippetMode=!0;var p=$(":not(pre) > code"),u=0;return function o(){if(u>=p.length)return Promise.resolve();var a=$(p[u++]),e=a.text(),n=/^(\|+)([^\|]+)\|+$/.exec(e);if(n){var t=/^(([^\:\.]*?)[\:\.])?(.*)$/.exec(n[2]),i=t[2]?t[2].trim().toLowerCase():"",r=1==n[1].length?"docs inlinebutton "+i:"docs inlineblock "+i,s=t[3].trim();return a.replaceWith($('<span class="'+r+'"/>').text(O.U.rlf(s))),o()}var c=/^\[([^\]]+)\]$/.exec(e);if(!c)return o();var l=c[1];return O.runner.decompileSnippetAsync(l,d).then(function(e){if(e.blocksSvg){var n=$('<span class="block"/>').append(e.blocksSvg),t=y(e.compileProgram.getSourceFile("main.ts").statements[0]);if(t&&e.apiInfo){var i=e.apiInfo.byQName[t.qName];i&&i.attributes.help&&(n=$('<a class="ui link"/>').attr("href","/reference/"+i.attributes.help).append(n))}a.replaceWith(n)}return Promise.delay(1,o())})}()}(n)}).then(function(){return u(n,n.linksClass,n.snippetReplaceParent,!1)}).then(function(){return u(n,n.namespacesClass,n.snippetReplaceParent,!0)}).then(function(){return function(e,s){var n=e.apisClass;if(!n)return Promise.resolve();var t=$("."+n);return t.length?d(e).then(function(e){var n=e.compileBlocks.blocksInfo,r=O.Util.values(n.apis.byQName).filter(function(e){return!e.attributes.hidden&&!!e.attributes.jsDoc&&!/^__/.test(e.name)});t.each(function(e,n){var t=$(n),i=O.Util.toDictionary(t.text().split("\n"),function(e){return e}),o=r.filter(function(e){return!!i[e.namespace]});if(o.length){o.sort(function(e,n){var t=!e.attributes.blockHidden&&Blockly.Blocks[e.attributes.blockId],i=!n.attributes.blockHidden&&Blockly.Blocks[n.attributes.blockId];return!!t!=!!i?(i?1:0)-(t?1:0):e.name.localeCompare(n.name)});var a=$("<div />").addClass("ui divided items");a.attr("role","listbox"),o.forEach(function(e){return g(a,e,"item")}),s&&(t=t.parent()),t.replaceWith(a)}})}):Promise.resolve()}(n,n.snippetReplaceParent)}).then(function(){return p((k=n).signatureClass,function(e,n){var t,i,o,a,r,s=n.compileProgram;if(s){var c=y(s.getSourceFile("main.ts").statements[0]);if(c&&n.apiInfo){var l=n.apiInfo.byQName[c.qName];if(l){var d=(null===(i=null===(t=Blockly.Blocks[l.attributes.blockId])||void 0===t?void 0:t.codeCard)||void 0===i?void 0:i.blocksXml)||void 0,p=d?O.blocks.render(d):(null===(o=n.compileBlocks)||void 0===o?void 0:o.success)?n.blocksSvg:void 0,u=p?$(p):void 0,f=ts.pxtc.service.displayStringForSymbol(l,!1,n.apiInfo).split("\n")[1]+";",m=$('<code class="lang-typescript highlight"/>').text(f),g=(null===(r=null===(a=O.appTarget)||void 0===a?void 0:a.appTheme)||void 0===r?void 0:r.python)&&ts.pxtc.service.displayStringForSymbol(l,!0,n.apiInfo).split("\n")[1],h=g&&$('<code class="lang-python highlight"/>').text(g);if(k.snippetReplaceParent&&(e=e.parent()),O.Util.isTranslationMode()){var v=$('<div class="ui segment" />');v.append($('<div class="ui header"><i class="ui xicon globe"></i></div>')),l.attributes.translationId&&v.append($('<div class="ui message">').text(l.attributes.translationId)),l.attributes.jsDoc&&v.append($('<div class="ui message">').text(l.attributes.jsDoc)),v.insertAfter(e)}b(k,e,m,h,u,n,{showJs:!0,showPy:!0,hideGutter:!0})}}}},{package:k.package,snippetMode:!0,aspectRatio:k.blocksAspectRatio,jres:k.jres});var k}).then(function(){return function(l){if(l.tutorial)return p(l.snippetClass,function(e,n){var t=n.blocksSvg;l.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(i)},{package:l.package,snippetMode:!1,aspectRatio:l.blocksAspectRatio,jres:l.jres});var d=0;return p(l.snippetClass,function(e,n){var t=n.compileBlocks&&n.compileBlocks.success?$(n.blocksSvg):void 0,i=n.compilePython&&n.compilePython.success&&n.compilePython.outfiles["main.py"],o=$('<code class="lang-typescript highlight"/>').text(e.text().trim()),a=i?$('<code class="lang-python highlight"/>').text(i.trim()):void 0;l.snippetReplaceParent&&(e=e.parent());var r=n.compileJS&&n.compileJS.success,s=l.hex&&r&&n.compileJS.outfiles[pxtc.BINARY_HEX]?n.compileJS.outfiles[pxtc.BINARY_HEX]:void 0,c=(O.appTarget.nickname||O.appTarget.id)+"-"+(l.hexName||"")+"-"+d+++".hex";b(l,e,o,a,t,n,{showEdit:l.showEdit,run:l.simulator,hexname:c,hex:s})},{package:l.package,aspectRatio:l.blocksAspectRatio,jres:l.jres})}(n)}).then(function(){return p((o=n).blocksClass,function(e,n){var t=n.blocksSvg;o.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(i)},{package:o.package,snippetMode:!0,aspectRatio:o.blocksAspectRatio,jres:o.jres});var o}).then(function(){return(o=n).blocksXmlClass?function n(t,i,o){var a=$("."+t).first();return a[0]?(o.emPixels||(o.emPixels=18),o.splitSvg=!0,O.runner.compileBlocksAsync(a.text(),o).then(function(e){try{i(a,e)}catch(e){O.reportException(e),a.append($("<div/>").addClass("ui segment warning").text(e.message))}return a.removeClass(t),Promise.delay(1,n(t,i,o))})):Promise.resolve()}(o.blocksXmlClass,function(e,n){var t=n.blocksSvg;o.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(i)},{package:o.package,snippetMode:!0,aspectRatio:o.blocksAspectRatio,jres:o.jres}):Promise.resolve();var o}).then(function(){return(o=n).diffBlocksXmlClass?function t(i,o,a){var r=$("."+i).first();if(!r[0])return Promise.resolve();a.emPixels||(a.emPixels=18),a.splitSvg=!0;var e=r.text().split(/-{10,}/),s=e[0],c=e[1];return O.runner.compileBlocksAsync("",a).then(function(e){r.removeClass(i);try{var n=O.blocks.diffXml(s,c);n?(e.blocksSvg=n.svg,o(r,e)):r.text("no changes")}catch(e){O.reportException(e),r.append($("<div/>").addClass("ui segment warning").text(e.message))}return Promise.delay(1,t(i,o,a))})}(o.diffBlocksXmlClass,function(e,n){var t=n.blocksSvg;o.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(i)},{package:o.package,snippetMode:!0,aspectRatio:o.blocksAspectRatio,jres:o.jres}):Promise.resolve();var o}).then(function(){return(u=n).diffBlocksClass?function s(c){var l=$("."+c).first();if(!l[0])return Promise.resolve();var e=O.diff.split(l.text(),{removeTrailingSemiColumns:!0}),d=e.fileA,p=e.fileB;return Promise.mapSeries([d,p],function(e){return O.runner.decompileSnippetAsync(e,{generateSourceMap:!0})}).then(function(e){try{var n=O.blocks.decompiledDiffAsync(d,e[0].compileBlocks,p,e[1].compileBlocks,{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0}),t=O.diff.render(d,p,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0}),i=void 0,o=e.map(function(e){return e.compilePython&&e.compilePython.outfiles&&e.compilePython.outfiles["main.py"]}),a=o[0],r=o[1];a&&r&&(i=O.diff.render(a,r,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0})),b(u,l.parent(),$(t),i&&$(i),$(n.svg),void 0,{showEdit:!1,run:!1,hexname:void 0,hex:void 0})}catch(e){O.reportException(e),l.append($("<div/>").addClass("ui segment warning").text(e.message))}return Promise.delay(1,s(c))})}(u.diffBlocksClass):Promise.resolve();var u}).then(function(){return(c=n).diffClass?function e(n){var t=$("."+n).first();if(!t[0])return Promise.resolve();var i=O.diff.split(t.text()),o=i.fileA,a=i.fileB;try{var r=O.diff.render(o,a,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});c.snippetReplaceParent&&(t=t.parent());var s=$('<div class="ui segment codewidget"/>').append(r);t.removeClass(n),t.replaceWith(s)}catch(e){O.reportException(e),t.append($("<div/>").addClass("ui segment warning").text(e.message))}return Promise.delay(1,e(n))}(c.diffClass):Promise.resolve();var c}).then(function(){return r={showEdit:!!(a=n).showEdit,run:!!a.simulator},p(a.staticPythonClass,function(e,n){var t=n.compilePython;if(t&&t.success){var i=e.clone().removeClass("lang-shadow").addClass("highlight"),o=i.clone().addClass("lang-python").text(t.outfiles["main.py"]);i.addClass("lang-typescript"),s(o),b(a,e.parent(),i,o,void 0,n,r)}},{package:a.package,snippetMode:!0,jres:a.jres});var a,r}).then(function(){return(a=n).projectClass?function e(){var n=$("."+a.projectClass).first(),t=n[0];if(!t)return Promise.resolve();n.removeClass(a.projectClass);var i=O.Cloud.parseScriptId(t.innerText);if(i){if(a.snippetReplaceParent){t=t.parentElement;var o=document.createElement("div");t.parentElement.insertBefore(o,t),t.parentElement.removeChild(t),t=o}return O.runner.renderProjectAsync(t,i).then(function(){return e()})}return e()}():Promise.resolve();var a}).then(function(){return a={},function e(){var n=l.shift();if(!n)return Promise.resolve();var t=n.el,i=n.options,o=n.render;return O.runner.decompileSnippetAsync(t.text(),i).then(function(e){var n=e.compileJS&&e.compileJS.diagnostics&&e.compileJS.diagnostics.filter(function(e){return e.category==pxtc.DiagnosticCategory.Error});n&&n.length&&n.forEach(function(e){return O.reportError("docs.decompile",""+e.messageText,{code:e.code+""})}),e.blocksSvg.querySelectorAll("defs *").forEach(function(e){a[e.id]?e.remove():a[e.id]=!0}),o(t,e)},function(e){O.reportException(e),t.append($("<div/>").addClass("ui segment warning").text(e.message))}).finally(function(){return t.removeClass("lang-shadow"),e()})}().then(function(){Blockly.Workspace.getAll().forEach(function(e){return e.dispose()}),O.blocks.cleanRenderingWorkspace()});var a})}}(O.runner||(O.runner={}))}(pxt||(pxt={})),function(E){!function(l){var c,o=function(){function e(e,n){this.ksPkg=e,this.topPkg=n,this.files={}}return e.prototype.getKsPkg=function(){return this.ksPkg},e.prototype.getPkgId=function(){return this.ksPkg?this.ksPkg.id:this.id},e.prototype.isTopLevel=function(){return this.ksPkg&&0==this.ksPkg.level},e.prototype.setFiles=function(e){this.files=e},e.prototype.getAllFiles=function(){return E.Util.mapMap(this.files,function(e,n){return n})},e}(),d=function(){function e(){this.githubPackageCache={}}return e.prototype.readFile=function(e,n){var t=u(e);return E.U.lookup(t.files,n)},e.prototype.writeFile=function(e,n,t){n!=E.CONFIG_NAME&&(u(e).files[n]=t)},e.prototype.getHexInfoAsync=function(e){return E.hexloader.getHexInfoAsync(this,e)},e.prototype.cacheStoreAsync=function(e,n){return Promise.resolve()},e.prototype.cacheGetAsync=function(e){return Promise.resolve(null)},e.prototype.patchDependencies=function(e,n,t){if(!t)return!1;var i=E.github.parseRepoId(t);if(!i)return!1;for(var o=0,a=Object.keys(e.dependencies);o<a.length;o++){var r=a[o],s=e.dependencies[r],c=E.github.parseRepoId(s);if(c&&i.fullName==c.fullName)return E.semver.strcmp(i.tag,c.tag)<0&&(e.dependencies[r]=t),!0}return!1},e.prototype.downloadPackageAsync=function(o,a){var r=this,s=o.verProtocol(),c=void 0;"github"==s&&(c=this.githubPackageCache[o._verspec]);var l=u(o);return(c?Promise.resolve(c):o.commonDownloadAsync()).then(function(e){if(e)return"github"!=s||c||(r.githubPackageCache[o._verspec]=E.Util.clone(e)),l.setFiles(e),Promise.resolve();if("empty"==s){if(0==Object.keys(l.files).length&&l.setFiles(f()),a&&a.length){var n=u(o).files,t=JSON.parse(n[E.CONFIG_NAME]);a.forEach(function(e){p(t,e)}),n[E.CONFIG_NAME]=E.Package.stringifyConfig(t)}return Promise.resolve()}if("docs"==s){n=f();var i=JSON.parse(n[E.CONFIG_NAME]);return o.verArgument().split(",").forEach(function(e){p(i,e)}),i.yotta||(i.yotta={}),i.yotta.ignoreConflicts=!0,n[E.CONFIG_NAME]=E.Package.stringifyConfig(i),l.setFiles(n),Promise.resolve()}return"invalid"==s?(E.log("skipping invalid pkg "+o.id),Promise.resolve()):Promise.reject("Cannot download "+o.version()+"; unknown protocol")})},e}();function p(e,n){var t=/^([a-zA-Z0-9_-]+)(=(.+))?$/.exec(n);if(t){if(t[3]&&this&&this.patchDependencies(e,t[1],t[3]))return!1;e.dependencies[t[1]]=t[3]||"*"}else console.warn("unknown package syntax "+n);return!0}function u(e){var n=e._editorPkg;if(n)return n;var t=null;e!=l.mainPkg&&(t=u(l.mainPkg));var i=new o(e,t);return e==l.mainPkg&&(i.topPkg=i),e._editorPkg=i}function f(){var e=E.appTarget.tsprj,n=E.U.clone(e.files);return n[E.CONFIG_NAME]=E.Package.stringifyConfig(e.config),n["main.blocks"]="",n}function e(){E.setAppTarget(window.pxtTargetBundle),E.Util.assert(!!E.appTarget);var e=window.location.href,n=!1,t=!1,i=void 0;if(/[&?]translate=1/.test(e)&&!E.BrowserUtils.isIE())i=ts.pxtc.Util.TRANSLATION_LOCALE,t=n=!0;else{var o=/PXT_LANG=(.*?)(?:;|$)/.exec(document.cookie),a=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(e);i=a?a[3]:o&&o[1]||E.appTarget.appTheme.defaultLocale||navigator.userLanguage||navigator.language,n=!E.appTarget.appTheme.disableLiveTranslations||a&&!!a[1],t=!!a&&!!a[2]}var r=E.appTarget.versions;$&&$.fn&&$.fn.embed&&$.fn.embed.settings&&$.fn.embed.settings.sources&&$.fn.embed.settings.sources.youtube&&($.fn.embed.settings.sources.youtube.url="//www.youtube.com/embed/{id}?rel=0");var s=E.webConfig;return E.Util.updateLocalizationAsync(E.appTarget.id,s.commitCdnUrl,i,r?r.pxtCrowdinBranch:"",r?r.targetCrowdinBranch:"",n,t).then(function(){l.mainPkg=new E.MainPackage(new d)})}function s(e){console.error(e)}E.react.getTilemapProject||(E.react.getTilemapProject=function(){return c||(c=new E.TilemapProject).loadPackage(l.mainPkg),c}),l.initFooter=function(e,n){if(e){var t=E.appTarget.appTheme,i=$("body"),o=$(e),a=$("<a/>").attr("href",t.homeUrl).attr("target","_blank");o.append(a),t.organizationLogo?a.append($("<img/>").attr("src",E.Util.toDataUri(t.organizationLogo))):a.append(lf("powered by {0}",t.title)),i.mouseenter(function(e){return o.fadeOut()}),i.mouseleave(function(e){return o.fadeIn()})}},l.showError=s;var m,n,g=void 0;function a(e,t,n){var i,o,a,r=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj";return g&&g._verspec==r?(l.mainPkg=g,i=l.mainPkg.host(),o=Promise.resolve(),a=Promise.resolve()):(i=l.mainPkg.host(),l.mainPkg=new E.MainPackage(i),l.mainPkg._verspec=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj",o=i.downloadPackageAsync(l.mainPkg,n),a=l.mainPkg.installAllAsync(),g=l.mainPkg),o.then(function(){return i.readFile(l.mainPkg,E.CONFIG_NAME)}).then(function(e){return e?a.then(function(){if(t){var e=u(l.mainPkg);e.files["main.ts"]=t;var n=JSON.parse(e.files[E.CONFIG_NAME]);n.name=window.location.href.split("/").pop().split(/[?#]/)[0],e.files[E.CONFIG_NAME]=E.Package.stringifyConfig(n),l.mainPkg.config.name=n.name,-1==l.mainPkg.config.files.indexOf("main.blocks")&&l.mainPkg.config.files.push("main.blocks")}}).catch(function(e){s(lf("Cannot load extension: {0}",e.message))}):Promise.resolve()})}function r(e){var n=l.mainPkg.getTargetOptions();return n.isNative=!!e,n.hasHex=!!e,l.mainPkg.getCompileOptionsAsync(n)}function t(e,t){return r(e).then(function(e){t&&t(e);var n=pxtc.compile(e);return n.diagnostics&&0<n.diagnostics.length&&n.diagnostics.forEach(function(e){console.error(e.messageText)}),n})}function h(e){var n={};try{var t=window.localStorage.getItem(e);t&&(n=JSON.parse(t))}catch(e){}return n}function v(e,n){if(l.editorLanguageMode=e,n!=E.Util.localeInfo()){var t=/^live-/;return E.Util.updateLocalizationAsync(E.appTarget.id,E.webConfig.commitCdnUrl,n.replace(t,""),E.appTarget.versions.pxtCrowdinBranch,E.appTarget.versions.targetCrowdinBranch,t.test(n))}return Promise.resolve()}function k(e){var n=e.data;if(n)switch(n.type){case"fileloaded":var t=n,i=t.name;v(/\.ts$/i.test(i)?m.TypeScript:m.Blocks,t.locale).done();break;case"popout":var o=/((\/v[0-9+])\/)?[^\/]*#(doc|md):([^&?:]+)/i.exec(window.location.href);if(o){var a=E.webConfig.docsUrl||"/--docs",r=o[2]||"",s="doc"==o[3]?E.webConfig.isStatic?"/docs"+o[4]+".html":""+o[4]:a+"?md="+o[4];window.parent&&window.parent.postMessage({type:"opendoc",url:E.BrowserUtils.urlJoin(r,s)},"*")}break;case"localtoken":var c=n;c&&c.localToken&&(E.Cloud.localToken=c.localToken,A.forEach(function(e){return e()}),A=[])}}function b(n,t){return E.Cloud.privateGetTextAsync(t+"/text").then(function(e){return JSON.parse(e)}).then(function(e){return y(n,e,t)})}function y(e,n,t,i){void 0===t&&(t=null),void 0===i&&(i=!1);var o=JSON.parse(n[E.CONFIG_NAME])||{},a="# "+o.name+" "+(o.version?o.version:"")+"\n\n",r="README.md";n[r]&&(a+=n[r].replace(/^#+/,"$0#")+"\n"),o.files.filter(function(e){return e!=E.CONFIG_NAME&&e!=r}).filter(function(e){return l.editorLanguageMode==m.Blocks==/\.blocks?$/.test(e)}).forEach(function(e){/^main\.(ts|blocks)$/.test(e)||(a+="\n## "+e+"\n"),/\.ts$/.test(e)?a+="```typescript\n"+n[e]+"\n```\n":/\.blocks?$/.test(e)?a+="```blocksxml\n"+n[e]+"\n```\n":a+="```"+e.substr(e.indexOf("."))+"\n"+n[e]+"\n```\n"});var s=o&&o.dependencies&&Object.keys(o.dependencies).filter(function(e){return e!=E.appTarget.corepkg});if(s&&s.length&&(a+="\n## "+lf("Extensions")+" #extensions\n\n"+s.map(function(e){return"* "+e+", "+o.dependencies[e]}).join("\n")+"\n\n```package\n"+s.map(function(e){return e+"="+o.dependencies[e]}).join("\n")+"\n```\n"),t){var c=(E.appTarget.appTheme.shareUrl||"https://makecode.com/")+t;i&&(c="`"+c+"`"),a+="\n"+c+"\n\n"}console.debug("print md: "+a);return C(e,a,{print:!0})}l.generateHexFileAsync=function(n){return a(n.id).then(function(){return t(!0,function(e){n.code&&(e.fileSystem["main.ts"]=n.code)})}).then(function(e){return e.diagnostics&&0<e.diagnostics.length&&console.error("Diagnostics",e.diagnostics),e.outfiles[pxtc.BINARY_HEX]})},l.generateVMFileAsync=function(n){return E.setHwVariant("vm"),a(n.id).then(function(){return t(!0,function(e){n.code&&(e.fileSystem["main.ts"]=n.code)})}).then(function(e){return console.log(e),e})},l.simulateAsync=function(l,d){return a(d.id,d.code,d.dependencies).then(function(){return t(!1,function(e){d.code&&(e.fileSystem["main.ts"]=d.code)})}).then(function(e){e.diagnostics&&0<e.diagnostics.length&&console.error("Diagnostics",e.diagnostics);var n=e.outfiles[pxtc.BINARY_JS];if(n){var t={};t.onSimulatorCommand=function(e){"restart"===e.command&&(c.storedState=h(d.id),i.run(n,c)),"setstate"==e.command&&e.stateKey&&e.stateValue&&function(e,n,t){var i=h(e);if(e){t?i[n]=t:delete i[n];try{window.localStorage.setItem(e,JSON.stringify(i))}catch(e){}}}(d.id,e.stateKey,e.stateValue)};var i=new pxsim.SimulatorDriver(l,t),o=e.usedArguments,a=E.appTarget.simulator.boardDefinition,r=pxtc.computeUsedParts(e,!0),s=h(d.id),c={boardDefinition:a,parts:r,fnArgs:o,cdnUrl:E.webConfig.commitCdnUrl,localizedStrings:E.Util.getLocalizedStrings(),highContrast:d.highContrast,storedState:s,light:d.light};E.appTarget.simulator&&!d.fullScreen&&(c.aspectRatio=r.length&&E.appTarget.simulator.partsAspectRatio?E.appTarget.simulator.partsAspectRatio:E.appTarget.simulator.aspectRatio),i.run(n,c)}})},(n=m=l.LanguageMode||(l.LanguageMode={}))[n.Blocks=0]="Blocks",n[n.TypeScript=1]="TypeScript",l.editorLanguageMode=m.Blocks,l.setEditorContextAsync=v,l.startRenderServer=function(){E.tickEvent("renderer.ready");var o=[],a=void 0;E.editor.initEditorExtensionsAsync().done(function(){window.addEventListener("message",function(e){var n=e.data;"renderblocks"==n.type&&(o.push(n),function e(){if(!a){var n=o.shift();if(n){var t=n.options||{};t.splitSvg=!1,E.tickEvent("renderer.job");var i=/^\s*<xml/.test(n.code);a=E.BrowserUtils.loadBlocklyAsync().then(function(){return i?E.runner.compileBlocksAsync(n.code,t):l.decompileSnippetAsync(n.code,n.options)}).then(function(e){var n=e.blocksSvg;return n?E.blocks.layout.blocklyToSvgAsync(n,0,0,n.viewBox.baseVal.width,n.viewBox.baseVal.height):void 0}).then(function(e){window.parent.postMessage({source:"makecode",type:"renderblocks",id:n.id,width:e?e.width:void 0,height:e?e.height:void 0,svg:e?e.svg:void 0,uri:e?e.xml:void 0,css:e?e.css:void 0},"*")}).catch(function(e){window.parent.postMessage({source:"makecode",type:"renderblocks",id:n.id,error:e.message},"*")}).finally(function(){a=void 0,e()})}}}())},!1),window.parent.postMessage({source:"makecode",type:"renderready"},"*")})},l.startDocsServer=function(e,c,n){E.tickEvent("docrenderer.ready");var t=[];function i(r,s){E.debug("rendering "+r),n&&$(n).hide(),$(c).hide(),$(e).show(),Promise.delay(100).then(function(){switch(r){case"print":var e=window.localStorage.printjob;return delete window.localStorage.printjob,y(c,JSON.parse(e),void 0,!0).then(function(){return pxsim.print(1e3)});case"project":return y(c,JSON.parse(s)).then(function(){return pxsim.print(1e3)});case"projectid":return b(c,JSON.parse(s)).then(function(){return pxsim.print(1e3)});case"doc":return o=c,a=(a=s).replace(/^\//,""),E.Cloud.markdownAsync(a).then(function(e){return C(o,e,{path:a})});case"book":return t=c,n=(n=s).replace(/^\//,""),E.tickEvent("book",{id:n}),E.log("rendering book from "+n),$("#loading").find(".loader").addClass("text").text(lf("Compiling your book (this may take a minute)")),Promise.delay(100).then(function(){return E.Cloud.markdownAsync(n)}).then(function(e){i=E.docs.buildTOC(e),E.log("TOC: "+JSON.stringify(i,null,2));var t=[];return E.docs.visitTOC(i,function(n){/^\//.test(n.path)&&!/^\/pkg\//.test(n.path)&&t.push(E.Cloud.markdownAsync(n.path).then(function(e){n.markdown=e},function(e){n.markdown="_"+n.path+" failed to load._"}))}),Promise.all(t)}).then(function(e){var n=i[0].name;return E.docs.visitTOC(i,function(e){e.markdown&&(n+="\n\n"+e.markdown)}),C(t,n)});default:return C(c,s)}var t,n,i,o,a}).catch(function(e){$(c).html('\n                    <img style="height:4em;" src="'+E.appTarget.appTheme.docsLogo+'" />\n                    <h1>'+lf("Oops")+"</h1>\n                    <h3>"+lf("We could not load the documentation, please check your internet connection.")+'</h3>\n                    <button class="ui button primary" id="tryagain">'+lf("Try Again")+"</button>"),$(c).find("#tryagain").click(function(){i(r,s)}),window.parent&&window.parent.postMessage({type:"docfailed",docType:r,src:s},"*")}).finally(function(){$(e).hide(),n&&$(n).show(),$(c).show()}).done(function(){})}function o(e,n){n?(pxsim.U.addClass(e,"disabled"),e.setAttribute("aria-disabled","true")):(pxsim.U.removeClass(e,"disabled"),e.setAttribute("aria-disabled","false"))}function a(){var e=/^#(doc|md|tutorial|book|project|projectid|print):([^&?:]+)(:([^&?:]+):([^&?:]+))?/i.exec(window.location.hash);e&&(n&&(t.push(window.location.hash),10<t.length&&t.shift(),1<t.length&&o(n,!1)),(e[4]?v(/^blocks$/.test(e[4])?m.Blocks:m.TypeScript,e[5]):Promise.resolve()).then(function(){return i(e[1],decodeURIComponent(e[2]))}))}n&&(n.addEventListener("click",function(){n&&(1<t.length&&(t.pop(),window.location.hash=t.pop()),t.length<=1&&o(n,!0))}),o(n,!0)),E.editor.initEditorExtensionsAsync().done(function(){window.addEventListener("message",k,!1),window.addEventListener("hashchange",function(){a()},!1),parent.postMessage({type:"sidedocready"},"*"),setTimeout(function(){return a()},1)})},l.renderProjectAsync=b,l.renderProjectFilesAsync=y;var x,i,w='\n<aside id=button class=box>\n   <a class="ui primary button" href="@ARGS@">@BODY@</a>\n</aside>\n\n<aside id=vimeo>\n<div class="ui two column stackable grid container">\n<div class="column">\n    <div class="ui embed mdvid" data-source="vimeo" data-id="@ARGS@" data-placeholder="/thumbnail/1024/vimeo/@ARGS@" data-icon="video play">\n    </div>\n</div></div>\n</aside>\n\n<aside id=youtube>\n<div class="ui two column stackable grid container">\n<div class="column">\n    <div class="ui embed mdvid" data-source="youtube" data-id="@ARGS@" data-placeholder="https://img.youtube.com/vi/@ARGS@/0.jpg">\n    </div>\n</div></div>\n</aside>\n\n<aside id=section>\n    \x3c!-- section @ARGS@ --\x3e\n</aside>\n\n<aside id=hide class=box>\n    <div style=\'display:none\'>\n        @BODY@\n    </div>\n</aside>\n\n<aside id=avatar class=box>\n    <div class=\'avatar @ARGS@\'>\n        <div class=\'avatar-image\'></div>\n        <div class=\'ui compact message\'>\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=hint class=box>\n    <div class="ui info message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=tutorialhint class=box>\n    <div class="ui hint message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=reminder class=box>\n    <div class="ui warning message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=alert class=box>\n    <div class="ui negative message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=tip class=box>\n    <div class="ui positive message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n\x3c!-- wrapped around ordinary content --\x3e\n<aside id=main-container class=box>\n    <div class="ui text">\n        @BODY@\n    </div>\n</aside>\n\n\x3c!-- used for \'column\' box - they are collected and wrapped in \'column-container\' --\x3e\n<aside id=column class=aside>\n    <div class=\'column\'>\n        @BODY@\n    </div>\n</aside>\n<aside id=column-container class=box>\n    <div class="ui three column stackable grid text">\n        @BODY@\n    </div>\n</aside>\n@breadcrumb@\n@body@';function C(e,n,t){void 0===t&&(t={});var i=E.docs.renderMarkdown({template:w,markdown:n,theme:E.appTarget.appTheme}),o=t.blocksAspectRatio||window.innerHeight<window.innerWidth?1.62:1/1.62;$(e).html(i),$(e).find("a").attr("target","_blank");var a=E.runner.defaultClientRenderOptions();return a.tutorial=!!t.tutorial,a.blocksAspectRatio=o||a.blocksAspectRatio,a.showJavaScript=l.editorLanguageMode==m.TypeScript,t.print&&(a.showEdit=!1,a.simulator=!1),E.runner.renderAsync(a).then(function(){$(e).find('a[href^="/"]').removeAttr("target").each(function(e,n){$(n).attr("href","#doc:"+$(n).attr("href").replace(/^\//,""))}),$(e).find(".ui.embed").embed()})}function P(e,n){i||(i={});var t=Object.keys(n.fileSystem).sort().join(";");return i[t]||(i[t]=pxtc.getApiInfo(e,n.jres)),i[t]}l.renderMarkdownAsync=C,l.decompileSnippetAsync=function(t,s){return a(s&&s.packageId?"pub:"+s.packageId:s&&s.package?"docs:"+s.package:null,t).then(function(){return r(!!E.appTarget.compile&&E.appTarget.compile.hasHex)}).then(function(e){if(t&&(e.fileSystem["main.ts"]=t),e.ast=!0,s.jres){var n=E.emitTilemapsFromJRes(JSON.parse(s.jres));n&&(e.fileSystem[E.TILEMAP_JRES]=s.jres,e.fileSystem[E.TILEMAP_CODE]=n,e.sourceFiles.push(E.TILEMAP_JRES),e.sourceFiles.push(E.TILEMAP_CODE))}var i,o=void 0;s&&s.forceCompilation?(o=pxtc.compile(e),i=o&&o.ast):i=pxtc.getTSProgram(e,x),x=i;var a=void 0;E.appTarget.appTheme.python&&(a=ts.pxtc.transpile.tsToPy(i,"main.ts"));var r=P(i,e);return ts.pxtc.localizeApisAsync(r,l.mainPkg).then(function(){var e=pxtc.getBlocksInfo(r);E.blocks.initializeAndInject(e);var n=pxtc.decompiler.decompileToBlocks(e,i.getSourceFile("main.ts"),{snippetMode:s&&s.snippetMode,generateSourceMap:s&&s.generateSourceMap});if(n.diagnostics&&0<n.diagnostics.length&&n.diagnostics.forEach(function(e){return console.error(e.messageText)}),!n.success)return{package:l.mainPkg,compileProgram:i,compileJS:o,compileBlocks:n,apiInfo:r};E.debug(n.outfiles["main.blocks"]),s.jres&&((c=new E.TilemapProject).loadPackage(l.mainPkg),c.loadJres(JSON.parse(s.jres),!0));var t=E.blocks.render(n.outfiles["main.blocks"],s);return s.jres&&(c=null),{package:l.mainPkg,compileProgram:i,compileJS:o,compileBlocks:n,compilePython:a,apiInfo:r,blocksSvg:t}})})},l.compileBlocksAsync=function(i,o){return a(o&&o.packageId?"pub:"+o.packageId:o&&o.package?"docs:"+o.package:null,"").then(function(){return r(!!E.appTarget.compile&&E.appTarget.compile.hasHex)}).then(function(e){if(e.ast=!0,o.jres){var n=E.emitTilemapsFromJRes(JSON.parse(o.jres));n&&(e.fileSystem[E.TILEMAP_JRES]=o.jres,e.fileSystem[E.TILEMAP_CODE]=n,e.sourceFiles.push(E.TILEMAP_JRES),e.sourceFiles.push(E.TILEMAP_CODE))}var t=P(pxtc.compile(e).ast,e);return ts.pxtc.localizeApisAsync(t,l.mainPkg).then(function(){var e=pxtc.getBlocksInfo(t);E.blocks.initializeAndInject(e),o.jres&&((c=new E.TilemapProject).loadPackage(l.mainPkg),c.loadJres(JSON.parse(o.jres),!0));var n=E.blocks.render(i,o);return o.jres&&(c=null),{package:l.mainPkg,blocksSvg:n,apiInfo:t}})})};var S,A=[];l.initCallbacks=[],l.init=function(){e().done(function(){for(var e=0;e<l.initCallbacks.length;++e)l.initCallbacks[e]()})},(S=window.ksRunnerWhenLoaded)&&S()}(E.runner||(E.runner={}))}(pxt||(pxt={}));