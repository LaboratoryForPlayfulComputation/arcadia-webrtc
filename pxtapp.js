var e=function(){"use strict";function l(e,t){postMessage({action:Ue,cbn:t,result:e})}function P(e){var t=[];return t[e-1]=void 0,t}function x(e,t){return r(e[0]+t[0],e[1]+t[1])}function a(e,t){return n=~~Math.max(Math.min(e[1]/Re,2147483647),-2147483648)&~~Math.max(Math.min(t[1]/Re,2147483647),-2147483648),r=O(e)&O(t),(i=r)<0&&(i+=Re),[i,n*Re];var n,r,i}function U(e,t){var n,r;return e[0]==t[0]&&e[1]==t[1]?0:(n=e[1]<0,r=t[1]<0,n&&!r?-1:!n&&r?1:T(e,t)[1]<0?-1:1)}function r(e,t){var n,r;for(e%=0x10000000000000000,t=(t%=0x10000000000000000)-(n=t%Re)+(r=Math.floor(e/Re)*Re),e=e-r+n;e<0;)e+=Re,t-=Re;for(;4294967295<e;)e-=Re,t+=Re;for(t%=0x10000000000000000;0x7fffffff00000000<t;)t-=0x10000000000000000;for(;t<-0x8000000000000000;)t+=0x10000000000000000;return[e,t]}function k(e,t){return e[0]==t[0]&&e[1]==t[1]}function A(e){return 0<=e?[e,0]:[e+Re,-Re]}function O(e){return 2147483648<=e[0]?~~Math.max(Math.min(e[0]-Re,2147483647),-2147483648):~~Math.max(Math.min(e[0],2147483647),-2147483648)}function s(e){return e<=30?1<<e:s(30)*s(e-30)}function c(e,t){var n,r,i,o;if(t&=63,k(e,De))return t?Le:e;if(e[1]<0)throw Error("Neg");return o=s(t),r=e[1]*o%0x10000000000000000,0x8000000000000000<=(r+=n=(i=e[0]*o)-i%Re)&&(r-=0x10000000000000000),[i-=n,r]}function R(e,t){var n;return n=s(t&=63),r(Math.floor(e[0]/n),e[1]/n)}function T(e,t){return r(e[0]-t[0],e[1]-t[1])}function i(e,t){return e.Mc=t,e.Lc=0,e.Yb=t.length,e}function h(e){return e.Lc>=e.Yb?-1:255&e.Mc[e.Lc++]}function o(e){return e.Mc=P(32),e.Yb=0,e}function p(e){var t=e.Mc;return t.length=e.Yb,t}function N(e,t){e.Mc[e.Yb++]=t<<24>>24}function D(e,t,n,r){u(t,n,e.Mc,e.Yb,r),e.Yb+=r}function u(e,t,n,r,i){for(var o=0;o<i;++o)n[r+o]=e[t+o]}function f(t,n,r,i,o){var a,s,c,u,l,p,f,d,h,m,g,v,b,y,w,x,k,A,T,C,E,S,_,I;if(U(i,Ne)<0)throw Error("invalid length "+i);for(t.Tb=i,a=function(e){var t;for(e.v=P(4),e.a=[],e.d={},e.C=P(192),e.bb=P(12),e.hb=P(12),e.Ub=P(12),e.vc=P(12),e._=P(192),e.K=[],e.Sb=P(114),e.S=de({},4),e.$=$({}),e.i=$({}),e.A={},e.m=[],e.P=[],e.lb=[],e.nc=P(16),e.x=P(4),e.Q=P(4),e.Xb=[Le],e.uc=[Le],e.Kc=[0],e.fc=P(5),e.yc=P(128),e.vb=0,e.X=1,e.D=0,e.Hb=-1,e.mb=0,t=0;t<4096;++t)e.a[t]={};for(t=0;t<4;++t)e.K[t]=de({},6);return e}({}),f=p=l=void 0,function(e,t){e.ab=t;for(var n=0;1<<n<t;++n);e.$b=2*n}(u=a,1<<(c=o).s),u.n=c.f,l=u,p=c.m,f=l.X,l.X=p,l.b&&f!=l.X&&(l.wb=-1,l.b=null),u.eb=0,u.fb=3,u.Y=2,u.y=3,a.Gc=void 0===e.disableEndMark,function(e,t){e.fc[0]=9*(5*e.Y+e.eb)+e.fb<<24>>24;for(var n=0;n<4;++n)e.fc[1+n]=e.ab>>8*n<<24>>24;D(t,e.fc,0,5)}(a,r),s=0;s<64;s+=8)N(r,255&O(R(i,s)));t.yb=(a.W=0,a.oc=n,a.pc=0,(h=a).b||(m={},g=4,h.X||(g=2),(I=m).qb=2<g,I.qb?(I.w=0,I.xb=4,I.R=66560):(I.w=2,I.xb=3,I.R=0),h.b=m),function(e,t,n){var r,i,o;if(null==e.V||e.u!=n||e.I!=t)for(e.I=t,e.qc=(1<<t)-1,e.u=n,i=1<<e.u+e.I,e.V=P(i),r=0;r<i;++r)e.V[r]=((o={}).tb=P(768),o)}(h.A,h.eb,h.fb),(h.ab!=h.wb||h.Hb!=h.n)&&(v=h.b,b=h.ab,y=4096,w=h.n,x=274,b<1073741567&&(v.Fc=16+(w>>1),E=w+x,S=256+~~(((C=b+y)+w+x)/2),(T=v).Bc=C,T._b=E,_=C+E+S,(null==T.c||T.Kb!=_)&&(T.c=null,T.Kb=_,T.c=P(T.Kb)),T.H=T.Kb-E,v.ob=w,k=b+1,v.p!=k&&(v.L=P(2*(v.p=k))),A=65536,v.qb&&(A=b-1,A|=A>>1,A|=A>>2,A|=A>>4,A|=A>>8,A>>=1,16777216<(A|=65535)&&(A>>=1),v.Ec=A,++A,A+=v.R),A!=v.rc&&(v.ub=P(v.rc=A))),h.wb=h.ab,h.Hb=h.n),a.d.Ab=r,function(e){(function(e){e.l=0;for(var t=e.J=0;t<4;++t)e.v[t]=0})(e),t=e.d,t.mc=Le,t.xc=Le,t.E=-1,t.Jb=1,t.Oc=0,xe(e.C),xe(e._),xe(e.bb),xe(e.hb),xe(e.Ub),xe(e.vc),xe(e.Sb),function(e){var t,n=1<<e.u+e.I;for(t=0;t<n;++t)xe(e.V[t].tb)}(e.A);var t;for(var n=0;n<4;++n)xe(e.K[n].G);W(e.$,1<<e.Y),W(e.i,1<<e.Y),xe(e.S.G),e.N=0,e.jb=0,e.q=0,e.s=0}(a),j(a),B(a),a.$.rb=a.n+1-2,Y(a.$,1<<a.Y),a.i.rb=a.n+1-2,Y(a.i,1<<a.Y),a.g=Le,(d={}).cb=a,d.Z=null,d.zc=1,d)}function d(e,t,n){return e.Nb=o({}),f(e,i({},t),e.Nb,A(t.length),n),e}function n(e,t,n){var r,i,o,a,s,c,u,l,p,f="",d=[];for(i=0;i<5;++i){if(-1==(o=h(t)))throw Error("truncated input");d[i]=o<<24>>24}if(!function(e,t){var n,r,i,o,a,s,c;if(t.length<5)return 0;for(c=255&t[0],i=c%9,o=(s=~~(c/9))%5,a=~~(s/5),r=n=0;r<4;++r)n+=(255&t[1+r])<<8*r;return 99999999<n||!function(e,t,n,r){if(8<t||4<n||4<r)return 0;!function(e,t,n){var r,i;if(null==e.V||e.u!=n||e.I!=t)for(e.I=t,e.qc=(1<<t)-1,e.u=n,i=1<<e.u+e.I,e.V=P(i),r=0;r<i;++r)e.V[r]=(o={},o.Ib=P(768),o);var o}(e.gb,n,t);var i=1<<r;return I(e.Rb,i),I(e.sb,i),e.Dc=i-1,1}(e,i,o,a)?0:(u=e,l=n,l<0?0:(u.Ob!=l&&(u.Ob=l,u.nb=Math.max(u.Ob,1),p=u.B,f=Math.max(u.nb,4096),(null==p.Lb||p.M!=f)&&(p.Lb=P(f)),p.M=f,p.o=0,p.h=0),1));var u,l,p,f}(r=function(e){e.B={},e.e={},e.Gb=P(192),e.Zb=P(12),e.Cb=P(12),e.Db=P(12),e.Eb=P(12),e.pb=P(192),e.kb=P(4),e.kc=P(114),e.Fb=pe({},4),e.Rb=M({}),e.sb=M({}),e.gb={};for(var t=0;t<4;++t)e.kb[t]=pe({},6);return e}({}),d))throw Error("corrupted input");for(i=0;i<64;i+=8){if(-1==(o=h(t)))throw Error("truncated input");1==(o=o.toString(16)).length&&(o="0"+o),f=o+""+f}/^0+$|^f+$/i.test(f)?e.Tb=Ne:(a=parseInt(f,16),e.Tb=4294967295<a?Ne:A(a)),e.yb=(s=r,c=t,u=n,l=e.Tb,s.e.Ab=c,y(s.B),s.B.cc=u,function(e){e.B.h=0,e.B.o=0,xe(e.Gb),xe(e.pb),xe(e.Zb),xe(e.Cb),xe(e.Db),xe(e.Eb),xe(e.kc),function(e){var t,n;for(n=1<<e.u+e.I,t=0;t<n;++t)xe(e.V[t].Ib)}(e.gb);for(var t=0;t<4;++t)xe(e.kb[t].G);F(e.Rb),F(e.sb),xe(e.Fb.G),function(e){e.Bb=0,e.E=-1;for(var t=0;t<5;++t)e.Bb=e.Bb<<8|h(e.Ab)}(e.e)}(s),s.U=0,s.ib=0,s.Jc=0,s.Ic=0,s.Qc=0,s.Nc=l,s.g=Le,s.jc=0,(p={}).Z=s,p.cb=null,p.zc=1,p)}function m(e,t){return e.Nb=o({}),n(e,i({},t),e.Nb),e}function K(e,t){return e.c[e.f+e.o+t]}function X(e,t,n,r){var i,o;for(e.T&&e.o+t+r>e.h&&(r=e.h-(e.o+t)),++n,o=e.f+e.o+t,i=0;i<r&&e.c[o+i]==e.c[o+i-n];++i);return i}function Q(e){return e.h-e.o}function C(e){var t,n,r,i,o,a;if(!e.T)for(;;){if(!(n=-e.f+e.Kb-e.h))return;if(r=e.cc,i=e.c,o=e.f+e.h,a=n,-1==(t=r.Lc>=r.Yb?-1:(a=Math.min(a,r.Yb-r.Lc),u(r.Mc,r.Lc,i,o,a),r.Lc+=a,a)))return e.zb=e.h,e.f+e.zb>e.H&&(e.zb=e.H-e.f),void(e.T=1);e.h+=t,e.h>=e.o+e._b&&(e.zb=e.h-e._b)}}function E(e,t){e.f+=t,e.zb-=t,e.o-=t,e.h-=t}function S(e){var t,n;++e.k>=e.p&&(e.k=0),++(n=e).o,n.o>n.zb&&(n.f+n.o>n.H&&function(e){var t,n,r;for(0<(r=e.f+e.o-e.Bc)&&--r,n=e.f+e.h-r,t=0;t<n;++t)e.c[t]=e.c[r+t];e.f-=r}(n),C(n)),1073741823==e.o&&(t=e.o-e.p,g(e.L,2*e.p,t),g(e.ub,e.rc,t),E(e,t))}function g(e,t,n){var r,i;for(r=0;r<t;++r)(i=e[r]||0)<=n?i=0:i-=n,e[r]=i}function v(e){var t=e.o-e.h;t&&(D(e.cc,e.Lb,e.h,t),e.o>=e.M&&(e.o=0),e.h=e.o)}function b(e,t){var n=e.o-t-1;return n<0&&(n+=e.M),e.Lb[n]}function y(e){v(e),e.cc=null}function _(e){return(e-=2)<4?e:3}function Z(e){return e<4?0:e<10?e-3:e-6}function w(e){if(!e.zc)throw Error("bad state");return e.cb?(function(e,t,n,r){var i,o,a,s,c,u,l,p,f,d,h,m,g,v,b,y,w;if(t[0]=Le,n[0]=Le,r[0]=1,e.oc&&(e.b.cc=e.oc,(w=e.b).f=0,w.o=0,w.h=0,w.T=0,C(w),w.k=0,E(w,-1),e.W=1,e.oc=null),!e.pc){if(e.pc=1,v=e.g,k(e.g,Le)){if(!Q(e.b))return H(e,O(e.g));ie(e),g=O(e.g)&e.y,ke(e.d,e.C,(e.l<<4)+g,0),e.l=Z(e.l),a=K(e.b,-e.s),se(ae(e.A,O(e.g),e.J),e.d,a),e.J=a,--e.s,e.g=x(e.g,Me)}if(!Q(e.b))return H(e,O(e.g));for(;;){if(l=z(e,O(e.g)),d=e.mb,g=O(e.g)&e.y,o=(e.l<<4)+g,1==l&&-1==d)ke(e.d,e.C,o,0),a=K(e.b,-e.s),b=ae(e.A,O(e.g),e.J),e.l<7?se(b,e.d,a):(f=K(e.b,-e.v[0]-1-e.s),ce(b,e.d,f,a)),e.J=a,e.l=Z(e.l);else{if(ke(e.d,e.C,o,1),d<4){if(ke(e.d,e.bb,e.l,1),d?(ke(e.d,e.hb,e.l,1),1==d?ke(e.d,e.Ub,e.l,0):(ke(e.d,e.Ub,e.l,1),ke(e.d,e.vc,e.l,d-2))):(ke(e.d,e.hb,e.l,0),ke(e.d,e._,o,1==l?0:1)),1==l?e.l=e.l<7?9:11:(J(e.i,e.d,l-2,g),e.l=e.l<7?8:11),s=e.v[d],0!=d){for(u=d;1<=u;--u)e.v[u]=e.v[u-1];e.v[0]=s}}else{for(ke(e.d,e.bb,e.l,0),e.l=e.l<7?7:10,J(e.$,e.d,l-2,g),m=G(d-=4),p=_(l),he(e.K[p],e.d,m),4<=m&&(h=d-(i=(2|1&m)<<(c=(m>>1)-1)),m<14?be(e.Sb,i-m-1,e.d,c,h):(Ae(e.d,h>>4,c-4),ge(e.S,e.d,15&h),++e.Qb)),s=d,u=3;1<=u;--u)e.v[u]=e.v[u-1];e.v[0]=s,++e.Mb}e.J=K(e.b,l-1-e.s)}if(e.s-=l,e.g=x(e.g,A(l)),!e.s){if(128<=e.Mb&&j(e),16<=e.Qb&&B(e),t[0]=e.g,n[0]=x(x(A((y=e.d).Jb),y.mc),[4,0]),!Q(e.b))return H(e,O(e.g));if(0<=U(T(e.g,v),[4096,0]))return e.pc=0,r[0]=0}}}}((t=e).cb,t.cb.Xb,t.cb.uc,t.cb.Kc),t.Pb=t.cb.Xb[0],t.cb.Kc[0]&&(V(n=t.cb),n.d.Ab=null,t.zc=0)):function(e){var t=function(e){var t,n,r,i,o,a;if(a=O(e.g)&e.Dc,we(e.e,e.Gb,(e.U<<4)+a)){if(we(e.e,e.Zb,e.U))r=0,we(e.e,e.Cb,e.U)?(we(e.e,e.Db,e.U)?(we(e.e,e.Eb,e.U)?(n=e.Qc,e.Qc=e.Ic):n=e.Ic,e.Ic=e.Jc):n=e.Jc,e.Jc=e.ib,e.ib=n):we(e.e,e.pb,(e.U<<4)+a)||(e.U=e.U<7?9:11,r=1),r||(r=L(e.sb,e.e,a)+2,e.U=e.U<7?8:11);else if(e.Qc=e.Ic,e.Ic=e.Jc,e.Jc=e.ib,r=2+L(e.Rb,e.e,a),e.U=e.U<7?7:10,4<=(o=fe(e.kb[_(r)],e.e))){if(i=(o>>1)-1,e.ib=(2|1&o)<<i,o<14)e.ib+=function(e,t,n,r){var i,o,a=1,s=0;for(o=0;o<r;++o)i=we(n,e,t+a),a<<=1,a+=i,s|=i<<o;return s}(e.kc,e.ib-o-1,e.e,i);else if(e.ib+=function(e,t){var n,r,i=0;for(n=t;0!=n;--n)e.E>>>=1,r=e.Bb-e.E>>>31,e.Bb-=e.E&r-1,i=i<<1|1-r,-16777216&e.E||(e.Bb=e.Bb<<8|h(e.Ab),e.E<<=8);return i}(e.e,i-4)<<4,e.ib+=function(e,t){var n,r,i=1,o=0;for(r=0;e.F>r;++r)n=we(t,e.G,i),i<<=1,i+=n,o|=n<<r;return o}(e.Fb,e.e),e.ib<0)return-1==e.ib?1:-1}else e.ib=o;if(0<=U(A(e.ib),e.g)||e.ib>=e.nb)return-1;(function(e,t,n){var r=e.o-t-1;for(r<0&&(r+=e.M);0!=n;--n)r>=e.M&&(r=0),e.Lb[e.o++]=e.Lb[r++],e.o>=e.M&&v(e)})(e.B,e.ib,r),e.g=x(e.g,A(r)),e.jc=b(e.B,0)}else u=e.gb,l=O(e.g),p=e.jc,t=u.V[((l&u.qc)<<u.u)+((255&p)>>>8-u.u)],e.jc=e.U<7?function(e,t){var n=1;for(;n=n<<1|we(t,e.Ib,n),n<256;);return n<<24>>24}(t,e.e):function(e,t,n){var r,i,o=1;do{if(i=n>>7&1,n<<=1,r=we(t,e.Ib,(1+i<<8)+o),o=o<<1|r,i!=r){for(;o<256;)o=o<<1|we(t,e.Ib,o);break}}while(o<256);return o<<24>>24}(t,e.e,b(e.B,e.ib)),s=e.B,c=e.jc,s.Lb[s.o++]=c,s.o>=s.M&&v(s),e.U=Z(e.U),e.g=x(e.g,Me);var s,c;var u,l,p;return 0}(e.Z);if(-1==t)throw Error("corrupted input");e.Pb=Ne,e.Pc=e.Z.g,(t||0<=U(e.Z.Nc,Le)&&0<=U(e.Z.g,e.Z.Nc))&&(v(e.Z.B),y(e.Z.B),e.Z.e.Ab=null,e.zc=0)}(e),e.zc;var t,n}function I(e,t){for(;t>e.O;++e.O)e.ec[e.O]=pe({},3),e.hc[e.O]=pe({},3)}function L(e,t,n){return we(t,e.wc,0)?8+(we(t,e.wc,1)?8+fe(e.tc,t):fe(e.hc[n],t)):fe(e.ec[n],t)}function M(e){return e.wc=P(2),e.ec=P(16),e.hc=P(16),e.tc=pe({},8),e.O=0,e}function F(e){xe(e.wc);for(var t=0;e.O>t;++t)xe(e.ec[t].G),xe(e.hc[t].G);xe(e.tc.G)}function ee(e,t){var n,r,i,o;for(e.jb=t,i=e.a[t].r,r=e.a[t].j;e.a[t].t&&(le(e.a[i]),e.a[i].r=i-1,e.a[t].Ac&&(e.a[i-1].t=0,e.a[i-1].r=e.a[t].r2,e.a[i-1].j=e.a[t].j2)),o=i,n=r,r=e.a[o].j,i=e.a[o].r,e.a[o].j=n,e.a[o].r=t,0<(t=o););return e.mb=e.a[0].j,e.q=e.a[0].r}function B(e){for(var t=0;t<16;++t)e.nc[t]=ve(e.S,t);e.Qb=0}function j(e){var t,n,r,i,o,a,s,c;for(i=4;i<128;++i)t=(2|1&(a=G(i)))<<(r=(a>>1)-1),e.yc[i]=ye(e.Sb,t-a-1,r,i-t);for(o=0;o<4;++o){for(n=e.K[o],s=o<<6,a=0;e.$b>a;++a)e.P[s+a]=me(n,a);for(a=14;e.$b>a;++a)e.P[s+a]+=(a>>1)-1-4<<6;for(c=128*o,i=0;i<4;++i)e.lb[c+i]=e.P[s+i];for(;i<128;++i)e.lb[c+i]=e.P[s+G(i)]+e.yc[i]}e.Mb=0}function H(e,t){V(e),function(e,t){if(e.Gc){ke(e.d,e.C,(e.l<<4)+t,1),ke(e.d,e.bb,e.l,0),e.l=e.l<7?7:10,J(e.$,e.d,0,t);var n=_(2);he(e.K[n],e.d,63),Ae(e.d,67108863,26),ge(e.S,e.d,15)}}(e,t&e.y);for(var n=0;n<5;++n)Te(e.d)}function z(e,t){var n,r,i,o,a,s,c,u,l,p,f,d,h,m,g,v,b,y,w,x,k,A,T,C,E,S,_,I,P,U,O,R,N,D,L,M,F,B,j,H,z,V,G,W,q,J,$,Y;if(e.jb!=e.q)return h=e.a[e.q].r-e.q,e.mb=e.a[e.q].j,e.q=e.a[e.q].r,h;if(e.q=e.jb=0,e.N?(d=e.vb,e.N=0):d=ie(e),S=e.D,(C=Q(e.b)+1)<2)return e.mb=-1,1;for(273<C&&(C=273),l=j=0;l<4;++l)e.x[l]=e.v[l],e.Q[l]=X(e.b,-1,e.x[l],273),e.Q[l]>e.Q[j]&&(j=l);if(e.Q[j]>=e.n)return e.mb=j,re(e,(h=e.Q[j])-1),h;if(d>=e.n)return e.mb=e.m[S-1]+4,re(e,d-1),d;if(c=K(e.b,-1),b=K(e.b,-e.v[0]-1-1),d<2&&c!=b&&e.Q[j]<2)return e.mb=-1,1;if(e.a[0].Hc=e.l,N=t&e.y,e.a[1].z=je[e.C[(e.l<<4)+N]>>>2]+ue(ae(e.A,t,e.J),7<=e.l,b,c),le(e.a[1]),B=(y=je[2048-e.C[(e.l<<4)+N]>>>2])+je[2048-e.bb[e.l]>>>2],b==c&&(H=B+($=(J=e).l,Y=N,je[J.hb[$]>>>2]+je[J._[($<<4)+Y]>>>2]),e.a[1].z>H&&(e.a[1].z=H,(q=e.a[1]).j=0,q.t=0)),(f=d>=e.Q[j]?d:e.Q[j])<2)return e.mb=e.a[1].j,1;for(e.a[1].r=0,e.a[0].bc=e.x[0],e.a[0].ac=e.x[1],e.a[0].dc=e.x[2],e.a[0].lc=e.x[3],p=f;e.a[p--].z=268435455,2<=p;);for(l=0;l<4;++l)if(!((F=e.Q[l])<2))for(L=B+ne(e,l,e.l,N);o=L+oe(e.i,F-2,N),(U=e.a[F]).z>o&&(U.z=o,U.r=0,U.j=l,U.t=0),2<=--F;);if(T=y+je[e.bb[e.l]>>>2],(p=2<=e.Q[0]?e.Q[0]+1:2)<=d){for(_=0;p>e.m[_];)_+=2;for(;o=T+te(e,u=e.m[_+1],p,N),(U=e.a[p]).z>o&&(U.z=o,U.r=0,U.j=u+4,U.t=0),p!=e.m[_]||(_+=2)!=S;++p);}for(n=0;;){if(++n==f)return ee(e,n);if(w=ie(e),S=e.D,w>=e.n)return e.vb=w,e.N=1,ee(e,n);if(++t,R=e.a[n].r,e.a[n].t?(--R,e.a[n].Ac?(V=e.a[e.a[n].r2].Hc,V=e.a[n].j2<4?V<7?8:11:V<7?7:10):V=e.a[R].Hc,V=Z(V)):V=e.a[R].Hc,R==n-1?V=e.a[n].j?Z(V):V<7?9:11:(e.a[n].t&&e.a[n].Ac?(R=e.a[n].r2,O=e.a[n].j2,V=V<7?8:11):V=(O=e.a[n].j)<4?V<7?8:11:V<7?7:10,P=e.a[R],O<4?O?1==O?(e.x[0]=P.ac,e.x[1]=P.bc,e.x[2]=P.dc,e.x[3]=P.lc):2==O?(e.x[0]=P.dc,e.x[1]=P.bc,e.x[2]=P.ac,e.x[3]=P.lc):(e.x[0]=P.lc,e.x[1]=P.bc,e.x[2]=P.ac,e.x[3]=P.dc):(e.x[0]=P.bc,e.x[1]=P.ac,e.x[2]=P.dc,e.x[3]=P.lc):(e.x[0]=O-4,e.x[1]=P.bc,e.x[2]=P.ac,e.x[3]=P.dc)),e.a[n].Hc=V,e.a[n].bc=e.x[0],e.a[n].ac=e.x[1],e.a[n].dc=e.x[2],e.a[n].lc=e.x[3],s=e.a[n].z,c=K(e.b,-1),b=K(e.b,-e.x[0]-1-1),N=t&e.y,r=s+je[e.C[(V<<4)+N]>>>2]+ue(ae(e.A,t,K(e.b,-2)),7<=V,b,c),x=0,(k=e.a[n+1]).z>r&&(k.z=r,k.r=n,k.j=-1,k.t=0,x=1),B=(y=s+je[2048-e.C[(V<<4)+N]>>>2])+je[2048-e.bb[V]>>>2],b!=c||n>k.r&&!k.j||(H=B+(je[e.hb[V]>>>2]+je[e._[(V<<4)+N]>>>2]),k.z>=H&&(k.z=H,k.r=n,k.j=0,k.t=0,x=1)),!((C=E=4095-n<(E=Q(e.b)+1)?4095-n:E)<2)){if(C>e.n&&(C=e.n),!x&&b!=c&&(W=Math.min(E-1,e.n),2<=(g=X(e.b,0,e.x[0],W)))){for(G=Z(V),D=t+1&e.y,A=r+je[2048-e.C[(G<<4)+D]>>>2]+je[2048-e.bb[G]>>>2],I=n+1+g;f<I;)e.a[++f].z=268435455;o=A+(oe(e.i,g-2,D)+ne(e,0,G,D)),(U=e.a[I]).z>o&&(U.z=o,U.r=n+1,U.j=0,U.t=1,U.Ac=0)}for(z=2,M=0;M<4;++M)if(!((m=X(e.b,-1,e.x[M],C))<2)){v=m;do{for(;f<n+m;)e.a[++f].z=268435455;o=B+(oe(e.i,m-2,N)+ne(e,M,V,N)),(U=e.a[n+m]).z>o&&(U.z=o,U.r=n,U.j=M,U.t=0)}while(2<=--m);if(m=v,M||(z=m+1),m<E&&(W=Math.min(E-1-m,e.n),2<=(g=X(e.b,m,e.x[M],W)))){for(G=V<7?8:11,D=t+m&e.y,i=B+(oe(e.i,m-2,N)+ne(e,M,V,N))+je[e.C[(G<<4)+D]>>>2]+ue(ae(e.A,t+m,K(e.b,m-1-1)),1,K(e.b,m-1-(e.x[M]+1)),K(e.b,m-1)),G=Z(G),D=t+m+1&e.y,A=i+je[2048-e.C[(G<<4)+D]>>>2]+je[2048-e.bb[G]>>>2],I=m+1+g;f<n+I;)e.a[++f].z=268435455;o=A+(oe(e.i,g-2,D)+ne(e,0,G,D)),(U=e.a[n+I]).z>o&&(U.z=o,U.r=n+m+1,U.j=0,U.t=1,U.Ac=1,U.r2=n,U.j2=M)}}if(C<w){for(w=C,S=0;w>e.m[S];S+=2);e.m[S]=w,S+=2}if(z<=w){for(T=y+je[e.bb[V]>>>2];f<n+w;)e.a[++f].z=268435455;for(_=0;z>e.m[_];)_+=2;for(m=z;;++m)if(o=T+te(e,a=e.m[_+1],m,N),(U=e.a[n+m]).z>o&&(U.z=o,U.r=n,U.j=a+4,U.t=0),m==e.m[_]){if(m<E&&(W=Math.min(E-1-m,e.n),2<=(g=X(e.b,m,a,W)))){for(G=V<7?7:10,D=t+m&e.y,i=o+je[e.C[(G<<4)+D]>>>2]+ue(ae(e.A,t+m,K(e.b,m-1-1)),1,K(e.b,m-(a+1)-1),K(e.b,m-1)),G=Z(G),D=t+m+1&e.y,A=i+je[2048-e.C[(G<<4)+D]>>>2]+je[2048-e.bb[G]>>>2],I=m+1+g;f<n+I;)e.a[++f].z=268435455;o=A+(oe(e.i,g-2,D)+ne(e,0,G,D)),(U=e.a[n+I]).z>o&&(U.z=o,U.r=n+m+1,U.j=0,U.t=1,U.Ac=1,U.r2=n,U.j2=a+4)}if((_+=2)==S)break}}}}}function te(e,t,n,r){var i,o=_(n);return(t<128?e.lb[128*o+t]:e.P[(o<<6)+(i=t,i<131072?Be[i>>6]+12:i<134217728?Be[i>>16]+32:Be[i>>26]+52)]+e.nc[15&t])+oe(e.$,n-2,r)}function ne(e,t,n,r){var i;return t?(i=je[2048-e.hb[n]>>>2],1==t?i+=je[e.Ub[n]>>>2]:(i+=je[2048-e.Ub[n]>>>2],i+=Ce(e.vc[n],t-2))):(i=je[e.hb[n]>>>2],i+=je[2048-e._[(n<<4)+r]>>>2]),i}function re(e,t){0<t&&(function(e,t){var n,r,i,o,a,s,c,u,l,p,f,d,h,m,g,v,b;do{if(e.h>=e.o+e.ob)d=e.ob;else if(d=e.h-e.o,e.xb>d){S(e);continue}for(h=e.o>e.p?e.o-e.p:0,r=e.f+e.o,e.qb?(s=1023&(b=Fe[255&e.c[r]]^255&e.c[r+1]),e.ub[s]=e.o,c=65535&(b^=(255&e.c[r+2])<<8),e.ub[1024+c]=e.o,u=(b^Fe[255&e.c[r+3]]<<5)&e.Ec):u=255&e.c[r]^(255&e.c[r+1])<<8,i=e.ub[e.R+u],e.ub[e.R+u]=e.o,g=1+(e.k<<1),v=e.k<<1,p=f=e.w,n=e.Fc;;){if(i<=h||0==n--){e.L[g]=e.L[v]=0;break}if(a=e.o-i,o=(e.k>=a?e.k-a:e.k-a+e.p)<<1,m=e.f+i,l=p<f?p:f,e.c[m+l]==e.c[r+l]){for(;++l!=d&&e.c[m+l]==e.c[r+l];);if(l==d){e.L[v]=e.L[o],e.L[g]=e.L[o+1];break}}(255&e.c[r+l])>(255&e.c[m+l])?(e.L[v]=i,v=o+1,i=e.L[v],f=l):(e.L[g]=i,g=o,i=e.L[g],p=l)}S(e)}while(0!=--t)}(e.b,t),e.s+=t)}function ie(e){var t=0;return e.D=function(e,t){var n,r,i,o,a,s,c,u,l,p,f,d,h,m,g,v,b,y,w,x,k;if(e.h>=e.o+e.ob)m=e.ob;else if(m=e.h-e.o,e.xb>m)return S(e),0;for(b=0,g=e.o>e.p?e.o-e.p:0,r=e.f+e.o,v=1,l=u=0,e.qb?(u=1023&(k=Fe[255&e.c[r]]^255&e.c[r+1]),l=65535&(k^=(255&e.c[r+2])<<8),p=(k^Fe[255&e.c[r+3]]<<5)&e.Ec):p=255&e.c[r]^(255&e.c[r+1])<<8,i=e.ub[e.R+p]||0,e.qb&&(o=e.ub[u]||0,a=e.ub[1024+l]||0,e.ub[u]=e.o,e.ub[1024+l]=e.o,g<o&&e.c[e.f+o]==e.c[r]&&(t[b++]=v=2,t[b++]=e.o-o-1),g<a&&e.c[e.f+a]==e.c[r]&&(a==o&&(b-=2),t[b++]=v=3,t[b++]=e.o-a-1,o=a),0!=b&&o==i&&(b-=2,v=1)),e.ub[e.R+p]=e.o,w=1+(e.k<<1),x=e.k<<1,d=h=e.w,0!=e.w&&g<i&&e.c[e.f+i+e.w]!=e.c[r+e.w]&&(t[b++]=v=e.w,t[b++]=e.o-i-1),n=e.Fc;;){if(i<=g||0==n--){e.L[w]=e.L[x]=0;break}if(c=e.o-i,s=(e.k>=c?e.k-c:e.k-c+e.p)<<1,y=e.f+i,f=d<h?d:h,e.c[y+f]==e.c[r+f]){for(;++f!=m&&e.c[y+f]==e.c[r+f];);if(v<f&&(t[b++]=v=f,t[b++]=c-1,f==m)){e.L[x]=e.L[s],e.L[w]=e.L[s+1];break}}(255&e.c[r+f])>(255&e.c[y+f])?(e.L[x]=i,x=s+1,i=e.L[x],h=f):(e.L[w]=i,w=s,i=e.L[w],d=f)}return S(e),b}(e.b,e.m),0<e.D&&((t=e.m[e.D-2])==e.n&&(t+=X(e.b,t-1,e.m[e.D-1],273-t))),++e.s,t}function V(e){e.b&&e.W&&(e.b.cc=null,e.W=0)}function G(e){return e<2048?Be[e]:e<2097152?Be[e>>10]+20:Be[e>>20]+40}function W(e,t){xe(e.db);for(var n=0;n<t;++n)xe(e.Vb[n].G),xe(e.Wb[n].G);xe(e.ic.G)}function q(e,t,n,r,i){var o,a,s,c,u;for(o=je[e.db[0]>>>2],s=(a=je[2048-e.db[0]>>>2])+je[e.db[1]>>>2],c=a+je[2048-e.db[1]>>>2],u=u=0;u<8;++u){if(n<=u)return;r[i+u]=o+me(e.Vb[t],u)}for(;u<16;++u){if(n<=u)return;r[i+u]=s+me(e.Wb[t],u-8)}for(;u<n;++u)r[i+u]=c+me(e.ic,u-8-8)}function J(e,t,n,r){var i,o,a,s;i=e,o=t,s=r,(a=n)<8?(ke(o,i.db,0,0),he(i.Vb[s],o,a)):(a-=8,ke(o,i.db,0,1),a<8?(ke(o,i.db,1,0),he(i.Wb[s],o,a)):(ke(o,i.db,1,1),he(i.ic,o,a-8))),0==--e.sc[r]&&(q(e,r,e.rb,e.Cc,272*r),e.sc[r]=e.rb)}function $(e){return function(e){e.db=P(2),e.Vb=P(16),e.Wb=P(16),e.ic=de({},8);for(var t=0;t<16;++t)e.Vb[t]=de({},3),e.Wb[t]=de({},3)}(e),e.Cc=[],e.sc=[],e}function oe(e,t,n){return e.Cc[272*n+t]}function Y(e,t){for(var n=0;n<t;++n)q(e,n,e.rb,e.Cc,272*n),e.sc[n]=e.rb}function ae(e,t,n){return e.V[((t&e.qc)<<e.u)+((255&n)>>>8-e.u)]}function se(e,t,n){var r,i,o=1;for(i=7;0<=i;--i)r=n>>i&1,ke(t,e.tb,o,r),o=o<<1|r}function ce(e,t,n,r){var i,o,a,s,c=1,u=1;for(o=7;0<=o;--o)i=r>>o&1,s=u,c&&(s+=1+(a=n>>o&1)<<8,c=a==i),ke(t,e.tb,s,i),u=u<<1|i}function ue(e,t,n,r){var i,o,a=1,s=7,c=0;if(t)for(;0<=s;--s)if(o=n>>s&1,i=r>>s&1,c+=Ce(e.tb[(1+o<<8)+a],i),a=a<<1|i,o!=i){--s;break}for(;0<=s;--s)i=r>>s&1,c+=Ce(e.tb[a],i),a=a<<1|i;return c}function le(e){e.j=-1,e.t=0}function pe(e,t){return e.F=t,e.G=P(1<<t),e}function fe(e,t){var n,r=1;for(n=e.F;0!=n;--n)r=(r<<1)+we(t,e.G,r);return r-(1<<e.F)}function de(e,t){return e.F=t,e.G=P(1<<t),e}function he(e,t,n){var r,i,o=1;for(i=e.F;0!=i;)r=n>>>--i&1,ke(t,e.G,o,r),o=o<<1|r}function me(e,t){var n,r,i=1,o=0;for(r=e.F;0!=r;)n=t>>>--r&1,o+=Ce(e.G[i],n),i=(i<<1)+n;return o}function ge(e,t,n){var r,i,o=1;for(i=0;e.F>i;++i)r=1&n,ke(t,e.G,o,r),o=o<<1|r,n>>=1}function ve(e,t){var n,r,i=1,o=0;for(r=e.F;0!=r;--r)n=1&t,t>>>=1,o+=Ce(e.G[i],n),i=i<<1|n;return o}function be(e,t,n,r,i){var o,a,s=1;for(a=0;a<r;++a)ke(n,e,t+s,o=1&i),s=s<<1|o,i>>=1}function ye(e,t,n,r){var i,o,a=1,s=0;for(o=n;0!=o;--o)i=1&r,r>>>=1,s+=je[(2047&(e[t+a]-i^-i))>>>2],a=a<<1|i;return s}function we(e,t,n){var r,i=t[n];return(-2147483648^(r=(e.E>>>11)*i))>(-2147483648^e.Bb)?(e.E=r,t[n]=i+(2048-i>>>5)<<16>>16,-16777216&e.E||(e.Bb=e.Bb<<8|h(e.Ab),e.E<<=8),0):(e.E-=r,e.Bb-=r,t[n]=i-(i>>>5)<<16>>16,-16777216&e.E||(e.Bb=e.Bb<<8|h(e.Ab),e.E<<=8),1)}function xe(e){for(var t=e.length-1;0<=t;--t)e[t]=1024}function ke(e,t,n,r){var i,o=t[n];i=(e.E>>>11)*o,r?(e.xc=x(e.xc,a(A(i),[4294967295,0])),e.E-=i,t[n]=o-(o>>>5)<<16>>16):(e.E=i,t[n]=o+(2048-o>>>5)<<16>>16),-16777216&e.E||(e.E<<=8,Te(e))}function Ae(e,t,n){for(var r=n-1;0<=r;--r)e.E>>>=1,1==(t>>>r&1)&&(e.xc=x(e.xc,A(e.E))),-16777216&e.E||(e.E<<=8,Te(e))}function Te(e){var t,n,r,i,o=O((n=e.xc,r=32,i=R(n,r&=63),n[1]<0&&(i=x(i,c([2,0],63-r))),i));if(0!=o||U(e.xc,[4278190080,0])<0){for(e.mc=x(e.mc,A(e.Jb)),t=e.Oc;N(e.Ab,t+o),t=255,0!=--e.Jb;);e.Oc=O(e.xc)>>>24}++e.Jb,e.xc=c(a(e.xc,[16777215,0]),8)}function Ce(e,t){return je[(2047&(e-t^-t))>>>2]}function Ee(e){for(var t,n,r,i=0,o=0,a=e.length,s=[],c=[];i<a;++i,++o){if(128&(t=255&e[i]))if(192==(224&t)){if(a<=i+1)return e;if(128!=(192&(n=255&e[++i])))return e;c[o]=(31&t)<<6|63&n}else{if(224!=(240&t))return e;if(a<=i+2)return e;if(128!=(192&(n=255&e[++i])))return e;if(128!=(192&(r=255&e[++i])))return e;c[o]=(15&t)<<12|(63&n)<<6|63&r}else{if(!t)return e;c[o]=t}16383==o&&(s.push(String.fromCharCode.apply(String,c)),o=-1)}return 0<o&&(c.length=o,s.push(String.fromCharCode.apply(String,c))),s.join("")}function Se(e){var t,n,r,i=[],o=0,a=e.length;if("object"==typeof e)return e;for(function(e,t,n,r,i){var o;for(o=t;o<n;++o)r[i++]=e.charCodeAt(o)}(e,0,a,i,0),r=0;r<a;++r)1<=(t=i[r])&&t<=127?++o:o+=!t||128<=t&&t<=2047?2:3;for(n=[],r=o=0;r<a;++r)1<=(t=i[r])&&t<=127?n[o++]=t<<24>>24:(!t||128<=t&&t<=2047?n[o++]=(192|t>>6&31)<<24>>24:(n[o++]=(224|t>>12&15)<<24>>24,n[o++]=(128|t>>6&63)<<24>>24),n[o++]=(128|63&t)<<24>>24);return n}function _e(e){return e[1]+e[0]}var t,Ie=1,Pe=2,Ue=3,Oe="function"==typeof setImmediate?setImmediate:setTimeout,Re=4294967296,Ne=[4294967295,-Re],De=[0,-0x8000000000000000],Le=[0,0],Me=[1,0],Fe=function(){var e,t,n,r=[];for(e=0;e<256;++e){for(n=e,t=0;t<8;++t)0!=(1&n)?n=n>>>1^-306674912:n>>>=1;r[e]=n}return r}(),Be=function(){var e,t,n,r=2,i=[0,1];for(n=2;n<22;++n)for(t=1<<(n>>1)-1,e=0;e<t;++e,++r)i[r]=n<<24>>24;return i}(),je=function(){var e,t,n,r=[];for(t=8;0<=t;--t)for(e=1<<9-t,n=1<<9-t-1;n<e;++n)r[n]=(t<<6)+(e-n<<6>>>9-t-1);return r}(),He=(t=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}],function(e){return t[e-1]||t[6]});return"undefined"==typeof onmessage||"undefined"!=typeof window&&void 0!==window.document||(onmessage=function(t){t&&t.gc&&(t.gc.action==Pe?e.decompress(t.gc.gc,t.gc.cbn):t.gc.action==Ie&&e.compress(t.gc.gc,t.gc.Rc,t.gc.cbn))}),{compress:function(e,t,r,i){var o,n,a={},s=void 0===r&&void 0===i;if("function"!=typeof r&&(n=r,r=i=0),i=i||function(e){return void 0!==n?l(e,n):void 0},r=r||function(e,t){return void 0!==n?postMessage({action:Ie,cbn:n,result:e,error:t}):void 0},s){for(a.c=d({},Se(e),He(t));w(a.c.yb););return p(a.c.Nb)}try{a.c=d({},Se(e),He(t)),i(0)}catch(e){return r(null,e)}Oe(function e(){try{for(var t,n=(new Date).getTime();w(a.c.yb);)if(o=_e(a.c.yb.Pb)/_e(a.c.Tb),200<(new Date).getTime()-n)return i(o),Oe(e,0),0;i(1),t=p(a.c.Nb),Oe(r.bind(null,t),0)}catch(e){r(null,e)}},0)},decompress:function(e,i,o){var a,n,s,c,u={},t=void 0===i&&void 0===o;if("function"!=typeof i&&(n=i,i=o=0),o=o||function(e){return void 0!==n?l(s?e:-1,n):void 0},i=i||function(e,t){return void 0!==n?postMessage({action:Pe,cbn:n,result:e,error:t}):void 0},t){for(u.d=m({},e);w(u.d.yb););return Ee(p(u.d.Nb))}try{u.d=m({},e),c=_e(u.d.Tb),s=-1<c,o(0)}catch(e){return i(null,e)}Oe(function e(){try{for(var t,n=0,r=(new Date).getTime();w(u.d.yb);)if(++n%1e3==0&&200<(new Date).getTime()-r)return s&&(a=_e(u.d.yb.Z.g)/c,o(a)),Oe(e,0),0;o(1),t=Ee(p(u.d.Nb)),Oe(i.bind(null,t),0)}catch(e){i(null,e)}},0)}}}();this.LZMA=this.LZMA_WORKER=e,function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DOMPurify=t()}(this,function(){"use strict";function e(i){return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s(i,e,n)}}function t(r){return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return c(r,t)}}function ye(e,t){o&&o(e,null);for(var n=t.length;n--;){var r=t[n];if("string"==typeof r){var i=Pe(r);i!==r&&(a(t)||(t[n]=i),r=i)}e[r]=!0}return e}function we(e){var t={},n=void 0;for(n in e)s(r,e,[n])&&(t[n]=e[n]);return t}function xe(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var r=Object.hasOwnProperty,o=Object.setPrototypeOf,a=Object.isFrozen,ke=Object.keys,Ae=Object.freeze,n=Object.seal,i="undefined"!=typeof Reflect&&Reflect,s=i.apply,c=i.construct;s||(s=function(e,t,n){return e.apply(t,n)}),Ae||(Ae=function(e){return e}),n||(n=function(e){return e}),c||(c=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))))});var Te=e(Array.prototype.forEach),Ce=e(Array.prototype.indexOf),Ee=e(Array.prototype.join),Se=e(Array.prototype.pop),_e=e(Array.prototype.push),Ie=e(Array.prototype.slice),Pe=e(String.prototype.toLowerCase),Ue=e(String.prototype.match),Oe=e(String.prototype.replace),Re=e(String.prototype.indexOf),Ne=e(String.prototype.trim),De=e(RegExp.prototype.test),Le=t(RegExp),Me=t(TypeError),Fe=Ae(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Be=Ae(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),je=Ae(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),He=Ae(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),ze=Ae(["#text"]),Ve=Ae(["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","coords","crossorigin","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","integrity","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","minlength","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns"]),Ge=Ae(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),We=Ae(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),qe=Ae(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Je=n(/\{\{[\s\S]*|[\s\S]*\}\}/gm),$e=n(/<%[\s\S]*|[\s\S]*%>/gm),Ye=n(/^data-[\-\w.\u00B7-\uFFFF]/),Ke=n(/^aria-[\-\w]+$/),Xe=n(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Qe=n(/^(?:\w+script|data):/i),Ze=n(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g),et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt=function(){return"undefined"==typeof window?null:window},nt=function(e,t){if("object"!==(void 0===e?"undefined":et(e))||"function"!=typeof e.createPolicy)return null;var n=null;t.currentScript&&t.currentScript.hasAttribute("data-tt-policy-suffix")&&(n=t.currentScript.getAttribute("data-tt-policy-suffix"));var r="dompurify"+(n?"#"+n:"");try{return e.createPolicy(r,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+r+" could not be created."),null}};return function t(){var u=0<arguments.length&&void 0!==arguments[0]?arguments[0]:tt(),f=function(e){return t(e)};if(f.version="2.0.8",f.removed=[],!u||!u.document||9!==u.document.nodeType)return f.isSupported=!1,f;var l=u.document,a=!1,s=!1,c=u.document,p=u.DocumentFragment,e=u.HTMLTemplateElement,d=u.Node,n=u.NodeFilter,r=u.NamedNodeMap,o=void 0===r?u.NamedNodeMap||u.MozNamedAttrMap:r,h=u.Text,m=u.Comment,g=u.DOMParser,i=u.trustedTypes;if("function"==typeof e){var v=c.createElement("template");v.content&&v.content.ownerDocument&&(c=v.content.ownerDocument)}var b=nt(i,l),y=b?b.createHTML(""):"",w=c,x=w.implementation,k=w.createNodeIterator,A=w.getElementsByTagName,T=w.createDocumentFragment,C=l.importNode,E={};f.isSupported=x&&void 0!==x.createHTMLDocument&&9!==c.documentMode;var S=Je,_=$e,I=Ye,P=Ke,U=Qe,O=Ze,R=Xe,N=null,D=ye({},[].concat(xe(Fe),xe(Be),xe(je),xe(He),xe(ze))),L=null,M=ye({},[].concat(xe(Ve),xe(Ge),xe(We),xe(qe))),F=null,B=null,j=!0,H=!0,z=!1,V=!1,G=!1,W=!1,q=!1,J=!1,$=!1,Y=!1,K=!1,X=!1,Q=!0,Z=!0,ee=!1,te={},ne=ye({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),re=ye({},["audio","video","img","source","image"]),ie=null,oe=ye({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),ae=null,se=c.createElement("form"),ce=function(e){ae&&ae===e||(e&&"object"===(void 0===e?"undefined":et(e))||(e={}),N="ALLOWED_TAGS"in e?ye({},e.ALLOWED_TAGS):D,L="ALLOWED_ATTR"in e?ye({},e.ALLOWED_ATTR):M,ie="ADD_URI_SAFE_ATTR"in e?ye(we(oe),e.ADD_URI_SAFE_ATTR):oe,F="FORBID_TAGS"in e?ye({},e.FORBID_TAGS):{},B="FORBID_ATTR"in e?ye({},e.FORBID_ATTR):{},te="USE_PROFILES"in e&&e.USE_PROFILES,j=!1!==e.ALLOW_ARIA_ATTR,H=!1!==e.ALLOW_DATA_ATTR,z=e.ALLOW_UNKNOWN_PROTOCOLS||!1,V=e.SAFE_FOR_JQUERY||!1,G=e.SAFE_FOR_TEMPLATES||!1,W=e.WHOLE_DOCUMENT||!1,$=e.RETURN_DOM||!1,Y=e.RETURN_DOM_FRAGMENT||!1,K=e.RETURN_DOM_IMPORT||!1,X=e.RETURN_TRUSTED_TYPE||!1,J=e.FORCE_BODY||!1,Q=!1!==e.SANITIZE_DOM,Z=!1!==e.KEEP_CONTENT,ee=e.IN_PLACE||!1,R=e.ALLOWED_URI_REGEXP||R,G&&(H=!1),Y&&($=!0),te&&(N=ye({},[].concat(xe(ze))),L=[],!0===te.html&&(ye(N,Fe),ye(L,Ve)),!0===te.svg&&(ye(N,Be),ye(L,Ge),ye(L,qe)),!0===te.svgFilters&&(ye(N,je),ye(L,Ge),ye(L,qe)),!0===te.mathMl&&(ye(N,He),ye(L,We),ye(L,qe))),e.ADD_TAGS&&(N===D&&(N=we(N)),ye(N,e.ADD_TAGS)),e.ADD_ATTR&&(L===M&&(L=we(L)),ye(L,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&ye(ie,e.ADD_URI_SAFE_ATTR),Z&&(N["#text"]=!0),W&&ye(N,["html","head","body"]),N.table&&(ye(N,["tbody"]),delete F.tbody),Ae&&Ae(e),ae=e)},ue=function(t){_e(f.removed,{element:t});try{t.parentNode.removeChild(t)}catch(e){t.outerHTML=y}},le=function(e,t){try{_e(f.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){_e(f.removed,{attribute:null,from:t})}t.removeAttribute(e)},pe=function(e){var t=void 0,n=void 0;if(J)e="<remove></remove>"+e;else{var r=Ue(e,/^[\s]+/);n=r&&r[0]}var i=b?b.createHTML(e):e;if(a)try{t=(new g).parseFromString(i,"text/html")}catch(e){}if(s&&ye(F,["title"]),!t||!t.documentElement){var o=(t=x.createHTMLDocument("")).body;o.parentNode.removeChild(o.parentNode.firstElementChild),o.outerHTML=i}return e&&n&&t.body.insertBefore(c.createTextNode(n),t.body.childNodes[0]||null),A.call(t,W?"html":"body")[0]};f.isSupported&&(function(){try{pe('<svg><p><textarea><img src="</textarea><img src=x abc=1//">').querySelector("svg img")&&(a=!0)}catch(e){}}(),function(){try{var e=pe("<x/><title>&lt;/title&gt;&lt;img&gt;");De(/<\/title/,e.querySelector("title").innerHTML)&&(s=!0)}catch(e){}}());var fe=function(e){return k.call(e.ownerDocument||e,e,n.SHOW_ELEMENT|n.SHOW_COMMENT|n.SHOW_TEXT,function(){return n.FILTER_ACCEPT},!1)},de=function(e){return"object"===(void 0===d?"undefined":et(d))?e instanceof d:e&&"object"===(void 0===e?"undefined":et(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},he=function(e,t,n){E[e]&&Te(E[e],function(e){e.call(f,t,n,ae)})},me=function(e){var t,n=void 0;if(he("beforeSanitizeElements",e,null),!((t=e)instanceof h||t instanceof m||"string"==typeof t.nodeName&&"string"==typeof t.textContent&&"function"==typeof t.removeChild&&t.attributes instanceof o&&"function"==typeof t.removeAttribute&&"function"==typeof t.setAttribute&&"string"==typeof t.namespaceURI))return ue(e),!0;var r=Pe(e.nodeName);if(he("uponSanitizeElement",e,{tagName:r,allowedTags:N}),("svg"===r||"math"===r)&&0!==e.querySelectorAll("p, br").length)return ue(e),!0;if(!N[r]||F[r]){if(Z&&!ne[r]&&"function"==typeof e.insertAdjacentHTML)try{var i=e.innerHTML;e.insertAdjacentHTML("AfterEnd",b?b.createHTML(i):i)}catch(e){}return ue(e),!0}return"noscript"===r&&De(/<\/noscript/i,e.innerHTML)?(ue(e),!0):"noembed"===r&&De(/<\/noembed/i,e.innerHTML)?(ue(e),!0):(!V||e.firstElementChild||e.content&&e.content.firstElementChild||!De(/</g,e.textContent)||(_e(f.removed,{element:e.cloneNode()}),e.innerHTML?e.innerHTML=Oe(e.innerHTML,/</g,"&lt;"):e.innerHTML=Oe(e.textContent,/</g,"&lt;")),G&&3===e.nodeType&&(n=e.textContent,n=Oe(n,S," "),n=Oe(n,_," "),e.textContent!==n&&(_e(f.removed,{element:e.cloneNode()}),e.textContent=n)),he("afterSanitizeElements",e,null),!1)},ge=function(e,t,n){if(Q&&("id"===t||"name"===t)&&(n in c||n in se))return!1;if(H&&De(I,t));else if(j&&De(P,t));else{if(!L[t]||B[t])return!1;if(ie[t]);else if(De(R,Oe(n,O,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Re(n,"data:")||!re[e])if(z&&!De(U,Oe(n,O,"")));else if(n)return!1}return!0},ve=function(e){var t=void 0,n=void 0,r=void 0,i=void 0,o=void 0;he("beforeSanitizeAttributes",e,null);var a=e.attributes;if(a){var s={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:L};for(o=a.length;o--;){var c=t=a[o],u=c.name,l=c.namespaceURI;if(n=Ne(t.value),r=Pe(u),s.attrName=r,s.attrValue=n,s.keepAttr=!0,s.forceKeepAttr=void 0,he("uponSanitizeAttribute",e,s),n=s.attrValue,!s.forceKeepAttr){if("name"===r&&"IMG"===e.nodeName&&a.id)i=a.id,a=Ie(a,[]),le("id",e),le(u,e),Ce(a,i)>o&&e.setAttribute("id",i.value);else{if("INPUT"===e.nodeName&&"type"===r&&"file"===n&&s.keepAttr&&(L[r]||!B[r]))continue;"id"===u&&e.setAttribute(u,""),le(u,e)}if(s.keepAttr)if(V&&De(/\/>/i,n))le(u,e);else if(De(/svg|math/i,e.namespaceURI)&&De(Le("</("+Ee(ke(ne),"|")+")","i"),n))le(u,e);else{G&&(n=Oe(n,S," "),n=Oe(n,_," "));var p=e.nodeName.toLowerCase();if(ge(p,r,n))try{l?e.setAttributeNS(l,u,n):e.setAttribute(u,n),Se(f.removed)}catch(e){}}}}he("afterSanitizeAttributes",e,null)}},be=function e(t){var n=void 0,r=fe(t);for(he("beforeSanitizeShadowDOM",t,null);n=r.nextNode();)he("uponSanitizeShadowNode",n,null),me(n)||(n.content instanceof p&&e(n.content),ve(n));he("afterSanitizeShadowDOM",t,null)};return f.sanitize=function(e,t){var n=void 0,r=void 0,i=void 0,o=void 0,a=void 0;if(e||(e="\x3c!--\x3e"),"string"!=typeof e&&!de(e)){if("function"!=typeof e.toString)throw Me("toString is not a function");if("string"!=typeof(e=e.toString()))throw Me("dirty is not a string, aborting")}if(!f.isSupported){if("object"===et(u.toStaticHTML)||"function"==typeof u.toStaticHTML){if("string"==typeof e)return u.toStaticHTML(e);if(de(e))return u.toStaticHTML(e.outerHTML)}return e}if(q||ce(t),f.removed=[],"string"==typeof e&&(ee=!1),ee);else if(e instanceof d)1===(r=(n=pe("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===r.nodeName?n=r:"HTML"===r.nodeName?n=r:n.appendChild(r);else{if(!$&&!G&&!W&&X&&-1===e.indexOf("<"))return b?b.createHTML(e):e;if(!(n=pe(e)))return $?null:y}n&&J&&ue(n.firstChild);for(var s=fe(ee?e:n);i=s.nextNode();)3===i.nodeType&&i===o||me(i)||(i.content instanceof p&&be(i.content),ve(i),o=i);if(o=null,ee)return e;if($){if(Y)for(a=T.call(n.ownerDocument);n.firstChild;)a.appendChild(n.firstChild);else a=n;return K&&(a=C.call(l,a,!0)),a}var c=W?n.outerHTML:n.innerHTML;return G&&(c=Oe(c,S," "),c=Oe(c,_," ")),b&&X?b.createHTML(c):c},f.setConfig=function(e){ce(e),q=!0},f.clearConfig=function(){ae=null,q=!1},f.isValidAttribute=function(e,t,n){ae||ce({});var r=Pe(e),i=Pe(t);return ge(r,i,n)},f.addHook=function(e,t){"function"==typeof t&&(E[e]=E[e]||[],_e(E[e],t))},f.removeHook=function(e){E[e]&&Se(E[e])},f.removeHooks=function(e){E[e]&&(E[e]=[])},f.removeAllHooks=function(){E={}},f}()});var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,a,s,c){return new(s||(s=Promise))(function(n,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function i(e){try{o(c.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(r,i)}o((c=c.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r},pxt,pxt,pxt,pxt,ts;pxt||(pxt={}),function(c){!function(e){var a={},s={},t=!1;function n(){return"undefined"!=typeof mscc&&!mscc.hasConsent()}e.addDefaultProperties=function(t){Object.keys(t).forEach(function(e){"string"==typeof t[e]?a[e]=t[e]:s[e]=t[e]})},e.enable=function(){if(c.aiTrackException&&c.aiTrackEvent&&!t){t=!0,c.debug("setting up app insights");var o=c.tickEvent;c.tickEvent=function(e,t,n){if(o&&o(e,t,n),n&&n.interactiveConsent&&"undefined"!=typeof mscc&&!mscc.hasConsent()&&mscc.setConsent(),t){var r=a||{},i=s||{};Object.keys(t).forEach(function(e){"string"==typeof t[e]?r[e]=t[e]:"number"==typeof t[e]?i[e]=t[e]:r[e]=JSON.stringify(t[e]||"")}),c.aiTrackEvent(e,r,i)}else c.aiTrackEvent(e)};var r=c.reportException;c.reportException=function(e,t){r&&r(e,t);var n={target:c.appTarget.id,version:c.appTarget.versions.target};t&&c.Util.jsonMergeFrom(n,t),c.aiTrackException(e,"exception",n)};var e=c.reportError;c.reportError=function(t,n,r){e&&e(t,n,r);try{throw n}catch(e){var i={target:c.appTarget.id,version:c.appTarget.versions.target,category:t,message:n};r&&c.Util.jsonMergeFrom(i,r),c.aiTrackException(e,"error",i)}}}},e.isCookieBannerVisible=n,e.enableCookies=function(){n()&&mscc.setConsent()}}(c.analytics||(c.analytics={}))}(pxt||(pxt={})),pxt||(pxt={}),function(e){!function(e){var n,r,i,o=0,a=!1;function s(){return n||(n=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}return}()),n}function t(){n&&(i.gain.setTargetAtTime(0,n.currentTime,.015),o=0)}e.mute=function(e){n&&(a=e,t(),e&&r&&(r.disconnect(),i.disconnect(),i=r=void 0))},e.stop=t,e.frequency=function(){return o},e.tone=function(e){if(!(a||e<=0)){o=e;var t=s();if(t)try{r||((r=t.createOscillator()).type="triangle",(i=t.createGain()).connect(t.destination),r.connect(i),r.start(0)),r.frequency.value=e,i.gain.setTargetAtTime(1,n.currentTime,.015)}catch(e){return void(r=void 0)}}}}(e.AudioContextManager||(e.AudioContextManager={}))}(pxt||(pxt={})),(pxt||(pxt={})).tickEvent=function(e){},function(e){(e.pxtc||(e.pxtc={})).__dummy=42}(ts||(ts={}));var pxtc=ts.pxtc;!function(e){var t;(function(p){function t(e){return e.replace(/[^\w .!?\-$]/g,function(e){var t=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-t.length)+t})}p.assert=function(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)},p.flatClone=function(t){if(null==t)return null;var n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n},p.clone=function(e){return null==e?null:JSON.parse(JSON.stringify(e))},p.htmlEscape=function(e){return e?e.replace(/([^\w .!?\-$])/g,function(e){return"&#"+e.charCodeAt(0)+";"}):e},p.htmlUnescape=function(e){return e?e.replace(/(&#\d+;)/g,function(e){return String.fromCharCode(Number(e.substr(2,e.length-3)))}):e},p.jsStringQuote=t,p.jsStringLiteral=function(e){return'"'+t(e)+'"'};var n="en",r={},e={};function i(){return n}function o(e){var t=/^(\w{2})-(\w{2}$)/i.exec(e);return t&&t[1]&&t[2]?[t[1].toLowerCase()+"-"+t[2].toUpperCase(),t[1].toLowerCase(),t[1].toLowerCase()+"-"+t[2].toLowerCase()]:[(e||"en").toLowerCase()]}function a(e,l){return 0==l.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){var r=l[parseInt(t)],i="",o=/^:f(\d*)\.(\d+)/.exec(n);if(o){var a=parseInt(o[2]),s=parseInt(o[1])||0,c=/^0/.test(o[1])?"0":" ",u=r.toFixed(a);if(0<s&&0<a&&(s+=a+1),0<s)for(;u.length<s;)u=c+u;i=u}else i=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(i.toLowerCase())?i="an "+i:/^\s*[bcdfgjklmnpqrstvwxz]/.test(i.toLowerCase())&&(i="a "+i):":s"==n?i=1==r?"":"s":":q"==n?i=p.htmlEscape(i):":jq"==n?i=p.jsStringQuote(i):":uri"==n?i=encodeURIComponent(i).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?i=encodeURI(i).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(i=(100*r).toFixed(1).toString()+"%"),i})}p.localizeLive=!1,p.localeInfo=function(){return(p.localizeLive?"live-":"")+i()},p.userLanguage=i,p.normalizeLanguageCode=o,p.setUserLanguage=function(e){n=o(e)[0]},p.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(n)},p.TRANSLATION_LOCALE="pxt",p.isTranslationMode=function(){return i()==p.TRANSLATION_LOCALE},p._localize=function(e){return r[e]||e},p.getLocalizedStrings=function(){return r},p.setLocalizedStrings=function(e){r=e},p.translationsCache=function(){return e},p.fmt_va=a,p.fmt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return a(e,t)};var s={};p.dumpLocStats=function(){var t={};Object.keys(s).sort(function(e,t){return s[t]-s[e]}).forEach(function(e){return t[e]=e}),console.log("prioritized list of strings:"),console.log(JSON.stringify(t,null,2))};var c=!0;function u(e,t){if(!e)return e;s[e]=(s[e]||0)+1;var n=p._localize(e);return!c&&n!=e&&/\d:s\}/.test(n)&&(n=n.replace(/\{\d+:s\}/g,"")),a(n=n.replace(/^\{(id|loc):[^\}]+\}/g,""),t)}p.lf_va=u,p.lf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return u(e,t)},p.rlf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return u(e,t)},p.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},p.isoTime=function(e){var t=new Date(1e3*e);return p.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},p.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t},p.isPyLangPref=function(){return"py"==localStorage.getItem("editorlangpref")},p.getEditorLanguagePref=function(){return localStorage.getItem("editorlangpref")},p.setEditorLanguagePref=function(e){e.match(/prj$/)&&(e=e.replace(/prj$/,"")),localStorage.setItem("editorlangpref",e)},p.getToolboxAnimation=function(){return localStorage.getItem("toolboxanimation")},p.setToolboxAnimation=function(){localStorage.setItem("toolboxanimation","1")},p.deq=function e(t,n){if(t===n)return null;if(!t||!n)return"Null value";if("object"==typeof t&&"object"==typeof n){if(Array.isArray(t)){if(!Array.isArray(n))return"Expected array";if(t.length!=n.length)return"Expected array of length "+t.length+", got "+n.length;for(var r=0;r<t.length;r++)if(null!=e(t[r],n[r]))return"Expected array value "+t[r]+" got "+n[r];return null}var i=Object.keys(t),o=Object.keys(t);if(i.length!=o.length)return"Expected "+i.length+" keys, got "+o.length;for(r=0;r<i.length;r++){if(!Object.prototype.hasOwnProperty.call(n,i[r]))return"Missing key "+i[r];if(null!=e(t[i[r]],n[i[r]]))return"Expected value of "+i[r]+" to be "+t[i[r]]+", got "+n[i[r]]}return null}return"Unable to compare "+t+", "+n}})((t=e.pxtc||(e.pxtc={})).Util||(t.Util={}))}(ts||(ts={}));var lf=ts.pxtc.Util.lf,ts,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,ts,pxt,pxt,pxt,pxt,pxt,ts,pxt,pxt,pxt,pxt,ts,pxt,ts,pxtmelody,pxtmelody,pxtmelody,pxt,pxt,pxt,pxt,pxt;!function(e){var t;(t=e.pxtc||(e.pxtc={})).decodeBase64=function(e){return atob(e)},t.encodeBase64=function(e){return btoa(e)}}(ts||(ts={})),function(x){var k;(function(v){var e=function(){function e(){this.pending=!1,this.cancelled=!1}return e.prototype.startOperation=function(){this.pending=!0},e.prototype.isRunning=function(){return this.pending},e.prototype.onProgress=function(e){this.progressHandler=e},e.prototype.reportProgress=function(e,t){this.progressHandler&&this.progressHandler(e,t)},e.prototype.cancel=function(){this.cancelled=!0,this.pending=!1},e.prototype.cancelAsync=function(){var t=this;return this.cancelled||!this.pending?(this.cancelled=!0,this.pending=!1,Promise.resolve()):(this.cancelled=!0,this.deferred=new Promise(function(e){t.resolve=e}),this.deferred)},e.prototype.isCancelled=function(){return this.cancelled},e.prototype.throwIfCancelled=function(){if(this.isCancelled())throw new Error},e.prototype.resolveCancel=function(){this.pending=!1,this.deferred&&(this.resolve(),this.deferred=void 0,this.resolve=void 0)},e}();function r(e,t){for(var n=0;n<t.length;++n)e.push(t[n])}function t(e){for(var t=[],n=0;n<e.length;++n)r(t,e[n]);return t}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function u(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=n.length-r);for(var o=0;o<i;++o)e[t+o]=n[r+o]}function o(e,t){return e==t?0:e<t?-1:1}function n(n,r){var i={};return function(e){var t=n(e);return i.hasOwnProperty(t)?i[t]:i[t]=r(e)}}v.CancellationToken=e,v.codalHash16=function(e){var i=[251,175,119,215,81,14,79,191,103,49,181,143,186,157,0,232,31,32,55,60,152,58,17,237,174,70,160,144,220,90,57,223,59,3,18,140,111,166,203,196,134,243,124,95,222,179,197,65,180,48,36,15,107,46,233,130,165,30,123,161,209,23,97,16,40,91,219,61,100,10,210,109,250,127,22,138,29,108,244,67,207,9,178,204,74,98,126,249,167,116,34,77,193,200,121,5,20,113,71,35,128,13,182,94,25,226,227,199,75,27,41,245,230,224,43,225,177,26,155,150,212,142,218,115,241,73,88,105,39,114,62,255,192,201,145,214,168,158,221,148,154,122,12,84,82,163,44,139,228,236,205,242,217,11,187,146,159,64,86,239,195,42,106,198,118,112,184,172,87,2,173,117,176,229,247,253,137,185,99,164,102,147,45,66,231,52,141,211,194,206,246,238,56,110,78,248,63,240,189,93,92,51,53,183,19,171,72,50,33,104,101,69,8,252,83,120,76,135,85,54,202,125,188,213,96,235,136,208,162,129,190,132,156,38,47,1,7,254,24,4,216,131,89,21,28,133,37,153,149,80,170,68,6,169,234,151];function a(e){for(var t=0,n=0;n<e.length;n++){var r=e[n];t=i[t^r]}return t}return e?function(e,t){for(var n=new Uint8Array(e.length),r=0;r<e.length;++r){var i=e.charCodeAt(r);n[r]=255&i}var o=0;for(r=0;r<t;++r)o|=a(n)<<8*r,n[0]=(n[0]+1)%255;return o}(e,2):0},v.bufferSerial=function(e,t,n,r){void 0===t&&(t=""),void 0===n&&(n="?"),void 0===r&&(r=255);for(var i=0;i<t.length;++i){var o=t[i];if(e[n]=(e[n]||"")+o,"\n"===o||e[n].length>r){var a=e[n];e[n]="",window.postMessage({type:"serial",id:n,data:a},"*")}}},v.blobReadAsDataURL=function(r){return r?new Promise(function(e,t){var n=new FileReader;n.onload=function(){return e(n.result)},n.onerror=function(e){return t(e)},n.readAsDataURL(r)}):Promise.resolve(void 0)},v.fileReadAsBufferAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(new Uint8Array(n.result))},n.readAsArrayBuffer(r)}):Promise.resolve(null)},v.fileReadAsTextAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(n.result)},n.readAsText(r)}):Promise.resolve(null)},v.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},v.listsEqual=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},v.oops=function(e){throw void 0===e&&(e="OOPS"),new Error(e)},v.reversed=function(e){return(e=e.slice(0)).reverse(),e},v.iterMap=function(t,n){Object.keys(t).forEach(function(e){return n(e,t[e])})},v.mapMap=function(t,n){var r={};return Object.keys(t).forEach(function(e){return r[e]=n(e,t[e])}),r},v.values=function(t){return Object.keys(t||{}).map(function(e){return t[e]})},v.pushRange=r,v.concatArrayLike=function(e){return t(e)},v.concat=t,v.memcpy=u,v.uint8ArrayConcat=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=(c=r[n]).length;for(var i=new Uint8Array(t),o=0,a=0,s=e;a<s.length;a++){var c;u(i,o,c=s[a]),o+=c.length}return i},v.jsonTryParse=function(e){try{return JSON.parse(e)}catch(e){return}},v.jsonMergeFrom=function t(n,r){r&&Object.keys(r).forEach(function(e){i(n[e])&&i(r[e])?t(n[e],r[e]):n[e]=v.clone(r[e])})},v.jsonCopyFrom=function(e,t){for(var n=v.clone(t),r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];e[o]=n[o]}},v.jsonFlatten=function(e){var o={},a=function(e,t){if(null!==t&&"object"==typeof t){v.assert(!Array.isArray(t)),e&&(e+=".");for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];a(e+i,t[i])}}else o[e]=t};return a("",e),o},v.jsonUnFlatten=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++)for(var i=r[n],o=t,a=i.split("."),s=0;s<a.length;++s){var c=a[s];s==a.length-1?o[c]=e[i]:("object"!=typeof o[c]&&(o[c]={}),o=o[c])}return t},v.strcmp=o,v.stringMapEq=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!t.hasOwnProperty(a))return!1;if(e[a]!==t[a])return!1}return!0},v.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},v.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},v.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||-1<e.indexOf(t))},v.replaceAll=function(e,t,n){return t?e.split(t).join(n):e},v.sortObjectFields=function(t){var e=Object.keys(t);e.sort(o);var n={};return e.forEach(function(e){return n[e]=t[e]}),n},v.chopArray=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},v.unique=function(e,n){var r=[],i={};return e.forEach(function(e){var t=n(e);i.hasOwnProperty(t)||(i[t]=null,r.push(e))}),r},v.groupBy=function(e,n){var r={};return e.forEach(function(e){var t=n(e);r.hasOwnProperty(t)||(r[t]=[]),r[t].push(e)}),r},v.toDictionary=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=e}),n},v.toSet=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=!0}),n},v.toArray=function(e){if(Array.isArray(e))return e;var t=[];if(!e)return t;for(var n=0;n<e.length;++n)t.push(e[n]);return t},v.indexOfMatching=function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},v.nextTick=function(e){Promise._async._schedule(e)},v.memoizeString=function(e){return n(function(e){return e},e)},v.memoize=n,v.debounce=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;return clearTimeout(a),a=setTimeout(function(){a=null,o||r.apply(e,t)},i),n&&r.apply(e,t),a}};var a=function(){function e(e,t,n,r){var i=this;void 0===t&&(t=300),void 0===n&&(n=2e3),void 0===r&&(r=2),this.func=e,this.minDelay=t,this.maxDelay=n,this.slowdownFactor=r,this.lastPoke=0,this.recentGaps=[],this.wrapped=function(){i.timeout=null,i.func()}}return e.prototype.poke=function(){var e=Date.now();if(this.lastPoke){var t=e-this.lastPoke;if(t<10)return;for(t<4e3&&this.recentGaps.push(t);10<this.recentGaps.length;)this.recentGaps.shift()}this.lastPoke=e},e.prototype.trigger=function(){var e=this.maxDelay;if(this.lastPoke){var t=this.recentGaps.slice();t.sort();var n=t[t.length>>1]||1;e=Math.min(Math.max(n*this.slowdownFactor|0,this.minDelay),this.maxDelay),(e-=Date.now()-this.lastPoke)<0&&(e=0),this.lastPoke=null}clearTimeout(this.timeout),this.timeout=setTimeout(this.wrapped,e)},e}();function s(e){return e&&(e=e.replace(/\\/g,"/")),e}function c(i){return v.httpRequestCoreAsync(i).then(function(e){var t=e.statusCode;if((i.successCodes||[304,200,201,202]).indexOf(t)<0&&!i.allowHttpErrors){var n=v.lf("Bad HTTP status code: {0} at {1}; message: {2}",e.statusCode,i.url,(e.text||"").slice(0,500)),r=new Error(n);return r.statusCode=e.statusCode,Promise.reject(r)}return e.text&&/application\/json/.test(e.headers["content-type"])&&(e.json=k.U.jsonTryParse(e.text)),e})}function l(e,t){var n="";if(!e)return n;for(var r=0;r<e.length;++r){var i=e.charCodeAt(r);if(i<=127)n+=e.charAt(r);else if(i<=2047)n+=String.fromCharCode(192|i>>6,128|63&i);else{if(!t&&55296<=i&&i<=56319){var o=e.charCodeAt(++r);isNaN(o)||(i=65536+(i-55296<<10)+(o-56320))}n+=i<=65535?String.fromCharCode(224|i>>12,128|i>>6&63,128|63&i):String.fromCharCode(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}}return n}v.AdaptiveDebouncer=a,v.throttle=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;a||(a=setTimeout(function(){a=null,o||r.apply(e,t)},i)),n&&r.apply(e,t)}},v.randomPermute=function(e){for(var t=0;t<e.length;++t){var n=g()%e.length,r=e[t];e[t]=e[n],e[n]=r}},v.randomPick=function(e){return 0==e.length?null:e[g()%e.length]},v.timeSince=function(e){var t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?v.lf("in a few seconds"):t<120?v.lf("in a minute"):t<3600?v.lf("in {0} minute{0:s}",Math.floor(t/60)):t<7200?v.lf("in an hour"):t<86400?v.lf("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?v.lf("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?v.lf("in {0} month{0:s}",Math.floor(t/60/60/24/30)):v.lf("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?v.lf("now"):t<10?v.lf("a few seconds ago"):t<60?v.lf("{0} second{0:s} ago",Math.floor(t)):t<120?v.lf("a minute ago"):t<3600?v.lf("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?v.lf("an hour ago"):t<86400?v.lf("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?v.lf("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?v.lf("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):v.lf("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},v.unicodeToChar=function(e){return e.replace(/\\u([\d\w]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})},v.escapeForRegex=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},v.stripUrlProtocol=function(e){return e.replace(/.*?:\/\//g,"")},v.normalizePath=s,v.pathJoin=function(e,t){if(s(e),s(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),"/"==t.charAt(0)&&(t=t.substring(1)),e+t):e:t},v.isNodeJS="undefined"==typeof window,v.requestAsync=c,v.httpGetTextAsync=function(e){return c({url:e}).then(function(e){return e.text})},v.httpGetJsonAsync=function(e){return c({url:e}).then(function(e){return e.json})},v.httpPostJsonAsync=function(e,t){return c({url:e,data:t||{}}).then(function(e){return e.json})},v.stringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n},v.uint8ArrayToString=function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n},v.fromUTF8=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e.charCodeAt(n);t+=37==r||127<r?"%"+r.toString(16):e.charAt(n)}return decodeURIComponent(t)},v.toUTF8=l,v.toHex=function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t},v.fromHex=function(e){for(var t=new Uint8Array(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t};var p=function(){function e(){this.promises={}}return e.prototype.enqueue=function(r,i){var o=this;return new Promise(function(e,t){var n=o.promises[r];n||(n=o.promises[r]=[]),n.push(function(){return i().finally(function(){n.shift(),0==n.length?delete o.promises[r]:n[0]()}).then(e,t)}),1==n.length&&n[0]()})},e}();v.PromiseQueue=p;var f,d,h=function(){function e(){this.waiting=[],this.available=[]}return e.prototype.drain=function(){for(var e=0,t=this.waiting;e<t.length;e++)(0,t[e])(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]},e.prototype.pushError=function(e){this.push(e)},e.prototype.push=function(e){var t=this.waiting.shift();t?t(e):this.available.push(e)},e.prototype.shiftAsync=function(e){var i=this;if(void 0===e&&(e=0),0<this.available.length){var t=this.available.shift();return t instanceof Error?Promise.reject(t):Promise.resolve(t)}return new Promise(function(t,n){var r=function(e){e instanceof Error?n(e):t(e)};i.waiting.push(r),0<e&&Promise.delay(e).then(function(){var e=i.waiting.indexOf(r);0<=e&&(i.waiting.splice(e,1),n(new Error("Timeout")))})})},e}();function m(){return Date.now()}function g(){var e=new Uint8Array(4);return v.getRandomBuf(e),new Uint32Array(e.buffer)[0]}function b(i,o,a,s){function t(n){pxt.debug("downloading translations for "+i+" "+o+" "+(a||""));var e=pxt.BrowserUtils.isLocalHost()||pxt.webConfig.isStatic?"https://makecode.com/api/":"",t=e+"translations?lang="+encodeURIComponent(i)+"&filename="+encodeURIComponent(o)+"&approved=true";a&&(t+="&branch="+encodeURIComponent(a));var r={};return s&&!pxt.Cloud.useCdnApi()&&(r["If-None-Match"]=s),(e?c:pxt.Cloud.apiRequestWithCdnAsync)({url:t,headers:r}).then(function(t){return 304==t.statusCode||200==t.statusCode?(s=t.headers.etag||"",pxt.BrowserUtils.translationDbAsync().then(function(e){return e.setAsync(i,o,a,s,t.json||n)}).then(function(){return t.json||n})):t.json},function(e){console.log("failed to load translations from "+t)})}return pxt.BrowserUtils.translationDbAsync().then(function(e){return e.getAsync(i,o,a)}).then(function(e){return e?(s=e.etag,300<(Date.now()-e.time)/1e3&&t(e.strings).done(),e.strings):t()})}function y(e){var t=v.normalizeLanguageCode(e),n=t[0],r=t[1],i=pxt.appTarget.appTheme;if(i&&i.availableLocales){if(-1<i.availableLocales.indexOf(n))return!0;if(r&&-1<i.availableLocales.indexOf(r))return!0}return!1}function w(e,t,n,r,i,o,a){if(a=a||f.Editor,"en-US"===(n=v.normalizeLanguageCode(n)[0])||"en"===n)return Promise.resolve(void 0);var s,c,u=n+"/"+o+"/"+a;if(v.translationsCache()[u])return Promise.resolve(v.translationsCache()[u]);switch(a){case f.Editor:s=[{branch:r,staticName:"strings.json",path:"strings.json"},{branch:i,staticName:"target-strings.json",path:e+"/target-strings.json"}];break;case f.Sim:s=[{branch:i,staticName:"sim-strings.json",path:e+"/sim-strings.json"}];break;case f.Apis:s=[{branch:i,staticName:"bundled-strings.json",path:e+"/bundled-strings.json"}]}function l(t){t&&(c||(c={}),Object.keys(t).filter(function(e){return!!t[e]}).forEach(function(e){return c[e]=t[e]}))}if(o){var p=0;return Promise.mapSeries(s,function(e){return b(n,e.path,e.branch).then(l,function(e){console.log(e.message),++p})}).then(function(){return p&&(v.translationsCache()[u]=c),p!==s.length&&c?Promise.resolve(c):(pxt.tickEvent("translations.livetranslationsfailed"),w(e,t,n,r,i,!1,a))})}return Promise.all(s.map(function(e){return v.httpGetJsonAsync(t+"locales/"+n+"/"+e.staticName).catch(function(e){})})).then(function(e){var t={};e.forEach(function(e){return pxt.Util.jsonMergeFrom(t,e)}),Object.keys(t).length&&(c=t,v.translationsCache()[u]=c)},function(e){console.error("failed to load localizations")}).then(function(){return c})}v.PromiseBuffer=h,v.now=m,v.nowSeconds=function(){return Math.round(m()/1e3)},v.cpuUs=function(){var e="undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now;return v.cpuUs=function(){return 1e3*e()},v.cpuUs()},v.getMime=function(e){var t=/\.([a-zA-Z0-9]+)$/.exec(e);if(!t)return"application/octet-stream";switch(t[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";default:return"application/octet-stream"}},v.randomUint32=g,v.guidGen=function(){function e(){return(65536|g()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()},v.downloadLiveTranslationsAsync=b,v.pxtLangCookieId="PXT_LANG",v.langCookieExpirationDays=30,v.allLanguages={af:{englishName:"Afrikaans",localizedName:"Afrikaans"},ar:{englishName:"Arabic",localizedName:"العربية"},az:{englishName:"Azerbaijani",localizedName:"آذربایجان دیلی"},bg:{englishName:"Bulgarian",localizedName:"български"},bn:{englishName:"Bengali",localizedName:"বাংলা"},ca:{englishName:"Catalan",localizedName:"Català"},cs:{englishName:"Czech",localizedName:"Čeština"},da:{englishName:"Danish",localizedName:"Dansk"},de:{englishName:"German",localizedName:"Deutsch"},el:{englishName:"Greek",localizedName:"Ελληνικά"},en:{englishName:"English",localizedName:"English"},"es-ES":{englishName:"Spanish (Spain)",localizedName:"Español (España)"},"es-MX":{englishName:"Spanish (Mexico)",localizedName:"Español (México)"},et:{englishName:"Estonian",localizedName:"Eesti"},eu:{englishName:"Basque",localizedName:"Euskara"},fa:{englishName:"Persian",localizedName:"فارسی"},fi:{englishName:"Finnish",localizedName:"Suomi"},fr:{englishName:"French",localizedName:"Français"},"fr-CA":{englishName:"French (Canada)",localizedName:"Français (Canada)"},"gu-IN":{englishName:"Gujarati",localizedName:"ગુજરાતી"},he:{englishName:"Hebrew",localizedName:"עברית"},hr:{englishName:"Croatian",localizedName:"Hrvatski"},hu:{englishName:"Hungarian",localizedName:"Magyar"},"hy-AM":{englishName:"Armenian (Armenia)",localizedName:"Հայերէն (Հայաստան)"},id:{englishName:"Indonesian",localizedName:"Bahasa Indonesia"},is:{englishName:"Icelandic",localizedName:"Íslenska"},it:{englishName:"Italian",localizedName:"Italiano"},ja:{englishName:"Japanese",localizedName:"日本語"},kab:{englishName:"Kabyle",localizedName:"شئعم"},ko:{englishName:"Korean",localizedName:"한국어"},kmr:{englishName:"Kurmanji (Kurdish)",localizedName:"کورمانجی‎"},kn:{englishName:"Kannada",localizedName:"ಕನ್ನಡ"},lt:{englishName:"Lithuanian",localizedName:"Lietuvių"},lv:{englishName:"Latvian",localizedName:"Latviešu"},"ml-IN":{englishName:"Malayalam",localizedName:"മലയാളം"},mr:{englishName:"Marathi",localizedName:"मराठी"},nl:{englishName:"Dutch",localizedName:"Nederlands"},no:{englishName:"Norwegian",localizedName:"Norsk"},nb:{englishName:"Norwegian Bokmal",localizedName:"Norsk bokmål"},"nn-NO":{englishName:"Norwegian Nynorsk",localizedName:"Norsk nynorsk"},"pa-IN":{englishName:"Punjabi",localizedName:"ਪੰਜਾਬੀ"},pl:{englishName:"Polish",localizedName:"Polski"},"pt-BR":{englishName:"Portuguese (Brazil)",localizedName:"Português (Brasil)"},"pt-PT":{englishName:"Portuguese (Portugal)",localizedName:"Português (Portugal)"},ro:{englishName:"Romanian",localizedName:"Română"},ru:{englishName:"Russian",localizedName:"Русский"},"si-LK":{englishName:"Sinhala (Sri Lanka)",localizedName:"සිංහල (ශ්රී ලංකා)"},sk:{englishName:"Slovak",localizedName:"Slovenčina"},sl:{englishName:"Slovenian",localizedName:"Slovenski"},sr:{englishName:"Serbian",localizedName:"Srpski"},su:{englishName:"Sundanese",localizedName:"ᮘᮞ ᮞᮥᮔ᮪ᮓ"},"sv-SE":{englishName:"Swedish (Sweden)",localizedName:"Svenska (Sverige)"},ta:{englishName:"Tamil",localizedName:"தமிழ்"},te:{englishName:"Telugu",localizedName:"తెలుగు"},th:{englishName:"Thai",localizedName:"ภาษาไทย"},tl:{englishName:"Tagalog",localizedName:"ᜏᜒᜃᜅ᜔ ᜆᜄᜎᜓᜄ᜔"},tr:{englishName:"Turkish",localizedName:"Türkçe"},uk:{englishName:"Ukrainian",localizedName:"Українська"},"ur-IN":{englishName:"Urdu (India)",localizedName:"اردو (ہندوستان)"},"ur-PK":{englishName:"Urdu (Pakistan)",localizedName:"اردو (پاکستان)"},vi:{englishName:"Vietnamese",localizedName:"Tiếng việt"},"zh-CN":{englishName:"Chinese (Simplified)",localizedName:"简体中文"},"zh-TW":{englishName:"Chinese (Traditional)",localizedName:"繁体中文"}},v.isLocaleEnabled=y,v.updateLocalizationAsync=function(t,n,r,i,o,a,e){return"en-US"===(r=v.normalizeLanguageCode(r)[0])&&(r="en"),r===v.userLanguage()||!y(r)&&!e?(pxt.debug("loc: "+r+" (using built-in)"),Promise.resolve()):(pxt.debug("loc: "+r),w(t,n,r,i,o,a,x.pxtc.Util.TranslationsKind.Editor).then(function(e){return e&&(v.setUserLanguage(r),v.setLocalizedStrings(e),a&&(v.localizeLive=!0)),a?Promise.resolve():x.pxtc.Util.downloadTranslationsAsync(t,n,r,i,o,a,x.pxtc.Util.TranslationsKind.Apis).then(function(e){e&&(x.pxtc.apiLocalizationStrings=e)})}))},(d=f=v.TranslationsKind||(v.TranslationsKind={}))[d.Editor=0]="Editor",d[d.Sim=1]="Sim",d[d.Apis=2]="Apis",v.downloadTranslationsAsync=w,v.capitalize=function(e){return e?e[0].toLocaleUpperCase()+e.slice(1):e},v.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},v.range=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},v.multipartPostAsync=function(e,r,t,n){void 0===r&&(r={}),void 0===t&&(t=null),void 0===n&&(n=null);var i,o,a,s="--------------------------0461489f461126c5",c="";Object.keys(r).forEach(function(e){return n=r[t=e],c+=s+"\r\n",c+='Content-Disposition: form-data; name="'+t+'"\r\n\r\n',void(c+=n+"\r\n");var t,n}),t&&(o=n,a=(i=t).split("/").reverse()[0],c+=s+"\r\n",c+='Content-Disposition: form-data; name="files['+i+']"; filename="'+a+'"\r\n',c+="\r\n",c+=o+"\r\n"),c+=s+"--\r\n";var u={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+s.slice(2)},data:c};return v.httpRequestCoreAsync(u)},v.toDataUri=function(e,t){return/^https?:/i.test(e)?e:/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?"data:"+t+","+encodeURIComponent(e):"data:"+(t||"image/png")+";base64,"+k.encodeBase64(l(e)))},v.imageMagic=1496611453,v.imageHeaderSize=36,v.encodeBlobAsync=function(e,t){for(var n=v.imageHeaderSize+t.length,r=3*(e.width*e.height-1),i=1;i<4&&!(8*n<=r*i);)i++;var o=r*i>>3,a=n-o,s=0,c=e.width*e.height*4;if(0<a){var u=3*e.width;s=Math.ceil(a/u);var l=document.createElement("canvas");l.width=e.width,l.height=e.height+s,l.getContext("2d").drawImage(e,0,0),e=l}var p=pxt.HF2.encodeU32LE([v.imageMagic,t.length,s,0,0,0,0,0,0]);function f(e,t,n,r){for(var i=0,o=0,a=r[o++],s=(1<<n)-1,c=!0;c;){var u=a>>i&s,l=8-i;if(l<=n){if(o>=r.length){if(0==l)break;c=!1}u|=(a=r[o++])<<l&s,i=n-l}else i+=n;e[t]=255&(e[t]&~s|u),3==(3&++t)&&(e[t++]=255)}return t}pxt.Util.assert(p.length==v.imageHeaderSize);var d=e.getContext("2d"),h=d.getImageData(0,0,e.width,e.height);f(h.data,0,1,[i]);var m=4;if(m=f(h.data,m,i,p),pxt.Util.assert(0==(3&m)),0==s)m=f(h.data,m,i,t);else{var g=o-p.length;m=f(h.data,m,i,t.slice(0,g)),m=f(h.data,c,8,t.slice(g))}for(m|=3;m<h.data.length;)h.data[m]=255,m+=4;return d.putImageData(h,0,0),e},v.decodeBlobAsync=function(e){return pxt.BrowserUtils.loadCanvasAsync(e).then(function(e){var s=e.getContext("2d").getImageData(0,0,e.width,e.height).data,t=1&s[0]|(1&s[1])<<1|(1&s[2])<<2;if(5<t)return Promise.reject(new Error(v.lf("Invalid encoded PNG format")));function n(e,t,n){for(var r=0,i=0,o=0,a=(1<<t)-1;i<n.length;)o|=(s[e++]&a)<<r,3==(3&e)&&e++,8<=(r+=t)&&(n[i++]=255&o,o>>=8,r-=8);return e}var r=new Uint8Array(pxt.Util.imageHeaderSize),i=n(4,t,r),o=pxt.HF2.decodeU32LE(r);if(o[0]!=pxt.Util.imageMagic)return Promise.reject(new Error(v.lf("Invalid magic in encoded PNG")));var a=new Uint8Array(o[1]),c=o[2];if(0<c){var u=(e.height-c)*e.width,l=new Uint8Array((3*(u-1)*t>>3)-pxt.Util.imageHeaderSize);n(i,t,l),a.set(l);var p=new Uint8Array(a.length-l.length);n(4*u,8,p),a.set(p,l.length)}else n(i,t,a);return a})}})((k=x.pxtc||(x.pxtc={})).Util||(k.Util={}))}(ts||(ts={})),function(e){var v;(function(e){v.Util.httpRequestCoreAsync=function(c){return new Promise(function(t,e){var r,i=!1,n=v.Util.clone(c.headers)||{};r=new XMLHttpRequest,c.responseArrayBuffer&&(r.responseType="arraybuffer"),r.onreadystatechange=function(){if(!i&&4==r.readyState){i=!0;var n={statusCode:r.status,headers:{},buffer:r.responseBody||r.response,text:c.responseArrayBuffer?void 0:r.responseText},e=r.getAllResponseHeaders();e.split(/\r?\n/).forEach(function(e){var t=/^\s*([^:]+): (.*)/.exec(e);t&&(n.headers[t[1].toLowerCase()]=t[2])}),t(n)}};var o,a=c.data,s=c.method||(null==a?"GET":"POST");null==a?o=null:a instanceof Uint8Array?o=a:"object"==typeof a?(o=JSON.stringify(a),n["content-type"]="application/json; charset=utf8"):"string"==typeof a?o=a:v.Util.oops("bad data"),r.open(s,c.url),Object.keys(n).forEach(function(e){r.setRequestHeader(e,n[e])}),null==o?r.send():r.send(o)})},v.Util.sha256=n,v.Util.getRandomBuf=function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())};var m=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function g(e,t){return e>>>t|e<<32-t}function f(e,t){v.Util.assert(8==e.length),v.Util.assert(64==t.length);for(var n=16;n<64;++n){var r=g(t[n-15],7)^g(t[n-15],18)^t[n-15]>>>3,i=g(t[n-2],17)^g(t[n-2],19)^t[n-2]>>>10;t[n]=t[n-16]+r+t[n-7]+i|0}var o=e[0],a=e[1],s=e[2],c=e[3],u=e[4],l=e[5],p=e[6],f=e[7];for(n=0;n<64;++n){var d=f+(i=g(u,6)^g(u,11)^g(u,25))+(u&l^~u&p)+m[n]+t[n]|0,h=o&a^o&s^a&s;f=p,p=l,l=u,u=c+d|0,c=s,s=a,o=d+((r=g(a=o,2)^g(o,13)^g(o,22))+h|0)|0}e[0]+=o,e[1]+=a,e[2]+=s,e[3]+=c,e[4]+=u,e[5]+=l,e[6]+=p,e[7]+=f}function t(e){var o=new Uint32Array(8);o[0]=1779033703,o[1]=3144134277,o[2]=1013904242,o[3]=2773480762,o[4]=1359893119,o[5]=2600822924,o[6]=528734635,o[7]=1541459225;var a=new Uint32Array(64),s=64;function t(e){for(var t=e.length-(s-1),n=0;n<t;n+=s){for(var r=0;r<16;r++){var i=(r<<2)+n;a[r]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]}f(o,a)}}t(e);var n=64-(e.length+9)%64;64==n&&(n=0);for(var r=e.length-e.length%s,i=new Uint8Array(e.length-r+1+n+8),c=0;r<e.length;)i[c++]=e[r++];for(i[c++]=128;0<n--;)i[c++]=0;var u=8*e.length;for(c=i.length;0<u;)i[--c]=255&u,u>>=8;t(i);for(var l="",p=0;p<o.length;++p)l+=("000000000"+o[p].toString(16)).slice(-8);return l.toLowerCase()}function n(e){return t(v.Util.stringToUint8Array(v.Util.toUTF8(e)))}e.sha256buffer=t,e.sha256string=n})((v=e.pxtc||(e.pxtc={})).BrowserImpl||(v.BrowserImpl={}))}(ts||(ts={})),function(e){e.perf||(e.perf={})}(pxt||(pxt={})),pxt.perf.report||(pxt.perf.report=function(){}),pxt.perf.recordMilestone||(pxt.perf.recordMilestone=function(){}),pxt.perf.measureStart||(pxt.perf.measureStart=function(){}),pxt.perf.measureEnd||(pxt.perf.measureEnd=function(){}),function(s){var r;s.U=pxtc.Util,s.Util=pxtc.Util;var f,o,c={};function i(e,t){/^csv-/.test(e)?s.setAppTargetVariant(e.replace(/^csv-*/,"")):s.appTarget&&(c[e]=t,s.U.jsonCopyFrom(s.appTarget.compile.switches,c),s.U.jsonCopyFrom(r.compile.switches,c))}function a(){var e=s.appTarget.compile;e||(e=s.appTarget.compile={isNative:!1,hasHex:!1,switches:{}}),e.hasHex&&(e.nativeType||(e.nativeType=pxtc.NATIVE_TYPE_THUMB)),e.switches||(e.switches={}),s.U.jsonCopyFrom(e.switches,c),e.jsRefCounting=!1,e.useUF2||e.useELF||null!=e.noSourceInFlash||(e.noSourceInFlash=!0),void 0===e.utf8&&(e.utf8=!0),s.appTarget.appTheme||(s.appTarget.appTheme={}),s.appTarget.appTheme.embedUrl||(s.appTarget.appTheme.embedUrl=s.appTarget.appTheme.homeUrl);var t=s.appTarget.compileService;t&&t.yottaTarget&&!t.yottaBinary&&(t.yottaBinary="pxt-microbit-app-combined.hex");var n=s.appTarget.appTheme;n&&Object.keys(n).filter(function(e){return/(logo|hero)$/i.test(e)&&/^@cdnUrl@/.test(n[e])}).forEach(function(e){return n[e]=s.BrowserUtils.patchCdn(n[e])});var r=s.appTarget.simulator;if(r&&r.boardDefinition&&r.boardDefinition.visual){var i=r.boardDefinition.visual;i.image&&(i.image=s.BrowserUtils.patchCdn(i.image),i.outlineImage&&(i.outlineImage=s.BrowserUtils.patchCdn(i.outlineImage)))}if(Object.keys(s.appTarget.bundledpkgs).forEach(function(e){var t=s.appTarget.bundledpkgs[e],n=JSON.parse(t[s.CONFIG_NAME]);n.icon&&(n.icon=s.BrowserUtils.patchCdn(n.icon)),t[s.CONFIG_NAME]=s.Package.stringifyConfig(n)}),"undefined"!=typeof window){var o={"lockededitor=1":{appTheme:{lockedEditor:!0}},"hidemenu=1":{appTheme:{hideMenuBar:!0}}};s.appTarget.queryVariants&&s.Util.jsonCopyFrom(o,s.appTarget.queryVariants);var a=window.location.href;Object.keys(o).forEach(function(e){if(new RegExp(e,"i").exec(a)){var t=o[e];t&&s.U.jsonMergeFrom(s.appTarget,t)}})}}function n(e){void 0===e&&(e=!1),s.perf.measureStart("reloadAppTargetVariant");var t=e?"":JSON.stringify(s.appTarget);if(s.appTarget=s.U.clone(r),s.appTargetVariant){var n=s.appTarget.variants&&s.appTarget.variants[s.appTargetVariant];n?s.U.jsonMergeFrom(s.appTarget,n):s.U.userError(lf("Variant '{0}' not defined in pxtarget.json",s.appTargetVariant))}a(),!e&&s.onAppTargetChanged&&t!=JSON.stringify(s.appTarget)&&s.onAppTargetChanged(),s.perf.measureEnd("reloadAppTargetVariant")}s.setAppTarget=function(e){s.appTarget=e||{},a(),r=s.U.clone(s.appTarget)},s.setBundledApiInfo=function(e){for(var t=0,n=Object.keys(e);t<n.length;t++)for(var r=e[n[t]].apis.byQName,i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=r[a],c=a.lastIndexOf("."),u=s.pyQName,l=r[a]={kind:Math.abs(s.kind||7),qName:a,namespace:a.slice(0,c<0?0:c),name:a.slice(c+1),pyQName:u,pyName:u?u.slice(u.lastIndexOf(".")+1):void 0,fileName:"",attributes:s.attributes||{},retType:s.retType||"void",parameters:s.parameters?s.parameters.map(function(e){return{name:e.name,description:e.description||"",type:e.type||"number",initializer:e.initializer,default:e.default,options:e.options||{},isEnum:!!e.isEnum,handlerParameters:e.handlerParameters}}):null,extendsTypes:s.extendsTypes,snippet:s.kind&&s.kind<0?null:void 0,isInstance:!!s.isInstance,isReadOnly:!!s.isReadOnly},p=l.attributes;p.paramDefl||(p.paramDefl={}),p.callingConvention||(p.callingConvention=0),p.paramHelp||(p.paramHelp={}),p.jsDoc||(p.jsDoc=""),p._name=l.name.replace(/@.*/,"")}f=e},s.getBundledApiInfo=function(){return f},s.savedAppTheme=function(){return r?r.appTheme:void 0},s.setCompileSwitch=i,s.setCompileSwitches=function(e){if(e)for(var t=0,n=e.split(/[\s,;:]+/);t<n.length;t++){var r=n[t];r&&("-"==r[0]?i(r.slice(1),!1):i(r,!0))}},s.bundledSvg=function(e){if(e){var t=o&&o[e];if(t)return t;if(s.appTarget.simulator&&s.appTarget.simulator.dynamicBoardDefinition){o||(o={});var n=s.appTarget.bundledpkgs[e];if(n){if(JSON.parse(n["pxt.json"]).core&&n["board.json"]){var r=JSON.parse(n["board.json"]);if(r&&r.visual&&r.visual.image){var i=r.visual.image;/^pkg:\/\//.test(i)&&(i=n[i.slice(6)]),o[e]="data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(s.Util.toUTF8(i))}}return o[e]}}}},s.reloadAppTargetVariant=n,s.setAppTargetVariant=function(e,t){void 0===t&&(t={}),s.debug("app variant: "+e),(t.force||s.appTargetVariant!==e&&(s.appTargetVariant||e))&&(s.appTargetVariant=e,n(t.temporary))},s.setHwVariant=function(e,t){e=e.replace(/.*---/,""),/^[\w\-]+$/.test(e)?(s.hwVariant=e,s.hwName=t||e):(s.hwVariant=null,s.hwName=null)},s.hasHwVariants=function(){return!!s.appTarget.variants&&Object.keys(s.appTarget.bundledpkgs).some(function(e){return/^hw---/.test(e)})},s.getHwVariants=function(){return s.appTarget.variants?Object.keys(s.appTarget.bundledpkgs).filter(function(e){return/^hw---/.test(e)}).map(function(e){return JSON.parse(s.appTarget.bundledpkgs[e][s.CONFIG_NAME])}).filter(function(e){return!!s.appTarget.appTheme.experimentalHw||!e.experimentalHw}):[]},s.options={},s.debug="undefined"!=typeof console&&console.debug?function(e){s.options.debug&&console.debug(e)}:function(){},s.log="undefined"!=typeof console&&console.log?function(e){console.log(e)}:function(){},s.reportException=function(e,t){if(console&&(console.error(e),t))try{console.log(t)}catch(e){}},s.reportError=function(e,t,n){if(console&&(console.error(e+": "+t),n))try{s.log(JSON.stringify(n,null,2))}catch(e){}};var u={},l=s.Util.debounce(function(){s.tickEvent("activity",u),u={}},1e4,!1);function t(){return{relprefix:"/--",workerjs:"/worker.js",monacoworkerjs:"/monacoworker.js",gifworkerjs:"/gifjs/gif.worker.js",serviceworkerjs:"/serviceworker.js",pxtVersion:"local",pxtRelId:"",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:s.appTarget?s.appTarget.id:"",simUrl:"/sim/simulator.html",simserviceworkerUrl:"/simulatorserviceworker.js",simworkerconfigUrl:"/sim/workerConfig.js",partsUrl:"/sim/siminstructions.html"}}s.tickActivity=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.filter(function(e){return!!e}).map(function(e){return e.slice(0,64)}).forEach(function(e){return u[e]=(u[e]||0)+1}),l()},s.localWebConfig=t,s.getOnlineCdnUrl=function(){if(!s.webConfig)return null;var e=/^(https:\/\/[^\/]+)/.exec(s.webConfig.commitCdnUrl);return e?e[1]:null},s.setupWebConfig=function(e){e?s.webConfig=e:s.webConfig||(s.webConfig=t())},s.getEmbeddedScript=function(e){return s.U.lookup(s.appTarget.bundledpkgs||{},e)};var e=void 0;function p(){return e||(e=s.Cloud.downloadTargetConfigAsync().then(function(e){return e||{}},function(e){return{}})),e}function d(e){return void 0===e&&(e=null),e||(e=s.appTarget.compile),e.nativeType==ts.pxtc.NATIVE_TYPE_VM?ts.pxtc.BINARY_PXT64:e.useUF2&&!e.switches.rawELF?ts.pxtc.BINARY_UF2:e.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}s.targetConfigAsync=p,s.packagesConfigAsync=function(){return p().then(function(e){return e?e.packages:void 0})},s.CONFIG_NAME="pxt.json",s.SIMSTATE_JSON=".simstate.json",s.SERIAL_EDITOR_FILE="serial.txt",s.README_FILE="README.md",s.GITIGNORE_FILE=".gitignore",s.CLOUD_ID="pxt/",s.BLOCKS_PROJECT_NAME="blocksprj",s.JAVASCRIPT_PROJECT_NAME="tsprj",s.PYTHON_PROJECT_NAME="pyprj",s.DEFAULT_GROUP_NAME="other",s.TILEMAP_CODE="tilemap.g.ts",s.TILEMAP_JRES="tilemap.g.jres",s.outputName=d,s.isOutputText=function(e){return void 0===e&&(e=null),d(e)==ts.pxtc.BINARY_HEX}}(pxt||(pxt={})),function(i){!function(o){var t,v="this";function n(){if((t={device_while:{name:i.Util.lf("a loop that repeats while the condition is true"),tooltip:i.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:i.Util.lf("while %1"),appendField:i.Util.lf("{id:while}do")}},pxt_controls_for:{name:i.Util.lf("a loop that repeats the number of times you say"),tooltip:i.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:i.Util.lf("for %1 from 0 to %2"),variable:i.Util.lf("{id:var}index"),appendField:i.Util.lf("{id:for}do")}},controls_simple_for:{name:i.Util.lf("a loop that repeats the number of times you say"),tooltip:i.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:i.Util.lf("for %1 from 0 to %2"),variable:i.Util.lf("{id:var}index"),appendField:i.Util.lf("{id:for}do")}},pxt_controls_for_of:{name:i.Util.lf("a loop that repeats for each value in an array"),tooltip:i.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:i.Util.lf("for element %1 of %2"),variable:i.Util.lf("{id:var}value"),appendField:i.Util.lf("{id:for_of}do")}},controls_for_of:{name:i.Util.lf("a loop that repeats for each value in an array"),tooltip:i.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:i.Util.lf("for element %1 of %2"),variable:i.Util.lf("{id:var}value"),appendField:i.Util.lf("{id:for_of}do")}},math_op2:{name:i.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:i.Util.lf("smaller value of 2 numbers"),max:i.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:i.Util.lf("absolute number"),tooltip:i.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:i.Util.lf("absolute of %1")}},math_number:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.appTarget&&i.appTarget.compile?i.Util.lf("a decimal number"):i.Util.lf("an integer number")},math_integer:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.Util.lf("an integer number")},math_whole_number:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:i.Util.lf("a whole number")},math_number_minmax:{name:i.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_arithmetic:{name:i.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:i.Util.lf("Return the sum of the two numbers."),MINUS:i.Util.lf("Return the difference of the two numbers."),MULTIPLY:i.Util.lf("Return the product of the two numbers."),DIVIDE:i.Util.lf("Return the quotient of the two numbers."),POWER:i.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:i.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:i.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:i.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:i.Util.lf("{id:op}÷"),MATH_POWER_SYMBOL:i.Util.lf("{id:op}**")}},math_modulo:{name:i.Util.lf("division remainder"),tooltip:i.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:i.Util.lf("remainder of %1 ÷ %2")}},math_js_op:{name:i.Util.lf("math function"),tooltip:{sqrt:i.Util.lf("Returns the square root of the argument"),sin:i.Util.lf("Returns the sine of the argument"),cos:i.Util.lf("Returns the cosine of the argument"),tan:i.Util.lf("Returns the tangent of the argument"),atan2:i.Util.lf("Returns the arctangent of the quotient of the two arguments"),idiv:i.Util.lf("Returns the integer portion of the division operation on the two arguments"),imul:i.Util.lf("Returns the integer portion of the multiplication operation on the two arguments")},url:"/blocks/math",operators:{OP:["sqrt","sin","cos","tan","atan2","idiv","imul"]},category:"math",block:{sqrt:i.Util.lf("{id:op}square root"),sin:i.Util.lf("{id:op}sin"),cos:i.Util.lf("{id:op}cos"),tan:i.Util.lf("{id:op}tan"),atan2:i.Util.lf("{id:op}atan2"),idiv:i.Util.lf("{id:op}integer ÷"),imul:i.Util.lf("{id:op}integer ×")}},math_js_round:{name:i.Util.lf("rounding functions"),tooltip:{round:i.Util.lf("Increases the argument to the next higher whole number if its fractional part is more than one half"),ceil:i.Util.lf("Increases the argument to the next higher whole number"),floor:i.Util.lf("Decreases the argument to the next lower whole number"),trunc:i.Util.lf("Removes the fractional part of the argument")},url:"/blocks/math",operators:{OP:["round","ceil","floor","trunc"]},category:"math",block:{round:i.Util.lf("{id:op}round"),ceil:i.Util.lf("{id:op}ceiling"),floor:i.Util.lf("{id:op}floor"),trunc:i.Util.lf("{id:op}truncate")}},variables_change:{name:i.Util.lf("update the value of a number variable"),tooltip:i.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:i.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:i.Util.lf("a loop that repeats and increments an index"),tooltip:i.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:i.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:i.Util.lf("{id:repeat}do")}},variables_get:{name:i.Util.lf("get the value of a variable"),tooltip:i.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:i.Util.lf("Create 'set %1'")}},variables_get_reporter:{name:i.Util.lf("get the value of a variable"),tooltip:i.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:i.Util.lf("Create 'set %1'")}},variables_set:{name:i.Util.lf("assign the value of a variable"),tooltip:i.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:i.Util.lf("set %1 to %2")}},controls_if:{name:i.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:i.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:i.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:i.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:i.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:i.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:i.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:i.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:i.Util.lf("{id:logic}else if")}},lists_create_with:{name:i.Util.lf("create an array"),tooltip:i.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:i.Util.lf("empty array"),LISTS_CREATE_WITH_INPUT_WITH:i.Util.lf("array of"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:i.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:i.Util.lf("value")}},lists_length:{name:i.Util.lf("array length"),tooltip:i.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:i.Util.lf("length of array %1")}},lists_index_get:{name:i.Util.lf("get a value in an array"),tooltip:i.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:i.Util.lf("%1 get value at %2")}},lists_index_set:{name:i.Util.lf("set a value in an array"),tooltip:i.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:i.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:i.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:i.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:i.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:i.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:i.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:i.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:i.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:i.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:i.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:i.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:i.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:i.Util.lf("{id:op}or")}},logic_negate:{name:i.Util.lf("logical negation"),tooltip:i.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:i.Util.lf("not %1")}},logic_boolean:{name:i.Util.lf("a `true` or `false` value"),tooltip:i.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:i.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:i.Util.lf("{id:boolean}false")}},text:{name:i.Util.lf("a piece of text"),tooltip:i.Util.lf("A letter, word, or line of text."),url:"types/string",category:"text",block:{search:i.Util.lf("a piece of text")}},text_length:{name:i.Util.lf("number of characters in the string"),tooltip:i.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:i.Util.lf("length of %1")}},text_join:{name:i.Util.lf("join items to create text"),tooltip:i.Util.lf("Create a piece of text by joining together any number of items."),url:"reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:i.Util.lf("join")}},procedures_defnoreturn:{name:i.Util.lf("define the function"),tooltip:i.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:i.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:i.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:i.Util.lf("call the function"),tooltip:i.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:i.Util.lf("call function")}},function_return:{name:i.Util.lf("return a value from within a function"),tooltip:i.Util.lf("Return a value from within a user-defined function."),url:"types/function/return",category:"functions",block:{message_with_value:i.Util.lf("return %1"),message_no_value:i.Util.lf("return")}},function_definition:{name:i.Util.lf("define the function"),tooltip:i.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{FUNCTIONS_EDIT_OPTION:i.Util.lf("Edit Function")}},function_call:{name:i.Util.lf("call the function"),tooltip:i.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{FUNCTIONS_CALL_TITLE:i.Util.lf("call")}},function_call_output:{name:i.Util.lf("call the function with a return value"),tooltip:i.Util.lf("Call the user-defined function with a return value."),url:"types/function/call",category:"functions",block:{}}})[pxtc.ON_START_TYPE]={name:i.Util.lf("on start event"),tooltip:i.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:i.Util.lf("on start %1 %2")}},t[pxtc.PAUSE_UNTIL_TYPE]={name:i.Util.lf("pause until"),tooltip:i.Util.lf("Pause execution of code until the given boolean expression is true"),url:"/blocks/pause-until",category:"loops",block:{message0:i.Util.lf("pause until %1")}},t[pxtc.TS_BREAK_TYPE]={name:i.Util.lf("break"),tooltip:i.Util.lf("Break out of the current loop or switch"),url:"/blocks/loops/break",category:"loops",block:{message0:i.Util.lf("break")}},t[pxtc.TS_CONTINUE_TYPE]={name:i.Util.lf("continue"),tooltip:i.Util.lf("Skip current iteration and continues with the next iteration in the loop"),url:"/blocks/loops/continue",category:"loops",block:{message0:i.Util.lf("continue")}},i.Util.isTranslationMode()){var r=Blockly.Msg;i.Util.values(t).filter(function(e){return e.block}).forEach(function(n){var e=Object.keys(n.block);n.translationIds=i.Util.values(n.block),e.forEach(function(t){return i.crowdin.inContextLoadAsync(n.block[t]).done(function(e){n.block[t]=e,/^[A-Z_]+$/.test(t)&&(r[t]=e)})})})}}o.MATH_FUNCTIONS={unary:["sqrt","sin","cos","tan"],binary:["atan2"],infix:["idiv","imul"]},o.ROUNDING_FUNCTIONS=["round","ceil","floor","trunc"],o.builtinFunctionInfo={"Math.abs":{blockId:"math_op3",params:["x"]},"Math.min":{blockId:"math_op2",params:["x","y"]},"Math.max":{blockId:"math_op2",params:["x","y"]}},o.normalizeBlock=function(e,t){if(void 0===t&&(t=i.log),!e)return e;var n=e.replace(/[^\\]%\s+/g,"%");return n!=e?(t("block has extra spaces: "+e),e):((n=(e=n).replace(/(%\w+)\s*=\s*(\w+)/,"$1=$2"))!=e&&(t("block has space between %name and = : "+e),e=n),n=n.replace(/\s*\|\s*/g,"|"))},o.compileInfo=function(n){var a={parameters:[],actualNameToParam:{},definitionNameToParam:{},handlerArgs:[]},e=(1==n.kind||2==n.kind)&&!n.attributes.defaultInstance,s=!!n.attributes._def,c=s?n.attributes._def.parameters.slice(0):void 0,u=s?c.length:n.parameters?n.parameters.length:0,l=o.builtinFunctionInfo[n.qName];s&&n.attributes._expandedDef&&c.push.apply(c,n.attributes._expandedDef.parameters);var p={},f=c?c.filter(function(e){return!e.ref||(p[e.name]=e,!1)}):[];if(e&&s&&c.length){var t=p[v]||c[0],r=t.name,i=void 0;(!t.shadowBlockId||"variables_get"===t.shadowBlockId)&&(i=t.varName||n.attributes.paramDefl[r]||n.attributes.paramDefl.this),a.thisParameter={actualName:v,definitionName:r,shadowBlockId:t.shadowBlockId,type:n.namespace,defaultValue:i,fieldEditor:h(r,v),fieldOptions:m(r,v),shadowOptions:g(r,v)}}if(n.parameters){var d=e&&!p[v]?1:0;n.parameters.forEach(function(e,t){var n;if(p[e.name]?n=p[e.name]:d<f.length&&(n=f[d],++d),n||!s){var r=void 0;e.options&&e.options.min&&e.options.max&&(r={min:e.options.min.value,max:e.options.max.value});var i=n?n.name:l?l.params[d++]:e.name,o=n&&("variables_get"===n.shadowBlockId||"lists_create_with"==n.shadowBlockId);a.parameters.push({actualName:e.name,type:e.type,defaultValue:o&&n.varName||e.default,definitionName:i,shadowBlockId:n&&n.shadowBlockId,isOptional:!!c&&c.indexOf(n)>=u,fieldEditor:h(i,e.name),fieldOptions:m(i,e.name),shadowOptions:g(i,e.name),range:r})}e.handlerParameters&&e.handlerParameters.forEach(function(t){a.handlerArgs.push({name:t.name,type:t.type,inBlockDef:!!c&&c.some(function(e){return e.ref&&e.name===t.name})})})})}return a.parameters.forEach(function(e){a.actualNameToParam[e.actualName]=e,a.definitionNameToParam[e.definitionName]=e}),a;function h(e,t){return n.attributes.paramFieldEditor&&(n.attributes.paramFieldEditor[e]||n.attributes.paramFieldEditor[t])}function m(e,t){return n.attributes.paramFieldEditorOptions&&(n.attributes.paramFieldEditorOptions[e]||n.attributes.paramFieldEditorOptions[t])}function g(e,t){return n.attributes.paramShadowOptions&&(n.attributes.paramShadowOptions[e]||n.attributes.paramShadowOptions[t])}},o.hasHandler=function(e){return e.parameters&&e.parameters.some(function(e){var t,n;return"() => void"==e.type||"Action"==e.type||!!(null===(t=e.properties)||void 0===t?void 0:t.length)||!!(null===(n=e.handlerParameters)||void 0===n?void 0:n.length)})},o.reporterTypeForArgType=function(e){var t="argument_reporter_custom";return"boolean"!==e&&"number"!==e&&"string"!==e||(t="argument_reporter_"+e),t},o.defaultIconForArgType=function(e){switch(void 0===e&&(e=""),e){case"number":return"calculator";case"string":return"text width";case"boolean":return"random";default:return"align justify"}},o.parseFields=function(e){return e.split("|").map(function(e,t){var n=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!n)return{n:e,ni:t};var r=n[1];return r&&(r=r.trim()),{n:e,ni:t,pre:r,p:n[2]}})},o.blockDefinitions=function(){return t||n(),t},o.getBlockDefinition=function(e){return t||n(),t[e]}}(i.blocks||(i.blocks={}))}(pxt||(pxt={})),function(J){!function(p){function t(){return"undefined"!=typeof navigator}function e(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function f(){return t()&&/mobi/i.test(navigator.userAgent)}function n(){return t()&&/Mac/i.test(navigator.platform)}function d(){return!!navigator&&/Linux/i.test(navigator.platform)}function h(){return t()&&/arm/i.test(navigator.platform)}function m(){return t()&&/Edge/i.test(navigator.userAgent)}function r(){return t()&&/Trident/i.test(navigator.userAgent)}function g(){return!m()&&!r()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function v(){return!g()&&!m()&&!!navigator&&/(Macintosh|Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function b(){return!v()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function y(){return t()&&/Opera|OPR/i.test(navigator.userAgent)}function w(){return t()&&/Midori/i.test(navigator.userAgent)}function x(){return t()&&/Epiphany/i.test(navigator.userAgent)}function i(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function o(){return"undefined"!=typeof window&&!!window.pxtElectron}function a(){return"undefined"!=typeof window&&!!window.ipcRenderer}function s(){return o()||a()}function c(e){var t,n;try{return"undefined"!=typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&(e||!/nolocalhost=1/.test(window.location.href))&&!(null===(n=null===(t=J)||void 0===t?void 0:t.webConfig)||void 0===n?void 0:n.isStatic)}catch(e){return!1}}function u(){return"undefined"!=typeof window&&!!window.PointerEvent}function k(){return e()?"windows":n()?"mac":d()&&h()?"rpi":d()?"linux":"unknown"}function A(){return m()?"edge":x()?"epiphany":w()?"midori":y()?"opera":r()?"ie":g()?"chrome":v()?"safari":b()?"firefox":"unknown"}function T(){if(!t())return null;var e=[];return y()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),x()?e=/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):w()?e=/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):v()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||(e=/(Macintosh|iPod|iPhone|iPad); (CPU|Intel).*?OS (X )?(\d+)/i.exec(navigator.userAgent)):e=g()?/(Chrome|Chromium)\/([0-9\.]+)/i.exec(navigator.userAgent):m()?/Edge\/([0-9\.]+)/i.exec(navigator.userAgent):r()?/(MSIE |rv:)([0-9\.]+)/i.exec(navigator.userAgent):/(Firefox|Seamonkey)\/([0-9\.]+)/i.exec(navigator.userAgent),e&&0!=e.length?e[e.length-1]:null}p.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},p.hasNavigator=t,p.isWindows=e,p.isWindows10=function(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},p.isMobile=f,p.isIOS=function(){return t()&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints)},p.isAndroid=function(){return t()&&/android/i.test(navigator.userAgent)},p.isMac=n,p.isLinux=d,p.isARM=h,p.isUwpEdge=function(){return"undefined"!=typeof window&&!!window.Windows},p.isEdge=m,p.isIE=r,p.isChrome=g,p.isSafari=v,p.isFirefox=b,p.isOpera=y,p.isMidori=w,p.isEpiphany=x,p.isTouchEnabled=i,p.isPxtElectron=o,p.isIpcRenderer=a,p.isElectron=s,p.isWinRT=function(){return!1},p.isLocalHost=c,p.isLocalHostDev=function(){return c()&&!s()},p.hasPointerEvents=u,p.hasSaveAs=function(){return m()||r()||b()},p.os=k,p.browser=A,p.browserVersion=T;var C=!1;function E(){return f()&&v()&&!/downloadWindowOpen=0/i.test(window.location.href)}function l(e,t,n){var r=E(),i=T(),o=parseInt(i||"0");if(r)n?n.location.href=e:window.open(e,"_self");else if(J.BrowserUtils.isSafari()&&(o<10||0==i.indexOf("10.0")||f())){var a=document.getElementById("downloader");a||(J.debug("injecting downloader iframe"),(a=document.createElement("iframe")).id="downloader",a.style.position="absolute",a.style.right="0",a.style.bottom="0",a.style.zIndex="-1",a.style.width="1px",a.style.height="1px",document.body.appendChild(a)),a.src=e}else if(J.BrowserUtils.isEdge()||J.BrowserUtils.isIE()){var s=atob(e.split(",")[1]),c=J.Util.stringToUint8Array(s),u=new Blob([c],{type:"img/png"});window.navigator.msSaveOrOpenBlob(u,t)}else{var l=window.document.createElement("a");"string"==typeof l.download?(l.href=e,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l)):document.location.href=e}}function S(e,t){var n="data";f()&&v()&&J.appTarget.appTheme.mobileSafariDownloadProtocol&&(n=J.appTarget.appTheme.mobileSafariDownloadProtocol);var r=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);return r&&(n=r[1]),n+":"+t+";base64,"+e}function _(e,t,n,r,i){void 0===n&&(n="application/octet-stream"),J.debug("trigger download");var o=window.navigator.msSaveOrOpenBlob&&!J.BrowserUtils.isMobile(),a=S(e,t);try{if(o){var s=new Blob([J.Util.stringToUint8Array(atob(e))],{type:n});window.navigator.msSaveOrOpenBlob(s,t)}else l(a,t,r)}catch(e){i&&i(e),J.debug("saving failed")}return a}function I(n){var r=document.createElement("img");return new Promise(function(e,t){r.onload=function(){return e(r)},r.onerror=function(){return e(void 0)},r.crossOrigin="anonymous",r.src=n})}function P(e){if(/^https?:\/\//i.test(e))return e;var t=(window.MonacoPaths||{})[e];return t||(J.U.startsWith(e,J.webConfig.commitCdnUrl)?e:J.webConfig.commitCdnUrl+e)}p.isBrowserSupported=function(){var e,t,n;if(!navigator)return!0;if(/bot|crawler|spider|crawling/i.test(navigator.userAgent))return!0;if(null===(n=(null===(e=J.appTarget)||void 0===e?void 0:e.unsupportedBrowsers)||(null===(t=window.pxtTargetBundle)||void 0===t?void 0:t.unsupportedBrowsers))||void 0===n?void 0:n.some(function(e){return e.id==A()}))return!1;var r=T(),i=parseInt(r||"0"),o=g()&&38<=i,a=b()&&31<=i,s=m(),c=v()&&9<=i,u=y()&&g()&&21<=i,l=o||a||s||c||u,p=w()||d()&&h()&&x();return l=(l=l&&!p)||/anybrowser=(true|1)/.test(window.location.href),C||(J.log("Browser: "+A()+" "+r+" on "+k()),l||J.tickEvent("browser.unsupported",{useragent:navigator.userAgent}),C=!0),l},p.devicePixelRatio=function(){if("undefined"==typeof window||!window.screen)return 1;var e=window.screen.systemXDPI,t=window.screen.logicalXDPI;return void 0!==e&&void 0!==t&&t<e?e/t:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1},p.browserDownloadBinText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),_(ts.pxtc.encodeBase64(e),t,n,r,i)},p.browserDownloadText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),_(ts.pxtc.encodeBase64(J.Util.toUTF8(e)),t,n,r,i)},p.isBrowserDownloadInSameWindow=E,p.isBrowserDownloadWithinUserContext=function(){var e=T(),t=parseInt(e||"0");return f()&&v()&&11<=t||/downloadUserContext=1/i.test(window.location.href)},p.browserDownloadDataUri=l,p.browserDownloadUInt8Array=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),_(ts.pxtc.encodeBase64(J.Util.uint8ArrayToString(e)),t,n,r,i)},p.toDownloadDataUri=S,p.browserDownloadBase64=_,p.loadImageAsync=I,p.loadCanvasAsync=function(e){return I(e).then(function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t})},p.imageDataToPNG=function(e){if(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t.toDataURL("image/png")}},p.resolveCdnUrl=P,p.loadStyleAsync=function(e,t){t&&(e="rtl"+e);var r="style-"+e;if(document.getElementById(r))return Promise.resolve();var i=P(e),n=J.Util.toArray(document.head.getElementsByTagName("link")).filter(function(e){return e.getAttribute("href")==i})[0];return n?(n.id||(n.id=r),Promise.resolve()):new Promise(function(e,t){var n=document.createElement("link");n.href=i,n.rel="stylesheet",n.type="text/css",n.id=r,n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){return t(e)}),document.head.appendChild(n)})};var U,O={};function R(e,t){return e?t?(e.indexOf("/")==e.length-1?e.substring(0,e.length-1):e)+"/"+(0==t.indexOf("/")?t.substring(1):t):e:t}function N(){var e=t()&&window.navigator;return e&&e.storage&&e.storage.estimate?e.storage.estimate():Promise.resolve({})}p.loadScriptAsync=function(e){var r=P(e),t=O[r];return t||(t=O[r]=new Promise(function(e,t){J.debug("script: loading "+r);var n=document.createElement("script");n.type="text/javascript",n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){delete O[r],t(e)}),n.src=r,n.async=!0,document.body.appendChild(n)})),t},p.loadAjaxAsync=function(r){return new Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200==n.status?e(n.responseText):t(n.status))},n.open("GET",r,!0),n.send()})},p.loadBlocklyAsync=function(){if(!U){J.debug("blockly: delay load");var e=J.BrowserUtils.loadStyleAsync("blockly.css",ts.pxtc.Util.isUserLanguageRtl());"undefined"==typeof Blockly&&(e=e.then(function(){return J.BrowserUtils.loadScriptAsync("pxtblockly.js")})),e=e.then(function(){J.debug("blockly: loaded")}),U=e}return U},p.patchCdn=function(e){if(!e)return e;var t=J.getOnlineCdnUrl();return t?e.replace("@cdnUrl@",t):e.replace(/@cdnUrl@\/(blob|commit)\/[a-f0-9]{40}\//,"./")},p.initTheme=function(){var e=J.appTarget.appTheme;if(e&&e.accentColor){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(".ui.accent { color: "+e.accentColor+"; }\n                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: "+e.accentColor+"; }")),document.getElementsByTagName("head")[0].appendChild(t)}if(J.Util.isUserLanguageRtl()){J.debug("rtl layout"),J.BrowserUtils.addClass(document.body,"rtl"),document.body.style.direction="rtl";var n=J.Util.toArray(document.head.getElementsByTagName("link")),r=n.filter(function(e){return J.Util.endsWith(e.getAttribute("href"),"semantic.css")})[0];if(r){var i=r.getAttribute("data-rtl");i&&(J.debug("swapping to "+i),r.setAttribute("href",i))}var o=n.filter(function(e){return J.Util.endsWith(e.getAttribute("href"),"blockly.css")})[0];if(o){var a=o.getAttribute("data-rtl");a&&(J.debug("swapping to "+a),o.setAttribute("href",a),o.removeAttribute("data-rtl"))}}},p.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)},p.urlJoin=R,p.joinURLs=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(t)for(var r=0;r<t.length;r++)e=R(e,t[r]);return e},p.storageEstimateAsync=N,p.scheduleStorageCleanup=t()&&navigator.storage&&navigator.storage.estimate?ts.pxtc.Util.throttle(function(){N().then(function(e){return J.debug("storage estimate: "+(e.usage/e.quota*100>>0)+"%, "+(e.usage/1e6>>0)+"/"+(e.quota/1e6>>0)+"Mb"),e.quota&&e.usage&&1e6<e.quota&&.9<e.usage/e.quota?(J.log("quota usage exceeded, clearing translations"),J.tickEvent("storage.cleanup"),j()):Promise.resolve()}).catch(function(e){J.reportException(e)})},1e4,!1):function(){},p.stressTranslationsAsync=function t(){for(var n="...",e=0;e<16;++e)n+=n+Math.random();return console.log("adding entry "+2*n.length+" bytes"),Promise.delay(1).then(function(){return B()}).then(function(e){return e.setAsync("foobar",Math.random().toString(),"",null,void 0,n)}).then(function(){return J.BrowserUtils.storageEstimateAsync()}).then(function(e){return!e.quota||e.usage/e.quota<.8?t():Promise.resolve()})};var D=function(){function e(){this.translations={}}return e.prototype.key=function(e,t,n){return e+"|"+t+"|"+(n||"master")},e.prototype.get=function(e,t,n){return this.translations[this.key(e,t,n)]},e.prototype.getAsync=function(e,t,n){return Promise.resolve(this.get(e,t,n))},e.prototype.set=function(e,t,n,r,i,o,a){this.translations[this.key(e,t,n)]={etag:r,time:i,strings:o,md:a}},e.prototype.setAsync=function(e,t,n,r,i,o){return this.set(e,t,n,r,J.Util.now(),i),Promise.resolve()},e.prototype.clearAsync=function(){return this.translations={},Promise.resolve()},e}(),L=function(){function e(e,t,n,r){this.name=e,this.version=t,this.upgradeHandler=n,this.quotaExceededHandler=r}return e.prototype.throwIfNotOpened=function(){if(!this._db)throw new Error("Database not opened; call IDBWrapper.openAsync() first")},e.prototype.errorHandler=function(e,t,n){console.error(new Error(this.name+" IDBWrapper error for "+t+": "+e.message)),n(e),"QuotaExceededError"==e.name&&(J.log("storage quota exceeded..."),J.tickEvent("storage.quotaexceedederror"),this.quotaExceededHandler&&this.quotaExceededHandler())},e.prototype.getObjectStore=function(e,t){return void 0===t&&(t="readonly"),this.throwIfNotOpened(),this._db.transaction([e],t).objectStore(e)},e.deleteDatabaseAsync=function(r){return new Promise(function(e,t){var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(r);n.onsuccess=function(){return e()},n.onerror=function(){return t(n.error)}})},e.prototype.openAsync=function(){var r=this;return new Promise(function(e,t){var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(r.name,r.version);n.onsuccess=function(){r._db=n.result,e()},n.onerror=function(){return r.errorHandler(n.error,"open",t)},n.onupgradeneeded=function(e){return r.upgradeHandler(e,n)}})},e.prototype.getAsync=function(r,i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(r).get(i);n.onsuccess=function(){return e(n.result)},n.onerror=function(){return o.errorHandler(n.error,"get",t)}})},e.prototype.getAllAsync=function(i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(i).openCursor(),r=[];n.onsuccess=function(){n.result?(r.push(n.result.value),n.result.continue()):e(r)},n.onerror=function(){return o.errorHandler(n.error,"getAll",t)}})},e.prototype.setAsync=function(i,o){var a=this;return new Promise(function(e,t){var n,r=a.getObjectStore(i,"readwrite");(n=void 0!==o.id&&null!==o.id?r.put(o):r.add(o)).onsuccess=function(){return e()},n.onerror=function(){return a.errorHandler(n.error,"set",t)}})},e.prototype.deleteAsync=function(r,i){var o=this;return new Promise(function(e,t){var n=o.getObjectStore(r,"readwrite").delete(i);n.onsuccess=function(){return e()},n.onerror=function(){return o.errorHandler(n.error,"delete",t)}})},e.prototype.deleteAllAsync=function(r){var i=this;return new Promise(function(e,t){var n=i.getObjectStore(r,"readwrite").clear();n.onsuccess=function(){return e()},n.onerror=function(){return i.errorHandler(n.error,"deleteAll",t)}})},e}();p.IDBWrapper=L;var M,F=function(){function l(e){this.db=e,this.mem=new D}return l.dbName=function(){return"__pxt_translations_"+(J.appTarget.id||"")},l.createAsync=function(){function t(){var e=new L(l.dbName(),2,function(e,t){t.result.createObjectStore(l.TABLE,{keyPath:l.KEYPATH})},function(){j().catch(function(e){})});return e.openAsync().then(function(){return new l(e)})}return t().catch(function(e){return console.log("db: failed to open database, try delete entire store..."),L.deleteDatabaseAsync(l.dbName()).then(function(){return t()})})},l.prototype.getAsync=function(t,n,r){var i=this;t=(t||"en-US").toLowerCase();var e=this.mem.key(t,n,r),o=this.mem.get(t,n,r);return o?Promise.resolve(o):this.db.getAsync(l.TABLE,e).then(function(e){return e?(i.mem.set(t,n,r,e.etag,e.time,e.strings),Promise.resolve(e)):Promise.resolve(void 0)}).catch(function(e){return Promise.resolve(void 0)})},l.prototype.setAsync=function(e,t,n,r,i,o){var a=this;e=(e||"en-US").toLowerCase();var s=this.mem.key(e,t,n),c=J.Util.now();this.mem.set(e,t,n,r,c,i,o),i&&Object.keys(i).filter(function(e){return!i[e]}).forEach(function(e){return delete i[e]});var u={id:s,etag:r,time:c,strings:i,md:o};return this.db.setAsync(l.TABLE,u).finally(function(){return p.scheduleStorageCleanup()}).catch(function(e){return console.log("db: set failed ("+e.message+"), recycling..."),a.clearAsync()})},l.prototype.clearAsync=function(){return this.db.deleteAllAsync(l.TABLE).then(function(){return console.debug("db: all clean")}).catch(function(e){console.error("db: failed to delete all")})},l.TABLE="files",l.KEYPATH="id",l}();function B(){return J.Util.isNodeJS?Promise.resolve(new D):(M||(M=F.createAsync().catch(function(){return new D})),M)}function j(){function t(){var t=F.dbName();return L.deleteDatabaseAsync(t).then(function(){M=void 0}).catch(function(e){J.log("db: failed to delete "+t),M=void 0})}return M?M.then(function(e){return e.clearAsync()}).catch(function(e){return t().done()}):t()}function H(e){var t=JSON.stringify(e)+J.appTarget.versions.pxt+"_"+J.appTarget.versions.target;return pxtc.U.sha256(t)}function z(e,t){return e+"|"+(t||"master")}p.translationDbAsync=B,p.clearTranslationDbAsync=j;var V,G=function(){function o(e){this.db=e}return o.dbName=function(){return"__pxt_tutorialinfo_"+(J.appTarget.id||"")},o.createAsync=function(){function t(){var e=new J.BrowserUtils.IDBWrapper(o.dbName(),2,function(e,t){t.result.createObjectStore(o.TABLE,{keyPath:o.KEYPATH})},function(){J.BrowserUtils.IDBWrapper.deleteDatabaseAsync(o.dbName())});return e.openAsync().then(function(){return new o(e)})}return t().catch(function(e){return console.log("db: failed to open tutorial info database, try delete entire store..."),J.BrowserUtils.IDBWrapper.deleteDatabaseAsync(o.dbName()).then(function(){return t()})})},o.prototype.getAsync=function(e,t,n){var r=z(e,n),i=H(t);return this.db.getAsync(o.TABLE,r).then(function(e){if(e&&e.hash==i)return e})},o.prototype.setAsync=function(e,t,n,r){J.perf.measureStart("tutorial info db setAsync");var i={id:z(e,r),hash:H(n),blocks:t};return this.db.setAsync(o.TABLE,i).then(function(){J.perf.measureEnd("tutorial info db setAsync")})},o.TABLE="info",o.KEYPATH="id",o}();function W(e){return e.split(/\s+/).filter(function(e){return!!e})}function q(){var e=new RegExp(J.Util.escapeForRegex(J.Util.pxtLangCookieId)+"=(.*?)(?:;|$)").exec(document.cookie);return e&&e[1]||null}p.tutorialInfoDbAsync=function(){return V||(V=G.createAsync()),V},p.pointerEvents=u()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:i()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},p.getPageX=function(e){return"pageX"in e?e.pageX:e.changedTouches[0].pageX},p.getPageY=function(e){return"pageY"in e?e.pageY:e.changedTouches[0].pageY},p.getClientX=function(e){return"clientX"in e?e.clientX:e.changedTouches[0].clientX},p.getClientY=function(e){return"clientY"in e?e.clientY:e.changedTouches[0].clientY},p.popupWindow=function(t,e,n,r){try{var i=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,c=a/2-n/2+i,u=s/2-r/2+o,l=window.open(t,e,"width="+n+", height="+r+", top="+u+", left="+c);return l.focus&&l.focus(),l}catch(e){return J.tickEvent("pxt.popupError",{url:t,msg:e.message}),null}},p.containsClass=function(t,e){return W(e).every(function(e){return function(e,t){if(e.classList)return e.classList.contains(t);var n=(e.className+"").split(/\s+/);return!(n.indexOf(t)<0)}(t,e)})},p.addClass=function(t,e){W(e).forEach(function(e){return function(e,t){if(e.classList)e.classList.add(t);else{var n=(e.className+"").split(/\s+/);n.indexOf(t)<0&&(e.className.baseVal+=" "+t)}}(t,e)})},p.removeClass=function(r,e){W(e).forEach(function(e){return n=e,void((t=r).classList?t.classList.remove(n):t.className.baseVal=(t.className+"").split(/\s+/).filter(function(e){return e!=n}).join(" "));var t,n})},p.getCookieLang=q,p.setCookieLang=function(e,t){if(void 0===t&&(t=!1),J.Util.allLanguages[e]&&e!==q()){J.tickEvent("menu.lang.setcookielang",{lang:e,docs:""+t});var n=new Date;n.setTime(n.getTime()+24*J.Util.langCookieExpirationDays*60*60*1e3),document.cookie=J.Util.pxtLangCookieId+"="+e+"; expires="+n.toUTCString()+"; path=/"}},p.cacheBustingUrl=function(e){return e?/[?&]rnd=/.test(e)?e:e+(0<e.indexOf("?")?"&":"?")+"rnd="+Math.random():e}}(J.BrowserUtils||(J.BrowserUtils={}))}(pxt||(pxt={})),function(e){var n;(n=e.commands||(e.commands={})).deployCoreAsync=void 0,n.deployFallbackAsync=void 0,n.hasDeployFn=function(){return n.deployCoreAsync||n.deployFallbackAsync},n.deployAsync=function(e,t){return(n.deployCoreAsync||n.deployFallbackAsync)(e,t)},n.patchCompileResultAsync=void 0,n.browserDownloadAsync=void 0,n.saveOnlyAsync=void 0,n.renderBrowserDownloadInstructions=void 0,n.renderUsbPairDialog=void 0,n.showUploadInstructionsAsync=void 0,n.saveProjectAsync=void 0,n.electronDeployAsync=void 0,n.webUsbPairDialogAsync=void 0,n.onTutorialCompleted=void 0}(pxt||(pxt={})),function(i){function e(){var e;return e||(e=i.U.isNodeJS?Promise.resolve(require("lzma")):Promise.resolve(window.LZMA)).then(function(e){return e||i.reportError("lzma","failed to load"),e}),e}i.lzmaDecompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.decompress(r,function(e,t){t&&i.debug("lzma decompression failed"),n(t?void 0:e)})}catch(e){e&&i.debug("lzma decompression failed"),n(void 0)}})})},i.lzmaCompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.compress(r,7,function(e,t){t&&i.reportException(t),n(t?void 0:new Uint8Array(e))})}catch(e){i.reportException(e),n(void 0)}})})}}(pxt||(pxt={})),function(Ue){!function(e){var Te=pxtc.Util,Ce=Te.lf;var Ee={"pxt::mkAction":1,"pxt::dumpPerfCounters":1,"pxt::deepSleep":1,"pxt::getConfig":1,"pxtrt::mkMap":1,"pxtrt::mapSet":1,"pxtrt::stclo":1,"pxtrt::mklocRef":1,"pxtrt::stlocRef":1,"pxtrt::ldlocRef":1,"pxtrt::panic":1};function Se(n){void 0===n&&(n="namespace");var r="",i="",e=function(e,t){void 0===t&&(t=""),i!=e&&(i&&(r+="}\n"),e&&(r+=t||n+" "+e+" {\n"),i=e)},t="    ";return{setNs:e,clear:function(){i=r=""},write:function(e){e.trim()?(e=e.trim().replace(/^\s*/gm,t).replace(/^(\s*)\*/gm,function(e,t){return t+" *"}),r+=e+"\n"):r+="\n"},incrIndent:function(){t+="    "},decrIndent:function(){t=t.slice(4)},finish:function(){return e(""),r}}}function _e(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}e.nsWriter=Se,e.parseCppInt=_e;var Ie={},Pe=function(n){function e(e){var t=n.call(this,e)||this;return t.isUserError=!0,t.message=e,t}return __extends(e,n),e}(Error);function u(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e[n];t+=37==r||127<r?"%"+r.toString(16):String.fromCharCode(r)}return decodeURIComponent(t)}function l(e){for(var t="",n=0;n<e.length;n+=2)t=e[n]+e[n+1]+t;return Ue.Util.assert(n==e.length),t}function o(e){var t=[65,20,14,47,184,47,162,187];e:for(var n=0;n<e.length;n+=16)if(e[n]==t[0]){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;var i=e[n+8]|e[n+9]<<8,o=e[n+10]|e[n+11]<<8|e[n+12]<<16|e[n+13]<<24,a=(n+=16)+i+o;if(!(a>e.length)){var s=e.slice(n,n+i),c=e.slice(n+i,a);return{meta:u(s),text:c}}}return null}function t(e){function t(e){return Ue.debug(e),Promise.reject(new Error(e))}var n;if(Ue.HF2.read32(e,0)==ts.pxtc.UF2.UF2_MAGIC_START0){var r=ts.pxtc.UF2.toBin(e);r&&(n=o(r.buf))}(1179403647==Ue.HF2.read32(e,0)&&(n=o(e)),58==e[0])&&(n=function(e){if(e){var r,i=0,o=0,a=0,s=0;if(e.split(/\r?\n/).forEach(function(e){var t=/^:10....0[0E]41140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(t)i=parseInt(l(t[1]),16),o=parseInt(l(t[2]),16),a=i+o,r=new Uint8Array(a);else if(0<a){if(!(t=/^:10....0[0E](.*)(..)$/.exec(e)))return;for(var n=t[1];0<a&&0<n.length;)r[s++]=parseInt(n[0]+n[1],16),n=n.slice(2),a--}}),r&&0==a&&s==r.length){for(var t=new Uint8Array(i),n=new Uint8Array(o),c=0;c<i;++c)t[c]=r[c];for(c=0;c<o;++c)n[c]=r[i+c];return{meta:u(t),text:n}}}}(u(e)||""));if(!n||!n.meta||!n.text)return t("This .hex file doesn't contain source.");var i=JSON.parse(n.meta);return i?"LZMA"==i.compression?Ue.lzmaDecompressAsync(n.text).then(function(e){if(!e)return null;var t=e.slice(0,i.headerSize||i.metaSize||0),n=e.slice(t.length);return t&&Ue.Util.jsonCopyFrom(i,JSON.parse(t)),{meta:i,source:n}}):i.compression?t("Compression type "+i.compression+" not supported."):Promise.resolve({source:u(n.text)}):t("This .hex file is not valid.")}e.PkgConflictError=Pe,e.getExtensionInfo=function(c){for(var e={__appVariant:Ue.appTargetVariant||""},t="dal.d.ts",u="/source/",n="",r=[],i=0,o=c.sortedDeps(!0).sort(function(e,t){return"this"==e.id?1:"this"==t.id?-1:Te.strcmp(e.id,t.id)});i<o.length;i++)(ae=o[i]).disablesVariant(Ue.appTargetVariant)||ae.resolvedDependencies().some(function(e){return e.disablesVariant(Ue.appTargetVariant)})?("this"!=ae.id&&(n&&(n+=", "),n+=ae.id),Ue.debug("disable variant "+Ue.appTargetVariant+" due to "+ae.id)):(r.push(ae),ae.addSnapshot(e,[t,".h",".cpp"]));var a=JSON.stringify(e),s=Ie[a];if(s){Ue.debug("Using cached extinfo");var l=Te.flatClone(s);return l.disabledDeps=n,l}Ue.debug("Generating new extinfo");var _=pxtc.emptyExtInfo();_.disabledDeps=n;var p=Ue.appTarget.compileService;p||(p={gittag:"none",serviceId:"nocompile"}),p=Te.clone(p);var f=c.getTargetOptions();f||(f={isNative:!1,hasHex:!1,switches:{}});var d=!!p.platformioIni,h="codal"==p.buildEngine||"dockercodal"==p.buildEngine,m="dockermake"==p.buildEngine||"dockercross"==p.buildEngine,I=!d&&!h&&!m,P=f.nativeType==pxtc.NATIVE_TYPE_VM;d?u="/src/":(h||m)&&(u="/pxtapp/");var g="// Configuration defines\n",U="\nPXT_SHIMS_BEGIN\n",O="",R="",v='#include "pxt.h"\n',b="",N=function(e){return b+="   "+y+"("+D+"): "+e+"\n"},D=0,y="",L=Se("namespace"),M=Se("declare namespace"),F=Se("declare namespace"),w="",B={},j={},H={true:"1",false:"0",null:"0",NULL:"0"};function z(e){return e.trim().replace(/[\_\*]$/,"")}for(var x="",k=0,A=r;k<A.length;k++){if(0<=(ae=A[k]).getFiles().indexOf(t)){var T=ae.host().readFile(ae,t);Ue.Util.assert(!!T,t+" not found in "+ae.id),T.split(/\r?\n/).forEach(function(e){var t=/^\s*(\w+) = (.*),/.exec(e);t&&(H[t[1]]=t[2])})}!x&&0<=ae.getFiles().indexOf("Makefile")&&(x=ae.host().readFile(ae,"Makefile"))}var V=["0","false","PXT_UTF8"],G={};function W(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}f.switches.boxDebug&&(G.PXT_BOX_DEBUG=1),f.utf8&&(G.PXT_UTF8=1),f.switches.profile&&(G.PXT_PROFILE=1),f.switches.gcDebug&&(G.PXT_GC_DEBUG=1),f.switches.numFloat&&(G.PXT_USE_FLOAT=1),f.nativeType==pxtc.NATIVE_TYPE_VM&&(G.PXT_VM=1);var q=0,J=!1,$="",Y="",K="",X=!1;function Q(){M.setNs(""),M.write(""),M.write(""),(K||Y)&&(M.write(Y),M.write(K),Y=K="")}function C(e,k){var A;K=Y=$="",X=!1;var T=-1;function C(){var e=$.replace(/Methods$/,"");return e==$?null:e}function E(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return f.shortPointers&&N("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral_":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return z(e)}}function S(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":case"ramint_t":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";case"ImageLiteral_":return"T";case"String":return"S";default:return Te.lookup(B,e)?"I":"_"+e.replace(/[\*_]+$/,"")}}e=e.replace(/^(\s*#\s*if\s+(\w+)\s*$)([^]*?)(^\s*#\s*(elif|else|endif)\s*$)/gm,function(e,t,n,r,i){return 0<=V.indexOf(n)&&!G[n]?t+r.replace(/[^\n]/g,"")+i:e}),J=!1,q=D=0,F.setNs(""),M.setNs(""),e.split(/\r?\n/).forEach(function(e){++D;var t=W(e);!function(e){var t=W(e);if(J&&0<=t.indexOf("}")&&(J=!1,F.write("}")),J){var n=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(t);if(n){var r=n[1],i=n[3],o="";if(i){i=i.trim();var a=Te.lookup(H,i);null!=a&&(o="  // "+i,i=a),null==(q=_e(i))&&N("cannot determine value of "+t)}else i=++q+"";F.write("    "+z(r)+" = "+i+","+o)}else F.write(e)}}(e);var n,r,i=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(t);if(i&&(n=i[2],r=i[3],J=!0,q=-1,F.write(""),F.write(""),(K||Y)&&(F.write(Y),F.write(K),Y=K=""),F.write("declare const enum "+z(n)+" "+r),B[n]=!0,k||(L.setNs($),L.write("enum "+i[2]+" : int;"))),o=e,!J&&!(/^\s*\/\*\*/.test(o)?(X=!0,Y=o+"\n",/\*\//.test(o)&&(X=!1),1):X?(Y+=o+"\n",/\*\//.test(o)&&(X=!1),1):/^\s*\/\/%/.test(o)&&(K+=o+"\n",1))){var o;/^typedef.*;\s*$/.test(e)&&(L.setNs($),L.write(e));var a=/^\s*namespace\s+(\w+)/.exec(e);if(a)if($=a[1],C()){Q();var s=C();M.setNs($,"declare interface "+s+" {")}else(K||Y)&&(Q(),M.setNs(z($)),F.setNs(z($)));else{if((a=/^PXT_ABI\((\w+)\)/.exec(e))&&!P&&(U+="PXT_FNPTR(::"+a[1]+"),\n",R+='extern "C" void '+a[1]+"();\n",_.functions.push({name:a[1],argsFmt:[],value:0})),(a=/^#define\s+PXT_COMM_BASE\s+([0-9a-fx]+)/.exec(e))&&(_.commBase=parseInt(a[1])),a=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),!K||!a){if(a=/^\s*extern const (\w+) (\w+);/.exec(e),K&&a)return b={name:$+"::"+a[2],argsFmt:[],value:null},_.functions.push(b),P||(U+="PXT_FNPTR(&::"+b.name+"),\n"),void(K="");if(a=/^\s*(\w+)\s+(\w+)\s*;/.exec(e),K&&a){var c=pxtc.parseCommentString(K);c.indexedInstanceNS&&(A=c,M.setNs(c.indexedInstanceNS),T=0);var u=a[1],l=a[2];if(A)return K=K.trim(),K+=" fixedInstance shim="+A.indexedInstanceShim+"("+T+++")",M.write(""),M.write(Y),M.write(K),M.write("const "+l+": "+E(u)+";"),void(K=Y="")}return K&&e.trim()?(N("declaration not understood: "+e),void(Y=K="")):void 0}A=null;var p=pxtc.parseCommentString(K);$||N("missing namespace declaration");var f=(a[1]+a[2]).replace(/\s+/g,""),d=a[3],h=a[4];K=K.trim().replace(/ \w+\.defl=\w+/g,"");var m=[S(f)],g=[],v=h.split(/,/).filter(function(e){return!!e}).map(function(e){var t=function(e,t){t=t.trim();var n=/(.*)=\s*(-?\w+)$/.exec(t),r="",i="";if(n&&(r=n[2],i="?",t=n[1].trim()),!(n=/^(.*?)(\w+)$/.exec(t)))return N("invalid argument: "+t),{name:"???",type:"int"};var o=n[2];e.paramDefl[o]&&(r=e.paramDefl[o],i="?");var a=r?Te.lookup(H,r):null;return null!=a&&(r=a),r&&(null==_e(r)&&N("Invalid default value (non-integer): "+r),K+=" "+o+".defl="+r),{name:o+i,type:n[1]}}(p,e);return m.push(S(t.type)),g.push(t.type.replace(/ /g,"")),t.name+": "+E(t.type)}),b={name:$+"::"+d,argsFmt:m,value:null};if(Y)if(M.setNs(z($)),M.write(""),M.write(Y),/ImageLiteral/.test(a[4])&&!/imageLiteral=/.test(K)&&(K+=" imageLiteral=1"),K+=" shim="+b.name,M.write(K),d=z(d),C()){var y=(v[0]||"").replace(/^.*:\s*/,"").trim();y.toLowerCase()!=C().toLowerCase()&&N(Ce("Invalid first argument; should be of type '{0}', but is '{1}'",C(),y)),v.shift(),0==v.length&&/\bproperty\b/.test(K)?M.write(d+": "+E(f)+";"):M.write(d+"("+v.join(", ")+"): "+E(f)+";")}else M.write("function "+d+"("+v.join(", ")+"): "+E(f)+";");if(K=Y="",k||(L.setNs($),L.write(f+" "+d+"("+h+");")),_.functions.push(b),I)U+="(uint32_t)(void*)::"+b.name+",\n";else if(P){if(Te.startsWith(b.name,"pxt::op_")||Ee[b.name]||p.expose||!Te.startsWith(b.name,"pxt::")&&!Te.startsWith(b.name,"pxtrt::")){var w=function(e,t){if("FiberContext*"==t[0])return"::"+e.name;var n="_wrp_"+e.name.replace(/:/g,"_");if(j[e.name])return n;j[e.name]=!0,O+="\nvoid "+n+"(FiberContext *ctx) {\n";for(var r=t.length,i=[],o=!1,a="",s=0;s<r;++s){var c=e.argsFmt[s+1],u=t[s],l="I"==c?"toInt":"B"==c?"numops::toBool":"",p=s==r-1?"ctx->r0":"ctx->sp["+(r-s-2)+"]",f="";switch(u){case"TValue":case"TNumber":break;case"Action":l="asRefAction";break;case"String":l="convertToString",f="ctx, ",o=!0;break;default:l||(l="as"+u.replace(/\*/g,""))}a+="  "+u+" a"+s+" = ("+u+") "+l+"("+f+p+");\n",i.push("a"+s)}o&&(O+="  auto prevSP = ctx->sp;\n"),O+=a,o&&(O+="  if (panicCode) { ctx->sp = prevSP; return; }\n");var d="::"+e.name+"("+i.join(", ")+")";return"V"==e.argsFmt[0]?(O+="  "+d+";\n",O+="  ctx->r0 = NULL;\n"):"I"==e.argsFmt[0]?O+="  ctx->r0 = fromInt("+d+");\n":"B"==e.argsFmt[0]?O+="  ctx->r0 = fromBool("+d+");\n":O+="  ctx->r0 = (TValue)"+d+";\n",o&&(O+="  ctx->sp = prevSP;\n"),1<r&&(O+="  ctx->sp += "+(r-1)+";\n"),O+="}\n",n}(b,g),x=b.argsFmt.length-1;U+='{ "'+b.name+'", (OpFun)'+w+", "+x+" },\n"}}else U+="PXT_FNPTR(::"+b.name+"),\n"}}})}var E=Te.clone(p.yottaConfig||{}),S={},Z={};if(I&&f.hasHex){var ee=p;Te.assert(!!ee.yottaCorePackage),Te.assert(!!ee.githubCorePackage),Te.assert(!!ee.gittag);var te=ee.githubCorePackage+"#"+p.gittag;_.yotta.dependencies[ee.yottaCorePackage]=te}if(c)for(var ne=!1,re=function(e){b="",function(e){var t=e.config.platformio;t&&t.dependencies&&Te.jsonCopyFrom(_.platformio.dependencies,t.dependencies),_.npmDependencies&&e.config.npmDependencies&&Te.jsonCopyFrom(_.npmDependencies,e.config.npmDependencies);var n=e.config.yotta;if(n){if(n.dependencies&&Te.jsonCopyFrom(_.yotta.dependencies,n.dependencies),n.config)for(var r=Te.jsonFlatten(n.config),i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=Te.lookup(Z,a),c=r[a];if(!s||s.config.yotta.configIsJustDefaults)Z[a]=e,E[a]=c;else if(E[a]===c);else if(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts){var u=new Pe(Ce("conflict on yotta setting {0} between extensions {1} and {2}",a,e.id,s.id));throw u.pkg0=s,u.pkg1=e,u.settingName=a,u}}if(n.optionalConfig){r=Te.jsonFlatten(n.optionalConfig);for(var l=0,p=Object.keys(r);l<p.length;l++)c=r[a=p[l]],S[a]=c}}}(e),e==c?(ne=!0,M.clear(),F.clear()):Te.assert(!ne);for(var t=function(e){return Te.endsWith(e,".h")},n=0,r=e.getFiles().filter(t).concat(e.getFiles().filter(function(e){return!t(e)}));n<r.length;n++){var i=r[n],o=t(i);if(o||Te.endsWith(i,".cpp")){var a=e.config.name+"/"+i;("base"==e.config.name||/^core($|---)/.test(e.config.name))&&o&&(a=i),o&&(v+='#include "'+(I?u.slice(1):"")+a+'"\n'),null==(s=e.readFile(i))&&Te.userError(Ce("C++ file {0} is missing in extension {1}.",i,e.config.name)),y=a,C(s,o),_.extensionFiles[u+a]=s,0==e.level&&(_.onlyPublic=!1),e.verProtocol()&&"pub"!=e.verProtocol()&&"embed"!=e.verProtocol()&&(_.onlyPublic=!1)}if(Te.endsWith(i,".c")||Te.endsWith(i,".S")||Te.endsWith(i,".s")){var s=e.readFile(i);_.extensionFiles[u+e.config.name+"/"+i.replace(/\.S$/,".s")]=s}}b&&(w+=Ce("Extension {0}:\n",e.id)+b)},ie=0,oe=r;ie<oe.length;ie++){var ae;re(ae=oe[ie])}w&&Te.userError(w),Te.jsonCopyFrom(S,E),Te.iterMap(S,function(e,t){null===t&&delete S[e]}),Object.keys(S).filter(function(e){return/-/.test(e)}).forEach(function(e){var t=S[e];delete S[e],S[e.replace(/-/g,"_")]=t}),!I&&p.yottaConfigCompatibility&&Object.keys(S).forEach(function(e){return S["YOTTA_CFG_"+e]=S[e]});var se=Te.jsonUnFlatten(S);if(m){var ce={name:"pxt-app",private:!0,dependencies:_.npmDependencies};_.generatedFiles["/package.json"]=JSON.stringify(ce,null,4)+"\n"}else if(h){ee=p;var ue=Te.clone(ee.codalDefinitions)||{},le=ee.codalTarget;"string"==typeof le&&(le+=".json");var pe={target:le,definitions:ue,config:ue,application:"pxtapp",output_folder:"build",pxt_gitrepo:ee.githubCorePackage,pxt_gittag:ee.gittag};Te.iterMap(Te.jsonFlatten(se),function(e,t){e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),ue[e]=t}),_.generatedFiles["/codal.json"]=JSON.stringify(pe,null,4)+"\n",Ue.debug("codal.json: "+_.generatedFiles["/codal.json"])}else if(d){var fe=p.platformioIni.slice();fe.push("lib_deps ="),Te.iterMap(_.platformio.dependencies,function(e,t){var n=/[@#\/]/.test(t)?t:e+"@"+t;fe.push("  "+n)}),_.generatedFiles["/platformio.ini"]=fe.join("\n")+"\n"}else{_.yotta.config=se;var de="pxt-app";p.yottaBinary&&(de=p.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""));var he={name:de,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:_.yotta.dependencies,targetDependencies:{},bin:"./source"};_.generatedFiles["/module.json"]=JSON.stringify(he,null,4)+"\n",Ue.debug("module.json: "+_.generatedFiles["/module.json"])}for(var me=0,ge=Object.keys(G);me<ge.length;me++){var ve=ge[me];g+="#define "+ve+" "+G[ve]+"\n"}if(f.uf2Family&&(g+="#define PXT_UF2_FAMILY "+f.uf2Family+"\n"),_.generatedFiles[u+"pointers.cpp"]=v+L.finish()+R+O+U+"\nPXT_SHIMS_END\n",_.generatedFiles[u+"pxtconfig.h"]=g,Ue.debug("pxtconfig.h: "+_.generatedFiles[u+"pxtconfig.h"]),I&&(_.generatedFiles["/config.json"]=JSON.stringify(se,null,4)+"\n",Ue.debug("yotta config.json: "+_.generatedFiles["/config.json"])),_.generatedFiles[u+"main.cpp"]='\n#include "pxt.h"\n#ifdef PXT_MAIN\nPXT_MAIN\n#else\nint main() {\n    uBit.init();\n    pxt::start();\n    release_fiber();\n    return 0;   // your program will never reach this line.\n}\n#endif\n',x){var be=Object.keys(_.extensionFiles).concat(Object.keys(_.generatedFiles)),ye="",we=function(e,t){var n=be.filter(function(e){return Te.endsWith(e,t)}).map(function(e){return e.slice(1)});ye+=e+" = "+n.join(" ")+"\n"};we("PXT_C",".c"),we("PXT_CPP",".cpp"),we("PXT_S",".s"),we("PXT_HEADERS",".h"),ye+="PXT_SOURCES := $(PXT_C) $(PXT_S) $(PXT_CPP)\n",ye+="PXT_OBJS := $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",_.generatedFiles["/Makefile"]=x,_.generatedFiles["/Makefile.inc"]=ye}_.generatedFiles["/functions.json"]=JSON.stringify(_.functions,null,1);var xe=_.extensionFiles;Te.jsonCopyFrom(xe,_.generatedFiles);var ke={config:p.serviceId,tag:p.gittag,replaceFiles:xe,dependencies:I?_.yotta.dependencies:null},Ae=JSON.stringify(ke);return _.sha=Te.sha256(Ae),_.skipCloudBuild=!!p.skipCloudBuild,_.compileData=ts.pxtc.encodeBase64(Te.toUTF8(Ae)),_.shimsDTS=M.finish(),_.enumsDTS=F.finish(),10<Object.keys(Ie).length&&(Ie={}),Ie[a]=_},e.unpackSourceFromHexFileAsync=function(e){if(e)return Ue.Util.fileReadAsBufferAsync(e).then(function(e){return t(new Uint8Array(e))})},e.unpackSourceFromHexAsync=t}(Ue.cpp||(Ue.cpp={}))}(pxt||(pxt={})),function(h){!function(a){var s,c={},o={};function u(e){var t,o,n,r,i;return c.hasOwnProperty(e.sha)||(c[e.sha]=(t=e,o="",a.showLoading(h.U.lf("Compiling (this may take a minute)...")),(n=t,n.skipCloudBuild?Promise.resolve({hex:["SKIP"]}):h.webConfig&&h.webConfig.isStatic?h.Util.requestAsync({url:h.webConfig.cdnUrl+"hexcache/"+n.sha+".hex"}).then(function(e){if(e.text){var t={enums:[],functions:[],hex:e.text.split(/\r?\n/)};return Promise.resolve(t)}return h.log("Hex info not found in bundled hex cache"),Promise.resolve()}).catch(function(e){return h.log("Error fetching hex info from bundled hex cache"),Promise.resolve()}):h.Cloud.localToken&&window&&h.BrowserUtils.isLocalHost()?(r="compile/"+n.sha,h.Cloud.localRequestAsync(r,i).then(function(e){return e.json})).then(function(e){return e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve(void 0)}).catch(function(e){return Promise.resolve(void 0)}):Promise.resolve(void 0)).then(function(e){return e||function(){if(s)return s;var e=h.getOnlineCdnUrl();if(e)return s=Promise.resolve(e);var t=h.webConfig&&h.webConfig.isStatic;return s=h.Cloud.privateGetAsync("clientconfig",t).then(function(e){return e.primaryCdnUrl})}().then(function(e){return o=e+"/compile/"+t.sha,h.U.httpGetTextAsync(o+".hex")}).then(function(e){return e},function(e){return h.Cloud.privatePostAsync("compile/extension",{data:t.compileData}).then(function(i){return new Promise(function(n,e){var r=function(){var t=i.hex.replace(/\.hex/,".json");return h.log("polling C++ build "+t),h.Util.httpGetJsonAsync(t).then(function(e){h.log("build log "+t.replace(/\.json$/,".log")),e.success?(h.log("fetching "+o+".hex"),n(h.U.httpGetTextAsync(o+".hex"))):(h.log("build failed"),e.mbedresponse&&e.mbedresponse.result&&e.mbedresponse.result.exception&&h.log(e.mbedresponse.result.exception),n(null))},function(e){return setTimeout(r,1e3),null})};r()})})}).then(function(e){return a.hideLoading(),{hex:e&&e.split(/\r?\n/)}})}).finally(function(){a.hideLoading()}))),c[e.sha]}function l(r,i,o,e,a){return void 0===a&&(a=10),r.cacheStoreAsync(o,e).then(function(){return r.cacheGetAsync(i)}).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){console.error("invalid cache entry, clearing entry"),t=[]}(t=t.filter(function(e){return e!=o})).unshift(o);var n=t.slice(a);return t=t.slice(0,a),Promise.map(n,function(e){return r.cacheStoreAsync(e,null)}).then(function(){return r.cacheStoreAsync(i,JSON.stringify(t))})})}function p(n,r,i){return n.cacheGetAsync(r).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){return console.error("invalid cache entry, clearing entry"),n.cacheStoreAsync(r,"[]")}return t[0]!=i?((t=t.filter(function(e){return e!=i})).unshift(i),n.cacheStoreAsync(r,JSON.stringify(t))):null})}a.showLoading=function(e){},a.hideLoading=function(){},a.storeWithLimitAsync=l,a.recordGetAsync=p,a.getHexInfoAsync=function(r,n,e){if(!n.sha)return Promise.resolve(null);var t=o[n.sha];if(t)return Promise.resolve(t);h.debug("get hex info: "+n.sha);var i="hex-"+n.sha;return r.cacheGetAsync(i).then(function(e){var t;try{t=e?JSON.parse(e):null}catch(e){console.log("invalid cache entry, clearing entry"),t=null}return t&&t.hex?(h.debug("cache hit, size="+e.length),t.hex=function(e){for(var t=[],n=0;n<e.length;n++){var r=/^([@!])(....)$/.exec(e[n]);if(r){var i=parseInt(r[2],16),o=e[++n],a="";if("@"==r[1]){a="";for(var s=parseInt(o,16);0<s--;)a+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else a=ts.pxtc.decodeBase64(o);h.Util.assert(0<a.length),h.Util.assert(a.length%16==0);for(var c=0;c<a.length;){var u=[16,i>>8&255,255&i,0];i+=16;for(var l=0;l<16;++l)u.push(a.charCodeAt(c++));for(var p=0,l=0;l<u.length;++l)p+=u[l];u.push(255&-p);for(var f=":",l=0;l<u.length;++l){var d=255&u[l];d<=15&&(f+="0"),f+=d.toString(16)}t.push(f.toUpperCase())}}else t.push(e[n])}return t}(t.hex),p(r,"hex-keys",i).then(function(){return t})):u(n).then(function(e){var t=e.hex;e.hex=function(e){for(var t=[],n=0,r=0;r<e.length;r+=n){var i=-1,o="";n=0;for(var a=!1;n<500;){var s=/^:10(....)00(.{32})(..)$/.exec(e[r+n]);if(!s)break;var c=s[2],u=/^0+$/.test(c),l=parseInt(s[1],16);if(-1==i)a=u,t.push((a?"@":"!")+s[1]),i=l-16;else{if(u!=a)break;if(i+16!=l)break}a||(o+=c),i=l,n++}if(0==n)t.push(e[r]),n=1;else if(a)t.push(n.toString(16));else{for(var p="",f=0;f<o.length;f+=2)p+=String.fromCharCode(parseInt(o.slice(f,f+2),16));t.push(ts.pxtc.encodeBase64(p))}}return t}(e.hex);var n=JSON.stringify(e);return e.hex=t,l(r,"hex-keys",i,n).then(function(){return e})}).catch(function(e){return h.reportException(e,{sha:n.sha}),Promise.resolve(null)})}).then(function(e){return e&&(20<Object.keys(o).length&&(o={}),o[n.sha]=e),e})}}(h.hexloader||(h.hexloader={}))}(pxt||(pxt={})),function(h){!function(a){function n(e,t,n,r,i){if(void 0===n&&(n={}),void 0===r&&(r=null),void 0===i&&(i=null),a.testMode||e==a.TEST_KEY){var o={success:!0};return Promise.resolve({statusCode:200,headers:{},text:JSON.stringify(o),json:o})}return h.Util.multipartPostAsync(t,n,r,i)}function f(e,t,n,r,i){h.Util.assert(!!t&&!!n&&!!r);var o="https://api.crowdin.com/api/project/"+t+"/";return i=i||{},a.testMode?delete i.key:i.key=n,e&&(i.branch=e),o+r+"?"+Object.keys(i).map(function(e){return e+"="+encodeURIComponent(i[e])}).join("&")}function e(e){var t=0;return function(){if(10<t++)throw new Error("Too many API calls for "+e)}}function d(r,i,o,a,s){return a=t(a),h.debug("create directory "+(r||"")+"/"+a),s||(s=e(a)),n(o,f(r,i,o,"add-directory"),{json:"true",name:a}).then(function(e){if(h.debug("crowdin resp: "+e.statusCode),200==e.statusCode||400==e.statusCode)return Promise.resolve();if(500==e.statusCode&&e.text&&50===JSON.parse(e.text).error.code)return h.log("directory already exists"),Promise.resolve();var t=e.json||JSON.parse(e.text)||{error:{}};if(404==e.statusCode&&17==t.error.code){h.log("parent directory missing for "+a);var n=a.replace(/\/[^\/]+$/,"");if(n!=a)return d(r,i,o,n,s).then(function(){return d(r,i,o,a,s)})}throw new Error("cannot create directory "+(r||"")+"/"+a+": "+e.statusCode+" "+JSON.stringify(t))})}function t(e){return e.replace(/\\/g,"/")}function i(e,t){var n=h.appTarget.versions.pxtCrowdinBranch||"",r=h.appTarget.versions.targetCrowdinBranch||"",i=[];if(e.forEach(function(e){return function t(n,r,i,o){var e=r.name,a=i?i+"/"+e:e;switch(r.fullName=a,r.branch=o||"",r.node_type){case"file":n.push(r);break;case"directory":(r.files||[]).forEach(function(e){return t(n,e,a,o)});break;case"branch":(r.files||[]).forEach(function(e){return t(n,e,i,r.name)})}}(i,e,"")}),i=i.filter(function(e){return e.fullName.indexOf("/")<0?e.branch==n:e.branch==r}),t&&(i=i.filter(function(e){return 0==e.fullName.indexOf(t)})),"core"!=h.appTarget.id){var o=h.appTarget.id+"/";i=i.filter(function(e){return e.fullName.indexOf("/")<0||e.fullName.substr(0,o.length)==o||0<=e.fullName.indexOf("common-docs")})}return i}function r(e,t){var n=f("",e,t,"info",{json:"true"});return h.Util.httpGetTextAsync(n).then(function(e){return JSON.parse(e)})}a.KEY_VARIABLE="CROWDIN_KEY",a.testMode=!1,a.TEST_KEY="!!!testmode!!!",a.setTestMode=function(){h.crowdin.testMode=!0,h.log("CROWDIN TEST MODE - files will NOT be uploaded")},a.downloadTranslationsAsync=function(a,s,c,u,l){void 0===l&&(l={});var e=f(a,s,c,"info",{json:"true"}),p={};return u=t(u),h.Util.httpGetTextAsync(e).then(function(e){var t=JSON.parse(e);if(!t)throw new Error("info failed");var i=t.languages.filter(function(e){return"en"!=e.code});h.appTarget&&h.appTarget.appTheme&&h.appTarget.appTheme.availableLocales&&(i=i.filter(function(e){return-1<h.appTarget.appTheme.availableLocales.indexOf(e.code)})),h.log("languages: "+i.map(function(e){return e.code}).join(", "));var o=function(){var n=i.pop();if(!n)return Promise.resolve();var r=f(a,s,c,"export-file",{file:u,language:n.code,export_translated_only:l.translatedOnly?"1":"0",export_approved_only:l.validatedOnly?"1":"0"});return h.log("downloading "+n.name+" - "+n.code+" ("+i.length+" more)"),h.Util.httpGetTextAsync(r).then(function(e){try{var t=JSON.parse(e);t&&(p[n.code]=t)}catch(e){h.log(r+" "+e)}return o()}).delay(1e3)};return o()}).then(function(){return p})},a.createDirectoryAsync=d,a.uploadTranslationAsync=function r(i,o,a,s,c){h.Util.assert(!!o),h.Util.assert(!!a);var u=e(s=t(s));function l(){return p("update-file",{update_option:"update_as_unapproved"})}function p(e,t){return t.type="auto",t.json="",t.escape_quotes="0",u(),n(a,f(i,o,a,e),t,s,c).then(function(e){return function(e){var t=e.statusCode,n=h.Util.jsonTryParse(e.text)||{};if(h.debug("upload result: "+t),404==t&&n.error&&8==n.error.code)return h.log("create new translation file: "+s),p("add-file",{});if(404==t&&n.error&&17==n.error.code)return d(i,o,a,s.replace(/\/[^\/]+$/,""),u).then(function(){return l()});if(!n.success&&n.error&&53==n.error.code)return h.log(s+" being updated, waiting 5s and retry..."),Promise.delay(5e3).then(function(){return r(i,o,a,s,c)});if(200==t||n.success)return Promise.resolve();throw new Error("Error, upload translation: "+s+", "+t+", "+e.text)}(e)})}return l()},a.projectInfoAsync=r,a.listFilesAsync=function(e,t,n){return h.log("crowdin: listing files under "+n),r(e,t).then(function(e){if(!e)throw new Error("info failed");var t=i(e.files,n);return h.debug("crowdin: found "+t.length+" under "+n),t.map(function(e){return{fullName:e.fullName,branch:e.branch||""}})})},a.languageStatsAsync=function(e,t,n){var r=f("",e,t,"language-status",{language:n,json:"true"});return h.Util.httpGetJsonAsync(r).then(function(e){return i(e.files)})},a.inContextLoadAsync=function(r){var i=document.createElement("input");i.type="text",i.setAttribute("class","hidden"),i.value=r;var e=new Promise(function(t,e){var n=new MutationObserver(function(){if(r!=i.value){var e=h.Util.rlf(i.value);i.remove(),n.disconnect(),t(e)}});n.observe(i,{attributes:!0})});return document.body.appendChild(i),e}}(h.crowdin||(h.crowdin={}))}(pxt||(pxt={})),function(w){!function(e){function B(e){return e?e.split(/\r?\n/):[]}function b(e,t,a){void 0===a&&(a={}),a.ignoreWhitespace&&(e=e.replace(/[\r\n]+$/,""),t=t.replace(/[\r\n]+$/,""));var n=B(e),r=B(t),o=Math.min(a.maxDiffSize||1024,n.length+r.length);if(0==o)return[];var s=65520<n.length?Uint32Array:Uint16Array,c={},u=0,l=i(n),p=i(r);function i(e){for(var t=new s(e.length),n=0,r=0,i=e;r<i.length;r++){var o=i[r];a.ignoreWhitespace&&(o=o.replace(/\s+$/g,"").replace(/^\s+/g,"")),c.hasOwnProperty(o)?t[n]=c[o]:(++u,t[n]=u,c[o]=u),n++}return t}for(var f=new s(2*o+1),d=-1,h=0;h<=o;h++)null!=F(h,f)&&(d=h);if(-1==d)return null;var m=[],g=null;for(h=0;h<=d;h++){var v=m.length?m[m.length-1].slice(0):new s(2*d+1);if(m.push(v),null!=(g=F(h,v)))break}var b=[],y=g;for(h=m.length-1;0<=h;h--){for(var w=m[h],x=0,k=0,A=(x=y==-h||y!=h&&w[o+y-1]<w[o+y+1]?w[o+(k=y+1)]:w[o+(k=y-1)]+1)-y,T=w[o+y]-x-1;0<=T;--T)b.push("  "+r[A+T]);k==y-1?b.push("- "+n[x-1]):0<A&&b.push("+ "+r[A-1]),y=k}if(b.reverse(),a.context==1/0||a.full)return b;for(var C=1,E=1,S=0,_=[],I=a.context||3;S<b.length;){for(var P=S;P<b.length&&" "==b[P][0];)P++;if(P==b.length)break;var U=P-I,O=U-S;0<O&&(C+=O,E+=O,S=U);var R=_.length,N=C,D=E;_.push("@@");for(var L=S,M=0;L<b.length;){if(" "==b[L][0]){if(2*I+2<++M){L-=I+2;break}}else M=0;L++}for(;S<L;){switch(_.push(b[S]),b[S][0]){case"-":C++;break;case"+":E++;break;case" ":C++,E++}S++}_[R]="@@ -"+N+","+(C-N)+" +"+D+","+(E-D)+" @@"}return _;function F(e,t){for(var n=-e;n<=e;n+=2){for(var r=0,i=(r=n==-e||n!=e&&t[o+n-1]<t[o+n+1]?t[o+n+1]:t[o+n-1]+1)-n;r<l.length&&i<p.length&&l[r]==p[i];)r++,i++;if((t[o+n]=r)>=l.length&&i>=p.length)return n}return null}}function o(e){return B(e).map(function(e){return e.replace(/;\s*$/,"")}).join("\n")}function y(e){var t=/^@@ -(\d+),(\d+) \+(\d+),(\d+)/.exec(e);return t&&{oldStart:parseInt(t[1])-1,oldLength:parseInt(t[2]),newStart:parseInt(t[3])-1,newLength:parseInt(t[4])}}e.toLines=B,e.compute=b,e.diff3=function(e,c,t,n,r){var i=v(e),o=v(t);if(i&&o){for(var a=B(e),s=B(t),u=0,l=[],p=0,f=0,d=0;d<i.length-1;)if(i[d]==p&&o[d]==f)l.push(a[p]),p++,f++,d++;else{for(var h=!0,m=!0,g=d;g<i.length&&(i[g]!=p+g-d&&(h=!1),o[g]!=f+g-d&&(m=!1),null==i[g]||null==o[g]);)g++;if(w.U.assert(g<i.length),h)for(;f<o[g];)l.push(s[f++]);else if(m)for(;p<i[g];)l.push(a[p++]);else if(a.slice(p,i[g]).join("\n")==s.slice(f,o[g]).join("\n"))for(;p<i[g];)l.push(a[p++]);else{for(u++,l.push("<<<<<<< "+n);p<i[g];)l.push(a[p++]);for(l.push("=======");f<o[g];)l.push(s[f++]);l.push(">>>>>>> "+r)}p=i[d=g],f=o[g]}return{merged:l.join("\n"),numConflicts:u}}function v(e){var t=b(c,e,{context:1/0});if(t){for(var n=[],r=0,i=0,o=0,a=t;o<a.length;o++){var s=a[o];"+"==s[0]?r++:"-"==s[0]?(n[i]=null,i++):" "==s[0]?(n[i]=r,r++,i++):w.U.oops()}return n.push(r+1),n}}},e.removeTrailingSemiColumns=o,e.split=function(e,t){var n=e.split(/-{10,}/,2);if(n.length<2)return{fileA:e,fileB:void 0};var r=n[0].replace(/\n$/,""),i=n[1].replace(/^\n/,"");return t&&t.removeTrailingSemiColumns&&(r=o(r),i=o(i)),{fileA:r,fileB:i}},e.parseDiffMarker=y,e.render=function(e,t,l){void 0===l&&(l={});var p=b(e,t,l);if(!p)return w.dom.el("div",null,pxtc.Util.lf("Too many differences to render diff."));var f={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},d=0,h=0,m="",g=w.dom.el("tbody"),n=w.dom.el("table",{class:"diffview "+(l.update?"update":"")},g),v=null;return p.forEach(function(e,t){var n=y(e);n?(d=n.oldStart,h=n.newStart):("+"!=e[0]&&d++,"-"!=e[0]&&h++);var r=p[t+1]?p[t+1][0]:"",i=p[t+2]?p[t+2][0]:"",o=e.slice(2),a=w.dom.el("code",null,o);if(v)a=v,v=null;else if(!("-"!=e[0]||" "!=m&&"@"!=m||"+"!=r||" "!=i&&"@"!=i&&""!=i)){var s=function(e,t){var n=b(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!n)return{a:w.dom.el("div",{class:"inline-diff"},w.dom.el("code",null,e)),b:w.dom.el("div",{class:"inline-diff"},w.dom.el("code",null,t))};for(var r=[],i=[],o=0;o<n.length;){for(var a=o,s=n[o][0];n[a]&&n[a][0]==s;)a++;var c=n.slice(o,a).map(function(e){return e.slice(2)}).join("");" "==s?(r.push(w.dom.el("code",{class:"ch-common"},c)),i.push(w.dom.el("code",{class:"ch-common"},c))):"-"==s?r.push(w.dom.el("code",{class:"ch-removed"},c)):"+"==s?i.push(w.dom.el("code",{class:"ch-added"},c)):w.Util.oops(),o=a}return{a:w.dom.el("div",{class:"inline-diff"},r),b:w.dom.el("div",{class:"inline-diff"},i)}}(e.slice(2),p[t+1].slice(2));a=s.a,v=s.b}if(m=e[0],!(l.hideMarkerLine&&"@"==m||l.hideRemoved&&"-"==m)){var c="@"==m,u=""+f[m];g.appendChild(w.dom.el("tr",{class:u},[!l.hideLineNumbers&&w.dom.el("td",{class:"line-a","data-content":d}),!l.hideLineNumbers&&w.dom.el("td",{class:"line-b","data-content":h}),c&&w.dom.el("td",{colspan:2,class:"change"},w.dom.el("code",null,e)),!l.hideMarker&&!c&&w.dom.el("td",{class:"marker","data-content":m}),!c&&w.dom.el("td",{class:"change"},a)]))}}),n},e.resolveMergeConflictMarker=function(e,t,n,r){for(var i=w.diff.toLines(e),o=t;o<i.length&&!/^<<<<<<<[^<]/.test(i[o]);)o++;for(var a=o+1;a<i.length&&!/^=======$/.test(i[a]);)a++;for(var s=a+1;s<i.length&&!/^>>>>>>>[^>]/.test(i[s]);)s++;if(s>=i.length)return w.debug("diff marker mistmatch: "+i.length+" -> "+o+" "+a+" "+s),e;if(i[o]=void 0,i[a]=void 0,i[s]=void 0,!n)for(var c=o;c<=a;++c)i[c]=void 0;if(!r)for(c=a;c<=s;++c)i[c]=void 0;return i.filter(function(e){return void 0!==e}).join("\n")},e.mergeDiff3Config=function(e,t,n){var r=w.Util.jsonTryParse(e),i=w.Util.jsonTryParse(t),o=w.Util.jsonTryParse(n);if(r&&!o)return e;if(!r)return n||t;if(!i&&o&&(i=o),r&&i&&o){delete r.installedVersion,delete i.installedVersion,delete o.installedVersion;for(var a={},s=0,c=w.U.unique(Object.keys(i).concat(Object.keys(r)).concat(Object.keys(o)),function(e){return e});s<c.length;s++){var u=c[s],l=r[u],p=i[u],f=o[u];if(JSON.stringify(l)==JSON.stringify(f))void 0!==l&&(a[u]=l);else switch(u){case"name":a[u]=(g=f,(h=l)==(m=p)?g:g==m?h:h==lf("Untitled")?g:h);break;case"version":a[u]=0<w.semver.strcmp(l,f)?l:f;break;case"languageRestriction":case"preferredEditor":case"targetVersion":a[u]=l;break;case"public":a[u]=l&&f;break;case"files":case"testFiles":if(!(d=v(l||[],p||[],f||[])))return;a[u]=d.length?d:void 0;break;case"dependencies":case"testDependencies":var d=b(l||{},p||{},f||{});if(Object.keys(d).length)return;a[u]=d;break;case"description":if(l&&!f)a[u]=l;else{if(l||!f)return;a[u]=f}break;default:return}}return w.Package.stringifyConfig(a)}var h,m,g;function v(e,t,n){for(var r=[],i=0,o=w.U.unique(t.concat(e).concat(n),function(e){return e});i<o.length;i++){var a=o[i],s=-1<e.indexOf(a),c=-1<n.indexOf(a),u=-1<t.indexOf(a);s==c?s&&r.push(a):c==u?s&&r.push(a):c&&r.push(a)}return r}function b(e,t,n){for(var r={},i=0,o=w.U.unique(Object.keys(t).concat(Object.keys(e)).concat(Object.keys(n)),function(e){return e});i<o.length;i++){var a=o[i],s=e[a],c=n[a],u=t[a];if(s==c)s&&(r[a]=s);else{var l=w.github.parseRepoId(s),p=w.github.parseRepoId(c);if(l&&p&&w.semver.tryParse(l.tag)&&w.semver.tryParse(p.tag)&&l.owner&&l.project&&l.owner==p.owner&&l.project==p.project){var f=0<w.semver.strcmp(l.tag,p.tag)?l.tag:p.tag;r[a]="github:"+l.owner+"/"+l.project+"#"+f}else c==u?s&&(r[a]=s):c&&(r[a]=c)}}return r}},e.hasMergeConflictMarker=function(e){return e&&/^(<<<<<<<[^<]|>>>>>>>[^>])/m.test(e)},e.reconstructConfig=function(t,e,n){var r={},i=e.tree.tree.map(function(e){return e.path}).filter(function(e){return/\.(ts|blocks|md|jres|asm|json)$/.test(e)}).filter(function(e){return e!=w.CONFIG_NAME});return i.find(function(e){return/\.ts$/.test(e)})||(n.config.files.filter(function(e){return i.indexOf(e)<0}).forEach(function(e){i.push(e),t[e]=n.files[e]}),w.Util.jsonCopyFrom(r,n.config.dependencies)),Object.keys(r).length||(r[w.appTarget.corepkg]="*"),{name:"",files:i,dependencies:r,preferredEditor:i.find(function(e){return/.blocks$/.test(e)})?w.BLOCKS_PROJECT_NAME:w.JAVASCRIPT_PROJECT_NAME}}}(w.diff||(w.diff={}))}(pxt||(pxt={})),function(r){var e;(e=r.discourse||(r.discourse={})).extractSharedIdFromPostUrl=function(e){return r.Util.httpGetJsonAsync(e+".json").then(function(e){return e.post_stream&&e.post_stream.posts&&e.post_stream.posts[0]&&e.post_stream.posts[0].link_counts.map(function(e){return r.Cloud.parseScriptId(e.url)}).filter(function(e){return!!e})[0]})},e.topicsByTag=function(n,e){var t=(n=n.replace(/\/$/,""))+"/tags/"+e+".json";return r.Util.httpGetJsonAsync(t).then(function(e){var t=r.Util.toDictionary(e.users,function(e){return e.id.toString()});return e.topic_list.topics.map(function(e){return{id:e.id,title:e.title,url:n+"/t/"+e.slug+"/"+e.id,imageUrl:e.image_url,author:t[e.posters[0].user_id].username,cardType:"forumUrl"}})})}}(pxt||(pxt={})),function(u){!function(E){var S,P=pxtc.Util,U={},O={},e="\x3c!-- @CMD@ @ARGS@ --\x3e",R={parent:e,short:e,description:"\x3c!-- desc --\x3e",activities:"\x3c!-- activities --\x3e",explicitHints:"\x3c!-- hints --\x3e",flyoutOnly:"\x3c!-- flyout --\x3e",hideIteration:"\x3c!-- iter --\x3e",codeStart:"\x3c!-- start --\x3e",codeStop:"\x3c!-- stop --\x3e",autoOpen:"\x3c!-- autoOpen --\x3e"};function t(e,t,n){return e.split(t).join(n)}function n(e){return e=t(e=t(e=t(e=t(e=t(e,"&","&amp;"),"<","&lt;"),">","&gt;"),'"',"&quot;"),"'","&#39;")}function N(e){return e?n(e.replace(/\&([#a-z0-9A-Z]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}})):e}E.htmlQuote=n,E.html2Quote=N;var _=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}];E.requireMarked=function(){return"undefined"!=typeof marked?marked:"undefined"!=typeof require?require("marked"):void 0},E.requireDOMSanitizer=function(){return"undefined"!=typeof DOMPurify?DOMPurify.sanitize:"undefined"!=typeof require?require("DOMPurify").sanitize:void 0};var D=function(e){return"<div class='ui negative message'>"+n(e)+"</div>"};function I(i){var o=P.clone(U),a=P.clone(O),s=P.clone(R),c={},u={},e=i.params,t=i.theme;i.boxes=o,i.macros=a,i.settings=s,i.html=i.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,function(e,t,n){var r=function(e){for(var t={};e.trim();){var n=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(e);if(n){var r=n[3]||n[4]||n[5]||"";t[n[1].toLowerCase()]=r}else t[(n=/^\s*(\S+)/.exec(e))[1]]="true";e=e.slice(n[0].length)}return t}(t),i=r["data-name"]||r.id;return i?(/box/.test(r.class)?o[i]=n:/aside/.test(r.class)?o[i]="\x3c!-- BEGIN-ASIDE "+i+" --\x3e"+n+"\x3c!-- END-ASIDE --\x3e":/setting/.test(r.class)?s[i]=n:/menu/.test(r.class)?c[i]=n:/toc/.test(r.class)?u[i]=n:a[i]=n,"\x3c!-- macro "+i+" --\x3e"):D("id or data-name missing on macro")});var l=function(e,t){var n=c.item,r={NAME:e.name};if(e.subitems)n=c["toc-dropdown"]?c["toc-dropdown"]:0==t?c["top-dropdown"]:c["inner-dropdown"],r.ITEMS=e.subitems.map(function(e){return l(e,t+1)}).join("\n");else{if(/^-+$/.test(e.name)&&(n=c.divider),e.path&&!/^(https?:|\/)/.test(e.path))return D("Invalid link: "+e.path);r.LINK=e.path}return F(n,r,["ITEMS"])},p=[{name:lf("Docs"),href:"/docs"}],n=i.TOC||t.TOC||[],f=[],d=function(e){for(var t=0,n=e.subitems||[];t<n.length;t++){var r=n[t];if(d(r))return f.push(e),!0}return!(!i.filepath||!e.path||0!=i.filepath.indexOf(e.path))&&(f.push(e),!0)};n.forEach(d);var h=function(e,t){var n=u.item,r={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?D("Invalid link: "+e.path):(/^\//.test(e.path)&&i.versionPath&&(e.path="/"+i.versionPath+e.path),r.LINK=e.path,0<=f.indexOf(e)?(r.ACTIVE="active",r.EXPANDED="true",p.push({name:e.name,href:e.path})):r.EXPANDED="false",e.subitems&&0<e.subitems.length?(n=u["toc-dropdown"]?""!==e.name?u["toc-dropdown"]:u["toc-dropdown-noLink"]:0==t?""!==e.name?u["top-dropdown"]:u["top-dropdown-noHeading"]:1==t?u["inner-dropdown"]:u["nested-dropdown"],r.ITEMS=e.subitems.map(function(e){return h(e,t+1)}).join("\n")):/^-+$/.test(e.name)&&(n=u.divider),F(n,r,["ITEMS"]))};e.menu=(t.docMenu||[]).map(function(e){return l(e,0)}).join("\n"),e.TOC=n.map(function(e){return h(e,0)}).join("\n"),t.appStoreID&&(e.appstoremeta='<meta name="apple-itunes-app" content="app-id='+P.htmlEscape(t.appStoreID)+'"/>');var r="";1<p.length&&(r='\n            <nav class="ui breadcrumb" aria-label="'+lf("Breadcrumb")+'">\n                '+p.map(function(e,t){return'<a class="'+(t==p.length-1?"active":"")+' section"\n                        href="'+N(e.href)+'" aria-current="'+(t==p.length-1?"page":"")+'">'+N(e.name)+"</a>"}).join('<i class="right chevron icon divider"></i>')+"\n            </nav>"),e.breadcrumb=r,t.boardName&&(e.boardname=N(t.boardName)),t.boardNickname&&(e.boardnickname=N(t.boardNickname)),t.driveDisplayName&&(e.drivename=N(t.driveDisplayName)),t.homeUrl&&(e.homeurl=N(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.docsheader=t.docsHeader||"Documentation",e.targetlogo=t.docsLogo?'<img aria-hidden="true" role="presentation" class="ui '+(t.logoWide?"small":"mini")+' image" src="'+t.docsLogo+'" />':"";var m=i.ghEditURLs||[];if(m.length){for(var g='<p style="margin-top:1em">\n',v=lf("Edit this page on GitHub"),b=0,y=m;b<y.length;b++){g+='<a href="'+y[b]+'"><i class="write icon"></i>'+v+"</a><br>\n",v=lf("Edit template of this page on GitHub")}g+="</p>\n",e.github=g}else e.github="";var w='\n            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">'+lf("Skip to main content")+"</a>\n        ";e.accMenu=w;var x=lf("Print this page"),k='\n            <button id="printbtn" class="circular ui icon right floated button hideprint" title="'+x+'" aria-label="'+x+'">\n                <i class="icon print"></i>\n            </button>\n        ';e.printBtn=k;var A='\n            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="'+lf("Side menu")+'" role="menuitem" aria-expanded="false">\n                <i class="content icon"></i>\n            </a>\n        ';e.sidebarToggle=A;var T=["tocsearch1","tocsearch2"].map(function(e){return'\n                <input type="search" name="q" placeholder="'+lf("Search...")+'" aria-label="'+lf("Search Documentation")+'">\n                <i onclick="document.getElementById(\''+e+'\').submit();" tabindex="0" class="search link icon" aria-label="'+lf("Search")+'" role="button"></i>\n            '});e.searchBar1=T[0],e.searchBar2=T[1];var C="";t.accentColor&&(C+="\n.ui.accent { color: "+t.accentColor+"; }\n.ui.inverted.accent { background: "+t.accentColor+"; }\n"),e.targetstyle=C,e.tocclass=t.lightToc?"lighttoc":"inverted";for(var E=0,S=Object.keys(t);E<S.length;E++){var _=S[E],I=t[_];void 0===e[_]&&"string"==typeof I&&(e[_]=I)}i.finish=function(){return F(i.html,e,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}}function L(e){e.image=function(e,t,n){var r='<img class="ui image" src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=' loading="lazy"',r+=this.options.xhtml?"/>":">"},e.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?'<li class="'+(" "==t[1]?"unchecked":"checked")+'">'+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"},e.heading=function(e,t,n){var r=/(.*)#([\w\-]+)\s*$/.exec(e),i="";return r?(e=r[1],i=r[2]):i=n.toLowerCase().replace(/[^\w]+/g,"-"),e&&(e=e.replace(/@(fullscreen|unplugged)/g,"")),"<h"+t+' id="'+this.options.headerPrefix+i+'">'+e+"</h"+t+">"}}function M(e,i){return e.replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,function(e,t,n,r){return"ifdef"==t&&i[n]||"ifndef"==t&&!i[n]?"\x3c!-- "+t+" "+n+" --\x3e"+r+"\x3c!-- endif --\x3e":"\x3c!-- "+t+" "+n+" endif --\x3e"})}function F(e,r,i){return void 0===i&&(i=[]),e?e.replace(/@(\w+)@/g,function(e,t){var n=P.lookup(r,t)||"";return n+="",i.indexOf(t)<0&&(n=N(n)),n}):""}E.prepTemplate=I,E.setupRenderer=L,E.renderConditionalMacros=M,E.renderMarkdown=function(f){var e=!0;f.pubinfo||(e=!1,f.pubinfo={});var d=f.pubinfo;if(f.theme||(f.theme={}),delete f.pubinfo.private,d.time){var t=parseInt(d.time);d.timems||(d.timems=1e3*t+""),d.humantime||(d.humantime=P.isoTime(t))}d.name&&(d.dirname=d.name.replace(/[^A-Za-z0-9_]/g,"-"),d.title=d.name),e&&(d.JSON=JSON.stringify(d,null,4).replace(/</g,"\\u003c"));var n=f.template;n=M(n=n.replace(/<!--\s*@include\s+(\S+)\s*-->/g,function(e,t){return"\x3c!-- include "+t+" --\x3e\n"+((f.theme.htmlDocIncludes||{})[t]||"")+"\n\x3c!-- end include --\x3e\n"}),d),f.locale&&(n=B(n,f.locale).text);var h={html:n,theme:f.theme,filepath:f.filepath,versionPath:f.versionPath,ghEditURLs:f.ghEditURLs,params:d,TOC:f.TOC};I(h),S||(S=E.requireMarked());var o=new S.Renderer;L(o);var a=o.link;o.link=function(e,t,n){var r=new RegExp("^[/#]").test(e),i=r?"":"_blank";return r&&h.versionPath&&(e="/"+h.versionPath+e),a.call(o,e,t,n).replace(/^<a /,"<a "+(i?'target="'+i+'"':"")+' rel="nofollow noopener" ')};var r=E.requireDOMSanitizer();S.setOptions({renderer:o,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:r,smartLists:!0,smartypants:!0});var i=f.markdown;f.repo&&(i+="\n```package\n"+f.repo.name.replace(/^pxt-/,"")+"=github:"+f.repo.fullName+"#"+(f.repo.tag||"master")+"\n```\n"),i=(i=i.replace(/^\s*https?:\/\/(\S+)\s*$/gm,function(e,t){for(var n=function(e){var n=e.rx.exec(t);if(n)return{value:e.cmd.replace(/\$(\d+)/g,function(e,t){return n[parseInt(t)]||""})+"\n"}},r=0,i=_;r<i.length;r++){var o=n(i[r]);if("object"==typeof o)return o.value}return e})).replace(/@([a-z]+)@/gi,function(e,t){var n=d[t];return!n&&f.throwOnError&&P.userError("unknown macro "+t),n||"unknown macro"});var s=S(i);s=(s=s.replace(/&lt;br\s*\/&gt;/gi,"<br/>")).replace(/(<img [^>]* src=")\/docs\/static\/([^">]+)"/g,function(e,t,n){return t+"/static/"+n+'"'});var m="",g=0;function v(e,t,n){var r=n;return e<=g&&(r=m+r,m="",g=0),r}if(s=s.replace(/<h(\d)[^>]+>\s*([~@])?\s*(.*?)<\/h\d>/g,function(e,t,n,r){var i=/^(\w+)\s+(.*)/.exec(r),o=i?i[1]:r,a=i?i[2]:"";if(a=N(a),o=N(o),t=parseInt(t),n){if("@"==n){var s=P.lookup(h.settings,o);if(null!=s)d[o]=a;else if(null==(s=P.lookup(h.macros,o)))return f.throwOnError&&P.userError("Unknown command: @"+o),D("Unknown command: @"+o);return v(t,0,F(s,{ARGS:a,CMD:o},["ARGS","CMD"]))}if(!o){var c=m;return m="",c}var u=P.lookup(h.boxes,o);if(u){var l=u.split("@BODY@");c=v(t,0,l[0].replace("@ARGS@",a)),m=l[1];var p=u.match(/data-[^>\s]+/gi);return p&&0<=p.indexOf("data-inferred")&&(g=t),c}return f.throwOnError&&P.userError("Unknown box: ~ "+o),D("Unknown box: ~ "+o)}return v(t,0,e)}),m&&(s+=m),!d.title){var c=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(s);c&&(d.title=N(c[1]))}if(!d.description){var u=/<p>([^]+?)<\/p>/.exec(s);u&&(d.description=N(u[1]))}var l=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(s)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(s);l&&(d.cardLogo=N(l[1])),d.twitter=N(f.theme.twitter||"@msmakecode");var p,b,y={main:""};s=(s=s.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,function(e,t,n){var r=P.lookup(y,t);return y[t]=(r||"")+n,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),y.main=s,s="";for(var w=0,x=Object.keys(y);w<x.length;w++){var k=x[w];s+=(p=k+"-container",b=y[k],F(h.boxes[p]||"@BODY@",{BODY:b},["BODY"]))}d.body=s,d.name=d.title||"";for(var A=0,T=Object.keys(f.theme);A<T.length;A++){k=T[A];var C=f.theme[k];"string"==typeof C&&(d["theme_"+k]=C)}return h.finish()},E.embedUrl=function(e,t,n,r){return'<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"#"+t+":"+n+'" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>'},E.runUrl=function(e,t,n){return'<div style="position:relative;height:0;padding-bottom:'+t+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"?id="+encodeURIComponent(n)+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>'},E.codeEmbedUrl=function(e,t,n){var r=e+"---codeembed#pub:"+t;return'<div style="position:relative;height:calc('+(n=Math.ceil(n||300))+'px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+r+'" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-scripts allow-same-origin"></iframe></div>'};var c={b:1,strong:1,em:1};function B(e,i){var o={};function a(e){var t=/^(\s*)([^]*?)(\s*)$/.exec(e),n=t[2].replace(/\s+/g," ");if(""==n||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(n))return null;var r=P.lookup(i,n);return r?n=r:o[n]="",t[1]+n+t[3]}function s(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}return{text:e=(e=(e=(e="<start>"+(e=e.replace(/<([\/\w]+)([^<>]*)>/g,function(e,t,n){var r=t.replace(/^\//,"").toLowerCase();return 1===c[r]?"&llt;"+t+n+"&ggt;":e}))).replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,function(e,t,n,r,i){if("script"==n||"style"==n)return s(e);var o=a(s(i));return null==o?s(e):t+o})).replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,function(e,t,n,r){return null==a(r)?e:t+n+'="'+r.replace(/"/g,"''")+'"'})).replace(/^<start>/g,""),missing:o}}function v(e,a){for(var s=0,c=[{level:0,id:"",title:"",start:s,text:"",children:[]}],t=(e=e.replace(/\r/g,"")).split(/\n/),u={},n=function(e){var t=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(e),n=null;if(a&&t)if(t[4])if(u[t[4]])t=null;else{n=function e(t,n){if(t.id==n)return t;for(var r=0,i=t.children;r<i.length;r++){var o=e(i[r],n);if(o)return o}return null}(a,t[4]);var r=function(e){e.id&&(u[e.id]=!0),e.children.forEach(r)};n&&r(n)}else t=null;if(t){var i={level:a?1:t[1].length,title:t[2].trim(),id:t[4]||"",start:s,text:"",children:[]};if(n){e="";for(var o=0;o<n.level;++o)e+="#";e+=" ",e+=i.title||n.title,e+=" #"+i.id}for(;c[c.length-1].level>=i.level;)c.pop();c[c.length-1].children.push(i),c.push(i)}c[c.length-1].text+=e+"\n",s++},r=0,i=t;r<i.length;r++){n(i[r])}return c[0]}E.translate=B,E.buildTOC=function(e){if(!e)return null;var t=u.docs.requireMarked(),n=E.requireDOMSanitizer(),r={renderer:new t.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:n,smartLists:!1,smartypants:!1},i={name:"dummy",subitems:[]},o=[];o.push(i);var a=t.lexer(e,r),s=!1;a.forEach(function(e){switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":return s=!0,void o.push({name:"",path:"",subitems:[]});case"text":var r=o[o.length-1];0<=e.text.indexOf("[")?e.text.replace(/\[(.*?)\]\((.*?)\)/i,function(e,t,n){r.name=t,r.path=n.replace(".md","")}):s&&(r.name=e.text);break;case"list_item_end":case"loose_item_end":var t=o.pop();o[o.length-1].subitems.push(t)}s=!1});var c=i.subitems;return c&&0!=c.length?c:null};var b=!(E.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})});function y(e,t){if(b||function(){function e(e,t,n){var r=y(e,t).trim();if(n=n.trim(),r!=n)throw console.log("*** Template:\n"+e+"\n*** Input:\n"+t+"\n*** Expected:\n"+n+"\n*** Output:\n"+r),new Error("augment docs test fail")}b=!0;var t="\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nTEx2\n### Example 3\nTEx3\n\n## See also #also\nTAlso\n";e(t,"",t),e(t," ",t),e(t,"\n# @extends\n# #ex2\nMy example\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nMy example\n### Example 3\nTEx3\n\n## See Also These! #also\nMy links\n"),e(t,"\n# @extends\n### #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n")}(),!t)return e;for(var n=v(e,null),r=v(t,n),i={},o={},a=0,s=r.children;a<s.length;a++){var c=s[a];P.assert(0==c.children.length),P.assert(!!c.id),i[c.id]=c.text}var u=function(e){e.id&&void 0!==i[e.id]&&(o[e.id]=!0,e.text=i[e.id],e.children=[]),e.children.forEach(u)};u(n);var l="",p=function(e){l+=e.text,e.children.forEach(p)};p(n);var f="",d=r.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");d.trim()&&(f+=d.trim()+"\n");for(var h=0,m=r.children;h<m.length;h++){var g=m[h];o[g.id]||(f+=g.text)}return f&&(l+="## Couldn't apply replacement logic to:\n"+f),l}E.augmentDocs=y}(u.docs||(u.docs={}))}(pxt||(pxt={})),function(e){(e.dom||(e.dom={})).el=function(e,t,n){var r=document.createElement(e);return t&&Object.keys(t).forEach(function(e){return r.setAttribute(e,t[e]+"")}),function t(e){Array.isArray(e)?e.forEach(function(e){return t(e)}):"string"==typeof e?r.appendChild(document.createTextNode(e)):e instanceof HTMLElement&&r.appendChild(e)}(n),r}}(pxt||(pxt={})),function(d){!function(e){function l(e){var t=/```package\s+((.|\s)+?)\s*```/i.exec(e),n=void 0;return t&&(n={},t[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).forEach(function(e){return n[e[0]]=e[1]||"*"})),n}function p(e){var t=/```config\s+((.|\s)+?)\s*```/i.exec(e),n=[];return t&&t[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).filter(function(e){return"feature"==e[0]&&!!e[1]}).forEach(function(e){return n.push(e[1])}),n.length?n:void 0}function f(e){var t=/```jres\s+((.|\s)+?)\s*```/i.exec(e);if(t){var n=t[1],r=JSON.parse(n);return{jres:n,ts:d.emitTilemapsFromJRes(r)}}}function t(e){if(!e)return[];var n=[],r=!1,i=void 0,o="";return e.split(/\r?\n/).forEach(function(e){if(/^##/.test(e))i=e.substr(2).trim();else if(/^```codecard$/.test(e))r=!0;else if(/^```$/.test(e)){if(r=!1,i&&o)try{var t=JSON.parse(o);t&&0<t.length&&n.push({name:i,cards:t})}catch(e){d.log("invalid card format in gallery")}o="",i=void 0}else r&&(o+=e+"\n")}),n.forEach(function(e){return e.cards.forEach(function(t){if(t.otherActions&&!t.otherActions.length&&("tutorial"==t.cardType||"example"==t.cardType)){var e=["js"];d.appTarget.appTheme.python&&e.unshift("py"),t.otherActions=e.map(function(e){return{url:t.url,cardType:t.cardType,editor:e}})}})}),n}e.parsePackagesFromMarkdown=l,e.parseFeaturesFromMarkdown=p,e.parseJResFromMarkdown=f,e.parseExampleMarkdown=function(e,t){var n;if(t){var r=/```(blocks?|typescript|python|spy|sim)\s+((.|\s)+?)\s*```/i.exec(t);if(r){var i=l(t),o=r[1],a=r[2],s=p(t),c=f(t),u={name:e,filesOverride:(n={"main.blocks":'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>'},n["python"===r[1]?"main.py":"main.ts"]=a,n),dependencies:i,features:s,snippetType:o,source:a};return c&&(u.filesOverride[d.TILEMAP_JRES]=c.jres,u.filesOverride[d.TILEMAP_CODE]=c.ts),u}}},e.parseGalleryMardown=t,e.loadGalleryAsync=function(e){return d.Cloud.markdownAsync(e).then(function(e){return t(e)})}}(d.gallery||(d.gallery={}))}(pxt||(pxt={})),function(c){var e=function(){function e(e){var t=this;this.io=e,this.q=new c.U.PromiseQueue,this.dataBuf="",this.numSent=0,this.pktSize=400,this.trace=!1,this.bmpMode=!0,this.targetInfo="",this.onEvent=function(e){},this.io.onData=function(e){return t.onData(e)}}return e.prototype.onData=function(e){for(this.dataBuf+=c.U.uint8ArrayToString(e);0<this.dataBuf.length;){var t=this.dataBuf[0];if("+"==t)this.dataBuf=this.dataBuf.slice(1);else if("$"==t||"%"==t){var n=this.decodeResp(this.dataBuf.slice(1));if(null==n)break;"$"==t?(this.io.sendPacketAsync(this.buildCmd("+")).done(),this.onResponse?this.onResponse(n):0<this.numSent&&this.io.error("unexpected response: "+n)):this.onEvent(n)}else this.io.error("invalid character: "+t)}},e.prototype.buildCmd=function(e){if("+"==e)return c.U.stringToUint8Array(e);for(var t="",n=0;n<e.length;++n){var r=e.charAt(n);"}"==r||"#"==r||"$"==r?(t+="}",t+=String.fromCharCode(32^r.charCodeAt(0))):t+=r}var i=0;e=t;for(n=0;n<e.length;++n)i=i+e.charCodeAt(n)&255;return t="$"+e+"#"+("0"+i.toString(16)).slice(-2),c.U.stringToUint8Array(t)},e.prototype.decodeResp=function(e){for(var t="",n=0;n<e.length;++n){var r=e[n];if("}"==r)++n,t+=String.fromCharCode(32^e.charCodeAt(n));else if("*"==r){++n;for(var i=e.charCodeAt(n)-29,o=t.charAt(t.length-1);0<i--;)t+=o}else{if("#"==r)return 2==e.slice(n+1,n+3).length?(this.dataBuf=e.slice(n+3),t):null;t+=r}}return null},e.prototype.sendCmdOKAsync=function(e){return this.sendCmdAsync(e,function(e){return"OK"==e})},e.prototype.error=function(e){this.io.error(e),this.io.disconnectAsync().done()},e.prototype.sendCmdAsync=function(n,r){var i=this;this.numSent++;var e=this.buildCmd(n);return this.q.enqueue("one",function(){return null===r?i.io.sendPacketAsync(e).then(function(){return null}):new Promise(function(t){i.onResponse=function(e){i.onResponse=null,i.trace&&c.log("GDB: '"+n+"' -> '"+e+"'"),void 0===r||r(e)||i.error("Invalid GDB command response: '"+n+"' -> '"+e+"'"),t(e)},i.io.sendPacketAsync(e).done()})})},e.prototype.sendRCmdAsync=function(e){return this.sendMCmdAsync("qRcmd,"+(t=e,c.U.toHex(c.U.stringToUint8Array(t))));var t},e.prototype.sendMCmdAsync=function(r){var i=this;this.numSent++;var e=this.buildCmd(r),o="";return this.q.enqueue("one",function(){return new Promise(function(n){i.onResponse=function(e){var t;"OK"!=e&&"O"==e[0]?o+=(t=e.slice(1),c.U.uint8ArrayToString(c.U.fromHex(t))):("OK"!=e&&(o+=" - "+e),i.onResponse=null,i.trace&&c.log("Final GDB: '"+r+"' -> '"+o+"'"),n(o))},i.io.sendPacketAsync(e).done()})})},e.prototype.write32Async=function(e,t){var n=new Uint8Array(4);return c.HF2.write32(n,0,t),this.writeMemAsync(e,n)},e.prototype.writeMemAsync=function(e,t){var n=this.pktSize/2-10;return c.U.assert(t.length<n),this.sendCmdOKAsync("M"+e.toString(16)+","+t.length.toString(16)+":"+c.U.toHex(t)).then(function(e){console.log(e)})},e.prototype.readMemAsync=function(e,r){var i=this,o=this.pktSize/2-6;if(o<r){var a=new Uint8Array(r),s=function(t){var n=Math.min(r-t,o);return 0==n?Promise.resolve(a):i.readMemAsync(e+t,n).then(function(e){return c.U.memcpy(a,t,e),s(t+n)})};return s(0)}return this.sendCmdAsync("m"+e.toString(16)+","+r.toString(16)).then(function(e){return c.U.fromHex(e)})},e.prototype.initBMPAsync=function(){var t=this;return Promise.resolve().then(function(){return t.sendRCmdAsync("swdp_scan")}).then(function(e){return t.targetInfo=e,t.sendCmdAsync("vAttach;1",function(e){return"T"==e[0]})}).then(function(){})},e.prototype.initAsync=function(){var t=this;return Promise.delay(1e3).then(function(){return t.sendCmdAsync("!")}).then(function(){return t.sendCmdAsync("qSupported")}).then(function(e){var r={};return e=(e=";"+e+";").replace(/;([^;]+)[=:]([^:;]+)/g,function(e,t,n){return r[t]=n,";"}),t.pktSize=parseInt(r.PacketSize)||1024,c.log("GDB-server caps: "+JSON.stringify(r)+" "+e.replace(/;+/g,";")),t.bmpMode?t.initBMPAsync():t.sendCmdAsync("c").then(function(){})})},e}();c.GDBServer=e}(pxt||(pxt={})),function(O){!function(u){function l(){var e,t,n;return!!u.forceProxy||!O.U.isNodeJS&&(null===(n=null===(t=null===(e=O)||void 0===e?void 0:e.appTarget)||void 0===t?void 0:t.cloud)||void 0===n?!0:!n.noGithubProxy)}u.token=null,u.forceProxy=!1;var i={};function o(i){var e;return i.method=null!=(e=i.method)?e:"GET",function n(e){var t;var r=O.U.clone(i);u.token&&(r.headers||(r.headers={}),r.url==P?r.headers.Authorization="bearer "+u.token:(r.url=O.BrowserUtils.cacheBustingUrl(r.url),r.headers.Authorization="token "+u.token));r.allowHttpErrors=(t=r.allowHttpErrors,null!=t&&t);return O.U.requestAsync(r).catch(function(e){if(O.tickEvent("github.error",{statusCode:e.statusCode}),u.handleGithubNetworkError){var t=u.handleGithubNetworkError(r,e);if(t)return n(!1)}throw e})}(u.token)}function p(e){return o({url:e,method:"GET"}).then(function(e){return e.json})}function s(e){return O.Cloud.apiRequestWithCdnAsync({url:"gh/"+e,forceLiveEndpoint:!0}).then(function(e){return e.json})}function c(e){O.log("github proxy error: "+e.message),O.debug(e)}u.isOrgAsync=function(e){return p("https://api.github.com/orgs/"+e).then(function(e){return 200==e.statusCode})};var f,e,t=function(){function e(){this.configs={},this.packages={}}return e.prototype.proxyWithCdnLoadPackageAsync=function(e,t){var n=this,r=e+"/"+t,i=this.packages[r];return i?(O.debug("github cache "+e+"/"+t+"/text"),Promise.resolve(i)):s(e+"/"+t+"/text").then(function(e){return n.packages[r]={files:e}})},e.prototype.cacheConfig=function(e,t){var n=O.Package.parseAndValidConfig(t);return this.configs[e]=n,O.U.clone(n)},e.prototype.loadConfigAsync=function(o,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:if(a||(a="master"),t=o+"/"+a,n=this.configs[t])return O.debug("github cache "+o+"/"+a+"/config"),[2,O.U.clone(n)];if(!l())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.proxyWithCdnLoadPackageAsync(o,a)];case 2:return r=e.sent(),[2,this.cacheConfig(t,r.files[O.CONFIG_NAME])];case 3:return c(e.sent()),[3,4];case 4:return[4,d(o,a,O.CONFIG_NAME)];case 5:return i=e.sent(),[2,this.cacheConfig(t,i)]}})})},e.prototype.loadPackageAsync=function(t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(n||(n="master"),!l())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.proxyWithCdnLoadPackageAsync(t,n).then(function(e){return O.U.clone(e)})];case 2:return[2,e.sent()];case 3:return c(e.sent()),[3,4];case 4:return[4,this.githubLoadPackageAsync(t,n)];case 5:return[2,e.sent()]}})})},e.prototype.githubLoadPackageAsync=function(o,t){var a=this;return b(o,t).then(function(r){var i=o+"/"+r,e=a.packages[i];return e?(O.debug("github cache "+o+"/"+t+"/text"),Promise.resolve(O.U.clone(e))):(O.log("Downloading "+o+"/"+t+" -> "+r),d(o,r,O.CONFIG_NAME).then(function(e){var n={files:{}};n.files[O.CONFIG_NAME]=e;var t=JSON.parse(e);return Promise.map(O.allPkgFiles(t).slice(1),function(t){return d(o,r,t).then(function(e){n.files[t]=e})}).then(function(){return a.packages[i]=n,O.U.clone(n)})}))})},e}();function a(n,e,t){return o({url:"https://api.github.com/repos/"+n+"/contents/"+t+"?ref="+e,method:"GET"}).then(function(e){var t=e.json;return i[n]=!0,t&&"base64"==t.encoding&&null!=t.content?atob(t.content):O.U.httpGetTextAsync(t.download_url)})}function d(t,n,r){return i[t]?a(t,n,r):O.U.requestAsync({url:"https://raw.githubusercontent.com/"+t+"/"+n+"/"+r,allowHttpErrors:!0}).then(function(e){return 200==e.statusCode?e.text:a(t,n,r)})}function h(e,t,n,r){return o({url:/^https:/.test(e)?e:"https://api.github.com/repos/"+e,headers:n,method:r||"POST",data:t,successCodes:[200,201,202,204]}).then(function(e){return e.json})}function m(e,t){for(var n=1;e.refs[t+n];)n++;return t+n}function g(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,h(t+"/git/refs",{ref:"refs/heads/"+n,sha:r})];case 1:return e.sent(),[2,n]}})})}function v(e,n,t,r){void 0===n&&(n="tags");var i,o=(i=t,!!u.forceProxy||!(u.token&&!i)&&l()),a=null,s=o?O.U.httpGetJsonAsync(O.BrowserUtils.cacheBustingUrl(O.Cloud.apiRoot+"gh/"+e+"/refs"+(r?"?nocache=1":""))).then(function(t){var e=Object.keys(t.refs).filter(function(e){return O.U.startsWith(e,"refs/"+n+"/")}).map(function(e){return{ref:e,object:{sha:t.refs[e]}}});return a=t.refs.HEAD,e}):p("https://api.github.com/repos/"+e+"/git/refs/"+n+"/?per_page=100"),c=function(e){return e.replace(/^refs\/[^\/]+\//,"")};return s.then(function(e){e.sort(function(e,t){return O.semver.strcmp(c(e.ref),c(t.ref))});for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[c(i.ref)]=i.object.sha}return{refs:t,head:a}},function(e){return 404==e.statusCode?{refs:{}}:Promise.reject(e)})}function r(e){return"commit"==e.object.type?Promise.resolve(e.object.sha):"tag"==e.object.type?p(e.object.url).then(function(e){return"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))}):Promise.reject(new Error("Bad type "+e.object.type))}function b(t,n){return/^[a-f0-9]{40}$/.test(n)?Promise.resolve(n):p("https://api.github.com/repos/"+t+"/git/refs/tags/"+n).then(r,function(e){return p("https://api.github.com/repos/"+t+"/git/refs/heads/"+n).then(r)})}function y(r,i){var e=C(r);return e?k(e,i)?(O.tickEvent("github.download.banned"),O.log("Github repo is banned"),Promise.resolve(void 0)):u.db.loadPackageAsync(e.fullName,e.tag).then(function(e){var t=I(i,r);if(t){var n=O.Package.parseAndValidConfig(e.files[O.CONFIG_NAME]);n&&(O.log("auto-disable "+t.join(",")+" due to targetconfig entry for "+r),n.disablesVariants=t,e.files[O.CONFIG_NAME]=O.Package.stringifyConfig(n))}return e}):(O.log("Unknown GitHub syntax"),Promise.resolve(void 0))}function n(e){return O.Cloud.cdnApiUrl("gh/"+e.fullName+"/icon")}function w(e,t,n){if(e){var r={owner:e.owner.login.toLowerCase(),fullName:e.full_name.toLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:n,updatedAt:Math.round(new Date(e.updated_at).getTime()/1e3),fork:e.fork,private:e.private};return r.status=x(r,t),r}}function x(e,t){return k(e,t)?f.Banned:(o=r=t,(i=n=e)&&o&&i.owner&&o.approvedOrgs&&o.approvedOrgs.some(function(e){return e.toLowerCase()==i.owner.toLowerCase()})||n&&r&&n.fullName&&r.approvedRepos&&r.approvedRepos.some(function(e){return e.toLowerCase()==n.fullName.toLowerCase()})?f.Approved:f.Unknown);var n,r,i,o}function k(t,e){return n=t,!(!(r=e)||n&&n.owner&&(!r.bannedOrgs||!r.bannedOrgs.some(function(e){return e.toLowerCase()==n.owner.toLowerCase()})))||!!e&&(!t||!t.fullName||!(!e.bannedRepos||!e.bannedRepos.some(function(e){return e.toLowerCase()==t.fullName.toLowerCase()})));var n,r}function A(o,a){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(e){switch(e.label){case 0:if(!(r=C(o)))return[2,void 0];if((i=x(r,a))==f.Banned)return[2,void 0];if(!l())return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=r,n=i,s(""+t.fullName).then(function(e){if(e)return{github:!0,owner:t.owner,fullName:t.fullName,name:e.name,description:e.description,defaultBranch:"master",tag:t.tag,status:n}}).catch(function(e){O.reportException(e)}))];case 2:return[2,e.sent()];case 3:return c(e.sent()),[3,4];case 4:return[4,p("https://api.github.com/repos/"+r.fullName)];case 5:return[2,w(e.sent(),a,r.tag)]}var t,n})})}function T(e){if(e){e=e.trim();var t=/^((https:\/\/)?github.com\/)?([^/]+\/[^/#]+)\/?(#(\w+))?$/i.exec(e);if(t){var n={repo:t?t[3].toLowerCase():null,tag:t?t[5]:null};return n.path=n.repo+(n.tag?"#"+n.tag:""),n}}}function C(e){if(e){e=(e=e.trim()).replace(/\/$/,"");var t=/^https:\/\/([^./#]+)\.github\.io\/([^/#]+)\/?$/i.exec(e);t&&(e="github:"+t[1]+"/"+t[2]),e=(e=(e=e.replace(/^github:/i,"")).replace(/^https:\/\/github\.com\//i,"")).replace(/\.git\b/i,"");var n=/^([^#\/:]+)\/([^#\/:]+)(\/([^#]+))?(#([^\/:]*))?$/.exec(e);if(n){var r=n[1],i=n[2],o=n[4];return{owner:r,project:i,fullName:r+"/"+i,tag:n[6],fileName:o}}}}function E(e){return!!e&&"github:"==e.slice(0,7)}function S(e){return e?"github:"+e.fullName.toLowerCase()+"#"+(e.tag||"master"):void 0}function _(e,t){if(!e||!e.upgrades)return null;var n=C(t);return n?O.U.lookup(e.upgrades,n.fullName.toLowerCase()):null}function I(e,t){var n=_(e,t),r=/^dv:(.*)/.exec(n);if(r){var i=r[1].split(/,/);return i.some(function(e){return!/^\w+$/.test(e)})?null:i}return null}u.MemoryGithubDb=t,u.downloadTextAsync=d,u.db=new t,u.authenticatedUserAsync=function(){return u.token?p("https://api.github.com/user"):Promise.resolve(void 0)},u.getCommitsAsync=function(e,t){return p("https://api.github.com/repos/"+e+"/commits?sha="+t).then(function(e){return e.map(function(e){var t=e.commit;return t.url=e.url,t.sha=e.sha,t})})},u.getCommitAsync=function(e,t){return p("https://api.github.com/repos/"+e+"/git/commits/"+t).then(function(t){return p(t.tree.url+"?recursive=1").then(function(e){return t.tree=e,t})})},u.createObjectAsync=function(e,t,n){return h(e+"/git/"+t+"s",n).then(function(e){return e.sha})},u.postCommitComment=function(e,t,n,r,i){return h(e+"/commits/"+t+"/comments",{body:n,path:r,position:i}).then(function(e){return e.id})},u.fastForwardAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,o({url:"https://api.github.com/repos/"+t+"/git/refs/heads/"+n,method:"PATCH",allowHttpErrors:!0,data:{sha:r,force:!1}})];case 1:return[2,200==e.sent().statusCode]}})})},u.putFileAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,o({url:"https://api.github.com/repos/"+t+"/contents/"+n,method:"PUT",allowHttpErrors:!0,data:{message:lf("Initialize empty repo"),content:btoa(O.U.toUTF8(r)),branch:"master"},successCodes:[201]})];case 1:return e.sent(),[2]}})})},u.createTagAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,h(t+"/git/refs",{ref:"refs/tags/"+n,sha:r})];case 1:return e.sent(),[2]}})})},u.createReleaseAsync=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,h(t+"/releases",{tag_name:n,target_commitish:r,name:n,draft:!1,prerelease:!1})];case 1:return e.sent(),[2]}})})},u.createPRFromBranchAsync=function(n,r,i,o,a){var s;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,h(n+"/pulls",{title:o,body:a||lf("Automatically created from MakeCode."),head:i,base:r,maintainer_can_modify:!0})];case 1:return t=e.sent(),[2,null===(s=t)||void 0===s?void 0:s.html_url]}})})},u.mergeAsync=function(t,e,n,r){return o({url:"https://api.github.com/repos/"+t+"/merges",method:"POST",successCodes:[201,204,409],data:{base:e,head:n,commit_message:r}}).then(function(e){if(201==e.statusCode||204==e.statusCode)return e.json.sha;if(409==e.statusCode)return null;throw O.U.userError(lf("Cannot merge in github.com/{1}; code: {2}",t,e.statusCode))})},u.getRefAsync=function(e,t){return p("https://api.github.com/repos/"+e+"/git/refs/heads/"+(t=t||"master")).then(r).catch(function(e){404!=e.statusCode&&Promise.reject(e)})},u.getNewBranchNameAsync=function(t,n){return void 0===n&&(n="patch-"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,v(t,"heads")];case 1:return[2,m(e.sent(),n)]}})})},u.createNewBranchAsync=g,u.forkRepoAsync=function(a,s,c){return void 0===c&&(c="pr-"),__awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:return[4,h(a+"/forks",{})];case 1:t=e.sent(),n=w(t,null),r=Date.now()+3e5,i=null,e.label=2;case 2:return!i&&Date.now()<r?[4,Promise.delay(1e3)]:[3,8];case 3:e.sent(),e.label=4;case 4:return e.trys.push([4,6,,7]),[4,v(n.fullName,"heads")];case 5:return i=e.sent(),[3,7];case 6:return e.sent(),[3,7];case 7:return[3,2];case 8:if(!i)throw new Error(lf("Timeout waiting for fork"));return o=m(i,c),[4,g(n.fullName,o,s)];case 9:return e.sent(),[2,n.fullName+"#"+o]}})})},u.listRefsAsync=function(e,t,n,r){return void 0===t&&(t="tags"),v(e,t,n,r).then(function(e){return Object.keys(e.refs)})},u.listRefsExtAsync=v,u.pkgConfigAsync=function(e,t){return void 0===t&&(t="master"),u.db.loadConfigAsync(e,t)},u.downloadPackageAsync=y,u.cacheProjectDependenciesAsync=function(o){var n;return __awaiter(this,void 0,void 0,function(){var t,r,i=this;return __generator(this,function(e){switch(e.label){case 0:return(t=null===(n=Object.keys(o.dependencies))||void 0===n?void 0:n.filter(function(e){return E(o.dependencies[e])})).length?[4,O.packagesConfigAsync()]:[3,3];case 1:return r=e.sent(),[4,Promise.all(t.map(function(n){return __awaiter(i,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,y(t=o.dependencies[n],r)];case 1:if(!e.sent())throw new Error(lf("Cannot load extension {0} from {1}",n,t));return[2]}})})}))];case 2:e.sent(),e.label=3;case 3:return[2]}})})},(e=f=u.GitRepoStatus||(u.GitRepoStatus={}))[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned",u.listUserReposAsync=function(){return U('{\n  viewer {\n    repositories(first: 100, affiliations: [OWNER, COLLABORATOR], orderBy: {field: PUSHED_AT, direction: DESC}) {\n      nodes {\n        name\n        description\n        full_name: nameWithOwner\n        private: isPrivate\n        fork: isFork\n        updated_at: updatedAt\n        owner {\n          login\n        }\n        defaultBranchRef {\n          name\n        }\n        pxtjson: object(expression: "master:pxt.json") {\n          ... on Blob {\n            text\n          }\n        }\n        readme: object(expression: "master:README.md") {\n          ... on Blob {\n            text\n          }\n        }\n      }\n    }\n  }\n}').then(function(e){return e.data.viewer.repositories.nodes.filter(function(e){return e.pxtjson}).filter(function(e){e.default_branch=e.defaultBranchRef.name;var t=O.Package.parseAndValidConfig(e.pxtjson&&e.pxtjson.text),n=e.readme&&e.readme.text;return!!t&&(t.supportedTargets?-1<t.supportedTargets.indexOf(O.appTarget.id):n&&-1<n.indexOf("PXT/"+O.appTarget.id))}).map(function(e){return w(e,null)})})},u.createRepoAsync=function(e,t,n){return h("https://api.github.com/user/repos",{name:e,description:t,private:!!n,has_issues:!0,has_projects:!1,has_wiki:!1,allow_rebase_merge:!1,allow_merge_commit:!0,delete_branch_on_merge:!1}).then(function(e){return w(e,null)})},u.enablePagesAsync=function(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:t=void 0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,p("https://api.github.com/repos/"+a+"/pages")];case 2:return(n=e.sent())&&(t=n.html_url),[3,4];case 3:return e.sent(),[3,4];case 4:if(t)return[3,8];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,h("https://api.github.com/repos/"+a+"/pages",{source:{branch:"master",path:"/"}},{Accept:"application/vnd.github.switcheroo-preview+json"})];case 6:return r=e.sent(),t=r.html_url,[3,8];case 7:return i=e.sent(),O.tickEvent("github.pages.error"),O.reportException(i),[3,8];case 8:return t?[4,p("https://api.github.com/repos/"+a)]:[3,13];case 9:if(!(o=e.sent())||o.homepage)return[3,13];e.label=10;case 10:return e.trys.push([10,12,,13]),[4,h("https://api.github.com/repos/"+a,{homepage:t},void 0,"PATCH")];case 11:return e.sent(),[3,13];case 12:return e.sent(),O.tickEvent("github.homepage.error"),[3,13];case 13:return[2]}})})},u.repoIconUrl=function(e){if(e.status==f.Approved)return n(e)},u.mkRepoIconUrl=n,u.repoStatus=x,u.repoAsync=A,u.searchAsync=function(e,t){if(!t)return Promise.resolve([]);var n=e.split("|").map(T).filter(function(e){return!!e});return 0<n.length?Promise.all(n.map(function(e){return A(e.path,t)})).then(function(e){return e.filter(function(e){return e&&e.status!=f.Banned})}):O.U.httpGetJsonAsync(O.Cloud.apiRoot+"ghsearch/"+O.appTarget.id+"/"+(O.appTarget.platformid||O.appTarget.id)+"?q="+encodeURIComponent(e)).then(function(e){return e.items.map(function(e){return w(e,t)}).filter(function(e){return e.status==f.Approved||t.allowUnapproved&&e.status==f.Unknown}).filter(function(e){return!O.appTarget.appTheme.githubUrl||"https://github.com/"+e.fullName!=O.appTarget.appTheme.githubUrl.toLowerCase()})}).catch(function(e){return[]})},u.parseRepoId=C,u.toGithubDependencyPath=function(e){var t="github:"+e.fullName;return e.tag&&(t+="#"+e.tag),t},u.isGithubId=E,u.stringifyRepo=S,u.normalizeRepoId=function(e){var t=C(e);if(t)return t.tag=t.tag||"master",S(t)},u.upgradedPackageReference=function(e,t){var n=_(e,t);if(!n)return null;var r=/^min:(.*)/.exec(n),i=r&&O.semver.tryParse(r[1]);if(i){var o=C(t),a=O.semver.tryParse(o.tag);return a&&O.semver.cmp(a,i)<0?(o.tag=r[1],O.debug("upgrading "+t+" to "+r[1]),S(o)):(a||O.log("not upgrading "+t+" - cannot parse version"),null)}return I(e,t)||O.log("invalid upgrade rule: "+t+" -> "+n),t},u.upgradedPackageId=function(e,t){var n=I(e,t);return n?t+"?dv="+n.join(","):t},u.latestVersionAsync=function(e,o,t,n){var a=C(e);return a?A(a.fullName,o).then(function(i){if(i)return v(i.fullName,"tags",t,n).then(function(e){var t=Object.keys(e.refs);t=O.semver.sortLatestTags(t);var n=O.appTarget.versions&&O.semver.tryParse(O.appTarget.versions.target);if(n&&o.releases&&o.releases["v"+n.major]){var r=o.releases["v"+n.major].map(function(e){return O.github.parseRepoId(e)}).filter(function(e){return e&&e.fullName.toLowerCase()==a.fullName.toLowerCase()})[0];if(r){if(t.some(function(e){return e==r.tag}))return O.debug("approved release "+r.fullName+"#"+r.tag+" for v"+n.major),Promise.resolve(r.tag);O.reportError("packages","approved release "+r.fullName+"#"+r.tag+" for v"+n.major+" not found anymore",{repo:i.fullName})}}return t[0]?Promise.resolve(t[0]):e.head||b(i.fullName,i.defaultBranch)})}):Promise.resolve(null)},u.GIT_JSON=".git.json";var P="https://api.github.com/graphql";function U(e){var t=JSON.stringify({query:e});return h(P,t)}u.lookupFile=function(e,t){return e?e.tree.tree.find(function(e){return e.path==t}):null},u.ghGraphQLQueryAsync=U,u.findPRNumberforBranchAsync=function(e,t){var n=C(e);return U("\n{\n    repository(owner: "+JSON.stringify(n.owner)+", name: "+JSON.stringify(n.project)+") {\n        pullRequests(last: 1, states: [OPEN, MERGED], headRefName: "+JSON.stringify(t)+") {\n            edges {\n                node {\n                    number\n                    state\n                    mergeable\n                    baseRefName\n                    url\n                    isDraft\n                }\n            }\n        }\n    }\n}\n").then(function(e){var t=e.data.repository.pullRequests.edges[0];if(t&&t.node){var n=t.node;return{number:n.number,mergeable:n.mergeable,state:n.state,title:n.title,url:n.url,base:n.baseRefName}}return{number:-1}})},u.getPagesStatusAsync=function(e){return p("https://api.github.com/repos/"+e+"/pages").catch(function(e){return{status:null}})}}(O.github||(O.github={}))}(pxt||(pxt={})),function(e){var t;e.REFCNT_FLASH="0xfffe",e.VTABLE_MAGIC=249,e.ValTypeObject=4,(t=e.BuiltInType||(e.BuiltInType={}))[t.BoxedString=1]="BoxedString",t[t.BoxedNumber=2]="BoxedNumber",t[t.BoxedBuffer=3]="BoxedBuffer",t[t.RefAction=4]="RefAction",t[t.RefImage=5]="RefImage",t[t.RefCollection=6]="RefCollection",t[t.RefRefLocal=7]="RefRefLocal",t[t.RefMap=8]="RefMap",t[t.RefMImage=9]="RefMImage",t[t.MMap=10]="MMap",t[t.User0=16]="User0"}(pxt||(pxt={})),function(g){!function(m){function c(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function u(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function l(e,t){return e[t]|e[t+1]<<8}function n(e){for(var t=new Uint8Array(4*e.length),n=0;n<e.length;++n)c(t,4*n,e[n]);return t}m.HF2_CMD_BININFO=1,m.HF2_MODE_BOOTLOADER=1,m.HF2_MODE_USERSPACE=2,m.HF2_CMD_INFO=2,m.HF2_CMD_RESET_INTO_APP=3,m.HF2_CMD_RESET_INTO_BOOTLOADER=4,m.HF2_CMD_START_FLASH=5,m.HF2_CMD_WRITE_FLASH_PAGE=6,m.HF2_CMD_CHKSUM_PAGES=7,m.HF2_CMD_READ_WORDS=8,m.HF2_CMD_WRITE_WORDS=9,m.HF2_CMD_DMESG=16,m.HF2_FLAG_SERIAL_OUT=128,m.HF2_FLAG_SERIAL_ERR=192,m.HF2_FLAG_CMDPKT_LAST=64,m.HF2_FLAG_CMDPKT_BODY=0,m.HF2_FLAG_MASK=192,m.HF2_SIZE_MASK=63,m.HF2_STATUS_OK=0,m.HF2_STATUS_INVALID_CMD=1,m.HF2_STATUS_EXEC_ERR=2,m.HF2_STATUS_EVENT=128,m.HF2_EV_MASK=8388608,m.write32=c,m.write16=u,m.read32=o,m.read16=l,m.encodeU32LE=n;var t=!(m.decodeU32LE=function(e){for(var t=[],n=0;n<e.length;n+=4)t.push(o(e,n));return t});function p(e){t?g.log("HF2: "+e):g.debug("HF2: "+e)}m.enableLog=function(){t=!0};var r=function(){function e(f){var d=this;this.io=f,this.cmdSeq=g.U.randomUint32(),this.lock=new g.U.PromiseQueue,this.flashing=!1,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.icon="usb",this.msgs=new g.U.PromiseBuffer,this.eventHandlers={},this.onSerial=function(e,t){};var h=[];f.onDeviceConnectionChanged=function(e){return d.disconnectAsync().then(function(){return e&&d.reconnectAsync()})},f.onSerial=function(e,t){return d.onSerial(e,t)},f.onData=function(e){var t=e[0]&m.HF2_FLAG_MASK,n=63&e[0],r=new Uint8Array(n);if(g.U.memcpy(r,0,e,1,n),t&m.HF2_FLAG_SERIAL_OUT)d.onSerial(r,t==m.HF2_FLAG_SERIAL_ERR);else if(h.push(r),t!=m.HF2_FLAG_CMDPKT_BODY){g.U.assert(t==m.HF2_FLAG_CMDPKT_LAST);for(var i=0,o=0,a=h;o<a.length;o++){i+=(p=a[o]).length}for(var s=new Uint8Array(i),c=0,u=0,l=h;u<l.length;u++){var p=l[u];g.U.memcpy(s,c,p),c+=p.length}h=[],s[2]&m.HF2_STATUS_EVENT?f.onEvent(s):d.msgs.push(s)}},f.onEvent=function(e){var t=o(e,0),n=g.U.lookup(d.eventHandlers,t+"");n?n(e.slice(4)):p("unhandled event: "+t.toString(16))},f.onError=function(e){p("recv error: "+e.message),d.autoReconnect&&(d.autoReconnect=!1,d.reconnectAsync().then(function(){d.autoReconnect=!0},function(e){p("reconnect error: "+e.message)}))}}return e.prototype.resetState=function(){this.lock=new g.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()},e.prototype.onEvent=function(e,t){g.U.assert(!!(e&m.HF2_EV_MASK)),this.eventHandlers[e+""]=t},e.prototype.reconnectAsync=function(){var t=this;return this.resetState(),p("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(function(){return t.initAsync()}).catch(function(e){if(t.reconnectTries<5)return t.reconnectTries++,p("error "+e.message+"; reconnecting attempt #"+t.reconnectTries),Promise.delay(500).then(function(){return t.reconnectAsync()});throw e})},e.prototype.disconnectAsync=function(){return p("disconnect"),this.io.disconnectAsync()},e.prototype.error=function(e){return this.io.error(e)},e.prototype.talkAsync=function(e,t){var n=this;if(this.io.talksAsync)return this.io.talksAsync([{cmd:e,data:t}]).then(function(e){return e[0]});var r=8;t&&(r+=t.length);var i=new Uint8Array(r),o=65535&++this.cmdSeq;c(i,0,e),u(i,4,o),u(i,6,0),t&&g.U.memcpy(i,8,t,0,t.length);var a=0,s=function(){return n.msgs.shiftAsync(1e3).then(function(e){if(l(e,0)!=o){if(a<3)return a++,p("message out of sync, ("+o+" vs "+l(e,0)+"); will re-try"),s();n.error("out of sync")}var t="";switch(e[3]&&(t="; info="+e[3]),e[2]){case m.HF2_STATUS_OK:return e.slice(4);case m.HF2_STATUS_INVALID_CMD:n.error("invalid command"+t);break;case m.HF2_STATUS_EXEC_ERR:n.error("execution error"+t);break;default:n.error("error "+e[2]+t)}return null})};return this.sendMsgAsync(i).then(s)},e.prototype.sendMsgAsync=function(e){return this.sendMsgCoreAsync(e)},e.prototype.sendSerialAsync=function(e,t){return void 0===t&&(t=!1),this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)},e.prototype.sendMsgCoreAsync=function(r,i){var o=this;void 0===i&&(i=0);var a=new Uint8Array(64),s=function(e){var t=r.length-e;if(t<=0)return Promise.resolve();63<t?(t=63,a[0]=m.HF2_FLAG_CMDPKT_BODY):a[0]=m.HF2_FLAG_CMDPKT_LAST,i&&(a[0]=1==i?m.HF2_FLAG_SERIAL_OUT:m.HF2_FLAG_SERIAL_ERR),a[0]|=t;for(var n=0;n<t;++n)a[n+1]=r[e+n];return o.io.sendPacketAsync(a).then(function(){return s(e+t)})};return this.lock.enqueue("out",function(){return s(0)})},e.prototype.switchToBootloaderAsync=function(){var t=this;return this.bootloaderMode?Promise.resolve():(p("Switching into bootloader mode"),this.io.isSwitchingToBootloader&&this.io.isSwitchingToBootloader(),this.maybeReconnectAsync().then(function(){return t.talkAsync(m.HF2_CMD_START_FLASH).then(function(){},function(e){return t.talkAsync(m.HF2_CMD_RESET_INTO_BOOTLOADER).then(function(){},function(e){}).then(function(){return t.reconnectAsync().catch(function(e){throw"devicenotfound"===e.type&&(e.type="repairbootloader"),e})})})}).then(function(){return t.initAsync()}).then(function(){t.bootloaderMode||t.error("cannot switch into bootloader mode")}))},e.prototype.isFlashing=function(){return!!this.flashing},e.prototype.reflashAsync=function(e){var t=this;p("reflash"),g.U.assert(g.appTarget.compile.useUF2);var n=e.outfiles[pxtc.BINARY_UF2],r=pxtc.UF2.parseFile(g.Util.stringToUint8Array(atob(n)));return this.flashing=!0,this.io.reconnectAsync().then(function(){return t.flashAsync(r)}).then(function(){return Promise.delay(100)}).finally(function(){return t.flashing=!1})},e.prototype.writeWordsAsync=function(e,t){return g.U.assert(t.length<=64),this.talkAsync(m.HF2_CMD_WRITE_WORDS,n([e,t.length].concat(t))).then(function(){})},e.prototype.readWordsAsync=function(e,t){var n=new Uint8Array(8);return c(n,0,e),c(n,4,t),g.U.assert(t<=64),this.talkAsync(m.HF2_CMD_READ_WORDS,n)},e.prototype.pingAsync=function(){return this.rawMode?Promise.resolve():this.talkAsync(m.HF2_CMD_BININFO).then(function(e){})},e.prototype.maybeReconnectAsync=function(){var t=this;return this.pingAsync().catch(function(e){return t.reconnectAsync().then(function(){return t.pingAsync()})})},e.prototype.flashAsync=function(r){var i=this,o=Date.now(),a=0,s=function(e){if(e>=r.length)return Promise.resolve();var t=r[e],n=new Uint8Array(4+t.payloadSize);return c(n,0,t.targetAddr),g.U.memcpy(n,4,t.data,0,t.payloadSize),i.talkAsync(m.HF2_CMD_WRITE_FLASH_PAGE,n).then(function(){return s(e+1)})};return this.switchToBootloaderAsync().then(function(){var e=256*r.length;return p("Starting flash ("+Math.round(e/1024)+"kB)."),a=Date.now(),16384<i.pageSize?r:f(r,function(e,t){return i.readWordsAsync(e,t)})}).then(function(e){if(e.length!=r.length){var t=256*(r=e).length;p("Performing partial flash ("+Math.round(t/1024)+"kB).")}}).then(function(){return s(0)}).then(function(){var e=Date.now(),t=e-o,n=e-a;p("Flashing done at "+Math.round(256*r.length/n*1e3/1024)+" kB/s in "+t+"ms (reset "+(t-n)+"ms). Resetting.")}).then(function(){return i.talkAsync(m.HF2_CMD_RESET_INTO_APP).catch(function(e){})}).then(function(){})},e.prototype.initAsync=function(){var n=this;return this.rawMode?Promise.resolve():Promise.resolve().then(function(){return n.talkAsync(m.HF2_CMD_BININFO)}).then(function(e){return n.bootloaderMode=e[0]==m.HF2_MODE_BOOTLOADER,n.pageSize=o(e,4),n.flashSize=o(e,8)*n.pageSize,n.maxMsgSize=o(e,12),n.familyID=o(e,16),p("Connected; msgSize "+n.maxMsgSize+"B; flash "+n.flashSize/1024+"kB; "+(n.bootloaderMode?"bootloader":"application")+" mode; family=0x"+n.familyID.toString(16)),n.talkAsync(m.HF2_CMD_INFO)}).then(function(e){n.infoRaw=g.U.fromUTF8(g.U.uint8ArrayToString(e)),g.debug("Info: "+n.infoRaw);var r={};("Header: "+n.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,function(e,t,n){return r[t.replace(/-/g,"")]=n,""}),n.info=r;var t=/v(\d\S+)(\s+(\S+))?/.exec(n.info.Header);n.info.Parsed=t?{Version:t[1],Features:t[3]||""}:{Version:"?",Features:""},p("Board-ID: "+n.info.BoardID+" v"+n.info.Parsed.Version+" f"+n.info.Parsed.Features)}).then(function(){n.reconnectTries=0})},e}();function f(r,e){if(!g.appTarget.compile.flashChecksumAddr)return Promise.resolve(r);var n,t=pxtc.UF2.readBytes(r,g.appTarget.compile.flashChecksumAddr,48),i=pxtc.parseChecksumBlock(t);return i?(n=e,g.appTarget.compile.flashChecksumAddr?n(g.appTarget.compile.flashChecksumAddr,12).then(function(e){var t=pxtc.parseChecksumBlock(e);return t?n(t.endMarkerPos,1).then(function(e){return o(e,0)!=t.endMarker?(g.log("end-marker mismatch"),null):t}):null}):Promise.resolve(null)).then(function(e){if(!e)return r;var n=e.regions.filter(function(t){return i.regions.some(function(e){return t.checksum==e.checksum&&t.length==e.length&&t.start==e.start})});if(0==n.length)return r;p("skipping flash at: "+n.map(function(e){return pxtc.assembler.tohex(e.start)+" ("+e.length/1024+"kB)"}).join(", "));var t=function(t){return n.some(function(e){return e.start<=t&&t<e.start+e.length})};return r.filter(function(e){return!(t(e.targetAddr)&&t(e.targetAddr+e.payloadSize-1))})}):Promise.resolve(r)}m.Wrapper=r,m.mkHF2PacketIOWrapper=function(e){return g.debug("packetio: wrapper hf2"),new r(e)},m.onlyChangedBlocksAsync=f}(g.HF2||(g.HF2={}))}(pxt||(pxt={})),function(I){!function(t){var m,e,p,n,g,v,a,f,b=I.Util,d=I.HF2,r=1409050336,i=665147697,o=287358355,h=1888490768,s=915601917,c=d.read32,y=!1;function u(e){return e<<2|2}function w(e){return 1&e?e>>1:0!=e?2&e?e==t.taggedNull?null:e!=t.taggedFalse&&(e==t.taggedTrue||{tagged:e>>2}):{ptr:e}:void 0}function l(e,t){if(b.assert(!(3&e)),b.assert(0<=e),e<2097152){var n=new Uint8Array(t);return e-=a.start,b.memcpy(n,0,a.buf,e,t),Promise.resolve(n)}var r=f.maxMsgSize-32;if(r<t){for(var i=[];0<t;){var o=Math.min(r,t);i.push(l(e,o)),t-=o,e+=o}return Promise.all(i).then(b.uint8ArrayConcat)}return f.readWordsAsync(e,Math.ceil(t/4)).then(function(e){return e.length>t?e.slice(0,t):e})}function x(n){if("object"!=typeof n||!n)return Promise.resolve(n);if("number"==typeof n.ptr){if(3&n.ptr)return Promise.resolve({unalignedPtr:n.ptr});var r=0;return l(n.ptr,56).then(function(t){r=d.read16(t,2);var e=t.length;return r==I.BuiltInType.BoxedString||r==I.BuiltInType.BoxedBuffer?e=d.read16(t,4)+6:r==I.BuiltInType.BoxedNumber&&(e=12),e>t.length?l(n.ptr+t.length,e-t.length).then(function(e){return b.uint8ArrayConcat([t,e])}):e<t.length?t.slice(0,e):t}).then(function(e){return r==I.BuiltInType.BoxedString?b.uint8ArrayToString(e.slice(6)):r==I.BuiltInType.BoxedBuffer?{type:"buffer",data:e.slice(6)}:r==I.BuiltInType.BoxedNumber?new Float64Array(e.buffer.slice(4))[0]:{type:"unknown",tag:r,refcnt:d.read16(e,0),data:e.slice(4)}})}return Promise.resolve(n)}function k(n){for(var e=[],t=function(t){e.push(x(n[t]).then(function(e){n[t]=e}))},r=0,i=Object.keys(n);r<i.length;r++){t(i[r])}return Promise.all(e).then(function(){})}function A(e){for(var t=m.breakpoints,n=t[0],r=1/0,i=0,o=t;i<o.length;i++){var a=o[i],s=e-a.binAddr;0<=s&&s<r&&(r=s,n=a)}return n}function T(u){return y?Promise.resolve():(y=!0,_().then(function(e){for(var t,n,r,i=d.decodeU32LE(u)[0],o={},a=0,s=m.procDebugInfo[0].locals;a<s.length;a++){var c=s[a];t=c,r=void 0,n=e.globals,null===(r=function(){switch(t.type){case"uint32":return d.read32(n,t.index);case"int32":return 0|d.read32(n,t.index);case"uint16":return d.read16(n,t.index);case"int16":return d.read16(n,t.index)<<16>>16;case"uint8":return n[t.index];case"int8":return n[t.index]<<24>>24;default:return null}}())&&(b.assert(0==(3&t.index)),r=w(d.read32(n,t.index))),o[t.name]=r}return g=A(i),l={type:"debugger",subtype:"breakpoint",breakpointId:g.id,globals:o,stackframes:[]},p(),f.talkAsync(h)}).then(function(e){!function(e,t){for(var n=g.binAddr,r=0,i=m.procDebugInfo.filter(function(e){return e.codeStartLoc<=n&&n<=e.codeEndLoc})[0];i&&i!=m.procDebugInfo[0];){var o=A(n),a=b.clone(o);a.functionName=i.name,a.argumentNames=i.args&&i.args.map(function(e){return e.name}),t.stackframes.push({locals:{},funcInfo:a,breakpointId:o.id});for(var s=t.stackframes[t.stackframes.length-1],c=0,u=0,l=i.locals;u<l.length;u++){var p=l[u];b.assert(p.index==c++),s.locals[p.name]=w(e[r++])}n=2147483646&e[r++];for(var f=v[n+""],d=0,h=i.args;d<h.length;d++)p=h[d],s.locals[p.name]=w(e[r+(i.args.length-1-p.index)]);if(!f)break;i=f.from,r+=f.stack-i.localsMark}}(d.decodeU32LE(e),l);var t=[l.globals].concat(l.stackframes.map(function(e){return e.locals}));return Promise.map(t,k)}).then(function(){return t.postMessage(l)}));var l}function C(){y=!1,e=new Promise(function(e,t){p=e})}function E(e){return void 0===e&&(e=!1),Promise.resolve().then(function(){return f.talkAsync(i,d.encodeU32LE([e?1:3]))}).then(C)}function S(){return e||(e=Promise.resolve()),e}function _(){return(n?Promise.resolve(n):f.talkAsync(r).then(function(e){return n={numGlobals:c(e,0),globalsPtr:c(e,4)}})).then(function(e){return f.readWordsAsync(e.globalsPtr,e.numGlobals)}).then(function(e){return{staticState:n,globals:e}})}t.taggedUndefined=0,t.taggedNull=u(1),t.taggedFalse=u(2),t.taggedTrue=u(16),t.postMessage=function(e){return console.log(e)},t.decodeValue=w,t.heapExpandAsync=x,t.heapExpandMapAsync=k,t.startDebugAsync=function(u,e){return(f=e).onEvent(s,T),(y=!1,n=m=null,Promise.resolve()).then(function(){v={};for(var e=[],t=0,n=(m=u).procDebugInfo;t<n.length;t++)e[(o=n[t]).idx]=o;for(var r=0,i=u.procDebugInfo;r<i.length;r++)for(var o,a=0,s=(o=i[r]).calls;a<s.length;a++){var c=s[a];v[c.addr+""]={from:o,to:e[c.procIndex],stack:c.stack}}}).then(function(){var e=m.outfiles[pxtc.BINARY_UF2],t=b.stringToUint8Array(atob(e));return a=pxtc.UF2.toBin(t),f.reflashAsync(m).then(function(){return f.reconnectAsync()})}).then(function(){return f.talkAsync(o).catch(function(e){})}).then(function(){return Promise.delay(200)}).then(function(){return f.reconnectAsync()}).then(C).then(S)},t.handleMessage=function(e){if(console.log("HWDBGMSG",e),"debugger"==e.type){var t=!1;switch(e.subtype){case"stepinto":t=!0;case"stepover":E(t)}}},t.resumeAsync=E,t.waitForHaltAsync=S,t.getHwStateAsync=_}(I.HWDBG||(I.HWDBG={}))}(pxt||(pxt={})),function(b){var e=function(){function e(){}return e.prototype.logTime=function(){if(this.start){var e=Date.now()-this.start;b.debug("Icon creation: "+e+"ms")}},e.prototype.convert=function(e){this.start||(this.start=Date.now());var t=atob(e.slice(e.indexOf(",")+1)),n=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2);if(135===n&&(n=224|t.charCodeAt(1),r=t.charCodeAt(2)|t.charCodeAt(3)<<8,i=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4)),225!=n&&228!=n)return null;if(!this.palette){var o=b.appTarget.runtime.palette.map(function(e){var t=parseInt(e.replace(/#/,""),16);return[t>>0&255,t>>8&255,t>>16&255,255]});o[0][3]=0,this.palette=new Uint8Array(4*o.length);for(var a=0;a<o.length;++a)this.palette[4*a+0]=o[a][0],this.palette[4*a+1]=o[a][1],this.palette[4*a+2]=o[a][2],this.palette[4*a+3]=o[a][3]}if(225==n)return this.genMonochrome(t,r,i);var s=(b.BrowserUtils.isEdge()||b.BrowserUtils.isIE())&&r<100&&i<100?3:1;return this.genColor(t,r,i,s)},e.prototype.genMonochrome=function(e,t,n){var r=t+3&-4,i=54+this.palette.length,o=i+r*n,a=new Uint8Array(o);a[0]=66,a[1]=77,b.HF2.write32(a,2,o),b.HF2.write32(a,10,i),b.HF2.write32(a,14,40),b.HF2.write32(a,18,t),b.HF2.write32(a,22,-n),b.HF2.write16(a,26,1),b.HF2.write16(a,28,8),b.HF2.write32(a,38,2835),b.HF2.write32(a,42,2835),b.HF2.write32(a,46,this.palette.length>>2),a.set(this.palette,54);for(var s=4,c=i,u=1,l=e.charCodeAt(s++),p=0;p<t;++p){c=i+p;for(var f=0;f<n;++f)a[c]=l&u?1:0,c+=r,256==(u<<=1)&&(u=1,l=e.charCodeAt(s++))}return"data:image/bmp;base64,"+btoa(b.U.uint8ArrayToString(a))},e.prototype.genColor=function(e,t,n,r){var i=t*(r=Math.max(1,0|r)),o=n*r,a=i<<2,s=138+a*o,c=new Uint8Array(s);c[0]=66,c[1]=77,b.HF2.write32(c,2,s),b.HF2.write32(c,10,138),b.HF2.write32(c,14,124),b.HF2.write32(c,18,i),b.HF2.write32(c,22,-o),b.HF2.write16(c,26,1),b.HF2.write16(c,28,32),b.HF2.write16(c,30,3),b.HF2.write32(c,38,2835),b.HF2.write32(c,42,2835),b.HF2.write32(c,54,16711680),b.HF2.write32(c,58,65280),b.HF2.write32(c,62,255),b.HF2.write32(c,66,4278190080),c[70]=66,c[71]=71,c[72]=82,c[73]=115;for(var u=4,l=138,p=!0,f=0;f<i;f++){var d=!1;l=138+(f<<2);for(var h=u,m=e.charCodeAt(u++),g=d?(m>>4&15)<<2:(15&m)<<2,v=0;v<o;v++)m&&(p=!1),c[l]=this.palette[g],c[l+1]=this.palette[g+1],c[l+2]=this.palette[g+2],c[l+3]=this.palette[g+3],l+=a,v%r==r-1&&(d&&(m=e.charCodeAt(u++)),g=(d=!d)?(m>>4&15)<<2:(15&m)<<2);if(p&&(c[141]=1),f%r==r-1)for(n%2||--u;3&u;)u++;else u=h}return"data:image/bmp;base64,"+btoa(b.U.uint8ArrayToString(c))},e}();b.ImageConverter=e}(pxt||(pxt={})),function(c){!function(e){function s(){var t={"tsconfig.json":e.TS_CONFIG,"test.ts":"// "+lf("tests go here; this will not be compiled when this package is used as an extension.")+"\n","_config.yml":"makecode:\n  target: @TARGET@\n  platform: @PLATFORM@\n  home_url: @HOMEURL@\ntheme: jekyll-theme-slate\ninclude:\n  - assets\n  - README.md\n",Makefile:"all: deploy\n\nbuild:\n\tpxt build\n\ndeploy:\n\tpxt deploy\n\ntest:\n\tpxt test\n",Gemfile:"source 'https://rubygems.org'\ngem 'github-pages', group: :jekyll_plugins","README.md":"\n> "+lf("Open this page at {0}","[https://@REPOOWNER@.github.io/@REPONAME@/](https://@REPOOWNER@.github.io/@REPONAME@/)")+"\n\n## "+lf("Use as Extension")+"\n\n"+lf("This repository can be added as an **extension** in MakeCode.")+"\n\n* "+lf("open [@HOMEURL@](@HOMEURL@)")+"\n* "+lf("click on **New Project**")+"\n* "+lf("click on **Extensions** under the gearwheel menu")+"\n* "+lf("search for **https://github.com/@REPO@** and import")+"\n\n## "+lf("Edit this project")+" !["+lf("Build status badge")+"](https://github.com/@REPO@/workflows/MakeCode/badge.svg)\n\n"+lf("To edit this repository in MakeCode.")+"\n\n* "+lf("open [@HOMEURL@](@HOMEURL@)")+"\n* "+lf("click on **Import** then click on **Import URL**")+"\n* "+lf("paste **https://github.com/@REPO@** and click import")+"\n\n## "+lf("Blocks preview")+"\n\n"+lf("This image shows the blocks code from the last commit in master.")+"\n"+lf("This image may take a few minutes to refresh.")+"\n\n!["+lf("A rendered view of the blocks")+"](https://github.com/@REPO@/raw/master/.github/makecode/blocks.png)\n\n#### "+lf("Metadata (used for search, rendering)")+'\n\n* for PXT/@TARGET@\n<script src="https://makecode.com/gh-pages-embed.js"><\/script><script>makeCodeRender("{{ site.makecode.home_url }}", "{{ site.github.owner_name }}/{{ site.github.repository_name }}");<\/script>\n',".gitignore":"# MakeCode\nbuilt\nnode_modules\nyotta_modules\nyotta_targets\npxt_modules\n_site\n*.db\n*.tgz\n.header.json\n.simstate.json\n",".vscode/settings.json":'{\n    "editor.formatOnType": true,\n    "files.autoSave": "afterDelay",\n    "files.watcherExclude": {\n        "**/.git/objects/**": true,\n        "**/built/**": true,\n        "**/node_modules/**": true,\n        "**/yotta_modules/**": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules/**": true\n    },\n    "files.associations": {\n        "*.blocks": "html",\n        "*.jres": "json"\n    },\n    "search.exclude": {\n        "**/built": true,\n        "**/node_modules": true,\n        "**/yotta_modules": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules": true\n    }\n}',".github/workflows/makecode.yml":"name: MakeCode\n\non: [push]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [8.x]\n\n    steps:\n      - uses: actions/checkout@v1\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v1\n        with:\n          node-version: ${{ matrix.node-version }}\n      - name: npm install\n        run: |\n          npm install -g pxt\n          pxt target @TARGET@\n      - name: build\n        run: |\n          pxt install\n          pxt build --cloud\n        env:\n          CI: true\n",".vscode/tasks.json":'\n// A task runner that calls the MakeCode (PXT) compiler\n{\n    "version": "2.0.0",\n    "tasks": [{\n        "label": "pxt deploy",\n        "type": "shell",\n        "command": "pxt deploy --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt build",\n        "type": "shell",\n        "command": "pxt build --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt install",\n        "type": "shell",\n        "command": "pxt install",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt clean",\n        "type": "shell",\n        "command": "pxt clean",\n        "group": "test",\n        "problemMatcher": [ "$tsc" ]\n    }]\n}\n'},n=r();return n&&Object.keys(n).forEach(function(e){return t[e]=n[e]}),t}function r(){var e=c.appTarget.bundledpkgs[c.template.TEMPLATE_PRJ];if(e){var t=c.Util.clone(e);return delete t[c.CONFIG_NAME],t}}e.TS_CONFIG='{\n    "compilerOptions": {\n        "target": "es5",\n        "noImplicitAny": true,\n        "outDir": "built",\n        "rootDir": "."\n    },\n    "exclude": ["pxt_modules/**/*test.ts"]\n}\n',e.defaultFiles=s,e.targetTemplateFiles=r,e.TEMPLATE_PRJ="template",e.packageFiles=function(e){var t=c.appTarget.blocksprj||c.appTarget.tsprj,n=c.U.clone(t.config);delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths,n.preferredEditor=n.files.find(function(e){return/\.blocks$/.test(e)})?c.BLOCKS_PROJECT_NAME:c.JAVASCRIPT_PROJECT_NAME,n.name=e,n.public=!0,n.version||(n.version="0.0.0");var r={},i=s();for(var o in i)r[o]=i[o];for(var o in t.files)"README.md"!=o&&(r[o]=t.files[o]);var a=Object.keys(r).filter(function(e){return/\.(blocks|md|ts|asm|cpp|h|py)$/.test(e)});return n.files=a.filter(function(e){return!/test/.test(e)}),n.testFiles=a.filter(function(e){return/test/.test(e)}),n.supportedTargets=[c.appTarget.id],r[c.CONFIG_NAME]=c.Package.stringifyConfig(n),r},e.packageFilesFixup=function(n,e){var r=JSON.parse(n[c.CONFIG_NAME]);e&&c.Util.jsonMergeFrom(r,e),c.webConfig&&(Object.keys(c.webConfig).forEach(function(e){return r[e.toLowerCase()]=c.webConfig[e]}),r.platform=c.appTarget.platformid||c.appTarget.id,r.target=c.appTarget.id,r.docs=c.appTarget.appTheme.homeUrl||"./",r.homeurl=c.appTarget.appTheme.homeUrl||"???"),c.U.iterMap(n,function(e,t){t=t.replace(/@([A-Z]+)@/g,function(e,t){return r[t.toLowerCase()]||""}),n[e]=t})}}(c.template||(c.template={}))}(pxt||(pxt={})),function(k){!function(e){var v,t,b,n;(t=v=e.NT||(e.NT={}))[t.Prefix=0]="Prefix",t[t.Postfix=1]="Postfix",t[t.Infix=2]="Infix",t[t.Block=3]="Block",t[t.NewLine=4]="NewLine",(n=b=e.GlueMode||(e.GlueMode={}))[n.None=0]="None",n[n.WithSpace=1]="WithSpace",n[n.NoSpace=2]="NoSpace";var r,i=["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"];function o(e){return"`"+e.replace(/[\\`${}]/g,function(e){return"\\"+e})+"`"}function a(e){return 20<e.length&&/\n/.test(e)?o(e):JSON.stringify(e)}function s(e,t,n){return{type:e,op:t,children:n}}function c(){return s(v.NewLine,"",[])}function u(e,t){return s(v.Prefix,e,t)}function l(e,t,n){return s(v.Infix,t,null==e?[n]:[e,n])}function y(e){return u(e,[])}function p(e){return s(v.Block,"",e)}function w(e){return u("",e)}function f(e,t){void 0===t&&(t=!1);for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];t?(0<n.length&&n.push(y(",")),n.push(c())):0<n.length&&n.push(y(", ")),n.push(o)}return t&&n.push(c()),w(n)}e.backtickLit=o,e.stringLit=a,e.mkNode=s,e.mkNewLine=c,e.mkPrefix=u,e.mkPostfix=function(e,t){return s(v.Postfix,t,e)},e.mkInfix=l,e.mkText=y,e.mkBlock=p,e.mkGroup=w,e.mkStmt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return n&&n.type==v.Block||e.push(c()),w(e)},e.mkCommaSep=f,function(e){function i(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),w(r?[l(t[0],".",y(e)),y("("),f(t.slice(1),n),y(")")]:[y(e),y("("),f(t,n),y(")")])}function n(e,t,n,r){return i(e+"."+t,n,r)}function r(e,t){return k.U.assert(2==t.length),l(t[0],e,t[1])}e.mkArrayLiteral=function(e,t){return w([y("["),f(e,t),y("]")])},e.mkNumberLiteral=function(e){return y(e.toString())},e.mkBooleanLiteral=function(e){return y(e?"true":"false")},e.mkStringLiteral=function(e){return y(a(e))},e.mkPropertyAccess=function(e,t){return w([l(t,".",y(e))])},e.mkCall=i,e.stdCall=function(e,t,n){return i(e,t,n)},e.extensionCall=function(e,t,n){return i(e,t,n,!0)},e.namespaceCall=n,e.mathCall=function(e,t){return n("Math",e,t,!1)},e.mkGlobalRef=function(e){return y(e)},e.mkSimpleCall=r,e.mkWhile=function(e,t){return w([y("while ("),e,y(")"),p(t)])},e.mkComment=function(e){return y("// "+e)},e.mkMultiComment=function(e){var r=[y("/**"),c()];return e.split("\n").forEach(function(e,t,n){e&&(r.push(y(" * "+e)),r.push(c()),t<n.length-1&&(r.push(y(" * ")),r.push(c())))}),w(r.concat([y(" */"),c()]))},e.mkAssign=function(e,t){return r("=",[e,t])},e.mkParenthesizedExpression=function(e){return h(d([e]).output)?e:w([y("("),e,y(")")])}}(r=e.Helpers||(e.Helpers={})),e.H=r;var x={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};function d(e){var s=[],c={},u="",l="",p=[{}],f=0;function d(e){"string"==typeof e&&(f+=(e.match(/\n/g)||[]).length),u+=e}var t=w(e);return function e(t,n){if(t.type==v.Infix){var r=[],i=k.U.lookup(x,t.op);if(null==i&&k.U.oops("bad infix op: "+t.op),i<n&&c("("),1==t.children.length)c(t.op),e(t.children[0],i),r.push(t.children[0]);else{var o=3!=i&&"**"!=t.op;e(t.children[0],o?i:i+.1),r.push(t.children[0]),"."==t.op?c("."):c(" "+t.op+" "),e(t.children[1],o?i+.1:i),r.push(t.children[1])}i<n&&c(")"),t.type=v.Prefix,t.op="",t.children=r}else for(var a=0,s=t.children;a<s.length;a++)e(s[a],-1);function c(e){"P"==e[0]&&(e=e.slice(1)),r.push(y(e))}}(t,-1),h(t),u||d("\n"),{output:u,sourceMap:s};function h(e){e.glueToBlock&&(g(),e.glueToBlock==b.WithSpace&&d(" "));var t=f,n=u.length;switch(e.type){case v.Infix:k.U.oops("no infix should be left");break;case v.NewLine:d("\n"+l);break;case v.Block:!function(e){var t=e.noFinalNewline?"":"\n";if(0==e.children.length)return m(" {\n\t\n}"+t);var n=k.U.clone(p[p.length-1]||{});p.push(n),l+="    "," "!=u[u.length-1]&&m(" ");m("{\n");for(var r=0,i=e.children;r<i.length;r++){var o=i[r];h(o)}l=l.slice(4),g(),m("\n}"+t),p.pop()}(e);break;case v.Prefix:e.canIndentInside?d(e.op.replace(/\n/g,"\n"+l+"    ")):d(e.op),e.children.forEach(h);break;case v.Postfix:e.children.forEach(h),e.canIndentInside?d(e.op.replace(/\n/g,"\n"+l+"    ")):d(e.op)}var r=f,i=Math.max(u.length,1);if(e.id)if(c[e.id]){var o=c[e.id];o.startLine=Math.min(o.startLine,t),o.endLine=Math.max(o.endLine,r),o.startPos=Math.min(o.startPos,n),o.endPos=Math.max(o.endPos,i)}else{var a={id:e.id,startLine:t,startPos:n,endLine:r,endPos:i};c[e.id]=a,s.push(a)}}function m(e){d(e.replace(/\n/g,"\n"+l))}function g(){u=u.replace(/\n *$/,function(){return f--,""})}}function h(e){if("("!==e[0]||")"!==e[e.length-1])return!1;for(var t=1,n=1;n<e.length;n++){var r=e[n];if("("===r)t++;else if(")"===r&&0===--t)return n===e.length-1}return!1}e.flattenNode=d,e.isReservedWord=function(e){return-1!==i.indexOf(e)},e.isParenthesized=h}(k.blocks||(k.blocks={}))}(pxt||(pxt={})),function(x){!function(s){var c=[".","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];s.BLOCKLY_TILESET_TYPE="BLOCKLY_TILESET_TYPE",s.TILE_PREFIX="tile",s.TILE_NAMESPACE="myTiles";var p=function(){function s(e,t,n,r,i){void 0===n&&(n=0),void 0===r&&(r=0),this.width=e,this.height=t,this.x0=n,this.y0=r,this.buf=i||new Uint8ClampedArray(this.dataLength())}return s.fromData=function(e){return new s(e.width,e.height,e.x0,e.y0,e.data)},s.prototype.set=function(e,t,n){if(e<this.width&&t<this.height&&0<=e&&0<=t){var r=this.coordToIndex(e,t);this.setCore(r,n)}},s.prototype.get=function(e,t){if(e<this.width&&t<this.height&&0<=e&&0<=t){var n=this.coordToIndex(e,t);return this.getCore(n)}return 0},s.prototype.copy=function(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=this.width),void 0===r&&(r=this.height);var i=new s(n,r);i.x0=e,i.y0=t;for(var o=0;o<n;o++)for(var a=0;a<r;a++)i.set(o,a,this.get(e+o,t+a));return i},s.prototype.apply=function(e,t){var n;void 0===t&&(t=!1);for(var r=0;r<e.width;r++)for(var i=0;i<e.height;i++)!(n=e.get(r,i))&&t||this.set(e.x0+r,e.y0+i,n)},s.prototype.equals=function(e){if(this.width===e.width&&this.height===e.height&&this.x0===e.x0&&this.y0===e.y0&&this.buf.length===e.buf.length){for(var t=0;t<this.buf.length;t++)if(this.buf[t]!==e.buf[t])return!1;return!0}return!1},s.prototype.data=function(){return{width:this.width,height:this.height,x0:this.x0,y0:this.y0,data:this.buf}},s.prototype.resize=function(e,t){return n(this,e,t)},s.prototype.coordToIndex=function(e,t){return e+t*this.width},s.prototype.getCore=function(e){var t=Math.floor(e/2);return e%2==0?15&this.buf[t]:(240&this.buf[t])>>4},s.prototype.setCore=function(e,t){var n=Math.floor(e/2);this.buf[n]=e%2==0?240&this.buf[n]|15&t:15&this.buf[n]|(15&t)<<4},s.prototype.dataLength=function(){return Math.ceil(this.width*this.height/2)},s}(),o=function(e){function s(){return null!==e&&e.apply(this,arguments)||this}return __extends(s,e),s.fromData=function(e){return new s(e.width,e.height,e.x0,e.y0,e.data)},s.prototype.copy=function(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=this.width),void 0===r&&(r=this.height);var i=new s(n,r);i.x0=e,i.y0=t;for(var o=0;o<n;o++)for(var a=0;a<r;a++)i.set(o,a,this.get(e+o,t+a));return i},s.prototype.resize=function(e,t){return a(this,e,t)},s.prototype.getCore=function(e){return this.buf[e]},s.prototype.setCore=function(e,t){this.buf[e]=t},s.prototype.dataLength=function(){return this.width*this.height},s}(s.Bitmap=p);s.Tilemap=o;var u=function(){function e(e,t,n){this.tilemap=e,this.tileset=t,this.layers=n,this.nextId=0}return e.prototype.cloneData=function(){return new e(this.tilemap.copy(),{tileWidth:this.tileset.tileWidth,tiles:this.tileset.tiles.map(function(e){return __assign(__assign({},e),{bitmap:p.fromData(e.bitmap).copy().data()})})},p.fromData(this.layers).copy().data())},e}();s.TilemapData=u;var e=function(){function e(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}return e.prototype.set=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;this.mask[r]|=1<<i},e.prototype.get=function(e,t){var n=e+this.width*t,r=n>>3,i=7&n;return this.mask[r]>>i&1},e}();function r(e){var t=atob(e.slice(e.indexOf(",")+1)),n=t.charCodeAt(0),r=t.charCodeAt(1),i=t.charCodeAt(2);135===n&&(n=224|t.charCodeAt(1),r=t.charCodeAt(2)|t.charCodeAt(3)<<8,i=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4));var o=new x.sprite.Bitmap(r,i),a=4;if(225===n)for(var s=1,c=t.charCodeAt(a++),u=0;u<r;++u)for(var l=0;l<i;++l)o.set(u,l,c&s?1:0),256==(s<<=1)&&(s=1,c=t.charCodeAt(a++));else for(u=0;u<r;u++){for(l=0;l<i;l+=2){c=t.charCodeAt(a++);o.set(u,l,15&c),l!=i-1&&o.set(u,l+1,c>>4&15)}for(;3&a;)a++}return o}function l(e,t){!(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:hex)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&t&&(e=t);var n=parseInt(e.substr(0,2),16)|parseInt(e.substr(2,2),16)<<8,r=parseInt(e.substr(4,2),16)|parseInt(e.substr(6,2),16)<<8,i=b(e.substring(8));return o.fromData({width:n,height:r,x0:0,y0:0,data:i})}function i(e){return""+t(e.width,2)+t(e.height,2)+y(e.data().data)}function t(e,t){var n=e.toString(16),r=t<<1;for(1&n.length&&(n="0"+n);n.length<r;)n+="0";return n}function n(e,t,n){var r=new p(t,n);return r.apply(e),r}function a(e,t,n){var r=new o(t,n);return r.apply(e),r}function f(e,t){!(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&t&&(e=t);for(var n=e.split("\n"),r=[],i=0,o=0;o<n.length;o++){for(var a=n[o],s=[],c=0;c<a.length;c++)switch(a[c]){case"0":case".":s.push(0);break;case"1":case"#":s.push(1);break;case"2":case"T":s.push(2);break;case"3":case"t":s.push(3);break;case"4":case"N":s.push(4);break;case"5":case"n":s.push(5);break;case"6":case"G":s.push(6);break;case"7":case"g":s.push(7);break;case"8":s.push(8);break;case"9":s.push(9);break;case"a":case"A":case"R":s.push(10);break;case"b":case"B":case"P":s.push(11);break;case"c":case"C":case"p":s.push(12);break;case"d":case"D":case"O":s.push(13);break;case"e":case"E":case"Y":s.push(14);break;case"f":case"F":case"W":s.push(15)}s.length&&(r.push(s),i=Math.max(i,s.length))}var u=r.length,l=new p(i,u);for(o=0;o<u;o++)for(a=r[o],c=0;c<i;c++)c<a.length?l.set(c,o,a[c]):l.set(c,o,0);return l}function d(e){var t="";switch(e){case"python":t='img("""';break;default:t="img`"}return t}function h(e){var t="";switch(e){case"python":t+='""")';break;default:t+="`"}return t}function m(e,t){var n=d(t);if(e)for(var r=300<e.width*e.height?"":" ",i=0;i<e.height;i++){n+="\n";for(var o=0;o<e.width;o++)n+=c[e.get(o,i)]+r}return n+="\n",n+=h(t)}function g(e){switch(e){case 8:return"TileScale.Eight";case 16:return"TileScale.Sixteen";case 32:return"TileScale.ThirtyTwo";default:return Math.floor(Math.log2(e)).toString()}}function v(e){switch(e=e.replace(/\s/g,"")){case"TileScale.Eight":return 8;case"TileScale.Sixteen":return 16;case"TileScale.ThirtyTwo":return 32;default:return Math.pow(2,parseInt(e))}}function b(e){for(var t=new Uint8ClampedArray(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t}function y(e){for(var t="0123456789abcdef",n="",r=0;r<e.length;++r)n+=t[e[r]>>4],n+=t[15&e[r]];return n}function w(e){var t,n,r,i=function(e){if(e){if(6===e.length)return parseInt("0x"+e);if(7===e.length)return parseInt("0x"+e.substr(1))}return 0}(e);return[(r=i,r>>16&255),(n=i,n>>8&255),(t=i,255&t)]}s.Bitmask=e,s.encodeTilemap=function(e,t){return e?"tiles.createTilemap("+((n=e.tilemap)?"hex`"+i(n)+"`":"hex``")+", "+m(p.fromData(e.layers),t)+", ["+e.tileset.tiles.map(function(e){return e.id})+"], "+g(e.tileset.tileWidth)+")":"null";var n},s.decodeTilemap=function(e,t,n){if(!(e=x.Util.htmlUnescape(e).trim()).trim())return null;var r,i,o=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),a=(e=e.substr(o.length+1)).substr(0,e.indexOf(",")),s=(e=e.substr(a.length+1)).substr(0,e.lastIndexOf("]")+1),c=e=e.substr(s.length+1);return new u(l(o),{tiles:(r=s,i=n,(r=r.replace(/[\[\]]/g,""))?r.split(",").filter(function(e){return!!e.trim()}).map(function(e){return function(e,t){if(0===(e=e.trim()).indexOf("img")){var n=f(e);return t.createNewTile(n.data())}return t.resolveTile(e)}(e,i)}):[]),tileWidth:v(c)},f(a).data())},s.trimTilemapTileset=function(e){var t=e.tileset.tiles.slice(),n=e.tilemap,r={};r[t[0].id]=!0;for(var i=0;i<n.width;i++)for(var o=0;o<n.height;o++)r[t[n.get(i,o)].id]=!0;var a=e.editedTiles||[],s=t.filter(function(e){return r[e.id]||"*"===e.id.charAt(0)||-1!==a.indexOf(e.id)});if(s.length!==t.length){for(var c=[],u=0;u<t.length;u++)c.push(s.indexOf(t[u]));for(i=0;i<n.width;i++)for(o=0;o<n.height;o++)n.set(i,o,c[n.get(i,o)]);e.tileset.tiles=s}},s.computeAverageColor=function(e,t){for(var n=t.map(w),r=[0,0,0],i=0,o=0;o<e.width;o++)for(var a=0;a<e.height;a++){var s=e.get(o,a);if(s){++i;var c=n[s];r[0]+=c[0],r[1]+=c[1],r[2]+=c[2]}}return i?"#"+function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t}(r.map(function(e){return Math.floor(e/i)})):"#00000000"},s.getBitmap=function(e,t){var n=e.apis.byQName[t];return n?r(n.attributes.jresURL):null},s.getBitmapFromJResURL=r,s.filterItems=function(e,t){var i=(t=t.filter(function(e){return!!e}).map(function(e){return e.toLowerCase()})).filter(function(e){return 0!==e.indexOf("!")}),o=t.filter(function(e){return 0===e.indexOf("!")&&1<e.length}).map(function(e){return e.substring(1)});return e.filter(function(e){return r=e,i.every(function(t){var n="?"+t;return r.tags.some(function(e){return e===t||e===n})})&&(n=e,o.every(function(t){return!n.tags.some(function(e){return e===t})}));var n,r})},s.getGalleryItems=function(e,t){var n,r,i,o,a=(n=e.apis,r=t,x.Util.values(n.byQName).filter(function(e){return 4===e.kind&&e.attributes.fixedInstance&&function(e,t,n){if(t==n)return!0;var r=e.byQName[t];return!(!r||!r.extendsTypes)&&0<=r.extendsTypes.indexOf(n)}(n,e.retType,r)}));return a=a.filter(function(e){return e.namespace!=s.TILE_NAMESPACE}),i=a,o=new x.ImageConverter,i.forEach(function(e){e.attributes.jresURL&&!e.attributes.iconURL&&0==e.attributes.jresURL.indexOf("data:image/x-mkcd-f")&&(e.attributes.iconURL=o.convert(e.attributes.jresURL))}),a.map(function(e){var t=(e.attributes.tags||"").split(" ").filter(function(e){return!!e}).map(function(e){return x.Util.startsWith(e,"category-")?e:e.toLowerCase()});return{qName:e.qName,src:e.attributes.iconURL,alt:e.qName,tags:t}})},s.base64EncodeBitmap=function(e){var n=p.fromData(e),t=pxtc.f4EncodeImg(e.width,e.height,4,function(e,t){return n.get(e,t)});return btoa(x.U.uint8ArrayToString(b(t)))},s.tilemapLiteralToTilemap=l,s.hexEncodeTilemap=i,s.formatByte=t,s.resizeBitmap=n,s.resizeTilemap=a,s.imageLiteralToBitmap=f,s.imageLiteralFromDimensions=function(e,t,n,r){for(var i=d(r),o=300<e*t?"":" ",a=0;a<t;a++){i+="\n";for(var s=0;s<e;s++)i+=c[n]+o}return i+="\n",i+=h(r)},s.bitmapToImageLiteral=m,s.tileWidthToTileScale=g,s.tileScaleToTileWidth=v,s.uint8ArrayToHex=y}(x.sprite||(x.sprite={}))}(pxt||(pxt={})),function(s){var c,e,u,l;c=s.sprite||(s.sprite={}),e=c.legacy||(c.legacy={}),u=new RegExp("^\\s*"+c.TILE_NAMESPACE+"\\s*\\.\\s*"+c.TILE_PREFIX+"(\\d+)\\s*$"),l=function(e,t,n){this.tilemap=e,this.tileset=t,this.layers=n,this.nextId=0},e.LegacyTilemapData=l,e.decodeTilemap=function(e,t){if(!(e=s.Util.htmlUnescape(e).trim()).trim())return new l(new c.Tilemap(16,16),{tileWidth:16,tiles:[]},new c.Bitmap(16,16).data());var n,r=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),i=(e=e.substr(r.length+1)).substr(0,e.indexOf(",")),o=(e=e.substr(i.length+1)).substr(0,e.lastIndexOf("]")+1),a=e=e.substr(o.length+1);return new l(c.tilemapLiteralToTilemap(r),{tiles:(n=o,(n=n.replace(/[\[\]]/g,""))?n.split(",").filter(function(e){return!!e.trim()}).map(function(e){return function(e){if(0===(e=e.trim()).indexOf("img")){var t=c.imageLiteralToBitmap(e);return{data:t.data()}}var n=u.exec(e);return n?{data:null,projectId:Number(n[1])}:{data:null,qualifiedName:e}}(e)}):[]),tileWidth:c.tileScaleToTileWidth(a)},c.imageLiteralToBitmap(i).data())},e.tileToBlocklyVariable=function(e){return e.projectId+";"+e.data.width+";"+e.data.height+";"+pxtc.Util.toHex(e.data.data)},e.blocklyVariableToTile=function(e){var t=e.split(";");return 4!==t.length?null:{projectId:parseInt(t[0]),data:{width:parseInt(t[1]),height:parseInt(t[2]),data:new Uint8ClampedArray(pxtc.Util.fromHex(t[3])),x0:0,y0:0}}}}(pxt||(pxt={})),function(E){var c=["name","version","description","license","dependencies","files","testFiles","testDependencies","fileDependencies","public","targetVersions","supportedTargets","preferredEditor","languageRestriction","additionalFilePath","additionalFilePaths"],e=function(){function h(e,t,n,r){this.id=e,this._verspec=t,this.parent=n,this.level=-1,this.isLoaded=!1,this.ignoreTests=!1,this.cppOnly=!1,r&&(this.level=r.level+1),this.addedBy=[r]}return h.stringifyConfig=function(e){for(var t=e,n={},r=0,i=c;r<i.length;r++){var o=i[r];t.hasOwnProperty(o)&&(n[o]=t[o])}for(var a=0,s=Object.keys(t);a<s.length;a++){o=s[a];n.hasOwnProperty(o)||(n[o]=t[o])}return JSON.stringify(n,null,4)+"\n"},h.parseAndValidConfig=function(e){var t=E.Util.jsonTryParse(e);return t&&void 0!==t.name&&"string"==typeof t.name&&t.files&&Array.isArray(t.files)&&t.files.every(function(e){return"string"==typeof e})&&t.dependencies&&Object.keys(t.dependencies).every(function(e){return"string"==typeof t.dependencies[e]})&&t},h.getConfigAsync=function(r,i,o){return Promise.resolve().then(function(){if(E.github.isGithubId(o)){var t=E.github.parseRepoId(o);return E.packagesConfigAsync().then(function(e){return E.github.repoAsync(t.fullName,e)}).then(function(e){return e?E.github.pkgConfigAsync(t.fullName,t.tag):null})}var e=E.patching.upgradePackageReference(r,i,o),n=E.appTarget.bundledpkgs[e];return JSON.parse(n[E.CONFIG_NAME])})},h.corePackages=function(){var t=E.appTarget.bundledpkgs;return Object.keys(t).map(function(e){return JSON.parse(t[e][E.CONFIG_NAME])}).filter(function(e){return!!e})},h.prototype.disablesVariant=function(e){return this.config&&this.config.disablesVariants&&0<=this.config.disablesVariants.indexOf(e)},h.prototype.invalid=function(){return/^invalid:/.test(this.version())},h.prototype.version=function(){return this.resolvedVersion||this._verspec},h.prototype.verProtocol=function(){var e=this.version().split(":");return 1<e.length?e[0]:""},h.prototype.verArgument=function(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()},h.prototype.targetVersion=function(){return this.parent&&this.parent!=this?this.parent.targetVersion():this.config.targetVersions?this.config.targetVersions.target:void 0},h.prototype.commonDownloadAsync=function(){var t=this,e=this.verProtocol();if("pub"==e)return E.Cloud.downloadScriptFilesAsync(this.verArgument());if("github"==e)return E.packagesConfigAsync().then(function(e){return E.github.downloadPackageAsync(t.verArgument(),e)}).then(function(e){return e.files});if("embed"==e){var n=E.getEmbeddedScript(this.verArgument());return Promise.resolve(n)}if("pkg"==e){var r=this.readFile(this.verArgument()),i=ts.pxtc.Util.jsonTryParse(r);return i||E.log("unable to find "+this.verArgument()),Promise.resolve(i)}return Promise.resolve(null)},h.prototype.host=function(){return this.parent._host},h.prototype.readFile=function(e){return this.host().readFile(this,e)},h.prototype.readGitJson=function(){var e=this.readFile(E.github.GIT_JSON);return E.Util.jsonTryParse(e)},h.prototype.resolveDep=function(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null},h.prototype.saveConfig=function(){var e=E.U.clone(this.config);delete e.additionalFilePaths;var t=E.Package.stringifyConfig(e);this.host().writeFile(this,E.CONFIG_NAME,t)},h.prototype.setPreferredEditor=function(e){this.config.preferredEditor!=e&&(this.config.preferredEditor=e,this.saveConfig())},h.prototype.getPreferredEditor=function(){var e=this.config.preferredEditor;if(!e){if(!(0<=this.getFiles().indexOf("main.blocks")))return E.JAVASCRIPT_PROJECT_NAME;var t=this.readFile("main.blocks"),n=this.readFile("main.ts");return!t&&n?E.JAVASCRIPT_PROJECT_NAME:E.BLOCKS_PROJECT_NAME}return e},h.prototype.parseJRes=function(e){void 0===e&&(e={});for(var t=0,n=this.getFiles();t<n.length;t++){var r=n[t];E.U.endsWith(r,".jres")&&i(JSON.parse(this.readFile(r)),e)}return e},h.prototype.resolveVersionAsync=function(){var e=this._verspec;return E.getEmbeddedScript(this.id)?this.resolvedVersion=e="embed:"+this.id:e&&"*"!=e||(this.configureAsInvalidPackage(lf("version not specified for {0}",this.id)),e=this._verspec),Promise.resolve(e)},h.prototype.downloadAsync=function(){var t=this;return this.resolveVersionAsync().then(function(e){if(t.invalid())E.debug("skip download of invalid package "+t.id);else if(/^embed:/.test(e)||t.installedVersion!=e)return E.debug("downloading "+e),t.host().downloadPackageAsync(t).then(function(){t.loadConfig(),E.debug("installed "+t.id+" /"+e)})})},h.prototype.loadConfig=function(){if(0==this.level||!this.invalid()){var e=this.readFile(E.CONFIG_NAME);e||E.U.userError("extension "+this.id+" is missing "+E.CONFIG_NAME),this.parseConfig(e),0!=this.level&&(this.installedVersion=this.version()),this.saveConfig()}},h.prototype.validateConfig=function(){this.config.dependencies||E.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||E.U.userError("Missing files in config of: "+this.id),"string"==typeof this.config.name&&this.config.name||(this.config.name=lf("Untitled")),this.config.targetVersions&&this.config.targetVersions.target&&0<E.semver.majorCmp(this.config.targetVersions.target,E.appTarget.versions.target)&&E.U.userError(lf("{0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,E.appTarget.versions.target))},h.prototype.isPackageInUse=function(n,e){void 0===e&&(e=this.readFile("main.ts"));var r=null,t=E.patching.computePatches(this.targetVersion(),"missingPackage");return t&&t.forEach(function(t){Object.keys(t.map).forEach(function(e){t.map[e]===n&&(r=new RegExp(e,"g"))})}),r||(r=new RegExp(n+"\\.","g")),r.test(e)},h.prototype.upgradePackagesAsync=function(){var a=this;return this.config||this.loadConfig(),E.packagesConfigAsync().then(function(r){var i=0,o={};return E.U.iterMap(a.config.dependencies,function(e,t){if(E.github.isGithubId(t)){var n=E.github.upgradedPackageReference(r,t);n&&n!=t&&(E.log("upgrading dep "+e+": "+t+" -> "+n),o[t]=n,a.config.dependencies[e]=n,i++)}}),i&&a.saveConfig(),i&&o})},h.prototype.getMissingPackages=function(i,o){var e=E.patching.computePatches(this.targetVersion(),"missingPackage"),a={};return o&&e&&e.forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp(e,"g"),n=r.map[e];o.replace(t,function(e){return i.dependencies[n]||(a[n]="*"),""})})}),a},h.prototype.findConflictsAsync=function(e,p){var f,n=this,d=[];return Promise.resolve().then(function(){return"string"==typeof e?h.getConfigAsync(n.targetVersion(),e,p):Promise.resolve(e)}).then(function(e){if(f=e){var l=f.yotta?E.U.jsonFlatten(f.yotta.config):null;n.parent.sortedDeps().forEach(function(e){if(f.core&&e.config.core&&f.name!=e.config.name)return(a=new E.cpp.PkgConflictError(lf("conflict between core extensions {0} and {1}",f.name,e.id))).pkg0=e,void d.push(a);var t=!1;if(l){var n=e.config||JSON.parse(e.readFile(E.CONFIG_NAME));if(!!n&&!!n.yotta&&!!e.config.yotta.config)for(var r=E.U.jsonFlatten(n.yotta.config),i=0,o=Object.keys(l);i<o.length;i++){var a,s=o[i],c=r[s],u=f.yotta.configIsJustDefaults||n.yotta.configIsJustDefaults;if(r.hasOwnProperty(s)&&c!==l[s]&&!u&&(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts))(a=new E.cpp.PkgConflictError(lf("conflict on yotta setting {0} between extensions {1} and {2}",s,f.name,e.id))).pkg0=e,a.settingName=s,d.push(a),t=!0}}t||f.name!==e.id||e._verspec==p||/^file:/.test(e._verspec)||/^file:/.test(p)||((a=new E.cpp.PkgConflictError(lf("version mismatch for extension {0} (installed: {1}, installing: {2})",e,e._verspec,p))).pkg0=e,a.isVersionConflict=!0,d.push(a))})}return Object.keys(f.dependencies).reduce(function(e,t){return e.then(function(){return n.findConflictsAsync(t,f.dependencies[t])}).then(function(e){return d.push.apply(d,e)})},Promise.resolve())}).then(function(){var r=function(e){var t=[];return e.addedBy.forEach(function(e){e.id!==n.id&&(t.push.apply(r(e)),t.push(e))}),t},e=[];return d.forEach(function(n){e.push.apply(e,r(n.pkg0).map(function(e){var t=new E.cpp.PkgConflictError(n.isVersionConflict?lf("a dependency of {0} has a version mismatch with extension {1} (installed: {1}, installing: {2})",e.id,f.name,n.pkg0._verspec,p):lf("conflict on yotta setting {0} between extensions {1} and {2}",n.settingName,f.name,n.pkg0.id));return t.pkg0=e,t}))}),d.push.apply(d,e),d=d.filter(function(e,t){for(var n=0;n<t;++n)if(e.pkg0.id===d[n].pkg0.id)return!1;return!0})})},h.prototype.configureAsInvalidPackage=function(e){E.log("invalid package "+this.id+": "+e),this._verspec="invalid:"+this.id,this.config={name:this.id,description:e,dependencies:{},files:[]}},h.prototype.parseConfig=function(e,t){try{var n=JSON.parse(e);this.config=n}catch(e){this.configureAsInvalidPackage(lf("Syntax error in pxt.json"))}var r=JSON.stringify(this.config);for(var i in this.config.dependencies){var o=E.patching.upgradePackageReference(this.targetVersion(),i,this.config.dependencies[i]);o!=i&&(delete this.config.dependencies[i],o&&(this.config.dependencies[o]="*"))}t&&(this.config.targetVersions={target:t}),JSON.stringify(this.config)!=r&&this.saveConfig(),this.validateConfig()},h.prototype.patchCorePackage=function(){var t=this;E.Util.assert(E.appTarget.simulator&&E.appTarget.simulator.dynamicBoardDefinition),E.Util.assert(0==this.level);var e=Object.keys(this.config.dependencies).filter(function(e){return!!e&&(e==E.BLOCKS_PROJECT_NAME||e==E.JAVASCRIPT_PROJECT_NAME||JSON.parse((E.appTarget.bundledpkgs[e]||{})[E.CONFIG_NAME]||"{}").core)});if(0==e.length){var n=E.Package.corePackages();n.length&&this.config.dependencies[n[0].name]}else 1<e.length&&(e.pop(),e.forEach(function(e){E.log("removing core package "+e),delete t.config.dependencies[e]}))},h.prototype.resolvedDependencies=function(){var t=this;return Object.keys(this.dependencies()).map(function(e){return t.resolveDep(e)})},h.prototype.dependencies=function(e){if(void 0===e&&(e=!1),!this.config)return{};var n=E.Util.clone(this.config.dependencies||{});return 0==this.level&&this.config.testDependencies&&E.Util.iterMap(this.config.testDependencies,function(e,t){("*"!=t||E.appTarget.bundledpkgs[e])&&(n[e]=t)}),e&&this.config.cppDependencies&&E.Util.jsonMergeFrom(n,this.config.cppDependencies),n},h.prototype.loadAsync=function(l,e){var p=this;if(void 0===l&&(l=!1),this.isLoaded)return Promise.resolve();var t=Promise.resolve();0!=this.level||E.appTarget.multiVariants||E.setAppTargetVariant(null),this.isLoaded=!0;var n=this.readFile(E.CONFIG_NAME);null==n?l||E.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):t=t.then(function(){return p.parseConfig(n)}),0!=this.level||l||(t=t.then(function(){return p.upgradePackagesAsync().then(function(){})})),l&&(t=t.then(function(){return p.downloadAsync()})),0==this.level&&l&&(t=t.then(function(){return p.upgradePackagesAsync()}).then(function(e){return e?(Object.keys(e).forEach(function(e){return E.tickEvent("package.doubleload",{extension:e})}),E.log("upgraded, downloading again"),E.debug(e),p.downloadAsync()):Promise.resolve()})),E.appTarget.simulator&&E.appTarget.simulator.dynamicBoardDefinition&&(0==this.level&&(t=t.then(function(){return p.patchCorePackage()})),t=t.then(function(){if(p.config.compileServiceVariant&&E.setAppTargetVariant(p.config.compileServiceVariant),!(p.config.files.indexOf("board.json")<0)){var e=E.appTarget.simulator.boardDefinition=JSON.parse(p.readFile("board.json"));e.id=p.config.name,E.appTarget.appTheme.boardName=e.boardName||lf("board"),E.appTarget.appTheme.driveDisplayName=e.driveDisplayName||lf("DRIVE");var t=function(e){var t=/^pkg:\/\/(.*)/.exec(e);if(t){var n=t[1],r=p.readFile(n);return E.U.toDataUri(r,E.U.getMime(n))}return e},n=E.appTarget.simulator.boardDefinition;if("object"==typeof n.visual){var r=n.visual;r.image=t(r.image),r.outlineImage=t(r.outlineImage)}}}));var s=function(s,c,u){return void 0===u&&(u=!1),__awaiter(p,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(e){switch(e.label){case 0:s||(s=c.dependencies(u)),t=0,n=Object.keys(s),e.label=1;case 1:return t<n.length?(r=n[t],i=s[r]||"*","hw"==r&&E.hwVariant&&(r="hw---"+E.hwVariant),(o=c.resolveDep(r))?(o.invalid()?(o.level=Math.min(o.level,c.level+1),o.addedBy.push(c)):(o._verspec==i||/^file:/.test(o._verspec)||/^file:/.test(i)||E.U.userError("Version spec mismatch on "+r),u||(o.level=Math.min(o.level,c.level+1),o.addedBy.push(c))),[3,4]):[3,2]):[3,5];case 2:return a=new h(r,i,c.parent,c),u&&(a.cppOnly=!0),c.parent.deps[r]=a,[4,(c.parent.deps[r.replace(/---.*/,"")]=a).loadAsync(l)];case 3:e.sent(),e.label=4;case 4:return t++,[3,1];case 5:return[2]}})})};return t.then(function(){return s(null,p)}).then(function(){if(p.config.palette&&E.appTarget.runtime&&(E.appTarget.runtime.palette=E.U.clone(p.config.palette),p.config.paletteNames&&(E.appTarget.runtime.paletteNames=p.config.paletteNames)),p.config.screenSize&&E.appTarget.runtime&&(E.appTarget.runtime.screenSize=E.U.clone(p.config.screenSize)),0===p.level){var e=p.readFile("main.ts");if(!e)return Promise.resolve(null);var o=p.getMissingPackages(p.config,e),a=!1;return Object.keys(o).reduce(function(e,i){return e.then(function(){return p.findConflictsAsync(i,o[i])}).then(function(e){if(e.length){var t=e.map(function(e){return e.pkg0.id}).join(", "),n=e.map(function(e){return e.settingName}).filter(function(e){return!!e}).join(", ");return E.log("skipping missing package "+i+" because it conflicts with the following packages: "+t+" (conflicting settings: "+n+")"),Promise.resolve(null)}E.log("adding missing package "+i),a=!0,p.config.dependencies[i]="*";var r={};return r[i]=o[i],s(r,p)})},Promise.resolve(null)).then(function(){return a&&(p.saveConfig(),p.validateConfig()),Promise.resolve(null)})}return Promise.resolve(null)}).then(function(){return 0!=p.level?Promise.resolve():Promise.all(E.U.values(p.parent.deps).map(function(e){return s(null,e,!0)}))}).then(function(){E.debug("  installed "+p.id)})},h.prototype.getFiles=function(){var e,r=this;e=0!=this.level||this.ignoreTests?this.config.files.slice(0):this.config.files.concat(this.config.testFiles||[]);var i=this.config.fileDependencies;return this.config.fileDependencies&&(e=e.filter(function(e){var t=E.U.lookup(i,e);if(!t)return!0;if(!(t=t.trim()))return!0;if(/^[\w-]+$/.test(t)){var n=r.parent.resolveDep(t);return!(!n||n.cppOnly)}return h.depWarnings[t]||(h.depWarnings[t]=!0,E.log("invalid dependency expression: "+t+" in "+r.id+"/"+e)),!1})),e},h.prototype.addSnapshot=function(e,n){void 0===n&&(n=[""]);for(var t=function(t){n.some(function(e){return E.U.endsWith(t,e)})&&(e[r.id+"/"+t]=r.readFile(t))},r=this,i=0,o=this.getFiles();i<o.length;i++){t(o[i])}e[this.id+"/"+E.CONFIG_NAME]=this.readFile(E.CONFIG_NAME)},h.prototype.packageLocalizationStringsAsync=function(n){var r=this,i=E.appTarget.id,e=[this.config.name+"-jsdoc",this.config.name],o={},a=E.appTarget.appTheme||{};return this.config.skipLocalization?Promise.resolve(o):E.Util.localizeLive&&"this"!=this.id&&E.appTarget.bundledpkgs[this.id]?(E.debug("loading live translations for "+this.id),Promise.all(e.map(function(t){return E.Util.downloadLiveTranslationsAsync(n,i+"/"+t+"-strings.json",a.crowdinBranch).then(function(e){e&&Object.keys(e).length?E.Util.jsonMergeFrom(o,e):(E.tickEvent("translations.livetranslationsfailed",{filename:t}),E.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t)))}).catch(function(e){E.tickEvent("translations.livetranslationsfailed",{filename:t}),E.log("error while downloading "+i+"/"+t+"-strings.json"),E.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t))})})).then(function(){return o})):(e.map(function(e){return r.bundledStringsForFile(n,e)}).filter(function(e){return!!e}).forEach(function(e){return E.Util.jsonMergeFrom(o,e)}),Promise.resolve(o))},h.prototype.bundledStringsForFile=function(e,t){var n={},r=E.Util.normalizeLanguageCode(e),i=r[0],o=r[1],a=r[2],s=this.config.files,c="_locales/"+i+"/"+t+"-strings.json";return-1<s.indexOf(c)?n=JSON.parse(this.readFile(c)):a&&(c="_locales/"+a+"/"+t+"-strings.json",-1<s.indexOf(c)?n=JSON.parse(this.readFile(c)):o&&(c="_locales/"+o+"/"+t+"-strings.json",-1<s.indexOf(c)&&(n=JSON.parse(this.readFile(c))))),n},h.depWarnings={},h}(),t=function(n){function e(e){var t=n.call(this,"this","file:.",null,null)||this;return t._host=e,t.deps={},(t.parent=t).addedBy=[t],t.level=0,t.deps[t.id]=t}return __extends(e,n),e.prototype.installAllAsync=function(e){return this.loadAsync(!0,e)},e.prototype.sortedDeps=function(n){var r=this;void 0===n&&(n=!1);var i={},o=[],a=function(e){return e.config?Object.keys(e.config.cppDependencies||{}).length:0},s=function(e){if(e&&!E.U.lookup(i,e.id)){i[e.id]=!0;var t=Object.keys(e.dependencies(n)).map(function(e){return r.resolveDep(e)});t.sort(function(e,t){return a(t)-a(e)||E.U.strcmp(e.id,t.id)}),t.forEach(s),o.push(e.id)}};return s(this),o.map(function(e){return r.resolveDep(e)})},e.prototype.localizationStringsAsync=function(t){var n={};return Promise.all(E.Util.values(this.deps).map(function(e){return e.packageLocalizationStringsAsync(t).then(function(t){t&&Object.keys(t).forEach(function(e){n[e]||(n[e]=t[e])})})})).then(function(){var t=E.U.getLocalizedStrings();return Object.keys(n).forEach(function(e){(E.U.startsWith(e,"{id:subcategory}")||E.U.startsWith(e,"{id:group}"))&&(t[e]||(t[e]=n[e]))}),E.U.setLocalizedStrings(t),Promise.resolve(n)})},e.prototype.getTargetOptions=function(){var t=E.U.clone(E.appTarget.compile);return E.U.assert(!!t),t.utf8||this.sortedDeps(!0).forEach(function(e){e.config&&e.config.utf8&&(E.debug("forcing utf8 mode: pkg="+e.id),t.utf8=!0)}),t},e.prototype.getJRes=function(){if(!this._jres){this._jres={};for(var e=0,t=this.sortedDeps();e<t.length;e++){t[e].parseJRes(this._jres)}var n=(E.appTarget.runtime&&E.appTarget.runtime.palette?E.appTarget.runtime.palette:["#000000","#ffffff"]).map(function(e){return("000000"+parseInt(e.replace(/#/,""),16).toString(16)).slice(-6)}).join("");this._jres.__palette={id:"__palette",data:n,dataEncoding:"hex",mimeType:"application/x-palette"}}return this._jres},e.prototype.updateJRes=function(){this._jres&&this.parseJRes(this._jres)},e.prototype.resolveBannedCategories=function(){var t=this;if(void 0!==this._resolvedBannedCategories)return this._resolvedBannedCategories;var n=[];return E.appTarget&&E.appTarget.runtime&&E.appTarget.runtime.bannedCategories&&E.appTarget.runtime.bannedCategories.length&&(n=E.appTarget.runtime.bannedCategories.slice(),Object.keys(this.deps).map(function(e){return t.deps[e]}).filter(function(e){return!!e}).map(function(e){return E.Util.jsonTryParse(e.readFile(E.CONFIG_NAME))}).filter(function(e){return e&&e.requiredCategories}).forEach(function(e){return e.requiredCategories.forEach(function(e){var t=n.indexOf(e);-1<t&&n.splice(t,1)})}),this._resolvedBannedCategories=n),this._resolvedBannedCategories=n,this._resolvedBannedCategories.length||(this._resolvedBannedCategories=null),this._resolvedBannedCategories},e.prototype.getCompileOptionsAsync=function(C){return void 0===C&&(C=this.getTargetOptions()),__awaiter(this,void 0,void 0,function(){var t,s,c,n,r,i,o,a,u,l,p,f,d,h,m,g,v,b,y,w,x,k,A,T=this;return __generator(this,function(e){switch(e.label){case 0:return t={sourceFiles:[],fileSystem:{},target:C,name:this.config?this.config.name:""},c=!(s=function(e,t){T.config.files.indexOf(e)<0&&E.U.userError(lf("please add '{0}' to \"files\" in {1}",e,E.CONFIG_NAME)),t="// Auto-generated. Do not edit.\n"+t+"\n// Auto-generated. Do not edit. Really.\n",T.host().readFile(T,e,!0)!==t&&(E.debug("updating "+e+" (size="+t.length+")..."),T.host().writeFile(T,e,t,!0))}),n=function(a){return __awaiter(T,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(e){switch(e.label){case 0:t={extinfo:null,target:null},n=E.appTargetVariant,a&&E.setAppTargetVariant(a,{temporary:!0}),e.label=1;case 1:return e.trys.push([1,,5,6]),r=E.cpp.getExtensionInfo(this),c||(c=!0,r.shimsDTS&&s("shims.d.ts",r.shimsDTS),r.enumsDTS&&s("enums.d.ts",r.enumsDTS)),C.isNative?[4,this.host().getHexInfoAsync(r)]:[3,3];case 2:return o=e.sent(),[3,4];case 3:o=null,e.label=4;case 4:return i=o,r=E.U.flatClone(r),C.keepCppFiles||(delete r.compileData,delete r.generatedFiles,delete r.extensionFiles),r.hexinfo=i,t.extinfo=r,t.target=E.appTarget.compile,[3,6];case 5:return a&&E.setAppTargetVariant(n,{temporary:!0}),[7];case 6:return[2,t]}})})},[4,this.loadAsync()];case 1:e.sent(),t.bannedCategories=this.resolveBannedCategories(),t.target.preferredEditor=this.getPreferredEditor(),E.debug("building: "+this.sortedDeps().map(function(e){return e.config.name}).join(", ")),r=E.appTarget.multiVariants?E.appTargetVariant?[E.appTargetVariant]:E.appTarget.alwaysMultiVariant||E.appTarget.compile.switches.multiVariant?E.appTarget.multiVariants:[E.appTarget.multiVariants[0]]:[null],i=null,o=0,a=r,e.label=2;case 2:return o<a.length?(u=a[o],i&&E.debug("building for "+u),[4,n(u)]):[3,5];case 3:l=e.sent(),(p=l.extinfo).appVariant=u,p.outputPrefix=1!=r.length&&u?u+"-":"",i?t.otherMultiVariants.push(l):(i=p,t.otherMultiVariants=[]),e.label=4;case 4:return o++,[3,2];case 5:return t.extinfo=i,E.appTarget.compile.shortPointers||"vm"==E.appTarget.compile.nativeType||this.config.binaryonly||!t.target.isNative?[3,8]:[4,this.filesToBePublishedAsync(!0)];case 6:return f=e.sent(),d=JSON.stringify({name:this.config.name,comment:this.config.description,status:"unpublished",scriptId:this.installedVersion,cloudId:E.CLOUD_ID+E.appTarget.id,editor:this.getPreferredEditor(),targetVersions:E.appTarget.versions}),h=JSON.stringify(f),[4,E.lzmaCompressAsync(d+h)];case 7:(m=e.sent())&&(t.embedMeta=JSON.stringify({compression:"LZMA",headerSize:d.length,textSize:h.length,name:this.config.name,eURL:E.appTarget.appTheme.embedUrl,eVER:E.appTarget.versions?E.appTarget.versions.target:"",pxtTarget:E.appTarget.id}),t.embedBlob=ts.pxtc.encodeBase64(E.U.uint8ArrayToString(m))),e.label=8;case 8:for(g=0,v=this.sortedDeps();g<v.length;g++)for(b=v[g],y=0,w=b.getFiles();y<w.length;y++)x=w[y],/\.(ts|asm|py)$/.test(x)&&(k=x,0<b.level&&(k="pxt_modules/"+b.id+"/"+x),t.sourceFiles.push(k),t.fileSystem[k]=b.readFile(x));return t.jres=this.getJRes(),A=E.appTarget.runtime&&E.appTarget.runtime.functionsOptions,t.allowedArgumentTypes=A&&A.extraFunctionEditorTypes&&A.extraFunctionEditorTypes.map(function(e){return e.typeName}).concat("number","boolean","string"),[2,t]}})})},e.prototype.prepareConfigToBePublished=function(){var i=this,o=E.U.clone(this.config);return delete o.installedVersion,delete o.additionalFilePath,delete o.additionalFilePaths,o.targetVersions||(o.targetVersions=E.Util.clone(E.appTarget.versions)),E.U.iterMap(o.dependencies,function(e,t){if(!t||/^(file|workspace):/.test(t)){t="*";try{var n=i.resolveDep(e).readGitJson();if(n&&n.repo){var r=E.github.parseRepoId(n.repo);r.tag=n.commit.tag||n.commit.sha,t=E.github.stringifyRepo(r)}}catch(e){}o.dependencies[e]=t}}),o},e.prototype.filesToBePublishedAsync=function(o){var a=this;void 0===o&&(o=!1);var s={};return this.loadAsync().then(function(){o||a.config.public||E.U.userError('Only packages with "public":true can be published');var e=a.prepareConfigToBePublished();s[E.CONFIG_NAME]=E.Package.stringifyConfig(e);for(var t=0,n=a.getFiles();t<n.length;t++){var r=n[t];if(r!=E.CONFIG_NAME){var i=a.readFile(r);null==i&&E.U.userError("referenced file missing: "+r),s[r]=i}}return E.U.sortObjectFields(s)})},e.prototype.saveToJsonAsync=function(){var t=this;return this.filesToBePublishedAsync(!0).then(function(e){return{meta:{cloudId:E.CLOUD_ID+E.appTarget.id,targetVersions:E.appTarget.versions,editor:t.getPreferredEditor(),name:t.config.name},source:JSON.stringify(e,null,2)}})},e.prototype.compressToFileAsync=function(){return this.saveToJsonAsync().then(function(e){return E.lzmaCompressAsync(JSON.stringify(e,null,2))})},e.prototype.computePartDefinitions=function(o){if(!o||!o.length)return{};var a={};return this.sortedDeps().forEach(function(r){var e=r.readFile("pxtparts.json");if(e)try{var i=JSON.parse(e);Object.keys(i).forEach(function(e){if(0<=o.indexOf(e)){var t=a[e]=i[e];if("string"==typeof t.visual.image&&/\.svg$/i.test(t.visual.image)){var n=r.readFile(t.visual.image);n||E.reportError("parts","invalid part definition",{error:"missing visual "+t.visual.image}),t.visual.image="data:image/svg+xml,"+encodeURIComponent(n)}}})}catch(e){E.reportError("parts","invalid pxtparts.json file")}}),a},e}(E.Package=e);function i(e,t){void 0===t&&(t={});for(var n=e["*"]||{},r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];if("*"!=o){var a=e[o];"string"==typeof a&&(a={data:a});var s=a.namespace||n.namespace||"";s&&(s+=".");var c=a.id||s+o,u=a.icon,l=a.mimeType||n.mimeType,p=a.dataEncoding||n.dataEncoding||"base64";u||"base64"!=p||"image/png"!=l&&"image/jpeg"!=l||(u="data:"+l+";base64,"+a.data),t[c]={id:c,data:a.data,dataEncoding:p,icon:u,namespace:s,mimeType:l,tilemapTile:a.tilemapTile,tileset:a.tileset}}}return t}E.MainPackage=t,E.inflateJRes=i,E.allPkgFiles=function(e){return[E.CONFIG_NAME].concat(e.files||[]).concat(e.testFiles||[])},E.isPkgBeta=function(e){return e&&/\bbeta\b/.test(e.description)}}(pxt||(pxt={})),function(u){!function(n){var r,i,o,a,s=function(){};function c(){if(a)return a;var e=Promise.resolve();if(r){u.debug("packetio: disconnect");var t=r;e=e.then(function(){return t.disconnectAsync()}).then(function(){return t.io.disposeAsync()}).catch(function(e){u.reportException(e)}).finally(function(){a=r=i=void 0}),s&&(e=e.then(function(){return s()})),a=e}return e}n.isActive=function(){return!!r},n.isConnected=function(){return!!r&&r.io.isConnected()},n.isConnecting=function(){return!!r&&r.io.isConnecting()},n.icon=function(){return!!r&&(r.icon||"usb")},n.disconnectAsync=c,n.configureEvents=function(e,t){s=e,o=t,r&&(r.io.onConnectionChanged=s,r.onSerial=o)},n.initAsync=function(e){if(void 0===e&&(e=!1),u.debug("packetio: init "+(e?"(force)":"")),!i){var t=Promise.resolve();e&&(t=t.then(function(){return c()})),i=t.then(function(){return r?Promise.resolve(r):n.mkPacketIOAsync?(u.debug("packetio: new wrapper"),n.mkPacketIOAsync().then(function(e){return e.onConnectionChanged=s,r=n.mkPacketIOWrapper(e),o&&(r.onSerial=o),s&&s(),r})):(u.debug("packetio: not defined, skipping"),Promise.resolve(void 0))}).finally(function(){i=void 0})}return i}}(u.packetio||(u.packetio={}))}(pxt||(pxt={})),function(o){var e;(e=o.patching||(o.patching={})).computePatches=function(e,t){var n=o.appTarget.compile?o.appTarget.compile.patches:void 0;if(n){var r=o.semver.tryParse(e||"0.0.0")||o.semver.tryParse("0.0.0"),i=[];return Object.keys(n).filter(function(e){return o.semver.inRange(e,r)}).forEach(function(e){return i=i.concat(n[e])}),t&&(i=i.filter(function(e){return e.type==t})),i.length?i:void 0}},e.upgradePackageReference=function(e,t,n){if("*"!=n)return t;var r=o.patching.computePatches(e,"package"),i=t;return r&&r.forEach(function(t){Object.keys(t.map).forEach(function(e){i==e&&(i=t.map[e])})}),i},e.patchJavaScript=function(e,t){var n=o.patching.computePatches(e),i=t;return n&&(n.filter(function(e){return"api"===e.type}).forEach(function(n){Object.keys(n.map).forEach(function(e){var t=new RegExp(e,"g");i=i.replace(t,n.map[e])})}),n.filter(function(e){return"userenum"===e.type}).forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp("enum\\s+"+e+"\\s*{","gm");i=i.replace(t,"enum "+r.map[e]+" {");var n=new RegExp("(^|[^_a-zA-Z0-9])"+e+"(\\s*\\.)","g");i=i.replace(n,"$1"+r.map[e]+"$2")})})),i}}(pxt||(pxt={})),function(e){e.react||(e.react={})}(pxt||(pxt={})),function(p){!function(n){function s(e,t){if(e){if(t){var n=e.major-t.major||e.minor-t.minor||e.patch-t.patch;if(n)return n;if(0==e.pre.length&&0<t.pre.length)return 1;if(0<e.pre.length&&0==t.pre.length)return-1;for(var r=0;r<e.pre.length+1;++r){var i=e.pre[r],o=t.pre[r];if(!i)return o?-1:0;if(!o)return 1;if(/^\d+$/.test(i)){if(!/^\d+$/.test(o))return-1;if(n=parseInt(i)-parseInt(o))return n}else{if(/^\d+$/.test(o))return 1;if(n=p.U.strcmp(i,o))return n}}return 0}return-1}return t?1:0}function a(e,t){var n=c(e)||c(t);return n||p.U.userError(p.U.lf("'{0}' doesn't look like a semantic version number",e)),n}function c(e){if(!e)return null;if("*"===e)return{major:Number.MAX_SAFE_INTEGER,minor:Number.MAX_SAFE_INTEGER,patch:Number.MAX_SAFE_INTEGER,pre:[],build:[]};/^v\d/i.test(e)&&(e=e.slice(1));var t=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return t?{major:parseInt(t[1]),minor:parseInt(t[2]),patch:parseInt(t[3]),pre:t[5]?t[5].split("."):[],build:t[7]?t[7].split("."):[]}:null}function u(e){var t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}function r(e,t){var n=c(e),r=c(t);return n||r?s(n,r):p.U.strcmp(e,t)}function l(e,t){var n=e.split(" - ");if(2!=n.length)return!1;var r=c(n[0]),i=c(n[1]);if(!r||!i)return!1;if(!t)return!0;var o=s(r,t),a=s(t,i);return o<=0&&a<0}n.cmp=s,n.parse=a,n.tryParse=c,n.normalize=function(e){return u(a(e))},n.stringify=u,n.majorCmp=function(e,t){var n=c(e),r=c(t);return n.major-r.major},n.strcmp=r,n.inRange=l,n.sortLatestTags=function(e){var t=e.filter(function(e){return!!n.tryParse(e)});return t.sort(r),t.reverse(),t},n.test=function(){console.log("Test semver");for(var e=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"],t=0;t<e.length;++t){var n=a(e[t]);console.log(e[t],n),p.U.assert(u(n)==e[t]);for(var r=0;r<e.length;++r){var i=s(n,a(e[r]));console.log(e[t],e[r],i),t<r?p.U.assert(i<0):r<t?p.U.assert(0<i):p.U.assert(0==i)}}var o=c("1.2.3");p.U.assert(l("0.1.2 - 2.2.3",o)),p.U.assert(l("1.2.3 - 2.2.3",o)),p.U.assert(!l("0.0.0 - 1.2.3",o)),p.U.assert(!l("1.2.4 - 4.2.3",o)),p.U.assert(!l("0.0.0 - 0.0.1",o))}}(p.semver||(p.semver={}))}(pxt||(pxt={})),function(e){!function(U){function t(e){return U.Util.values(e.byQName).filter(function(e){return e.attributes.block&&/^{[^:]+:[^}]+}/.test(e.attributes.block)}).forEach(function(e){e.attributes.block=e.attributes.block.replace(/^{[^:]+:[^}]+}/,"")}),e}U.assert=U.Util.assert,U.oops=U.Util.oops,U.U=U.Util,U.ON_START_TYPE="pxt-on-start",U.ON_START_COMMENT="on start",U.HANDLER_COMMENT="code goes here",U.TS_STATEMENT_TYPE="typescript_statement",U.TS_DEBUGGER_TYPE="debugger_keyword",U.TS_BREAK_TYPE="break_keyword",U.TS_CONTINUE_TYPE="continue_keyword",U.TS_OUTPUT_TYPE="typescript_expression",U.TS_RETURN_STATEMENT_TYPE="function_return",U.PAUSE_UNTIL_TYPE="pxt_pause_until",U.COLLAPSED_BLOCK="pxt_collapsed_block",U.FUNCTION_DEFINITION_TYPE="function_definition",U.BINARY_JS="binary.js",U.BINARY_ASM="binary.asm",U.BINARY_HEX="binary.hex",U.BINARY_UF2="binary.uf2",U.BINARY_ELF="binary.elf",U.BINARY_PXT64="binary.pxt64",U.NATIVE_TYPE_THUMB="thumb",U.NATIVE_TYPE_VM="vm",U.BuildSourceMapHelpers=function(i,t,n){var e=function(e){var t=e.split("\n").map(function(e){return e.length}),n=t.reduce(function(e,t){var n=e.lens,r=e.sum;return{lens:__spreadArrays(n,[r+t+1]),sum:r+t+1}},{lens:[],sum:0}).lens;return{posToLineCol:function(r){var e=n.reduce(function(e,t,n){return r<t?e:n+1},0);return[e,t[e]-(n[e]-r)+1]},lineColToPos:function(e,t){return(n[e-1]||0)+t}}},l={ts:e(t),py:e(n)},p=function(e){return e.endPos-e.startPos},r=function(e,t){var n=e.startPos,r=e.endPos;return i.filter(function(e){return e[t].startPos<=n&&r<=e[t].endPos})},f=function(e,n){var t=r(e,n);return t.reduce(function(e,t){return p(t[n])<p(e[n])?t:e},t[0])},o={ts:{allOverlaps:function(e){return r(e,"ts")},smallestOverlap:function(e){return f(e,"ts")}},py:{allOverlaps:function(e){return r(e,"py")},smallestOverlap:function(e){return f(e,"py")}}},a=function(c,u){return function(e){var t,n=(t=e,[l[c].lineColToPos(t.line,t.column),t.length]),r=n[0],i=f({startPos:r,endPos:r+n[1]},c);if(i){var o=l[u].posToLineCol(i[u].startPos),a=o[0],s=o[1];return{fileName:"main."+u,start:i[u].startPos,length:p(i[u]),line:a,column:s}}}},s=a("ts","py"),c=a("py","ts");return{ts:__assign(__assign(__assign({},l.ts),o.ts),{locToLoc:s,getText:function(e){return t.substring(e.startPos,e.endPos)}}),py:__assign(__assign(__assign({},l.py),o.py),{locToLoc:c,getText:function(e){return n.substring(e.startPos,e.endPos)}})}},U.computeUsedParts=function(r,e){if(void 0===e&&(e=!1),!r.usedSymbols||!pxt.appTarget.simulator||!pxt.appTarget.simulator.parts)return[];var i=[];if(Object.keys(r.usedSymbols).forEach(function(e){var t=r.usedSymbols[e];if(t&&t.attributes.parts){var n=t.attributes.parts;n&&n.split(/[ ,]+/).forEach(function(e){0<e.length&&i.indexOf(e)<0&&i.push(e)})}}),e){var t=pxt.appTarget.simulator.boardDefinition.onboardComponents;t&&(i=i.filter(function(e){return t.indexOf(e)<0}))}return i.sort(),i=i.reverse()},U.blocksCategory=function(e){var t=e?e.attributes.blockNamespace||e.namespace:void 0;return t?U.Util.capitalize(t.split(".")[0]):void 0},U.getBlocksInfo=function(e,t){var n,m=[],g={},v={},b={},r={},i={};function o(e,t){var n="get"==e,r="set"==e,i="number"==t.retType,o=n?v:r?g:b,a=t.namespace+"."+t.retType,s=U.U.lookup(o,a);if(!s){var c="@"+e+"@",u=void 0,l=void 0;if(t.attributes.blockCombineShadow){var p=t.attributes.blockCombineShadow,f=p.match(/^([^,.]*),?([^,.]*)$/);f&&3==f.length&&(u=f[1].trim(),0!=(l=f[2].trim()).length||U.Util.endsWith(p,",")||(l=u,u=""))}var d=(t.attributes.blockSetVariable||t.namespace.toLocaleLowerCase())+"="+(u||""),h="value="+(l||"");(s=o[a]={attributes:{blockId:(i?t.namespace:a)+"_blockCombine_"+e,callingConvention:0,group:t.attributes.group,paramDefl:{},jsDoc:n?U.U.lf("Read value of a property on an object"):U.U.lf("Update value of property on an object")},name:c,namespace:t.namespace,fileName:t.fileName,qName:a+"."+c,pkg:t.pkg,kind:2,parameters:[{name:"property",description:n?U.U.lf("the name of the property to read"):U.U.lf("the name of the property to change"),isEnum:!0,type:"@combined@"},{name:"value",description:r?U.U.lf("the new value of the property"):U.U.lf("the amount by which to change the property"),type:t.retType}].slice(0,n?1:2),retType:n?t.retType:"void",combinedProperties:[]}).attributes.block=n?U.U.lf("%{0} %property",d):r?U.U.lf("set %{0} %property to %{1}",d,h):U.U.lf("change %{0} %property by %{1}",d,h),O(s.attributes),m.push(s)}s.combinedProperties.push(t.qName)}for(var a=0,s=U.Util.values(e.byQName);a<s.length;a++){var c=s[a];if("ENUM_GET"===c.attributes.shim&&c.attributes.enumName&&c.attributes.blockId){var u=!1;if(r[c.attributes.enumName]&&(console.warn("Enum block "+c.attributes.blockId+" trying to overwrite enum "+c.attributes.enumName),u=!0),c.attributes.enumMemberName||(console.warn("Enum block "+c.attributes.blockId+" should specify enumMemberName"),u=!0),c.attributes.enumPromptHint||(console.warn("Enum block "+c.attributes.blockId+" should specify enumPromptHint"),u=!0),c.attributes.enumInitialMembers&&c.attributes.enumInitialMembers.length||(console.warn("Enum block "+c.attributes.blockId+" should specify enumInitialMembers"),u=!0),u)continue;var l=parseInt(c.attributes.enumStartValue);r[c.attributes.enumName]={blockId:c.attributes.blockId,name:c.attributes.enumName,memberName:c.attributes.enumMemberName,firstValue:isNaN(l)?void 0:l,isBitMask:c.attributes.enumIsBitMask,isHash:c.attributes.enumIsHash,initialMembers:c.attributes.enumInitialMembers,promptHint:c.attributes.enumPromptHint}}if("KIND_GET"===c.attributes.shim&&c.attributes.blockId){var p=c.attributes.kindNamespace||c.attributes.blockNamespace||c.namespace;if(i[p]){console.warn("More than one block defined for kind "+p);continue}var f=[];if(e.byQName[p])for(var d=0,h=U.Util.values(e.byQName);d<h.length;d++){var y=h[d];y.namespace===p&&y.attributes.isKind&&f.push(y.name)}i[p]={blockId:c.attributes.blockId,name:p,memberName:c.attributes.kindMemberName||p,initialMembers:f,promptHint:c.attributes.enumPromptHint||U.Util.lf("Create a new kind..."),createFunctionName:c.attributes.kindCreateFunction||"create"}}if(c.attributes.blockCombine)/@set/.test(c.name)||o("get",c),c.isReadOnly||("number"==c.retType&&o("change",c),o("set",c));else if(c.attributes.block&&!c.attributes.fixedInstance&&7!=c.kind&&5!=c.kind&&9!=c.kind&&8!=c.kind){if(c.attributes.blockId||(c.attributes.blockId=c.qName.replace(/\./g,"_")),"true"==c.attributes.block){var w=U.U.uncapitalize(c.name);1!=c.kind&&2!=c.kind||(w+=" %"+c.namespace.toLowerCase());for(var x=0,k=c.parameters||[];x<k.length;x++)w+=" %"+k[x].name;c.attributes.block=w,O(c.attributes)}m.push(c)}}for(var A=0,T=m;A<T.length;A++){w=T[A];var C=U.U.lookup(e.byQName,w.namespace);if(C)for(var E=C.attributes,S=w.attributes,_=0,I=["blockNamespace","color","blockGap"];_<I.length;_++){var P=I[_];void 0===S[P]&&E[P]&&(S[P]=E[P])}}return t&&(n=t).length&&(m=m.filter(function(e){var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];return-1===n.indexOf(t)})),{apis:e,blocks:m,blocksById:pxt.Util.toDictionary(m,function(e){return e.attributes.blockId}),enumsByName:r,kindsByName:i}},U.apiLocalizationStrings={},U.localizeApisAsync=function(u,e){var l=U.Util.userLanguage();if("en"==U.Util.userLanguage())return Promise.resolve(t(u));var p={},f=l.toLowerCase(),d=f+"|jsdoc",h=f+"|block";return e.localizationStringsAsync(l).then(function(c){return Promise.all(U.Util.values(u.byQName).map(function(n){U.apiLocalizationStrings&&U.Util.jsonMergeFrom(c,U.apiLocalizationStrings);var t=n.attributes.locs||{},e=c[n.qName]||t[d];e&&(n.attributes.jsDoc=e,n.parameters&&n.parameters.forEach(function(e){return e.description=c[n.qName+"|param|"+e.name]||t[f+"|param|"+e.name]||e.description}));var r=c["{id:category}"+U.Util.capitalize(n.qName)],i=c[n.qName+"|block"]||t[h];if(!i&&n.attributes.useLoc){var o=u.byQName[n.attributes.useLoc];if(o){var a=c[o.qName+"|block"];n.attributes.block===(o.attributes._untranslatedBlock||o.attributes.block)&&a&&(i=a)}}var s=Promise.resolve();return i&&pxt.Util.isTranslationMode()&&(n.attributes.translationId=i,s=s.then(function(){return pxt.crowdin.inContextLoadAsync(i)}).then(function(e){i=e})),s.then(function(){if(r)n.attributes.block?n.attributes.block=i||n.attributes.block:n.attributes.block=r,O(n.attributes);else if(n.attributes.block&&i){var e=pxt.blocks.compileInfo(n),t=n.attributes.block;n.attributes.block=pxt.blocks.normalizeBlock(i,function(e){return p[n.attributes.blockId+"."+l]=1}),(n.attributes._untranslatedBlock=t)!=n.attributes.block&&(O(n.attributes),function(e,t){if(e.parameters.length!=t.parameters.length)return pxt.debug("Localized block has extra or missing parameters"),!1;for(var n=0,r=e.parameters;n<r.length;n++){var i=r[n],o=t.actualNameToParam[i.actualName];if(!o||i.type!=o.type||i.shadowBlockId!=o.shadowBlockId)return pxt.debug("Parameter "+i.actualName+" type or shadow block does not match after localization"),!1}return!0}(e,pxt.blocks.compileInfo(n))||(pxt.log("block has non matching arguments: "+t+" vs "+n.attributes.block),p[n.attributes.blockId+"."+l]=2,n.attributes.block=t,O(n.attributes)))}else O(n.attributes)})}))}).then(function(){return t(u)}).finally(function(){Object.keys(p).length&&pxt.reportError("loc.errors","invalid translation",p)})},U.emptyExtInfo=function(){var e=pxt.appTarget.compileService;e||(e={});var t=!!e.platformioIni,n="dockermake"==e.buildEngine||"dockercross"==e.buildEngine,r={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?r.platformio={dependencies:{}}:n?r.npmDependencies={}:r.yotta={config:{},dependencies:{}},r};var a=["weight","imageLiteral","topblockWeight"],s=["advanced","handlerStatement","afterOnStart","optionalVariableArgs","blockHidden","constantShim","blockCombine","enumIsBitMask","enumIsHash","decompileIndirectFixedInstances","topblock","callInDebugger","duplicateShadowOnDrag","argsNullable"];function O(n){if(n.block){var e=n.block.split("||");n._def=t(r(e[0])),n._def||pxt.debug("Unable to parse block def for id: "+n.blockId),e[1]&&(n._expandedDef=t(r(e[1]))),e[1]&&!n._expandedDef&&pxt.debug("Unable to parse expanded block def for id: "+n.blockId)}function t(e){return n._shadowOverrides&&e.parameters.forEach(function(e){var t=n._shadowOverrides[e.name];"unset"===t?delete e.shadowBlockId:null!=t&&(e.shadowBlockId=t)}),e}}function r(p){for(var f,d=[],h=0,e=function(){var t=p[h],e=h,n=void 0;switch(t){case"*":case"_":var r=g(function(e){return e==t}),i="_"===t?2:0;1===r.length?n={kind:1<<i,content:r}:2===r.length?n={kind:2<<i,content:r}:3===r.length?n={kind:3<<i,content:r}:h=e;break;case"`":var o=v("`");if(void 0===o){h=e;break}n={kind:256,content:o};break;case"|":n={kind:32};break;case"\\":h<p.length-1&&(n={kind:16,content:p[1+h++]});break;case"[":var a=v("]");if(void 0!==a&&"("===p[1+h++]){var s=v(")");if(void 0!==s){n={kind:512,content:a,type:s};break}}h=e;break;case"$":case"%":var c=g(function(e){return/[a-zA-Z0-9_=]/.test(e)},!0).split("=");if(2<c.length){h=e;break}var u=void 0;if("("===p[h+1]){var l=h;++h,(u=v(")"))||(h=l)}n={kind:"$"===t?1024:64,content:c[0],type:c[1],name:u}}n?(f&&d.push({kind:128,content:f}),f=void 0,d.push(n)):f?f+=t:f=t};h<p.length;h++)e();f&&d.push({kind:128,content:f});for(var n=[],t=[],o=[],a=0,r="",s=[],i=0;i<d.length;i++){var c=d[i].kind,u=o[o.length-1];if(15&c)if(w(d[i].content),c&a)if(u&c){o.pop();var l=u&(a^=c)|c&a;l&&o.push(l)}else b();else a|=c,o.push(c);else 144&c?r+=d[i].content:1120&c&&y();if(64==c){var m={kind:"param",name:d[i].content,shadowBlockId:d[i].type,ref:!1};d[i].name&&(m.varName=d[i].name),n.push(m),t.push(m)}else if(1024==c){m={kind:"param",name:d[i].content,shadowBlockId:d[i].type,ref:!0};d[i].name&&(m.varName=d[i].name),n.push(m),t.push(m)}else 256==c?(w(),s.push({kind:"image",uri:d[i].content})):512==c?(w(),s.push({kind:"label",text:d[i].content,cssClass:d[i].type})):32==c&&n.push({kind:"break"})}return y(),{parts:n,parameters:t};function g(e,t){void 0===t&&(t=!1);var n="";for(t&&h++;h<p.length&&e(p[h]);)n+=p[h],++h;return n&&h--,n}function v(t){var e=g(function(e){return e!==t},!0);if(p[h+1]===t)return++h,e}function b(){for(var e="",t=[],n=0,r=s;n<r.length;n++){var i=r[n];x(i)?(t.push({content:e,styles:0}),t.push(i),e=""):(e+=i.content,i.endingToken&&(e+=i.endingToken))}s=t,e&&s.push({content:e,styles:0}),o=[],a=0}function y(){for(w(),a&&b();s.length;){var e=s.shift();if(x(e))n.push(e);else{if(!e.content)continue;var t=[];10&e.styles&&t.push("bold"),5&e.styles&&t.push("italics"),n.push({kind:"label",text:e.content,style:t})}}}function w(e){s.push({content:r,styles:a,endingToken:e}),r=""}}function x(e){return!!e.kind}U.parseCommentString=function(e){for(var f={paramDefl:{},callingConvention:0,_source:e},d=!0;d;)d=!1,e=e.replace(/\/\/%[ \t]*([\w\.]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,function(e,t,n,r,i,o,a){var s=i?JSON.parse(i):n?i||o||a:"true";if(s||(s=""),U.U.startsWith(t,"block.loc."))f.locs||(f.locs={}),f.locs[t.slice("block.loc.".length).toLowerCase()+"|block"]=s;else if(U.U.startsWith(t,"jsdoc.loc."))f.locs||(f.locs={}),f.locs[t.slice("jsdoc.loc.".length).toLowerCase()+"|jsdoc"]=s;else if(U.U.contains(t,".loc.")){f.locs||(f.locs={});var c=t.slice(0,t.indexOf(".loc.")),u=t.slice(t.indexOf(".loc.")+".loc.".length);f.locs[u+"|param|"+c]=s}else if(U.U.endsWith(t,".defl"))-1<s.indexOf(" ")?f.paramDefl[t.slice(0,t.length-5)]='"'+s+'"':f.paramDefl[t.slice(0,t.length-5)]=s,f.explicitDefaults||(f.explicitDefaults=[]),f.explicitDefaults.push(t.slice(0,t.length-5));else if(U.U.endsWith(t,".shadow"))f._shadowOverrides||(f._shadowOverrides={}),f._shadowOverrides[t.slice(0,t.length-7)]=s;else if(U.U.endsWith(t,".fieldEditor"))f.paramFieldEditor||(f.paramFieldEditor={}),f.paramFieldEditor[t.slice(0,t.length-12)]=s;else if(U.U.contains(t,".fieldOptions.")){f.paramFieldEditorOptions||(f.paramFieldEditorOptions={});var l=t.slice(0,t.indexOf(".fieldOptions.")),p=t.slice(t.indexOf(".fieldOptions.")+14,t.length);f.paramFieldEditorOptions[l]||(f.paramFieldEditorOptions[l]={}),f.paramFieldEditorOptions[l][p]=s}else U.U.contains(t,".shadowOptions.")?(f.paramShadowOptions||(f.paramShadowOptions={}),l=t.slice(0,t.indexOf(".shadowOptions.")),p=t.slice(t.indexOf(".shadowOptions.")+15,t.length),f.paramShadowOptions[l]||(f.paramShadowOptions[l]={}),f.paramShadowOptions[l][p]=s):U.U.endsWith(t,".min")?(f.paramMin||(f.paramMin={}),f.paramMin[t.slice(0,t.length-4)]=s):U.U.endsWith(t,".max")?(f.paramMax||(f.paramMax={}),f.paramMax[t.slice(0,t.length-4)]=s):f[t]=s;return d=!0,"//% "});for(var t=0,n=a;t<n.length;t++){var r=n[t];"string"==typeof f[r]&&(f[r]=parseInt(f[r]))}for(var i=0,o=s;i<o.length;i++)r=o[i],"string"==typeof f[r]&&(f[r]="true"==f[r]||"1"==f[r]);if(f.trackArgs&&(f.trackArgs=f.trackArgs.split(/[ ,]+/).map(function(e){return parseInt(e)||0})),f.enumInitialMembers&&(f.enumInitialMembers=f.enumInitialMembers.split(/[ ,]+/)),f.blockExternalInputs&&!f.inlineInputMode&&(f.inlineInputMode="external"),f.paramHelp={},f.jsDoc="",e=e.replace(/\/\*\*([^]*?)\*\//g,function(e,t){return t=(t=t.replace(/\n\s*(\*\s*)?/g,"\n")).replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,function(e,t,n){if(f.paramHelp[t]=n,!f.paramDefl[t]){var r=/\beg\.?:\s*(.+)/.exec(n);if(r&&r[1]){var i=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(r[1]);if(i){var o=i[1]||i[2]||i[3];o||(o=""),-1<o.indexOf(" ")?f.paramDefl[t]='"'+o+'"':f.paramDefl[t]=o}}}return""}),f.jsDoc+=t,""}),f.jsDoc=f.jsDoc.trim(),f.async&&(f.callingConvention=1),f.promise&&(f.callingConvention=2),f.jres&&(f.whenUsed=!0),f.subcategories)try{f.subcategories=JSON.parse(f.subcategories)}catch(e){f.subcategories=void 0}if(f.groups)try{f.groups=JSON.parse(f.groups)}catch(e){f.groups=void 0}if(f.groupIcons)try{f.groupIcons=JSON.parse(f.groupIcons)}catch(e){f.groupIcons=void 0}if(f.groupHelp)try{f.groupHelp=JSON.parse(f.groupHelp)}catch(e){f.groupHelp=void 0}return O(f),f},U.updateBlockDef=O,U.parseBlockDefinition=r,U.parseChecksumBlock=function(e,t){void 0===t&&(t=0);var n=pxt.HF2.read32(e,t);if(133083260!=(2147483647&n))return pxt.log("no checksum block magic"),null;var r=pxt.HF2.read32(e,t+4),i=pxt.HF2.read32(e,t+8);if(3&r)return pxt.log("invalid end marker position"),null;var o=1<<(255&i);if(o!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+o),null;for(var a={magic:n,endMarkerPos:r,endMarker:i,regions:[]},s=t+12;s<e.length-7;s+=8){var c={start:o*pxt.HF2.read16(e,s),length:o*pxt.HF2.read16(e,s+2),checksum:pxt.HF2.read32(e,s+4)};if(!c.length||!c.checksum)break;a.regions.push(c)}return a},function(d){function v(t){var e=function(e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0};if(!t||512!=t.length||e(0)!=d.UF2_MAGIC_START0||e(4)!=d.UF2_MAGIC_START1||e(t.length-4)!=d.UF2_MAGIC_END)return null;var n=e(8),r=e(16);476<r&&(r=256);var i=null,o=0,a=0;if(n&d.UF2_FLAG_FILE){var s=t.slice(32+r),c=s.indexOf(0);0<=c&&(s=s.slice(0,c)),i=U.U.fromUTF8(U.U.uint8ArrayToString(s)),a=e(28)}return n&d.UF2_FLAG_FAMILY_ID_PRESENT&&(o=e(28)),{flags:n,targetAddr:e(12),payloadSize:r,blockNo:e(20),numBlocks:e(24),fileSize:a,familyId:o,data:t.slice(32,32+r),filename:i}}function a(e,t){return!!e&&(e.targetAddr<=t&&t<e.targetAddr+e.payloadSize)}function h(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function s(e){return"string"==typeof e&&(e=parseInt(e)),{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0,familyId:e||0}}function c(e){for(var t=0;t<e.blocks.length;++t)h(e.blocks[t],20,t),h(e.blocks[t],24,e.blocks.length),e.filename&&h(e.blocks[t],28,e.filesize)}function m(e,t,n,r){void 0===r&&(r=0);var i=e.currBlock,o=t>>8,a=256-(255&t);if(n.length>a){var s=new Uint8Array(n);for(m(e,t,s.slice(0,a));a<n.length;){var c=Math.min(a+256,n.length);m(e,t+a,s.slice(a,c)),a=c}}else{if(o!=e.currPtr){var u=0;i=null;for(var l=0;l<e.ptrs.length;++l)if(e.ptrs[l]==o){i=e.blocks[l];break}if(!i){i=new Uint8Array(512),e.filename?r|=d.UF2_FLAG_FILE:e.familyId&&(r|=d.UF2_FLAG_FAMILY_ID_PRESENT),h(i,0,d.UF2_MAGIC_START0),h(i,4,d.UF2_MAGIC_START1),h(i,8,r),h(i,12,o<<8),h(i,16,256),h(i,20,e.blocks.length),h(i,28,e.familyId),h(i,508,d.UF2_MAGIC_END);for(var p=32;p<288;++p)i[p]=255;e.filename&&U.U.memcpy(i,288,U.U.stringToUint8Array(U.U.toUTF8(e.filename))),e.blocks.push(i),e.ptrs.push(o)}e.currPtr=o,e.currBlock=i}var f=32+(255&t);for(u=0;u<n.length;++u)i[f+u]=n[u];e.filesize=Math.max(e.filesize,n.length+t)}}d.UF2_MAGIC_START0=171066965,d.UF2_MAGIC_START1=2656915799,d.UF2_MAGIC_END=179400496,d.UF2_FLAG_NONE=0,d.UF2_FLAG_NOFLASH=1,d.UF2_FLAG_FILE=4096,d.UF2_FLAG_FAMILY_ID_PRESENT=8192,d.parseBlock=v,d.parseFile=function(e){for(var t=[],n=0;n<e.length;n+=512){var r=v(e.slice(n,n+512));r&&t.push(r)}return t},d.toBin=function(e,t){if(void 0===t&&(t=void 0),e.length<512)return null;for(var n=-1,r=-1,i=[],o=0;o<e.length;++o){var a=512*o,s=v(e.slice(a,a+512));if(s){if(t&&s.targetAddr+256>t)break;-1==n&&(r=n=s.targetAddr);var c=s.targetAddr-n;c<0||c%4||1048576<c||(0<c&&i.push(new Uint8Array(c)),i.push(e.slice(a+32,a+32+s.payloadSize)),n=s.targetAddr+s.payloadSize)}}for(var u=0,l=0,p=i;l<p.length;l++)u+=(g=p[l]).length;if(0==u)return null;for(var f=new Uint8Array(u),d=0,h=0,m=i;h<m.length;h++){var g=m[h];for(o=0;o<g.length;++o)f[d++]=g[o]}return{buf:f,start:r}},d.readBytes=function(e,t,n){for(var r,i=new Uint8Array(n),o=0;o<n;++o,++t)a(r,t)||(r=e.filter(function(e){return a(e,t)})[0]),r&&(i[o]=r.data[t-r.targetAddr]);return i},d.newBlockFile=s,d.finalizeFile=c,d.concatFiles=function(e){for(var t=0,n=e;t<n.length;t++)c(a=n[t]),a.filename=null;var r=s();r.blocks=U.U.concat(e.map(function(e){return e.blocks}));for(var i=0,o=e;i<o.length;i++){var a;(a=o[i]).blocks=[]}return r},d.serializeFile=function(e){c(e);for(var t="",n=0,r=e.blocks;n<r.length;n++){var i=r[n];t+=U.Util.uint8ArrayToString(i)}return t},d.readBytesFromFile=function e(t,n,r){var i,o=n>>8;if(o==t.currPtr)i=t.currBlock;else{for(var a=0;a<t.ptrs.length;++a)if(t.ptrs[a]==o){i=t.blocks[a];break}i&&(t.currPtr=o,t.currBlock=i)}if(!i)return null;var s=new Uint8Array(r),c=Math.min(r,256-(255&n));U.U.memcpy(s,0,i,32+(255&n),c);var u=r-c;if(0<u){var l=e(t,n+c,u);U.U.memcpy(s,c,l)}return s},d.writeBytes=m,d.writeHex=function(e,t){for(var n="0000",r=0;r<t.length;++r){var i=/:02000004(....)/.exec(t[r]);if(i&&(n=i[1]),i=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(t[r])){for(var o=parseInt(n+i[1],16),a=i[2],s=[],c=0;c<a.length;c+=2)s.push(parseInt(a[c]+a[c+1],16));m(e,o,s)}}}}(U.UF2||(U.UF2={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={})),function(n){var e;(e=n.streams||(n.streams={})).createStreamAsync=function(e,t){return n.Cloud.privatePostAsync("streams",{target:e,name:t||"data"}).then(function(e){return e})},e.postPayloadAsync=function(e,t){return n.Util.assert(!!e.privatekey),n.Cloud.privatePostAsync(e.id+"/data?privatekey="+e.privatekey,t)}}(pxt||(pxt={})),function(I){!function(n){var r,e,i,t;(e=r=n.PatternUnits||(n.PatternUnits={}))[e.userSpaceOnUse=0]="userSpaceOnUse",e[e.objectBoundingBox=1]="objectBoundingBox",(t=i=n.LengthUnit||(n.LengthUnit={}))[t.em=0]="em",t[t.ex=1]="ex",t[t.px=2]="px",t[t.in=3]="in",t[t.cm=4]="cm",t[t.mm=5]="mm",t[t.pt=6]="pt",t[t.pc=7]="pc",t[t.percent=8]="percent";var o=function(){function e(e){this.el=E(e)}return e.prototype.attr=function(t){var n=this;return Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),this},e.prototype.setAttribute=function(e,t){return this.el.setAttribute(e,t.toString()),this},e.prototype.setAttributeNS=function(e,t,n){return this.el.setAttributeNS(e,t,n.toString()),this},e.prototype.id=function(e){return this.setAttribute("id",e)},e.prototype.setClass=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.setAttribute("class",e.join(" "))},e.prototype.appendClass=function(e){return I.BrowserUtils.addClass(this.el,e),this},e.prototype.removeClass=function(e){I.BrowserUtils.removeClass(this.el,e)},e.prototype.title=function(e){this.titleElement||(this.titleElement=E("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=e},e.prototype.setVisible=function(e){return this.setAttribute("visibility",e?"visible":"hidden")},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.draw=function(e){var t=function(e){switch(e){case"text":return new d;case"circle":return new m;case"rect":return new h;case"line":return new g;case"polygon":return new y;case"polyline":return new b;case"path":return new w;default:return new f(e)}}(e);return this.el.appendChild(t.el),t},t.prototype.element=function(e,t){return t(this.draw(e)),this},t.prototype.group=function(){var e=new c;return this.el.appendChild(e.el),e},t.prototype.appendChild=function(e){this.el.appendChild(e.el)},t.prototype.onDown=function(e){return n.events.down(this.el,e),this},t.prototype.onUp=function(e){return n.events.up(this.el,e),this},t.prototype.onMove=function(e){return n.events.move(this.el,e),this},t.prototype.onEnter=function(e){return n.events.enter(this.el,e),this},t.prototype.onLeave=function(e){return n.events.leave(this.el,e),this},t.prototype.onClick=function(e){return n.events.click(this.el,e),this},t}(n.BaseElement=o),s=function(n){function e(e){var t=n.call(this,"svg")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.define=function(e){return this.defs||(this.defs=new l(this.el)),e(this.defs),this},e}(n.DrawContext=a);n.SVG=s;var c=function(n){function e(e){var t=n.call(this,"g")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.translate=function(e,t){return this.left=e,this.top=t,this.updateTransform()},e.prototype.scale=function(e){return this.scaleFactor=e,this.updateTransform()},e.prototype.def=function(){return new l(this.el)},e.prototype.style=function(){return new p(this.el)},e.prototype.updateTransform=function(){var e="";return null!=this.left&&(e+="translate("+this.left+" "+this.top+")"),null!=this.scaleFactor&&(e+=" scale("+this.scaleFactor+")"),this.setAttribute("transform",e),this},e}(a);n.Group=c;var u=function(e){function t(){return e.call(this,"pattern")||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("patternUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.contentUnits=function(e){return this.setAttribute("patternContentUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.size=function(e,t){return this.setAttribute("width",e),this.setAttribute("height",t),this},t}(a);n.Pattern=u;var l=function(n){function e(e){var t=n.call(this,"defs")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.create=function(e,t){var n;switch(e){case"path":n=new w;break;case"pattern":n=new u;break;case"radialGradient":n=new T;break;case"linearGradient":n=new A;break;case"clipPath":n=new C;break;default:n=new o(e)}return n.id(t),this.el.appendChild(n.el),n},e}(o);n.DefsElement=l;var p=function(n){function e(e){var t=n.call(this,"style")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.content=function(e){this.el.textContent=e},e}(o);n.StyleElement=p;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("x",e),this.setAttribute("y",t),this},t.prototype.moveTo=function(e,t){return this.at(e,t)},t.prototype.fill=function(e,t){return this.setAttribute("fill",e),null!=t&&this.opacity(t),this},t.prototype.opacity=function(e){return this.setAttribute("fill-opacity",e)},t.prototype.stroke=function(e,t){return this.setAttribute("stroke",e),null!=t&&this.strokeWidth(t),this},t.prototype.strokeWidth=function(e){return this.setAttribute("stroke-width",e)},t.prototype.strokeOpacity=function(e){return this.setAttribute("stroke-opacity",e)},t.prototype.clipPath=function(e){return this.setAttribute("clip-path",e)},t}(a),d=function(n){function e(e){var t=n.call(this,"text")||this;return null!=e&&t.text(e),t}return __extends(e,n),e.prototype.text=function(e){return this.el.textContent=e,this},e.prototype.fontFamily=function(e){return this.setAttribute("font-family",e)},e.prototype.fontSize=function(e,t){return this.setAttribute("font-size",_(e,t))},e.prototype.offset=function(e,t,n){return 0!==e&&this.setAttribute("dx",_(e,n)),0!==t&&this.setAttribute("dy",_(t,n)),this},e.prototype.anchor=function(e){return this.setAttribute("text-anchor",e)},e}(n.Drawable=f);n.Text=d;var h=function(e){function t(){return e.call(this,"rect")||this}return __extends(t,e),t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",_(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",_(e,t))},t.prototype.corner=function(e){return this.corners(e,e)},t.prototype.corners=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(f);n.Rect=h;var m=function(e){function t(){return e.call(this,"circle")||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(f);n.Circle=m;!function(e){function t(){return e.call(this,"ellipse")||this}__extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this}}(f);var g=function(e){function t(){return e.call(this,"line")||this}return __extends(t,e),t.prototype.at=function(e,t,n,r){return this.from(e,t),null!=n&&null!=r&&this.to(n,r),this},t.prototype.from=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.to=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(f);n.Line=g;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.points=function(e){return this.setAttribute("points",e)},t.prototype.with=function(e){return this.points(e.map(function(e){return e.x+" "+e.y}).join(","))},t}(f),b=function(e){function t(){return e.call(this,"polyline")||this}return __extends(t,e),t}(n.PolyElement=v);n.Polyline=b;var y=function(e){function t(){return e.call(this,"polygon")||this}return __extends(t,e),t}(v);n.Polygon=y;var w=function(t){function e(){var e=t.call(this,"path")||this;return e.d=new S,e}return __extends(e,t),e.prototype.update=function(){return this.setAttribute("d",this.d.toAttribute())},e.prototype.path=function(e){return e(this.d),this.update()},e}(f);n.Path=w;var x=function(e){function t(){return e.call(this,"image")||this}return __extends(t,e),t.prototype.src=function(e){return this.setAttributeNS("http://www.w3.org/1999/xlink","href",e)},t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",_(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",_(e,t))},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(f);n.Image=x;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("gradientUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.stop=function(e,t,n){var r=E("stop");return r.setAttribute("offset",e+"%"),null!=t&&r.setAttribute("stop-color",t),null!=n&&r.setAttribute("stop-opacity",n),this.el.appendChild(r),this},t}(o),A=function(e){function t(){return e.call(this,"linearGradient")||this}return __extends(t,e),t.prototype.start=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.end=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(n.Gradient=k);n.LinearGradient=A;var T=function(e){function t(){return e.call(this,"radialGradient")||this}return __extends(t,e),t.prototype.center=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.focus=function(e,t,n){return this.setAttribute("fx",e),this.setAttribute("fy",t),this.setAttribute("fr",n),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(k);n.RadialGradient=T;var C=function(e){function t(){return e.call(this,"clipPath")||this}return __extends(t,e),t.prototype.clipPathUnits=function(e){return e?this.setAttribute("clipPathUnits","objectBoundingBox"):this.setAttribute("clipPathUnits","userSpaceOnUse")},t}(a);function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}n.ClipPath=C;var S=function(){function e(){this.ops=[]}return e.prototype.clear=function(){this.ops=[]},e.prototype.moveTo=function(e,t){return this.op("M",e,t)},e.prototype.moveBy=function(e,t){return this.op("m",e,t)},e.prototype.lineTo=function(e,t){return this.op("L",e,t)},e.prototype.lineBy=function(e,t){return this.op("l",e,t)},e.prototype.cCurveTo=function(e,t,n,r,i,o){return this.op("C",e,t,n,r,i,o)},e.prototype.cCurveBy=function(e,t,n,r,i,o){return this.op("c",e,t,n,r,i,o)},e.prototype.qCurveTo=function(e,t,n,r){return this.op("Q",e,t,n,r)},e.prototype.qCurveBy=function(e,t,n,r){return this.op("q",e,t,n,r)},e.prototype.sCurveTo=function(e,t,n,r){return this.op("S",e,t,n,r)},e.prototype.sCurveBy=function(e,t,n,r){return this.op("s",e,t,n,r)},e.prototype.tCurveTo=function(e,t){return this.op("T",e,t)},e.prototype.tCurveBy=function(e,t){return this.op("t",e,t)},e.prototype.arcTo=function(e,t,n,r,i,o,a){return this.op("A",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.arcBy=function(e,t,n,r,i,o,a){return this.op("a",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.close=function(){return this.op("z")},e.prototype.toAttribute=function(){return this.ops.map(function(e){return e.op+" "+e.args.join(" ")}).join(" ")},e.prototype.op=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.ops.push({op:e,args:t}),this},e}();function _(e,t){switch(t){case i.em:return e+"em";case i.ex:return e+"ex";case i.px:return e+"px";case i.in:return e+"in";case i.cm:return e+"cm";case i.mm:return e+"mm";case i.pt:return e+"pt";case i.pc:return e+"pc";case i.percent:return e+"%";default:return e.toString()}}n.PathContext=S}(I.svgUtil||(I.svgUtil={}))}(pxt||(pxt={})),function(e){var t;(function(e){function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}e.isTouchEnabled=n,e.hasPointerEvents=r,e.down=function(e,t){r()?e.addEventListener("pointerdown",t):n()?(e.addEventListener("mousedown",t),e.addEventListener("touchstart",t)):e.addEventListener("mousedown",t)},e.up=function(e,t){r()?e.addEventListener("pointerup",t):(n(),e.addEventListener("mouseup",t))},e.enter=function(e,t){r()?e.addEventListener("pointerover",function(e){t(!!(1&e.buttons))}):n()?e.addEventListener("touchstart",function(e){t(!0)}):e.addEventListener("mouseover",function(e){t(!!(1&e.buttons))})},e.leave=function(e,t){r()?e.addEventListener("pointerleave",t):n()?e.addEventListener("touchend",t):e.addEventListener("mouseleave",t)},e.move=function(e,t){r()?e.addEventListener("pointermove",t):n()?e.addEventListener("touchmove",t):e.addEventListener("mousemove",t)},e.click=function(e,t){e.addEventListener("click",t)}})((t=e.svgUtil||(e.svgUtil={})).events||(t.events={}))}(pxt||(pxt={})),function(e){var t,n,r;t=e.svgUtil||(e.svgUtil={}),n=t.helpers||(t.helpers={}),r=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.at=function(e,t){return this.cx=e,this.cy=t,this.rePosition(),this},e.prototype.text=function(e,t){return void 0===t&&(t=12),n.prototype.text.call(this,e),this.fontSizePixels=t,this.setAttribute("font-size",t+"px"),this.rePosition(),this},e.prototype.rePosition=function(){null!=this.cx&&null!=this.cy&&null!=this.fontSizePixels&&(this.setAttribute("x",this.cx),this.setAttribute("y",this.cy),this.setAttribute("text-anchor","middle"),this.setAttribute("alignment-baseline","middle"))},e}(t.Text),n.CenteredText=r}(pxt||(pxt={})),function(m){var g="image/x-mkcd-f4",l="application/mkcd-tilemap",e=function(){function e(){this.needsRebuild=!0,this.nextID=0,this.state={revision:this.nextID++},this.undoStack=[],this.redoStack=[]}return e.prototype.getGalleryTiles=function(t){return this.extensionTileSets?this.extensionTileSets.map(function(e){return e.tileSets.find(function(e){return e.tileWidth===t})}).filter(function(e){var t;return null===(t=e)||void 0===t?void 0:t.tiles.length}):null},e.prototype.getProjectTiles=function(t,e){if(this.state.projectTileSet){var n=this.state.projectTileSet.tileSets.find(function(e){return e.tileWidth===t});return!n&&e?(this.createNewTile(new m.sprite.Bitmap(t,t).data()),this.getProjectTiles(t,!1)):n}return null},e.prototype.createNewTile=function(e,t){if(this.onChange(),!t||this.state.takenNames[t]){for(var n=m.sprite.TILE_NAMESPACE+"."+m.sprite.TILE_PREFIX,r=1;this.state.takenNames[n+r];)++r;t=n+r}this.state.takenNames[t]=!0;for(var i={id:t,data:m.sprite.base64EncodeBitmap(e),bitmap:e,isProjectTile:!0},o=0,a=this.state.projectTileSet.tileSets;o<a.length;o++){var s=a[o];if(s.tileWidth===e.width)return s.tiles.push(i),i}var c=this.createTileset(e.width);return c.tiles.push(i),this.state.projectTileSet.tileSets.push(c),i},e.prototype.updateTile=function(e,t){this.onChange();for(var n=0,r=this.state.projectTileSet.tileSets;n<r.length;n++)for(var i=0,o=r[n].tiles;i<o.length;i++){var a=o[i];if(a.id===e)return a.bitmap=t,a.data=m.sprite.base64EncodeBitmap(t),a}return null},e.prototype.deleteTile=function(t){this.onChange();for(var e=0,n=this.state.projectTileSet.tileSets;e<n.length;e++){var r=n[e];r.tiles=r.tiles.filter(function(e){return e.id!==t})}},e.prototype.getProjectTilesetJRes=function(){for(var e={},t=0,n=function(e){for(var t=[],n=0,r=e.tileSets;n<r.length;n++){var i=r[n];t.push.apply(t,i.tiles)}return t}(this.state.projectTileSet);t<n.length;t++){var r=n[t];e[r.id.substr(r.id.lastIndexOf(".")+1)]={data:r.data,mimeType:g,tilemapTile:!0}}for(var i=0,o=this.state.projectTilemaps;i<o.length;i++){var a=o[i],s=this.encodeTilemap(a.data,a.id);e[s.id]=s}return e["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:m.sprite.TILE_NAMESPACE},e},e.prototype.getTilemap=function(e){for(var t=0,n=this.state.projectTilemaps;t<n.length;t++){var r=n[t];if(r.id===e)return r.data.cloneData()}return null},e.prototype.getAllTilemaps=function(){var e;return(null===(e=this.state.projectTilemaps)||void 0===e?void 0:e.slice())||[]},e.prototype.updateTilemap=function(e,t){for(var n=0,r=this.state.projectTilemaps;n<r.length;n++){var i=r[n];i.id===e&&(this.onChange(),i.data=t.cloneData())}},e.prototype.createNewTilemap=function(e,t,n,r){return void 0===n&&(n=16),void 0===r&&(r=16),this.createNewTilemapFromData(this.blankTilemap(t,n,r),e)},e.prototype.blankTilemap=function(e,t,n){void 0===t&&(t=16),void 0===n&&(n=16);var r=new m.sprite.Tilemap(t,n),i=new m.sprite.Bitmap(t,n),o={tileWidth:e,tiles:[this.getTransparency(e)]};return new m.sprite.TilemapData(r,o,i.data())},e.prototype.resolveTile=function(e){for(var t=0,n=[this.state.projectTileSet].concat(this.extensionTileSets);t<n.length;t++){var r=i(n[t],e);if(r)return r}return null},e.prototype.resolveTileByBitmap=function(e){for(var t=[this.state.projectTileSet].concat(this.extensionTileSets),n=m.sprite.base64EncodeBitmap(e),r=0,i=t;r<i.length;r++)for(var o=0,a=i[r].tileSets;o<a.length;o++){var s=a[o];if(s.tileWidth===e.width)for(var c=0,u=s.tiles;c<u.length;c++){var l=u[c];if(n===l.data)return l}}return null},e.prototype.getTransparency=function(e){for(var t=0,n=this.state.projectTileSet.tileSets;t<n.length;t++){var r=n[t];if(r.tileWidth===e)return r.tiles[0]}var i=this.createTileset(e);return this.state.projectTileSet.tileSets.push(i),i.tiles[0]},e.prototype.createNewTilemapFromData=function(e,t){this.onChange(),t||(t=lf("level"));for(var n=0,r=t;this.state.takenNames[t];)t=r+"_"+n,++n;return this.state.takenNames[t]=!0,this.state.projectTilemaps.push({id:t,data:e}),[t,e]},e.prototype.cloneState=function(){return __assign(__assign({},this.state),{projectTileSet:__assign(__assign({},this.state.projectTileSet),{tileSets:this.state.projectTileSet.tileSets.map(function(e){return __assign(__assign({},e),{tiles:e.tiles.map(t)})})}),projectTilemaps:this.state.projectTilemaps.map(function(e){return __assign({},e)}),takenNames:__assign({},this.state.takenNames)})},e.prototype.undo=function(){if(this.undoStack.length){var e=this.undoStack.pop();this.redoStack.push(this.state),this.state=e,this.needsRebuild=!0}},e.prototype.redo=function(){if(this.redoStack.length){var e=this.redoStack.pop();this.undoStack.push(this.state),this.state=e,this.needsRebuild=!0}},e.prototype.pushUndo=function(){this.undoStack.length&&this.undoStack[this.undoStack.length-1].revision===this.state.revision||(this.redoStack=[],this.undoStack.push(this.state),this.state=this.cloneState())},e.prototype.revision=function(){return this.state.revision},e.prototype.encodeTilemap=function(e,t){var n=e.tilemap.data(),r=new Uint8ClampedArray(5+n.data.length+e.layers.data.length);return r[0]=e.tileset.tileWidth,r[1]=255&n.width,r[2]=n.width>>8&255,r[3]=255&n.height,r[4]=n.height>>8&255,r.set(n.data,5),r.set(e.layers.data,5+n.data.length),{id:t,mimeType:l,data:btoa(m.sprite.uint8ArrayToHex(r)),tileset:e.tileset.tiles.map(function(e){return e.id})}},e.prototype.forceUpdate=function(){this.onChange()},e.prototype.loadPackage=function(e){var t=this,n=e.sortedDeps();this.extensionTileSets=[];for(var r=0,i=n;r<i.length;r++){var o=i[r],a="this"===o.id,s=h(o.parseJRes(),o.id,a);s?a?this.state.projectTileSet=s:this.extensionTileSets.push(s):a&&(this.state.projectTileSet={extensionID:"this",tileSets:[]})}this.state.projectTilemaps=v(e.parseJRes()).map(function(e){return{id:e.id,data:b(e,function(e){return t.resolveTile(e)})}});var c=e.getJRes();this.state.takenNames={};for(var u=0,l=Object.keys(c);u<l.length;u++){var p=l[u];this.state.takenNames[p]=!0}},e.prototype.loadJres=function(e,t){var n,r=this;void 0===t&&(t=!1);var i=h(e=m.inflateJRes(e),"this",!0),o={};if(i)for(var a=0,s=i.tileSets;a<s.length;a++)for(var c=0,u=s[a].tiles;c<u.length;c++){var l=u[c];if(t){var p=this.resolveTileByBitmap(l.bitmap);if(p){o[l.id]=p.id;continue}}var f=this.createNewTile(l.bitmap,l.id);f.id!==l.id&&(o[l.id]=f.id)}var d=v(e).map(function(e){return{id:e.id,data:b(e,function(e){return o[e]&&(e=o[e]),r.resolveTile(e)})}});(n=this.state.projectTilemaps).push.apply(n,d),d.forEach(function(e){return r.state.takenNames[e.id]=!0})},e.prototype.createTileset=function(e){this.needsRebuild=!0;for(var t={tileWidth:e,tiles:[]},n=m.sprite.TILE_NAMESPACE+".transparency"+e,r=n,i=1;this.resolveTile(r);)r=n+"_"+i,++i;var o=new m.sprite.Bitmap(e,e).data();return t.tiles.push({id:r,bitmap:o,data:m.sprite.base64EncodeBitmap(o),isProjectTile:!0}),t},e.prototype.onChange=function(){this.needsRebuild=!0,this.state.revision=this.nextID++},e}();function h(e,t,n){void 0===n&&(n=!1);for(var r=[],i=0,o=Object.keys(e);i<o.length;i++){var a=e[o[i]];if(a.tilemapTile){var s={data:a.data,id:a.id,bitmap:m.sprite.getBitmapFromJResURL("data:"+g+";base64,"+a.data).data(),isProjectTile:n};r.push(s)}}for(var c=[],u=0,l=r;u<l.length;u++){s=l[u];for(var p=!1,f=0,d=c;f<d.length;f++){var h=d[f];if(h.tileWidth===s.bitmap.width){h.tiles.push(s),p=!0;break}}p||c.push({tileWidth:s.bitmap.width,tiles:[s]})}return c.length?{extensionID:t,tileSets:c}:null}function v(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=e[r[n]];i.mimeType===l&&t.push(i)}return t}function i(e,t){for(var n=0,r=e.tileSets;n<r.length;n++)for(var i=0,o=r[n].tiles;i<o.length;i++){var a=o[i];if(a.id===t)return a}return null}function t(e){return __assign(__assign({},e),{bitmap:m.sprite.Bitmap.fromData(e.bitmap).copy().data()})}function b(e,t){var n=atob(e.data),r=m.U.fromHex(n),i=r[1]|r[2]<<8,o=r[3]|r[4]<<8,a={tileWidth:r[0],tiles:e.tileset.map(function(e){return t&&t(e)||{id:e}})},s=r.slice(5,5+i*o),c=new m.sprite.Tilemap(i,o,0,0,new Uint8ClampedArray(s)),u=r.slice(5+s.length),l=new m.sprite.Bitmap(i,o,0,0,new Uint8ClampedArray(u)).data();return new m.sprite.TilemapData(c,a,l)}m.TilemapProject=e,m.emitTilemapsFromJRes=function(e){for(var t=Object.keys(e),n="",r=[],i=0,o=t;i<o.length;i++){var a=o[i];if("*"!==a){var s=e[a];if(s.tilemapTile&&(n+="    //% fixedInstance jres blockIdentity=images._tile\n",n+="    export const "+a+" = image.ofBuffer(hex``);\n"),s.mimeType===l){var c=b(s);r.push('case "'+a+'": return '+m.sprite.encodeTilemap(c,"typescript"))}}}r.length&&(n+="\n    helpers.registerTilemapFactory(function(name: string) {\n        switch(helpers.stringTrim(name)) {\n"+r.map(function(e){return"            "+e}).join("\n")+"\n        }\n        return null;\n    })\n");var u=lf("Auto-generated code. Do not edit.");return"// "+u+"\nnamespace "+m.sprite.TILE_NAMESPACE+" {\n"+n+"\n}\n// "+u+"\n"}}(pxt||(pxt={})),function(o){!function(e){e.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c",addpackage:"#717171",search:"#000",debug:"#e03030",default:"#dddddd",topblocks:"#aa8f00",recipes:"#717171"},e.blockIcons={loops:"",logic:"",math:"",variables:"",functions:"",text:"",arrays:"",advancedcollapsed:"",advancedexpanded:"",more:"",addpackage:"",search:"",debug:"",default:"",topblocks:"",recipes:""};var r="";function i(e){var t=function(e,t,n){var r=0,i=0,o=0;if(0==t)o=i=r=n;else{var a=Math.floor(e/60),s=e/60-a,c=n*(1-t),u=n*(1-t*s),l=n*(1-t*(1-s));switch(a){case 1:r=u,i=n,o=c;break;case 2:r=c,i=n,o=l;break;case 3:r=c,i=u,o=n;break;case 4:r=l,i=c,o=n;break;case 5:r=n,i=c,o=u;break;case 6:case 0:r=n,i=l,o=c}}return[Math.floor(r),Math.floor(i),Math.floor(o)]}(e,.45,165.75);return"#"+n(t[0])+n(t[1])+n(t[2])}function n(e){var t=e.toString(16);return 1==t.length?"0"+t:t}e.appendToolboxIconCss=function(e,t){if(!(-1<r.indexOf(e)))if(1===t.length){var n=o.Util.unicodeToChar(t);r+="\n                .blocklyTreeIcon."+e+'::before {\n                    content: "'+n+'";\n                }\n            '}else r+="\n                .blocklyTreeIcon."+e+' {\n                    background-image: url("'+o.Util.pathJoin(o.webConfig.commitCdnUrl,encodeURI(t))+'")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }\n            '},e.getNamespaceColor=function(e){return e=e.toLowerCase(),o.appTarget.appTheme.blockColors&&o.appTarget.appTheme.blockColors[e]?o.appTarget.appTheme.blockColors[e]:o.toolbox.blockColors[e]?o.toolbox.blockColors[e]:""},e.getNamespaceIcon=function(e){return e=e.toLowerCase(),o.appTarget.appTheme.blockIcons&&o.appTarget.appTheme.blockIcons[e]?o.appTarget.appTheme.blockIcons[e]:o.toolbox.blockIcons[e]?o.toolbox.blockIcons[e]:""},e.advancedTitle=function(){return o.Util.lf("{id:category}Advanced")},e.addPackageTitle=function(){return o.Util.lf("{id:category}Extensions")},e.recipesTitle=function(){return o.Util.lf("{id:category}Tutorials")},e.convertColor=function(e){var t;e=(t=e)?"0x"==t.substring(0,2)?"#"+t.substring(2):t:"#000000";var n=parseInt(e);return isNaN(n)?e:i(n)},e.hueToRgb=i,e.fadeColor=function(e,t,n){(e=e.replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);for(var r="#",i=0;i<3;i++){var o=parseInt(e.substr(2*i,2),16),a=(o=Math.round(Math.min(Math.max(0,n?o+o*t:o-o*t),255))).toString(16);r+=("00"+a).substr(a.length)}return r}}(o.toolbox||(o.toolbox={}))}(pxt||(pxt={})),function(A){!function(e){var y=/^##[^#](.*)$([\s\S]*?)(?=^##[^#]|$(?![\r\n]))/gim,w=/^###[^#](.*)$([\s\S]*?)(?=^###[^#]|$(?![\r\n]))/gim;function x(e,t,s){var n=t||y,c=[];if(e.replace(n,function(e,t,n){var r=function(e,t){var n,r=e=k(e);if(t){var i=/#+ ~ tutorialhint([\s\S]*)/i;r=e.replace(i,function(e,t){return n=t,""})}else{var i=/(^[\s\S]*?\S)\s*((```|\!\[[\s\S]+?\]\(\S+?\))[\s\S]*)/im,o=e.match(i);o&&2<o.length&&(r=o[1].trim(),n=o[2].trim())}return{header:r,hint:n}}(n=n.trim(),s&&s.explicitHints),i=r.header,o=r.hint,a={contentMd:n,headerContentMd:i};return/@(fullscreen|unplugged)/.test(t)&&(a.fullscreen=!0),/@unplugged/.test(t)&&(a.unplugged=!0),/@tutorialCompleted/.test(t)&&(a.tutorialCompleted=!0),/@resetDiff/.test(t)&&(a.resetDiff=!0),o&&(a.hintContentMd=o),c.push(a),""}),0!=e.indexOf("# Not found"))return c;A.debug("tutorial not found")}function k(e){if(!e)return e;return e.replace(/```(filterblocks|package|ghost|config|template|jres)\s*\n([\s\S]*?)\n```/gim,"").trim()}e.parseTutorial=function(e){var t,n=(u=e,l={},p=u.replace(/### @(\S+) ([ \S]+)/gi,function(e,t,n){try{l[t]=JSON.parse(n)}catch(e){l[t]=n}return""}),f=l,void 0!==f.explicitHints&&A.appTarget.appTheme&&A.appTarget.appTheme.tutorialExplicitHints&&(f.explicitHints=!0),{metadata:f,body:p}),r=n.metadata,i=n.body,o=function(e,t){if(t&&t.activities)return o=t,a=[],s=[],e.replace(y,function(e,t,n){var r=s.length;s.push({name:t||lf("Activity {0}",r),step:a.length});var i=x(n,w,o);return i=i.map(function(e){return e.activity=r,e}),a=a.concat(i),""}),{steps:a,activities:s};var o,a,s,n=x(e,null,t);return(!n||n.length<1)&&(n=x(e,w,t)),{steps:n,activities:null}}(i,r),a=o.steps,s=o.activities,c=(t=i.match(/^#[^#](.*)$/im))&&1<t.length?t[1]:null;var u,l,p,f;if(a){var d=function(e){var r,i,o,t=void 0,a=[];return e.replace(/((?!.)\s)+/g,"\n").replace(/``` *(sim|block|blocks|filterblocks|spy|ghost|typescript|ts|js|javascript|template|python|jres)?\s*\n([\s\S]*?)\n```/gim,function(e,t,n){switch(t){case"block":case"blocks":case"filterblocks":if(!s(A.BLOCKS_PROJECT_NAME))return;break;case"spy":case"python":if(!s(A.PYTHON_PROJECT_NAME))return;"python"==t&&(o=t);break;case"typescript":case"ts":case"javascript":case"js":if(!s(A.JAVASCRIPT_PROJECT_NAME))return;break;case"template":i=n;break;case"jres":r=n}return a.push("python"==t?"\n"+n+"\n":"{\n"+n+"\n}"),""}),t=t||A.BLOCKS_PROJECT_NAME,{code:a,templateCode:i,editor:t,language:o,jres:r};function s(e){return t&&t!=e?(A.debug("tutorial ambiguous: contains snippets of different types"),!1):(t=e,!0)}}(i),h=d.code,m=d.templateCode,g=d.editor,v=d.language,b=d.jres;return(!0===r.diffs||!1!==r.diffs&&!0!==r.noDiffs&&(g==A.BLOCKS_PROJECT_NAME&&A.appTarget.appTheme.tutorialBlocksDiff||g!=A.BLOCKS_PROJECT_NAME&&A.appTarget.appTheme.tutorialTextDiff))&&function(e,r){var c=void 0;function i(e){var a={typescript:"diff",spy:"diffspy",blocks:"diffblocks",python:"diff"},s=/\s*(\/\/|#)\s*@highlight/gm;return e?e.replace(/```(typescript|spy|python|blocks|ghost|template)((?:.|[\r\n])+)```/,function(e,t,n){var r=c,i=/^(template|ghost)$/.test(t),o=s.test(n);return n=n.replace(/^\n+/,"").replace(/\n+$/,""),o&&(n=n.replace(s,"")),c=n,!r||o||i?e:"```"+a[t]+"\n"+r+"\n----------\n"+n+"\n```"}):e}e.forEach(function(e,t){if((e.resetDiff||r&&r.find(function(e){return e.step==t}))&&(c=void 0),e.hintContentMd){var n=i(e.hintContentMd);if(n&&n!=e.hintContentMd)return void(e.hintContentMd=n)}if(e.headerContentMd){var n=i(e.headerContentMd);if(n&&n!=e.headerContentMd)return void(e.headerContentMd=n)}})}(a,s),a.forEach(function(e){e.contentMd=k(e.contentMd),e.headerContentMd=k(e.headerContentMd),e.hintContentMd=k(e.hintContentMd)}),{editor:g,title:c,steps:a,activities:s,code:h,templateCode:m,metadata:r,language:v,jres:b}}},e.highlight=function(e){var t=e.textContent;if(t=(t=t.replace(/img\s*\(\s*"{3}(.|\n)*"{3}\s*\)/g,'img(""" """)')).replace(/img\s*\s*`(.|\n)*`\s*/g,"img` `"),/@highlight/.test(t)){e.textContent="";for(var n=t.split("\n"),r=0;r<n.length;++r){0<r&&r<n.length&&e.appendChild(document.createTextNode("\n"));var i=n[r];if(/@highlight/.test(i)){if(void 0!==(i=n[++r])){var o=document.createElement("span");o.className="highlight-line",o.textContent=i,e.appendChild(o)}}else e.appendChild(document.createTextNode(i))}}else e.textContent=t},e.getTutorialOptions=function(e,t,n,r,i){var o=A.tutorial.parseTutorial(e);if(!o)throw new Error(lf("Invalid tutorial format"));return{options:{tutorial:t,tutorialName:o.title||n,tutorialReportId:r,tutorialStep:0,tutorialReady:!0,tutorialHintCounter:0,tutorialStepInfo:o.steps,tutorialActivityInfo:o.activities,tutorialMd:e,tutorialCode:o.code,tutorialRecipe:!!i,templateCode:o.templateCode,autoexpandStep:!0,metadata:o.metadata,language:o.language,jres:o.jres},editor:o.editor}}}(A.tutorial||(A.tutorial={}))}(pxt||(pxt={})),function(l){!function(n){var r,e;n.flattenDiagnosticMessageText=function(e,t){if("string"==typeof e)return e;for(var n=e,r="",i=0;n;){if(i){r+=t;for(var o=0;o<i;o++)r+="  "}r+=n.messageText,i++,n=n.next}return r},(e=r=n.ScriptTarget||(n.ScriptTarget={}))[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest",n.isIdentifierStart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||36===e||95===e||127<e&&c(e,t)},n.isIdentifierPart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||36===e||95===e||127<e&&(n=e,t>=r.ES5?u(n,o):u(n,s));var n},n.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],n.keywordTypes=["boolean","number","string"],n.escapeIdentifier=function(e){if(!e)return"_";var t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,function(e){return l.pxtc.isIdentifierPart(e.charCodeAt(0),l.pxtc.ScriptTarget.ES5)?e:""});return t&&l.pxtc.isIdentifierStart(t.charCodeAt(0),l.pxtc.ScriptTarget.ES5)&&-1===n.reservedWords.indexOf(t)||(t="_"+t),t};var t,i=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],o=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],a=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],s=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];function c(e,t){return t>=r.ES5?u(e,i):u(e,a)}function u(e,t){if(e<t[0])return!1;for(var n,r=0,i=t.length;r+1<i;){if(n=r+(i-r)/2,t[n-=n%2]<=e&&e<=t[n+1])return!0;e<t[n]?i=n:r=n+2}return!1}n.isUnicodeIdentifierStart=c,(t=n.DiagnosticCategory||(n.DiagnosticCategory={}))[t.Warning=0]="Warning",t[t.Error=1]="Error",t[t.Message=2]="Message"}(l.pxtc||(l.pxtc={}))}(ts||(ts={})),function(d){!function(r){function i(){return!!navigator&&!!navigator.bluetooth&&"TextDecoder"in window&&d.appTarget.appTheme.bluetoothUartConsole&&d.appTarget.appTheme.bluetoothUartFilters&&0<d.appTarget.appTheme.bluetoothUartFilters.length}function o(){return!!navigator&&!!navigator.bluetooth&&!!d.appTarget.appTheme.bluetoothPartialFlashing}r.isAvailable=function(){return i()||o()},r.hasConsole=i,r.hasPartialFlash=o,r.isValidUUID=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(e)};var e=function(){function e(e,t){this.connectionTimeout=2e4,this.connectPromise=void 0,this.id=e,this.aliveToken=t}return e.prototype.debug=function(e){d.debug(this.id+": "+e)},e.prototype.alivePromise=function(e){var r=this;return new Promise(function(t,n){r.aliveToken.isCancelled()&&n(new Error),e.then(function(e){return t(e)},function(e){return n(e)})})},e.prototype.cancelConnect=function(){this.connectPromise=void 0},e.prototype.createConnectPromise=function(){return Promise.resolve()},e.prototype.connectAsync=function(){var t=this;return this.connectPromise||(this.connectPromise=this.alivePromise(this.createConnectPromise())),this.connectPromise.timeout(this.connectionTimeout,"connection timeout").then(function(){return t.aliveToken.throwIfCancelled()}).catch(function(e){throw t.connectPromise=void 0,e})},e.prototype.disconnect=function(){this.cancelConnect()},e.prototype.kill=function(){this.disconnect(),this.aliveToken.cancel()},e}(),t=function(i){function e(e,t,n){var r=i.call(this,e,t.aliveToken)||this;return r.device=t,r.autoReconnect=n,r.autoReconnectDelay=1e3,r.disconnectOnAutoReconnect=!1,r.reconnectPromise=void 0,r.failedConnectionServicesVersion=-1,r.handleDisconnected=r.handleDisconnected.bind(r),r.device.device.addEventListener("gattserverdisconnected",r.handleDisconnected),r}return __extends(e,i),e.prototype.handleDisconnected=function(e){var t=this;this.aliveToken.isCancelled()||(this.disconnect(),this.autoReconnect&&!this.reconnectPromise&&(this.reconnectPromise=Promise.delay(this.autoReconnectDelay).then(function(){return t.exponentialBackoffConnectAsync(8,500)}).finally(function(){return t.reconnectPromise=void 0})))},e.prototype.exponentialBackoffConnectAsync=function(t,n){var r=this;return this.debug("retry connect"),this.aliveToken.throwIfCancelled(),this.connectAsync().then(function(){r.aliveToken.throwIfCancelled(),r.debug("reconnect success"),r.reconnectPromise=void 0}).catch(function(e){return r.debug("reconnect error "+e.message),r.aliveToken.throwIfCancelled(),r.device.isPaired?r.autoReconnect?0==t?(r.debug("give up, max tries"),void(r.reconnectPromise=void 0)):r.failedConnectionServicesVersion==r.device.servicesVersion?(r.debug("services haven't changed, giving up"),void(r.reconnectPromise=void 0)):(r.debug("retry connect "+n+"ms... ("+t+" tries left)"),r.device.connected&&(r.failedConnectionServicesVersion=r.device.servicesVersion),r.disconnectOnAutoReconnect&&r.device.disconnect(),Promise.delay(n).then(function(){return r.exponentialBackoffConnectAsync(--t,1.8*n)})):(r.debug("autoreconnect disabled"),void(r.reconnectPromise=void 0)):(r.debug("give up, device unpaired"),void(r.reconnectPromise=void 0))})},e}(r.BLERemote=e),n=function(o){function e(e,t,n,r){var i=o.call(this,e,t,!0)||this;return i.device=t,i.serviceUUID=n,i.txCharacteristicUUID=r,i.handleValueChanged=i.handleValueChanged.bind(i),i}return __extends(e,o),e.prototype.createConnectPromise=function(){var t=this;return this.debug("connecting"),this.device.connectAsync().then(function(){return t.alivePromise(t.device.gatt.getPrimaryService(t.serviceUUID))}).then(function(e){return t.debug("service connected"),t.service=e,t.alivePromise(t.service.getCharacteristic(t.txCharacteristicUUID))}).then(function(e){return t.debug("tx characteristic connected"),t.txCharacteristic=e,t.txCharacteristic.addEventListener("characteristicvaluechanged",t.handleValueChanged),t.txCharacteristic.startNotifications()}).then(function(){d.tickEvent("webble.connected",{id:t.id})})},e.prototype.handlePacket=function(e){},e.prototype.handleValueChanged=function(e){var t=e.target.value;this.handlePacket(t)},e.prototype.disconnect=function(){if(o.prototype.disconnect.call(this),this.txCharacteristic&&this.device&&this.device.connected)try{this.txCharacteristic.stopNotifications(),this.txCharacteristic.removeEventListener("characteristicvaluechanged",this.handleValueChanged)}catch(e){d.log(this.id+": error "+e.message)}this.service=void 0,this.txCharacteristic=void 0},e}(r.BLEService=t),a=function(n){function o(e){var t=n.call(this,"hf2",e,o.SERVICE_UUID,o.CHARACTERISTIC_TX_UUID)||this;return t.device=e,t}return __extends(o,n),o.prototype.handlePacket=function(e){var t=e.getUint8(0);switch(192&t){case o.BLEHF2_FLAG_SERIAL_OUT:case o.BLEHF2_FLAG_SERIAL_ERR:for(var n=Math.min(e.byteLength-1,-193&t),r="",i=0;i<n;++i)r+=String.fromCharCode(e.getUint8(i+1));r&&window.postMessage({type:"serial",id:this.device.name||"hf2",data:r},"*")}},o.SERVICE_UUID="b112f5e6-2679-30da-a26e-0273b6043849",o.CHARACTERISTIC_TX_UUID="b112f5e6-2679-30da-a26e-0273b604384a",o.BLEHF2_FLAG_SERIAL_OUT=128,o.BLEHF2_FLAG_SERIAL_ERR=192,o}(r.BLETXService=n);r.HF2Service=a;var s,c,u=function(n){function r(e){var t=n.call(this,"uart",e,r.SERVICE_UUID,r.CHARACTERISTIC_TX_UUID)||this;return t.device=e,t}return __extends(r,n),r.prototype.handlePacket=function(e){var t=(new window.TextDecoder).decode(e);t&&window.postMessage({type:"serial",id:this.device.name||"uart",data:t},"*")},r.SERVICE_UUID="6e400001-b5a3-f393-e0a9-e50e24dcca9e",r.CHARACTERISTIC_TX_UUID="6e400002-b5a3-f393-e0a9-e50e24dcca9e",r}(n);r.UARTService=u,(c=s||(s={}))[c.Idle=1]="Idle",c[c.StatusRequested=2]="StatusRequested",c[c.PairingModeRequested=4]="PairingModeRequested",c[c.RegionDALRequested=8]="RegionDALRequested",c[c.RegionMakeCodeRequested=16]="RegionMakeCodeRequested",c[c.Flash=32]="Flash",c[c.EndOfTransmision=64]="EndOfTransmision",c[c.USBFlashRequired=128]="USBFlashRequired";var l=function(n){function a(e){var t=n.call(this,"partial flashing",e,!1)||this;return t.device=e,t.state=s.Idle,t.disconnectOnAutoReconnect=!0,t.handleCharacteristic=t.handleCharacteristic.bind(t),t}return __extends(a,n),a.prototype.clearFlashData=function(){this.version=0,this.mode=0,this.regions=[],this.chunkDelay=a.CHUNK_MIN_DELAY,this.hex=void 0,this.bin=void 0,this.magicOffset=void 0,this.dalHash=void 0,this.makeCodeHash=void 0,this.flashReject=void 0,this.flashResolve=void 0,this.flashOffset=void 0},a.prototype.createConnectPromise=function(){var t=this;return this.debug("connecting to partial flash service"),this.device.connectAsync().then(function(){return t.alivePromise(t.device.gatt.getPrimaryService(a.SERVICE_UUID))}).then(function(e){return t.debug("connecting to characteristic"),t.alivePromise(e.getCharacteristic(a.CHARACTERISTIC_UUID))}).then(function(e){return t.debug("starting notifications"),t.pfCharacteristic=e,t.pfCharacteristic.startNotifications(),t.pfCharacteristic.addEventListener("characteristicvaluechanged",t.handleCharacteristic),t.state==s.PairingModeRequested?(t.debug("checking pairing mode"),t.autoReconnect=!1,t.pfCharacteristic.writeValue(new Uint8Array([a.STATUS]))):Promise.resolve()})},a.prototype.disconnect=function(){if(n.prototype.disconnect.call(this),this.flashPacketToken&&this.flashPacketToken.cancel(),this.pfCharacteristic&&this.device.connected)try{this.pfCharacteristic.stopNotifications(),this.pfCharacteristic.removeEventListener("characteristicvaluechanged",this.handleCharacteristic)}catch(e){d.log("ble: partial flash disconnect error "+e.message)}this.pfCharacteristic=void 0},a.prototype.findMarker=function(e,t){if(!this.bin)return-1;for(;e+t.length<this.bin.length;e+=16){for(var n=!0,r=0;r<t.length;++r)if(t[r]!=this.bin[e+r]){n=!1;break}if(n)return e}return-1},a.prototype.flashAsync=function(e){var t=this;return this.hex?(this.debug("flashing already in progress"),Promise.resolve()):(this.device.pauseLog(),this.createFlashPromise(e).finally(function(){return t.device.resumeLogOnDisconnection()}))},a.prototype.createFlashPromise=function(e){var n=this;if(this.hex)return this.debug("flashing already in progress"),Promise.resolve();this.clearFlashData(),this.hex=e;var t=ts.pxtc.UF2.newBlockFile();ts.pxtc.UF2.writeHex(t,this.hex.split(/\r?\n/));var r=d.appTarget.compile.flashUsableEnd;this.bin=ts.pxtc.UF2.toBin(d.U.stringToUint8Array(ts.pxtc.UF2.serializeFile(t)),r).buf,this.debug("bin bytes "+this.bin.length),this.magicOffset=this.findMarker(0,a.MAGIC_MARKER),this.debug("magic block "+this.magicOffset.toString(16)),this.magicOffset<0&&(this.debug("magic block not found, not a valid HEX file"),d.U.userError(lf("Invalid file"))),this.debug("bytes to flash "+(this.bin.length-this.magicOffset));var i=this.magicOffset+a.MAGIC_MARKER.length;return this.dalHash=d.Util.toHex(this.bin.slice(i,i+8)),this.makeCodeHash=d.Util.toHex(this.bin.slice(i+8,i+16)),this.debug("DAL hash "+this.dalHash),this.debug("MakeCode hash "+this.makeCodeHash),this.connectAsync().then(function(){return new Promise(function(e,t){return n.flashResolve=e,n.flashReject=t,n.debug("check service version"),n.state=s.StatusRequested,n.pfCharacteristic.writeValue(new Uint8Array([a.STATUS]))})}).then(function(){},function(e){d.log("pf: error "+e.message),n.clearFlashData()})},a.prototype.checkStateTransition=function(e,t){return!!(this.state&t)||(this.debug("flash cmd "+e+" in state "+this.state.toString(16)+" "),this.flashReject(new Error),this.clearFlashData(),!1)},a.prototype.handleCharacteristic=function(e){var t=this;this.aliveToken.isCancelled()&&(this.flashReject(new Error),this.clearFlashData());var n=event.target.value,r=new Uint8Array(n.buffer),i=r[0];if(this.state!=s.Idle)switch(i){case a.STATUS:if(!this.checkStateTransition(i,s.StatusRequested|s.PairingModeRequested))return;this.version=r[1],this.mode=r[2],this.debug("flash service version "+this.version+" mode "+this.mode),this.debug("reading DAL region"),this.state=s.RegionDALRequested,this.pfCharacteristic.writeValue(new Uint8Array([a.REGION_INFO,a.REGION_DAL])).then(function(){});break;case a.REGION_INFO:if(!this.checkStateTransition(i,s.RegionDALRequested|s.RegionMakeCodeRequested))return;var o=this.regions[r[1]]={start:r[2]<<24|r[3]<<16|r[4]<<8|r[5],end:r[6]<<24|r[7]<<16|r[8]<<8|r[9],hash:d.Util.toHex(r.slice(10))};if(this.debug("read region "+r[1]+" start "+o.start.toString(16)+" end "+o.end.toString(16)+" hash "+o.hash),r[1]==a.REGION_DAL){if(o.hash!=this.dalHash)return d.tickEvent("webble.flash.DALrequired"),this.debug("DAL hash does not match, partial flashing not possible"),this.state=s.USBFlashRequired,this.flashReject(new Error("USB flashing required")),void this.clearFlashData();this.debug("DAL hash match, reading makecode region"),this.state=s.RegionMakeCodeRequested,this.pfCharacteristic.writeValue(new Uint8Array([a.REGION_INFO,a.REGION_MAKECODE])).then(function(){})}else if(r[1]==a.REGION_MAKECODE)if(o.start!=this.magicOffset&&(this.debug("magic offset and MakeCode region.start not matching"),d.U.userError(lf("Invalid file"))),o.hash==this.makeCodeHash)d.tickEvent("webble.flash.noop"),this.debug("MakeCode hash matches, same code!"),this.debug("restart application mode"),this.pfCharacteristic.writeValue(new Uint8Array([a.RESET,a.MODE_APPLICATION])).then(function(){t.state=s.Idle,t.flashResolve(),t.clearFlashData()});else{if(this.mode!=a.MODE_PAIRING)return this.debug("application mode, reset into pairing mode"),this.state=s.PairingModeRequested,this.autoReconnect=!0,void this.pfCharacteristic.writeValue(new Uint8Array([a.RESET,a.MODE_PAIRING])).then(function(){});this.flashOffset=o.start,this.flashPacketNumber=0,this.debug("starting to flash from address "+this.flashOffset.toString(16)),this.flashNextPacket()}break;case a.FLASH_DATA:if(!this.checkStateTransition(i,s.Flash))return;switch(r[1]){case a.PACKET_OUT_OF_ORDER:this.debug("packet out of order"),this.flashPacketToken.cancel(),this.flashPacketNumber+=4,this.chunkDelay=Math.min(this.chunkDelay+10,a.CHUNK_MAX_DELAY),this.flashNextPacket();break;case a.PACKET_WRITTEN:this.chunkDelay=Math.max(this.chunkDelay-1,a.CHUNK_MIN_DELAY),this.flashOffset+=64,this.flashPacketNumber+=4,this.flashOffset>=this.bin.length?(this.debug("end transmission"),this.state=s.EndOfTransmision,this.pfCharacteristic.writeValue(new Uint8Array([a.END_OF_TRANSMISSION])).finally(function(){t.flashResolve&&t.flashResolve(),t.clearFlashData()})):this.flashNextPacket()}break;default:this.debug("unknown message "+d.Util.toHex(r)),this.disconnect()}},a.prototype.flashNextPacket=function(){var r=this;this.state=s.Flash,this.flashPacketToken=new d.Util.CancellationToken,this.flashPacketToken.startOperation();var t=this.bin.slice(this.flashOffset,this.flashOffset+64);this.debug("flashing "+this.flashOffset.toString(16)+" / "+this.bin.length.toString(16)+" "+((this.flashOffset-this.magicOffset)/(this.bin.length-this.magicOffset)*100>>0)+"%");var i=new Uint8Array(20);Promise.delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=r.flashOffset>>8&255,i[2]=r.flashOffset>>0&255,i[3]=r.flashPacketNumber;for(var e=0;e<16;e++)i[4+e]=t[e];return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=r.flashOffset>>24&255,i[2]=r.flashOffset>>16&255,i[3]=r.flashPacketNumber+1;for(var e=0;e<16;e++)i[4+e]=t[16+e]||0;return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=r.flashPacketNumber+2;for(var e=0;e<16;e++)i[4+e]=t[32+e]||0;return r.pfCharacteristic.writeValue(i)}).delay(this.chunkDelay).then(function(){r.flashPacketToken.throwIfCancelled(),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=r.flashPacketNumber+3;for(var e=0;e<16;e++)i[4+e]=t[48+e]||0;return r.pfCharacteristic.writeValue(i)}).then(function(){var t=r.flashOffset,n=function(){return Promise.delay(500).then(function(){if(t!=r.flashOffset||r.flashPacketToken.isCancelled()||r.aliveToken.isCancelled()||r.state!=s.Flash)return Promise.resolve();r.debug("packet transfer deadlock, force restart"),i[0]=a.FLASH_DATA,i[1]=0,i[2]=0,i[3]=-1;for(var e=0;e<16;e++)i[4+e]=0;return r.pfCharacteristic.writeValue(i).then(function(){return n()})})};n().catch(function(e){r.flashReject&&(r.flashReject(new Error("failed packet transfer")),r.clearFlashData())})}).catch(function(){r.flashPacketToken.resolveCancel()})},a.SERVICE_UUID="e97dd91d-251d-470a-a062-fa1922dfa9a8",a.CHARACTERISTIC_UUID="e97d3b10-251d-470a-a062-fa1922dfa9a8",a.REGION_INFO=0,a.FLASH_DATA=1,a.PACKET_OUT_OF_ORDER=170,a.PACKET_WRITTEN=255,a.END_OF_TRANSMISSION=2,a.STATUS=238,a.RESET=255,a.MODE_PAIRING=0,a.MODE_APPLICATION=1,a.REGION_SOFTDEVICE=0,a.REGION_DAL=1,a.REGION_MAKECODE=2,a.MAGIC_MARKER=d.Util.fromHex("708E3B92C615A841C49866C975EE5197"),a.CHUNK_MIN_DELAY=0,a.CHUNK_MAX_DELAY=75,a}(t);r.PartialFlashingService=l;var p=function(n){function e(e){var t=n.call(this,"ble",new d.Util.CancellationToken)||this;return t.device=void 0,t.services=[],t.pendingResumeLogOnDisconnection=!1,t.servicesVersion=0,t.device=e,t.handleDisconnected=t.handleDisconnected.bind(t),t.handleServiceAdded=t.handleServiceAdded.bind(t),t.handleServiceChanged=t.handleServiceChanged.bind(t),t.handleServiceRemoved=t.handleServiceRemoved.bind(t),t.device.addEventListener("gattserverdisconnected",t.handleDisconnected),t.device.addEventListener("serviceadded",t.handleServiceAdded),t.device.addEventListener("servicechanged",t.handleServiceChanged),t.device.addEventListener("serviceremoved",t.handleServiceRemoved),i()&&(t.services.push(t.uartService=new u(t)),t.services.push(t.hf2Service=new a(t))),o()&&t.services.push(t.partialFlashingService=new l(t)),t.aliveToken.startOperation(),t}return __extends(e,n),e.prototype.startServices=function(){this.services.filter(function(e){return e.autoReconnect}).forEach(function(e){return e.connectAsync().catch(function(){})})},e.prototype.pauseLog=function(){this.uartService&&(this.uartService.autoReconnect=!1,this.uartService.disconnect()),this.hf2Service&&(this.hf2Service.autoReconnect=!1,this.hf2Service.disconnect())},e.prototype.resumeLogOnDisconnection=function(){this.pendingResumeLogOnDisconnection=!0},e.prototype.resumeLog=function(){this.uartService&&(this.uartService.autoReconnect=!0,this.uartService.connectAsync().catch(function(){})),this.hf2Service&&(this.hf2Service.autoReconnect=!0,this.hf2Service.connectAsync().catch(function(){}))},Object.defineProperty(e.prototype,"isPaired",{get:function(){return this===r.bleDevice},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.device.name||"?"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this.device&&this.device.gatt&&this.device.gatt.connected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gatt",{get:function(){return this.device.gatt},enumerable:!0,configurable:!0}),e.prototype.createConnectPromise=function(){var e=this;return this.debug("connecting gatt server"),this.alivePromise(this.device.gatt.connect().then(function(){return e.debug("gatt server connected")}))},e.prototype.handleServiceAdded=function(e){this.debug("service added"),this.servicesVersion++},e.prototype.handleServiceRemoved=function(e){this.debug("service removed"),this.servicesVersion++},e.prototype.handleServiceChanged=function(e){this.debug("service changed"),this.servicesVersion++},e.prototype.handleDisconnected=function(e){var t=this;this.debug("disconnected"),this.disconnect(),this.pendingResumeLogOnDisconnection&&(this.pendingResumeLogOnDisconnection=!1,Promise.delay(500).then(function(){return t.resumeLog()}))},e.prototype.disconnect=function(){if(n.prototype.disconnect.call(this),this.services.forEach(function(e){return e.disconnect()}),this.connected){this.debug("disconnect");try{this.device.gatt&&this.device.gatt.connected&&this.device.gatt.disconnect()}catch(e){this.debug("gatt disconnect error "+e.message)}}},e}(e);function f(){if(r.bleDevice)return Promise.resolve();d.log("ble: requesting device");var e=[];return i()&&(e.push(u.SERVICE_UUID),e.push(a.SERVICE_UUID)),o()&&e.push(l.SERVICE_UUID),navigator.bluetooth.requestDevice({filters:d.appTarget.appTheme.bluetoothUartFilters,optionalServices:e}).then(function(e){return d.log("ble: received device "+e.name),r.bleDevice=new p(e),r.bleDevice.startServices(),r.bleDevice.connectAsync()})}r.BLEDevice=p,r.bleDevice=void 0,r.isPaired=function(){return!!r.bleDevice},r.pairAsync=function(){return r.bleDevice&&(r.bleDevice.kill(),r.bleDevice=void 0),f().catch(function(e){r.bleDevice&&r.bleDevice.aliveToken&&r.bleDevice.aliveToken.resolveCancel(),d.log("ble: error "+e.message)})},r.flashAsync=function(e,t){d.tickEvent("webble.flash");var n=e.outfiles[ts.pxtc.BINARY_HEX];return f().then(function(){return r.bleDevice.partialFlashingService.flashAsync(n)}).then(function(){return d.tickEvent("webble.flash.success")}).catch(function(e){throw d.tickEvent("webble.fail.fail",{message:e.message}),e})}}(d.webBluetooth||(d.webBluetooth={}))}(pxt||(pxt={})),function(c){!function(o){var t=function(n){function e(e){var t=n.call(this,e)||this;return t.message=e,t}return __extends(e,n),e}(Error);o.USBError=t;o.filters=[{classCode:255,subclassCode:42}];var r=!0;o.setFilters=function(e){r=!1,o.filters=e};var e,n=function(){function e(){this.ready=!1,this.connecting=!1,this.readLoopStarted=!1,this.onDeviceConnectionChanged=function(e){},this.onConnectionChanged=function(){},this.onData=function(e){},this.onError=function(e){},this.onEvent=function(e){},this.enabled=!1,this.handleUSBConnected=this.handleUSBConnected.bind(this),this.handleUSBDisconnected=this.handleUSBDisconnected.bind(this)}return e.prototype.enable=function(){this.enabled||(this.enabled=!0,this.log("registering webusb events"),navigator.usb.addEventListener("disconnect",this.handleUSBDisconnected,!1),navigator.usb.addEventListener("connect",this.handleUSBConnected,!1))},e.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.log("unregistering webusb events"),navigator.usb.removeEventListener("disconnect",this.handleUSBDisconnected),navigator.usb.removeEventListener("connect",this.handleUSBConnected))},e.prototype.disposeAsync=function(){return this.disable(),Promise.resolve()},e.prototype.handleUSBDisconnected=function(e){this.log("device disconnected"),e.device==this.dev&&(this.log("clear device"),this.clearDev(),this.onDeviceConnectionChanged&&this.onDeviceConnectionChanged(!1))},e.prototype.handleUSBConnected=function(e){var t=e.device;this.log("device connected "+t.serialNumber),this.dev||this.connecting||(this.log("attach device"),this.onDeviceConnectionChanged&&this.onDeviceConnectionChanged(!0))},e.prototype.clearDev=function(){this.dev&&(this.dev=null,this.epIn=null,this.epOut=null,this.onConnectionChanged&&this.onConnectionChanged())},e.prototype.error=function(e){throw new t(c.U.lf("USB error on device {0} ({1})",this.dev.productName,e))},e.prototype.log=function(e){c.debug("webusb: "+e)},e.prototype.disconnectAsync=function(){var e=this;return this.ready=!1,this.dev?(this.log("close device"),this.dev.close().catch(function(e){}).then(function(){return e.clearDev(),Promise.delay(500)})):Promise.resolve()},e.prototype.reconnectAsync=function(){var t=this;return this.log("reconnect"),this.setConnecting(!0),this.disconnectAsync().then(i).then(function(e){return t.connectAsync(e)}).finally(function(){return t.setConnecting(!1)})},e.prototype.setConnecting=function(e){e!=this.connecting&&(this.connecting=e,this.onConnectionChanged&&this.onConnectionChanged())},e.prototype.isConnecting=function(){return this.connecting},e.prototype.isConnected=function(){return!!this.dev&&this.ready},e.prototype.connectAsync=function(s){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(e){switch(e.label){case 0:if(this.log("trying to connect ("+s.length+" devices)"),0==s.length)throw(o=new Error("Device not found.")).type="devicenotfound",o;this.setConnecting(!0),e.label=1;case 1:return e.trys.push([1,,11,12]),this.lastKnownDeviceSerialNumber?(t=s.find(function(e){return e.serialNumber===a.lastKnownDeviceSerialNumber}))?(this.log("last known device spotted"),s.splice(s.indexOf(t),1),s.unshift(t),[3,4]):[3,2]:[3,4];case 2:return this.log("delay for last known device"),[4,Promise.delay(2e3)];case 3:e.sent(),e.label=4;case 4:n=0,e.label=5;case 5:if(!(n<s.length))return[3,10];r=s[n],this.dev=r,this.log("connect device: "+r.manufacturerName+" "+r.productName),this.log("serial number: "+r.serialNumber+" "+(this.lastKnownDeviceSerialNumber===r.serialNumber?"(last known device)":"")+" "),e.label=6;case 6:return e.trys.push([6,8,,9]),[4,this.initAsync()];case 7:return e.sent(),[2];case 8:return i=e.sent(),this.dev=void 0,this.log("connection failed, "+i.message),[3,9];case 9:return++n,[3,5];case 10:throw(o=new Error(c.U.lf("Device in use or not found."))).type="devicelocked",o;case 11:return this.setConnecting(!1),[7];case 12:return[2]}})})},e.prototype.sendPacketAsync=function(e){var t=this;return this.dev?(c.Util.assert(e.length<=64),this.epOut?this.dev.transferOut(this.epOut.endpointNumber,e).then(function(e){"ok"!=e.status&&t.error("USB OUT transfer failed")}):this.dev.controlTransferOut({requestType:"class",recipient:"interface",request:9,value:512,index:this.iface.interfaceNumber},e).then(function(e){"ok"!=e.status?t.error("USB CTRL OUT transfer failed"):r||t.recvOne()})):Promise.reject(new Error("Disconnected"))},e.prototype.recvOne=function(){var t=this;this.recvPacketAsync().then(function(e){t.onData(e)},function(e){t.onError(e)})},e.prototype.readLoop=function(){var t=this;if(!this.readLoopStarted){this.readLoopStarted=!0,this.log("start read loop");var n=function(){t.ready?t.recvPacketAsync().then(function(e){e[0]?(t.onData(e),n()):Promise.delay(500).then(n)},function(e){t.dev&&t.onError(e),Promise.delay(300).then(n)}):Promise.delay(300).then(n)};n()}},e.prototype.recvPacketAsync=function(){var n=this,e=function(e){"ok"!=e.status&&n.error("USB IN transfer failed");var t=new Uint8Array(e.data.buffer);return 0==t.length?n.recvPacketAsync():t};return this.dev?this.epIn?this.dev.transferIn(this.epIn.endpointNumber,64).then(e):this.dev.controlTransferIn({requestType:"class",recipient:"interface",request:1,value:256,index:this.iface.interfaceNumber},64).then(e):Promise.reject(new Error("Disconnected"))},e.prototype.initAsync=function(){var t=this;if(!this.dev)return Promise.reject(new Error("Disconnected"));var n=this.dev;return this.log("open device"),n.open().then(function(){return t.log("select configuration"),n.selectConfiguration(1)}).then(function(){t.log("got "+n.configurations[0].interfaces.length+" interfaces");var e=n.configurations[0].interfaces.filter(function(e){for(var t=e.alternates[0],n=0,r=o.filters;n<r.length;n++){var i=r[n];if((null==i.classCode||t.interfaceClass===i.classCode)&&!(null!=i.subclassCode&&t.interfaceSubclass!==i.subclassCode||null!=i.protocolCode&&t.interfaceProtocol!==i.protocolCode)){if(0==t.endpoints.length)return!0;if(2==t.endpoints.length&&t.endpoints.every(function(e){return 64==e.packetSize}))return!0}}return!1})[0];return e||t.error("cannot find supported USB interface"),t.altIface=e.alternates[0],t.iface=e,t.altIface.endpoints.length&&(t.epIn=t.altIface.endpoints.filter(function(e){return"in"==e.direction})[0],t.epOut=t.altIface.endpoints.filter(function(e){return"out"==e.direction})[0],c.Util.assert(64==t.epIn.packetSize),c.Util.assert(64==t.epOut.packetSize)),t.log("claim interface"),n.claimInterface(e.interfaceNumber)}).then(function(){t.log("device ready"),t.lastKnownDeviceSerialNumber=t.dev.serialNumber,t.ready=!0,(t.epIn||r)&&t.readLoop(),t.onConnectionChanged&&t.onConnectionChanged()})},e}();function i(){return c.log("webusb: get devices"),navigator.usb.getDevices().then(function(e){return e=e||[]})}function a(){if(c.BrowserUtils.isElectron()||c.BrowserUtils.isWinRT())return!1;if(navigator.usb){var e=/Windows NT (\d+\.\d+)/.exec(navigator.userAgent);return!(e&&parseFloat(e[1])<6.3)}return!1}o.pairAsync=function(){return navigator.usb.requestDevice({filters:o.filters}).then(function(e){return!!e}).catch(function(e){if("NotFoundError"!=e.name)throw e})},o.mkWebUSBHIDPacketIOAsync=function(){return c.debug("packetio: mk webusb io"),e||(e=new n),e.enable(),Promise.resolve(e)},o.isEnabled=!1,o.setEnabled=function(e){a()||(e=!1),o.isEnabled=e},o.isAvailable=a}(c.usb||(c.usb={}))}(pxt||(pxt={})),function(s){!function(e){var n=s.Util,r={};function a(o){var a={},s=0,e=new n.PromiseQueue,t=new Promise(function(e,t){a.ready=e});e.enqueue("main",function(){return t});return{opAsync:function(r,i){return e.enqueue("main",function(){return new Promise(function(t,n){var e=""+s++;a[e]=function(e){e?e.errorMessage?n(new Error(e.errorMessage)):t(e):n(new Error("no response"))},o({id:e,op:r,arg:i})})})},recvHandler:function(e){if(a.hasOwnProperty(e.id)){var t=a[e.id];delete a[e.id],t(e.result)}}}}function i(e){var t=new Worker(e),n=a(function(e){return t.postMessage(e)});return t.onmessage=function(e){s.perf.measureStart("webworker recvHandler"),n.recvHandler(e.data),s.perf.measureEnd("webworker recvHandler")},n}e.getWorker=function(e){var t=r[e];return t||(t=r[e]=i(e)),t},e.wrap=a,e.makeWebWorker=i,e.makeWebSocket=function(e,n){void 0===n&&(n=null);var i=new WebSocket(e),o=[],r=a(function(e){var t=JSON.stringify(e);o?o.push(t):i.send(t)});return i.onmessage=function(e){var t=JSON.parse(e.data);n&&null==t.id?n(t):r.recvHandler(t)},i.onopen=function(e){s.debug("socket opened");for(var t=0,n=o;t<n.length;t++){var r=n[t];i.send(r)}o=null},i.onclose=function(e){s.debug("socket closed")},i.onerror=function(e){s.debug("socket errored")},r}}(s.worker||(s.worker={}))}(pxt||(pxt={})),function(c){!function(a){function s(){a.apiKey||c.U.userError("YouTube API key missing")}a.apiKey=void 0,a.playlistItemToCodeCard=function(e){return{name:e.snippet.title.replace(/[^-]*-/,"").trim(),description:(r=e.snippet.description,r.split(/\n\s+/,1)[0].trim()),youTubeId:e.snippet.resourceId.videoId,youTubePlaylistId:e.snippet.playlistId,imageUrl:(t=e.snippet.thumbnails,t&&(null===(n=t.medium||t.high||t.standard||t.default)||void 0===n?void 0:n.url)||"")};var t,n,r},a.playlistInfoAsync=function(e){s();var t="https://www.googleapis.com/youtube/v3/playlists?part=snippet&id="+e+"&key="+a.apiKey;return c.Util.httpGetJsonAsync(t).then(function(e){return e.items[0]})},a.listPlaylistVideosAsync=function(o){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:s(),t=[],n=void 0,e.label=1;case 1:return r="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId="+o+"&key="+a.apiKey,n&&(r+="&pageToken="+n),[4,c.Util.httpGetJsonAsync(r)];case 2:i=e.sent(),t=t.concat(i.items),n=i.nextPageToken,e.label=3;case 3:if(n)return[3,1];e.label=4;case 4:return c.options.debug&&c.debug(JSON.stringify(t,null,2)),[2,t]}})})},a.watchUrl=function(e,t){var n=void 0;return e?(n="https://www.youtube.com/watch?v="+e,t&&(n+="&list="+t)):t&&(n="https://www.youtube.com/playlist?list="+t),n}}(c.youtube||(c.youtube={}))}(pxt||(pxt={})),function(e){var y;(function(g){function v(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return e.replace(/{(\d+)}/g,function(e,t){return n[+t]})}g.debug=!1,g.lf=v;var m=b("opcode name doesn't match","<name>"),a=function(){function e(e,t,n,r,i){var o=this;this.opcode=n,this.mask=r,this.is32bit=i,this.canBeShared=!1,y.assert((n&r)==n),this.ei=e,this.code=t.replace(/\s+/g," "),this.friendlyFmt=t.replace(/\$\w+/g,function(e){return o.ei.encoders[e]?o.ei.encoders[e].pretty:e});var a=l(t);this.name=a[0],this.args=a.slice(1)}return e.prototype.emit=function(e){var t=e.words;if(t[0]!=this.name)return m;for(var n=this.opcode,r=1,i=0,o=[],a=null,s=null,c=null,u=0;u<this.args.length;++u){var l=this.args[u],p=t[r++];if("$"==l[0]){var f=this.ei.encoders[l],d=null;if(f.isRegister){if(null==(d=this.ei.registerNo(p)))return b("expecting register name",p);this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--}else if(f.isImmediate){if(p=p.replace(/^#/,""),null==(d=e.bin.parseOneInt(p)))return b("expecting number",p);this.ei.isAddSP(this.opcode)?i=-d/this.ei.wordSize():this.ei.isSubSP(this.opcode)&&(i=d/this.ei.wordSize())}else if(f.isRegList){if("{"!=p)return b("expecting {",p);for(d=0;"}"!=t[r];){if(!(p=t[r++]))return b("expecting }",t[r-2]);var h=this.ei.registerNo(p);if(null==h)return b("expecting register name",p);if(d&1<<h)return b("duplicate register name",p);d|=1<<h,this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--,","==t[r]&&r++}p=t[r++]}else if(f.isLabel){if(p=p.replace(/^#/,""),/^[+-]?\d+$/.test(p))a="rel"+(d=parseInt(p,10));else if(/^0x[0-9a-fA-F]+$/.test(p))a="abs"+(d=parseInt(p,16));else if(a=p,null==(d=this.ei.getAddressFromLabel(e.bin,this,p,f.isWordAligned))){if(e.bin.finalEmit)return b("unknown label",p);d=8}if(this.ei.is32bit(this)){s=d,c=p;continue}}else y.oops();if(null==d)return b("didn't understand it",p);if(o.push(d),null==(d=f.encode(d)))return b("argument out of range or mis-aligned",p);y.assert(0==(n&d)),n|=d}else if(l!=p)return b("expecting "+l,p)}return t[r]?b("trailing tokens",t[r]):this.ei.is32bit(this)?this.ei.emit32(n,s,e.bin.normalizeExternalLabel(c)):{stack:i,opcode:n,numArgs:o,labelName:e.bin.normalizeExternalLabel(a)}},e.prototype.toString=function(){return this.friendlyFmt},e}();g.Instruction=a;var u=function(){function e(e,t){this.bin=e,this.text=t}return e.prototype.getOpExt=function(){return this.instruction?this.instruction.code:""},e.prototype.getOp=function(){return this.instruction?this.instruction.name:""},e.prototype.update=function(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),e="    "+e,this.text=e+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=l(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")},e}();g.Line=u;var s=function(){function e(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=function(e){return e},this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.equs={},this.stackpointers={},this.stack=0,this.commPtr=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.currLine=new u(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}return e.prototype.emitShort=function(e){y.assert(0<=e&&e<=65535),this.buf.push(e)},e.prototype.emitOpCode=function(e){this.emitShort(e)},e.prototype.location=function(){return 2*this.buf.length},e.prototype.pc=function(){return this.location()+this.baseOffset},e.prototype.parseOneInt=function(e){if(!e)return null;if(/^\d+$/.test(e))return parseInt(e,10);var t=e.indexOf("-");if(0<t)return this.parseOneInt(e.slice(0,t))-this.parseOneInt(e.slice(t+1));var n=1;if(0<=e.indexOf("*"))for(var r=null;r=/^([^\*]*)\*(.*)$/.exec(e);){var i=this.parseOneInt(r[1]);if(null==i)return null;n*=i,e=r[2]}if("-"==e[0]?(n*=-1,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1)),/^\d+$/.test(e))return n*parseInt(e,10);if(y.U.endsWith(e,"|1"))return 1|this.parseOneInt(e.slice(0,e.length-2));if(y.U.endsWith(e,"-1"))return this.parseOneInt(e.slice(0,e.length-2))-1;if(y.U.endsWith(e,"+1"))return this.parseOneInt(e.slice(0,e.length-2))+1;var o=/(.*)>>(\d+)$/.exec(e);if(o){var a=this.parseOneInt(o[1]);return(a&=~(-16777216&this.baseOffset))>>parseInt(o[2])}var s=null;return"0"==e[0]&&("x"==e[1]||"X"==e[1]?(r=/^0x([a-f0-9]+)$/i.exec(e))&&(s=parseInt(r[1],16)):"b"!=e[1]&&"B"!=e[1]||(r=/^0b([01]+)$/i.exec(e))&&(s=parseInt(r[1],2))),0<=e.indexOf("@")&&((r=/^(\w+)@(-?\d+)$/.exec(e))&&(1!=n&&this.directiveError(v("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(r[1])?s=this.ei.wordSize()*this.ei.computeStackOffset(r[1],this.stack-this.stackpointers[r[1]]+parseInt(r[2])):this.directiveError(v("saved stack not found"))),(r=/^(.*)@(hi|lo|fn)$/.exec(e))&&this.looksLikeLabel(r[1])&&null!=(s=this.lookupLabel(r[1],!0))&&("fn"==r[2]?s=this.ei.toFnPtr(s,this.baseOffset,r[1]):0<=(s>>=1)&&s<=65535?"hi"==r[2]?s=s>>8&255:"lo"==r[2]?s&=255:y.oops():(this.directiveError(v("@hi/lo out of range")),s=null))),null==s&&this.looksLikeLabel(e)&&null!=(s=this.lookupLabel(e,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(s+=this.baseOffset),null==s||isNaN(s)?null:s*n},e.prototype.looksLikeLabel=function(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)},e.prototype.scopedName=function(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e},e.prototype.lookupLabel=function(e,t){void 0===t&&(t=!1);var n=null,r=this.scopedName(e);return this.labels.hasOwnProperty(r)?(n=this.labels[r],n=this.ei.postProcessRelAddress(this,n)):this.lookupExternalLabel&&null!=(n=this.lookupExternalLabel(e))&&(n=this.ei.postProcessAbsAddress(this,n)),null==n&&this.equs.hasOwnProperty(r)&&(n=this.equs[r]),null==n&&t&&(this.finalEmit?this.directiveError(v("unknown label: {0}",e)):n=11111),n},e.prototype.align=function(e){for(y.assert(2==e||4==e||8==e||16==e);this.location()%e!=0;)this.emitOpCode(0)},e.prototype.pushError=function(e,t){void 0===t&&(t="");var n={scope:this.scope,message:v("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(n),this.throwOnError)throw new Error(n.message)},e.prototype.directiveError=function(e){this.pushError(e)},e.prototype.emitString=function(e,t){function n(e,t){return 255&(e.charCodeAt(t)||0)}void 0===t&&(t=!1);var r,i=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);if(i&&null!=(r=function(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,function(e,t){return t}).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,function(e,t){return"\\u00"+t}).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}(i[2])))if(this.align(2),t)for(var o=0;o<r.length;o++)this.emitShort(r.charCodeAt(o));else for(o=0;o<r.length+1;o+=2)this.emitShort(n(r,o+1)<<8|n(r,o));else this.directiveError(v("expecting string"))},e.prototype.parseNumber=function(e){var t=this.parseOneInt(e.shift());return null==t?null:t},e.prototype.parseNumbers=function(e){e=e.slice(1);for(var t=[];;){var n=this.parseNumber(e);if(null==n){this.directiveError(v("cannot parse number at '{0}'",e[0]));break}if(t.push(n),","!=e[0]){if(null==e[0])break;this.directiveError(v("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t},e.prototype.emitSpace=function(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(v("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(v("only even space supported"));else{var n=255&t[1];n|=n<<8;for(var r=0;r<t[0];r+=2)this.emitShort(n)}},e.prototype.emitBytes=function(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];0<=r&&i<=255&&0<=i&&r<=255?this.emitShort(255&r|(255&i)<<8):this.directiveError(v("expecting uint8"))}},e.prototype.emitHex=function(e){var r=this;e.slice(1).forEach(function(e){if(","!=e)if(e.length%4!=0)r.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(e))for(var t=0;t<e.length;t+=4){var n=parseInt(e.slice(t,t+4),16);n=(255&n)<<8|n>>8&255,r.emitShort(n)}else r.directiveError(".hex needs a hex number")})},e.prototype.handleDirective=function(e){var t,n=this,r=e.words,i=function(){2!=r.length&&n.directiveError(v("expecting one argument"))};switch(r[0]){case".ascii":case".asciz":case".string":this.emitString(e.text);break;case".utf16":this.emitString(e.text,!0);break;case".align":if(i(),null!=(t=this.parseOneInt(r[1]))){if(0==t)return;t<=4?this.align(1<<t):this.directiveError(v("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(v("expecting number"));break;case".balign":if(i(),null!=(t=this.parseOneInt(r[1]))){if(1==t)return;2==t||4==t||8==t||16==t?this.align(t):this.directiveError(v("expecting 2, 4, 8, or 16"))}else this.directiveError(v("expecting number"));break;case".p2align":i(),null!=(t=this.parseOneInt(r[1]))?this.align(1<<t):this.directiveError(v("expecting number"));break;case".byte":this.emitBytes(r);break;case".hex":this.emitHex(r);break;case".hword":case".short":case".2bytes":this.parseNumbers(r).forEach(function(e){-32768<=e&&e<=65535?n.emitShort(65535&e):n.directiveError(v("expecting int16"))});break;case".word":case".4bytes":case".long":this.parseNumbers(r).forEach(function(e){-2147483648<=e&&e<=4294967295?(n.emitShort(65535&e),n.emitShort(e>>16&65535)):n.directiveError(v("expecting int32"))});break;case".skip":case".space":this.emitSpace(r);break;case".set":case".equ":/^\w+$/.test(r[1])||this.directiveError(v("expecting name"));var o=this.parseNumbers(r.slice(","==r[2]||"="==r[2]?2:1));1!=o.length&&this.directiveError(v("expecting one value")),void 0!==this.equs[r[1]]&&this.equs[r[1]]!=o[0]&&this.directiveError(v("redefinition of {0}",r[1])),this.equs[r[1]]=o[0];break;case".startaddr":this.location()&&this.directiveError(v(".startaddr can be only be specified at the beginning of the file")),i(),this.baseOffset=this.parseOneInt(r[1]);break;case"@stackmark":i(),this.stackpointers[r[1]]=this.stack;break;case"@stackempty":this.checkStack&&(null==this.stackpointers[r[1]]?this.directiveError(v("no such saved stack")):this.stackpointers[r[1]]!=this.stack&&this.directiveError(v("stack mismatch")));break;case"@scope":this.scope=r[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case".syntax":case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":i(),this.stack+=this.parseOneInt(r[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".comm":(r=r.filter(function(e){return","!=e})).shift();var a=this.parseOneInt(r[1]),s=0;if(s=r[2]?this.parseOneInt(r[2]):4,null==this.lookupLabel(r[0])){for(this.commPtr||(this.commPtr=this.lookupExternalLabel("_pxt_comm_base")||0,this.commPtr||this.directiveError(v("PXT_COMM_BASE not defined")));this.commPtr&s-1;)this.commPtr++;this.labels[this.scopedName(r[0])]=this.commPtr-this.baseOffset,this.commPtr+=a}break;case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case".fnstart":case".save":case".size":case".fnend":case".pad":case".globl":case".local":case"@":break;default:/^\.cfi_/.test(r[0])||this.directiveError(v("unknown directive"))}},e.prototype.handleOneInstruction=function(e,t){var n=t.emit(e);return!n.error&&(this.stack+=n.stack,this.checkStack&&this.stack<0&&this.pushError(v("stack underflow")),e.location=this.location(),e.opcode=n.opcode,e.stack=n.stack,this.emitOpCode(n.opcode),null!=n.opcode2&&this.emitOpCode(n.opcode2),null!=n.opcode3&&this.emitOpCode(n.opcode3),e.instruction=t,e.numArgs=n.numArgs,!0)},e.prototype.handleInstruction=function(n){var t=this;if(!n.instruction||!this.handleOneInstruction(n,n.instruction)){var e=function(e){return t.ei.instructions.hasOwnProperty(e)?t.ei.instructions[e]:[]};if(!n.instruction)for(var r=e(n.words[0]),i=0;i<r.length;++i)if(this.handleOneInstruction(n,r[i]))return;var o=n.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,""),a="",s=e(o).concat(e(o+"s"));0<s.length&&s.forEach(function(e){var t=e.emit(n);a+=v("   Maybe: {0} ({1} at '{2}')\n",e.toString(),t.error,t.errorAt)}),this.pushError(v("assembly error"),a)}},e.prototype.buildLine=function(e,n){var r=this,t=function(e){var t=new u(r,e);return t.scope=r.scope,t.lineNo=r.currLineNo,n.push(t),t},i=t(e),o=l(i.text)||[],a=(i.words=o)[0]||"";if(":"==a.charAt(a.length-1)){var s=/^([\.\w]+):$/.exec(o[0]);if(s){if(i.type="label",i.text=s[1]+":",i.words=[s[1]],!(1<o.length))return;o.shift(),a=((i=t(e.replace(/^[^:]*:/,""))).words=o)[0]||""}}var c=a.charAt(0);"."==c||"@"==c?(i.type="directive","@scope"==i.words[0]&&this.handleDirective(i)):0==i.words.length?i.type="empty":i.type="instruction"},e.prototype.prepLines=function(e){var t=this;this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(function(e){10<t.errors.length||(t.currLineNo++,t.realCurrLineNo++,t.buildLine(e,t.lines))})},e.prototype.iterLines=function(){var r=this;this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(function(e){if(!(10<r.errors.length)&&0!=(r.currLine=e).words.length)if("label"==e.type){var t=r.scopedName(e.words[0]);if(r.prevLabel=t,r.finalEmit){null!=r.equs[t]&&r.directiveError(v(".equ redefined as label"));var n=r.labels[t];null==n&&y.oops(),0==r.errors.length&&n!=r.location()&&y.oops("invalid location: "+r.location()+" != "+n+" at "+t),y.assert(0<r.errors.length||n==r.location()),r.reallyFinalEmit&&(r.stackAtLabel[t]=r.stack)}else r.labels.hasOwnProperty(t)?r.directiveError(v("label redefinition")):r.inlineMode&&/^_/.test(t)?r.directiveError(v("labels starting with '_' are reserved for the compiler")):r.labels[t]=r.location();e.location=r.location()}else"directive"==e.type?r.handleDirective(e):"instruction"==e.type?r.handleInstruction(e):"empty"==e.type||y.oops()})},e.prototype.getSource=function(r,e,t){var i=this;void 0===e&&(e=1),void 0===t&&(t=0);var o=0,n=function(e){var t=i.labels[e]||o,n=t-o;return o=t,n},a=this.buf?this.location():0,s=n("_code_end"),c=n("_helpers_end"),u=n("_vtables_end"),l=n("_literals_end"),p=o,f=a+this.baseOffset&16777215;t&&t<f&&y.U.userError(v("program too big by {0} bytes!",f-t));var d=v("; total bytes: {0} ({1}% of {2}k flash with {3} free)",f,(100*f/(t=t||131072)).toFixed(1),(t/1024).toFixed(1),t-f),h=v("; generated code sizes (bytes): {0} (incl. {1} user, {2} helpers, {3} vtables, {4} lits); src size {5}\n",p,s,c,u,l,a-p)+v("; assembly: {0} lines; density: {1} bytes/stmt; ({2} stmts)\n",this.lines.length,Math.round(100*s/e)/100,e)+d+"\n"+this.stats+"\n\n",m=!1;return this.lines.forEach(function(e,t){if("_stored_program"==e.words[0])return h+='_stored_program: .string "..."\n',void(m=!0);if(m)m=!1;else{var n=e.text;if(r){if("@stackempty"==e.words[0]&&i.lines[t-1].text==e.text)return;if(!(n=n.replace(/; WAS: .*/,"")).trim())return}g.debug&&("label"!=e.type&&"instruction"!=e.type||(n+=" \t; 0x"+(e.location+i.baseOffset).toString(16))),h+=n+"\n"}}),h},e.prototype.peepHole=function(){for(var e=this.lines.filter(function(e){return"empty"!=e.type}),t=0;t<e.length;++t){var n=e[t];if(!/^user/.test(n.scope)){var r=e[t+1];if(r){var i=e[t+2];"instruction"==n.type&&this.ei.peephole(n,r,i)}}}},e.prototype.clearLabels=function(){this.labels={},this.commPtr=0},e.prototype.peepPass=function(e){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.clearLabels(),this.iterLines(),y.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=e||0==this.peepOps,this.iterLines(),this.stats+=v("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))},e.prototype.getLabels=function(){var n=this;return this.userLabelsCache||(this.userLabelsCache=y.U.mapMap(this.labels,function(e,t){return t+n.baseOffset})),this.userLabelsCache},e.prototype.emit=function(e){if(y.assert(null==this.buf),this.prepLines(e),!(0<this.errors.length||(this.clearLabels(),this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(v("stack misaligned at the end of the file")),0<this.errors.length||(this.ei.expandLdlit(this),this.clearLabels(),this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),0<this.errors.length)))){for(var t=0;t<5&&(pxt.debug("Peephole OPT, pass "+t),this.peepPass(5==t),0!=this.peepOps);++t);pxt.debug("emit done")}},e}(),e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(g.File=s);g.VMFile=e;var t=function(){function e(){var o=this;this.file=null,this.addEnc=function(e,t,n){var r={name:e,pretty:t,encode:n,isRegister:/^\$r\d/.test(e),isImmediate:/^\$i\d/.test(e),isRegList:/^\$rl\d/.test(e),isLabel:/^\$l[a-z]/.test(e)};return o.encoders[e]=r},this.inrange=function(e,t,n){return Math.floor(t)!=t?null:t<0?null:e<t?null:n},this.inminmax=function(e,t,n,r){return Math.floor(n)!=n?null:n<e?null:t<n?null:r},this.inseq=function(e,t){var n=e.indexOf(t);return n<0?null:n},this.inrangeSigned=function(e,t,n){return Math.floor(t)!=t?null:t<-(e+1)?null:e<t?null:n&(e<<1|1)},this.addInst=function(e,t,n,r){var i=new a(o,e,t,n,r);return o.instructions.hasOwnProperty(i.name)||(o.instructions[i.name]=[]),o.instructions[i.name].push(i),i},this.encoders={},this.instructions={}}return e.prototype.toFnPtr=function(e,t,n){return e},e.prototype.wordSize=function(){return-1},e.prototype.computeStackOffset=function(e,t){return t},e.prototype.is32bit=function(e){return!1},e.prototype.emit32=function(e,t,n){return null},e.prototype.postProcessRelAddress=function(e,t){return t},e.prototype.postProcessAbsAddress=function(e,t){return t},e.prototype.peephole=function(e,t,n){},e.prototype.registerNo=function(e){return null},e.prototype.getAddressFromLabel=function(e,t,n,r){return void 0===r&&(r=!1),null},e.prototype.isPop=function(e){return!1},e.prototype.isPush=function(e){return!1},e.prototype.isAddSP=function(e){return!1},e.prototype.isSubSP=function(e){return!1},e.prototype.testAssembler=function(){y.assert(!1)},e.prototype.expandLdlit=function(e){},e}();function l(e){var t=[],n="";e:for(var r=0;r<e.length;++r)switch(e[r]){case"[":case"]":case"!":case"{":case"}":case",":n&&(t.push(n),n=""),t.push(e[r]);break;case" ":case"\t":case"\r":case"\n":n&&(t.push(n),n="");break;case";":break e;default:n+=e[r]}return n&&(t.push(n),n=""),t[0]?t:null}function b(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function c(e){return e<0||65535<e?("0x"+e.toString(16)).toLowerCase():("0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}g.AbstractProcessor=t,g.emitErr=b,g.expectError=function(e,t){var n=new s(e);n.emit(t),0==n.errors.length&&y.oops("ASMTEST: expecting error for: "+t)},g.tohex=c,g.expect=function(e,t){var n=[],r=t.replace(/^([0-9a-fA-F]{4,8})\s/gm,function(e,t){return n.push(parseInt(t.slice(0,4),16)),8==t.length&&n.push(parseInt(t.slice(4,8),16)),""}),i=new s(e);i.throwOnError=!0,i.disablePeepHole=!0,i.emit(r),0<i.errors.length&&(console.debug(i.errors[0].message),y.oops("ASMTEST: not expecting errors")),i.buf.length!=n.length&&y.oops("ASMTEST: wrong buf len");for(var o=0;o<n.length;++o)i.buf[o]!=n[o]&&y.oops("ASMTEST: wrong buf content at "+o+" , exp:"+c(n[o])+", got: "+c(i.buf[o]))}})((y=e.pxtc||(e.pxtc={})).assembler||(y.assembler={}))}(ts||(ts={})),function(g){!function(r){var a=pxtc.Util;r.apiRoot=g.BrowserUtils.isLocalHost()||a.isNodeJS?"https://www.makecode.com/api/":"/api/",r.accessToken="";var n=!(r.localToken="");function i(e){var t=new Error(a.lf("Cannot access {0} while offline",e));return t.isOffline=!0,Promise.delay(1e3).then(function(){return Promise.reject(t)})}function f(e,t){return g.U.requestAsync({url:"/api/"+e,headers:{Authorization:r.localToken},method:t?"POST":"GET",data:t||void 0,allowHttpErrors:!0})}function d(){return g.webConfig&&!g.webConfig.isStatic&&!g.BrowserUtils.isLocalHost()&&!!g.webConfig.cdnUrl}function e(e){if(e=e.replace(/^\//,""),!d())return r.apiRoot+e;var t=new Date,n=t.getUTCFullYear()+("0"+(t.getUTCMonth()+1)).slice(-2)+("0"+t.getUTCDate()).slice(-2);return e.indexOf("?")<0?e+="?":e+="&",e+="cdn="+n,g.webConfig.cdnUrl+"/api/"+e}function h(t){return d()?(t.url=e(t.url),a.requestAsync(t).catch(function(e){return o(t,e)})):m(t)}function o(e,t){return 0==t.statusCode?(n&&(n=!1,r.onOffline()),i(e.url)):Promise.reject(t)}function m(t){var e;return t.url=(null===(e=g.webConfig)||void 0===e?void 0:e.isStatic)&&!t.forceLiveEndpoint?g.webConfig.relprefix+t.url:r.apiRoot+t.url,t.allowGzipPost=!0,r.isOnline()||g.BrowserUtils.isPxtElectron()?(t.headers||(t.headers={}),g.BrowserUtils.isLocalHost()?r.localToken&&(t.headers.Authorization=r.localToken):r.accessToken&&(t.headers["x-td-access-token"]=r.accessToken),a.requestAsync(t).catch(function(e){return o(t,e)})):i(t.url)}r.onOffline=function(){},r.hasAccessToken=function(){return!!r.accessToken},r.localRequestAsync=f,r.useCdnApi=d,r.cdnApiUrl=e,r.apiRequestWithCdnAsync=h,r.privateRequestAsync=m,r.privateGetTextAsync=function(e,t){return m({url:e,headers:t}).then(function(e){return e.text})},r.privateGetAsync=function(e,t){return void 0===t&&(t=!1),m({url:e,forceLiveEndpoint:t}).then(function(e){return e.json})},r.downloadTargetConfigAsync=function(){if(!r.isOnline())return Promise.resolve(void 0);var e=g.appTarget.versions&&g.appTarget.versions.target,t=g.webConfig&&g.webConfig.isStatic?"targetconfig.json":"config/"+g.appTarget.id+"/targetconfig"+(e?"/v"+e:"");return g.BrowserUtils.isLocalHost()?f(t).then(function(e){return e?e.json:void 0}):h({url:t}).then(function(e){return e.json})},r.downloadScriptFilesAsync=function(e){return m({url:e+"/text",forceLiveEndpoint:!0}).then(function(e){return JSON.parse(e.text)})};var s=g.BrowserUtils.isLocalHostDev()?1:36e5;function c(e,t,n,r){var i,o,a=null===(i=g.webConfig)||void 0===i?void 0:i.isStatic,s=g.appTarget.versions&&g.appTarget.versions.target||"?";if(a){var c=/\/?docs\//.test(o=e),u=/\.\w+$/.test(o);if(!c){var l="/"===o[0];o="docs"+(l?"":"/")+o}u||(o+=".md")}else o="md/"+g.appTarget.id+"/"+e.replace(/^\//,"")+"?targetVersion="+encodeURIComponent(s);if(a||"en"==t||(o+="&lang="+encodeURIComponent(t),n&&(o+="&live=1")),g.BrowserUtils.isLocalHost()&&!n)return f(o).then(function(e){return 404==e.statusCode?m({url:o,method:"GET"}).then(function(e){return{md:e.text,etag:e.headers.etag}}):{md:e.text,etag:void 0}});var p=r&&!d()?{"If-None-Match":r}:void 0;return h({url:o,method:"GET",headers:p}).then(function(e){return{md:e.text,etag:e.headers.etag}})}function t(){return navigator&&navigator.onLine}r.markdownAsync=function(r,i){i=i||g.Util.userLanguage();var e=g.Util.localizeLive;return g.BrowserUtils.translationDbAsync().then(function(n){return n.getAsync(i,r,"").then(function(t){return t&&Date.now()-t.time>s&&c(r,i,e,t.etag).then(function(e){return n.setAsync(i,r,"",e.etag,void 0,e.md||t.md)}).catch(function(){}).done(),t&&t.md?t.md:c(r,i,e).then(function(e){return n.setAsync(i,r,"",e.etag,void 0,e.md).then(function(){return e.md})}).catch(function(){return""})})})},r.privateDeleteAsync=function(e){return m({url:e,method:"DELETE"}).then(function(e){return e.json})},r.privatePostAsync=function(e,t,n){return void 0===n&&(n=!1),m({url:e,data:t||{},forceLiveEndpoint:n}).then(function(e){return e.json})},r.isLoggedIn=function(){return!!r.accessToken},r.isNavigatorOnline=t,r.isOnline=function(){return"undefined"!=typeof navigator&&t()&&(n=!0),n},r.getServiceUrl=function(){return r.apiRoot.replace(/\/api\/$/,"")},r.getUserId=function(){var e=/^0(\w+)\./.exec(r.accessToken);return e?e[1]:null},r.parseScriptId=function(e){var t=g.appTarget;if(e&&t.appTheme&&t.cloud&&t.cloud.sharing){var n=["makecode.com"];t.appTheme.embedUrl&&n.push(t.appTheme.embedUrl),t.appTheme.shareUrl&&n.push(t.appTheme.shareUrl);var r="^((https://)?(?:"+(n=a.unique(n,function(e){return e}).map(function(e){return a.escapeForRegex(a.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase()})).join("|")+")/)?(?:v[0-9]+/)?(api/oembed?url=.*%2F([^&]*)&.*?|([a-z0-9-_]+))$",i=new RegExp(r,"i").exec(e.trim()),o=i&&(!i[1]||0<=n.indexOf(a.escapeForRegex(i[1].replace(/https:\/\//,"").replace(/\/$/,"")).toLowerCase()))&&(i[3]||i[4])?i[3]?i[3]:i[4]:null;if(o)return"_"==o[0]&&13==o.length?o:23==o.length&&/^[0-9\-]+$/.test(o)?o:void 0}}}(g.Cloud||(g.Cloud={}))}(pxt||(pxt={})),function(e){(e.pxtc||(e.pxtc={})).f4EncodeImg=function(e,t,n,r){for(var i=[135,n,255&e,e>>8,255&t,t>>8,0,0].map(p).join(""),o=4,a=0,s=0,c=function(e){a|=e<<s,s==8-n?(i+=p(a),o++,s=a=0):s+=n},u=0;u<e;++u){for(var l=0;l<t;++l)c(r(u,l));for(;0!=s;)c(0);if(1<n)for(;3&o;)c(0)}return i;function p(e){return("0"+e.toString(16)).slice(-2)}}}(ts||(ts={})),function(e){var t=function(){function e(e){this.numCols=8,this.numRows=8,this.polyphonic=!1,e&&(this.tempo=e),this.resetMelody()}return e.prototype.setTempo=function(e){this.tempo=e},e.prototype.getArray=function(){return this.melody},e.prototype.setArray=function(e){this.melody=e},e.prototype.getColor=function(e){return 0},e.prototype.getValue=function(e,t){return this.melody[e][t]},e.prototype.getWidth=function(){return this.numCols},e.prototype.getHeight=function(){return this.numRows},e.prototype.updateMelody=function(e,t){var n=!this.melody[e][t];if(n&&!this.polyphonic)for(var r=0;r<this.numRows;r++)this.melody[r][t]=!1;this.melody[e][t]=n},e.prototype.getStringRepresentation=function(){for(var e="",t=new Array(this.numCols),n=0,r=0;r<this.numRows;r++){var i=0;t[r]=[];for(var o=0;o<this.numCols;o++)this.melody[o][r]&&(t[r].push(a(o)),i++);n<i&&(n=i)}if(0==n)return"- - - - - - - - ";for(o=0;o<n;o++)for(r=0;r<this.numCols;r++)t[r]&&0<t[r].length?e+=t[r].shift()+" ":e+="- ";return e},e.prototype.parseNotes=function(e){for(var t=(e=e.trim()).split(" "),n=0;n<t.length;n++){for(var r=0;r<this.numRows;r++)this.melody[r][n]=!1;"-"!=t[n]&&(this.melody[i(t[n])][n]=!0)}},e.prototype.setPolyphonic=function(e){this.polyphonic=e},e.prototype.isPolyphonic=function(){return this.polyphonic},e.prototype.resetMelody=function(){this.melody=new Array(this.numCols);for(var e=0;e<this.numCols;e++)this.melody[e]=new Array(this.numRows).fill(!1)},e}();function a(e){var t="";switch(e){case 0:t="C5";break;case 1:t="B";break;case 2:t="A";break;case 3:t="G";break;case 4:t="F";break;case 5:t="E";break;case 6:t="D";break;case 7:t="C"}return t}function i(e){var t=-1;switch(e){case"C5":t=0;break;case"B":t=1;break;case"A":t=2;break;case"G":t=3;break;case"F":t=4;break;case"E":t=5;break;case"D":t=6;break;case"C":t=7}return t}e.MelodyArray=t,e.rowToNote=a,e.noteToRow=i,e.getColorClass=function(e){var t="melody-default";switch(e){case 0:t="melody-red";break;case 1:t="melody-orange";break;case 2:t="melody-yellow";break;case 3:t="melody-green";break;case 4:t="melody-teal";break;case 5:t="melody-blue";break;case 6:t="melody-purple";break;case 7:t="melody-violet"}return t}}(pxtmelody||(pxtmelody={})),function(a){var e=function(){function e(){var e=this;this.value=null,this.visible=!1,this.timeouts=[],this.numSamples=a.SampleMelodies.length,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("id","melody-editor-gallery-outer"),this.contentDiv=document.createElement("div"),this.contentDiv.setAttribute("id","melody-editor-gallery"),this.itemBackgroundColor="#DCDCDC",this.itemBorderColor="white",this.initStyles(),this.containerDiv.appendChild(this.contentDiv),this.containerDiv.style.display="none",this.contentDiv.addEventListener("animationend",function(){e.visible||(e.containerDiv.style.display="none")}),this.contentDiv.addEventListener("wheel",function(e){e.stopPropagation()},!0)}return e.prototype.getElement=function(){return this.containerDiv},e.prototype.getValue=function(){return this.value},e.prototype.show=function(e){this.pending=e,this.containerDiv.style.display="block",this.buildDom(),this.visible=!0,pxt.BrowserUtils.removeClass(this.contentDiv,"hidden-above"),pxt.BrowserUtils.addClass(this.contentDiv,"shown")},e.prototype.hide=function(){this.visible=!1,pxt.BrowserUtils.removeClass(this.contentDiv,"shown"),pxt.BrowserUtils.addClass(this.contentDiv,"hidden-above"),this.value=null,this.stopMelody()},e.prototype.clearDomReferences=function(){this.contentDiv=null,this.containerDiv=null},e.prototype.layout=function(e,t,n){this.containerDiv.style.left=e+"px",this.containerDiv.style.top=t+"px",this.containerDiv.style.height=n+"px"},e.prototype.buildDom=function(){for(;this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild);var e=a.SampleMelodies;this.buttons=[];for(var t=0;t<e.length;t++)this.mkButton(e[t],t,"255px","45px")},e.prototype.initStyles=function(){var e=document.createElement("style");e.textContent="\n            #melody-editor-gallery {\n                margin-top: -100%;\n            }\n\n            #melody-editor-gallery.hidden-above {\n                margin-top: -100%;\n                animation: slide-up 0.2s 0s ease;\n            }\n\n            #melody-editor-gallery.shown {\n                margin-top: 0px;\n                animation: slide-down 0.2s 0s ease;\n            }\n\n            @keyframes slide-down {\n                0% {\n                    margin-top: -100%;\n                }\n                100% {\n                    margin-top: 0px;\n                }\n            }\n\n            @keyframes slide-up {\n                0% {\n                    margin-top: 0px;\n                }\n                100% {\n                    margin-top: -100%;\n                }\n            }\n            ",this.containerDiv.appendChild(e)},e.prototype.mkButton=function(e,t,n,r){var i=this,o=f("div",{className:"melody-gallery-button melody-editor-card",role:"menuitem",id:":"+t}),a=f("i",{className:"music icon melody-icon"}),s=f("div",{className:"melody-editor-text"});s.innerText=e.name;var c=this.createColorBlock(e),u=f("div",{className:"melody-editor-button left-button",role:"button",title:e.name},function(){return i.handleSelection(e)});u.appendChild(a),u.appendChild(s),u.appendChild(c),o.appendChild(u);var l=f("div",{className:"melody-editor-button right-button",role:"button",title:lf("Preview {0}",e.name)},function(){return i.togglePlay(e,t)}),p=f("i",{className:"play icon"});this.buttons[t]=p,l.appendChild(p),o.appendChild(l),this.contentDiv.appendChild(o)},e.prototype.handleSelection=function(e){if(this.pending){var t=this.pending;this.pending=void 0,t(e.notes)}},e.prototype.playNote=function(e,t,n){var r=0;switch(e){case"C5":r=523;break;case"B":r=494;break;case"A":r=440;break;case"G":r=392;break;case"F":r=349;break;case"E":r=330;break;case"D":r=294;break;case"C":r=262}this.timeouts.push(setTimeout(function(){pxt.AudioContextManager.tone(r)},t*this.getDuration(n))),this.timeouts.push(setTimeout(function(){pxt.AudioContextManager.stop()},(t+1)*this.getDuration(n)))},e.prototype.getDuration=function(e){return 6e4/e},e.prototype.previewMelody=function(e){this.stopMelody();for(var t=e.notes.split(" "),n=0;n<t.length;n++)this.playNote(t[n],n,e.tempo)},e.prototype.togglePlay=function(e,t){var n=this.buttons[t];pxt.BrowserUtils.containsClass(n,"play icon")?(this.resetPlayIcons(),pxt.BrowserUtils.removeClass(n,"play icon"),pxt.BrowserUtils.addClass(n,"stop icon"),this.previewMelody(e),this.timeouts.push(setTimeout(function(){pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon")},e.notes.split(" ").length*this.getDuration(e.tempo)))):(pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon"),this.stopMelody())},e.prototype.stopMelody=function(){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop()},e.prototype.resetPlayIcons=function(){for(var e=0;e<this.numSamples;e++){var t=this.buttons[e];if(pxt.BrowserUtils.containsClass(t,"stop icon")){pxt.BrowserUtils.removeClass(t,"stop icon"),pxt.BrowserUtils.addClass(t,"play icon");break}}},e.prototype.createColorBlock=function(e){var t=document.createElement("div");pxt.BrowserUtils.addClass(t,"melody-color-block");for(var n=e.notes.split(" "),r=0;r<n.length;r++){var i=a.getColorClass(a.noteToRow(n[r])),o=document.createElement("div");0==r?pxt.BrowserUtils.addClass(o,"left-edge sliver "+i):r==n.length-1?pxt.BrowserUtils.addClass(o,"right-edge sliver "+i):pxt.BrowserUtils.addClass(o,"sliver "+i),t.appendChild(o)}return t},e}();function f(e,t,n){return function(e,t,n){if(t)for(var r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];"className"===o?e.setAttribute("class",t[o]+""):e.setAttribute(o,t[o]+"")}n&&e.addEventListener("click",n);return e}(document.createElement(e),t,n)}a.MelodyGallery=e}(pxtmelody||(pxtmelody={})),function(e){var t=function(e,t,n){this.name=e,this.notes=t,this.tempo=n};e.MelodyInfo=t,e.SampleMelodies=[new t(lf("Scale"),"C5 B A G F E D C",120),new t(lf("Reverse"),"C D E F G A B C5",120),new t(lf("Mystery"),"E B C5 A B G A F",120),new t(lf("Gilroy"),"A F E F D G E F",120),new t(lf("Falling"),"C5 A B G A F G E",120),new t(lf("Hopeful"),"G B A G C5 B A B",120),new t(lf("Tokyo"),"B A G A G F A C5",120),new t(lf("Paris"),"G F G A - F E D",120),new t(lf("Rising"),"E D G F B A C5 B",120),new t(lf("Sitka"),"C5 G B A F A C5 B",120)]}(pxtmelody||(pxtmelody={})),function(o){var e;(e=o.winrt||(o.winrt={})).browserDownloadAsync=function(t,e,n){var r;return o.winrt.promisify(Windows.Storage.ApplicationData.current.temporaryFolder.createFileAsync(e,Windows.Storage.CreationCollisionOption.replaceExisting).then(function(e){return Windows.Storage.FileIO.writeTextAsync(r=e,t)}).then(function(){return Windows.System.Launcher.launchFileAsync(r)}).then(function(e){}))},e.saveOnlyAsync=function(r){var i=o.appTarget.compile.useUF2,e=i?[".uf2"]:[".hex"],t=new Windows.Storage.Pickers.FileSavePicker;return t.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.documentsLibrary,t.fileTypeChoices.insert("MakeCode binary file",e),t.suggestedFileName=r.downloadFileBaseName,o.winrt.promisify(t.pickSaveFileAsync().then(function(e){if(e){var t=i?r.outfiles[pxtc.BINARY_UF2]:r.outfiles[pxtc.BINARY_HEX];o.isOutputText()||(t=atob(t));var n=[];return o.Util.stringToUint8Array(t).forEach(function(e){return n.push(e)}),Windows.Storage.FileIO.writeBytesAsync(e,n).then(function(){return!0})}return Promise.resolve(!1)}))}}(pxt||(pxt={})),function(f){!function(s){var e=function(){function e(){this.onDeviceConnectionChanged=function(e){},this.onConnectionChanged=function(){},this.onData=function(e){},this.onEvent=function(e){},this.onError=function(e){},this.connecting=!1,this.handleInputReport=this.handleInputReport.bind(this)}return e.prototype.disposeAsync=function(){return Promise.resolve()},e.prototype.error=function(e){throw new Error(f.U.lf("USB/HID error ({0})",e))},e.prototype.setConnecting=function(e){this.connecting=e,this.onConnectionChanged&&this.onConnectionChanged()},e.prototype.isConnecting=function(){return this.connecting},e.prototype.isConnected=function(){return!!this.dev},e.prototype.reconnectAsync=function(){var e=this;return this.disconnectAsync().then(function(){return e.initAsync()})},e.prototype.isSwitchingToBootloader=function(){l=!0,this.dev&&(p=!0)},e.prototype.disconnectAsync=function(){if(this.dev){var e=this.dev;delete this.dev;try{e.close()}catch(e){}this.onConnectionChanged&&this.onConnectionChanged()}return Promise.resolve()},e.prototype.sendPacketAsync=function(e){if(!this.dev)return Promise.resolve();for(var t=[0],n=0;n<Math.max(e.length,64);++n)t.push(e[n]||0);var r=new Windows.Storage.Streams.DataWriter;r.writeBytes(t);var i=r.detachBuffer(),o=this.dev.createOutputReport(0);return o.data=i,f.winrt.promisify(this.dev.sendOutputReportAsync(o).then(function(e){}))},e.prototype.handleInputReport=function(e){for(var t=Windows.Storage.Streams.DataReader.fromBuffer(e.report.data),n=[];t.unconsumedBufferLength;)n.push(t.readByte());65==n.length&&0===n[0]&&n.shift(),this.onData(new Uint8Array(n))},e.prototype.initAsync=function(t){var n=this;void 0===t&&(t=!1),f.Util.assert(!this.dev,"HID interface not properly reseted");var r,i=Windows.Devices,o=i.HumanInterfaceDevice.HidDevice,a=function(){var e=new Error(f.U.lf("Device not found"));return e.type="devicenotfound",Promise.reject(e)},e=c.reduce(function(e,t){return e.then(function(e){return e&&e.length?Promise.resolve(e):i.Enumeration.DeviceInformation.findAllAsync(t,null)})},Promise.resolve(null));return this.setConnecting(!0),e.then(function(e){if(!e||!e[0])return f.debug("no hid device found"),Promise.reject(new Error("no hid device found"));f.debug("hid enumerate "+e.length+" devices");var t=e[0];return f.debug("hid connect to "+t.name+" ("+t.id+")"),r=t.id,o.fromIdAsync(t.id,Windows.Storage.FileAccessMode.readWrite)}).then(function(e){if(n.dev=e,!n.dev){f.debug("can't connect to hid device");var t=Windows.Devices.Enumeration.DeviceAccessInformation.createFromId(r).currentStatus;return f.reportError("winrt_device","could not connect to HID device; device status: "+t),Promise.reject(new Error("can't connect to hid device"))}return f.debug("hid device version "+n.dev.version),n.dev.addEventListener("inputreportreceived",n.handleInputReport),Promise.resolve()}).finally(function(){n.setConnecting(!1)}).catch(function(e){return t?a():s.bootloaderViaBaud(n).then(function(){return n.initAsync(!0)}).catch(function(){return a()})})},e}();s.WinRTPacketIO=e,s.packetIO=void 0,s.mkWinRTPacketIOAsync=function(){return f.debug("packetio: mk winrt packetio"),s.packetIO=new e,s.packetIO.initAsync().catch(function(e){return s.packetIO=void 0,Promise.reject(e)}).then(function(){return s.packetIO})};var c=[],a=[],u=0,l=!1,p=!1;s.initWinrtHid=function(n,r){var e=Windows.Devices,i=Windows.Devices.Enumeration.DeviceInformation,o=e.HumanInterfaceDevice.HidDevice;f.appTarget&&f.appTarget.compile&&f.appTarget.compile.hidSelectors&&f.appTarget.compile.hidSelectors.forEach(function(e){var t=o.getDeviceSelector(parseInt(e.usagePage),parseInt(e.usageId),parseInt(e.vid),parseInt(e.pid));c.indexOf(t)<0&&c.push(t)}),c.forEach(function(e){var t=i.createWatcher(e,null);t.addEventListener("added",function(e){f.debug("new hid device detected: "+e.id),l?l=!1:1==++u&&n&&n()}),t.addEventListener("removed",function(e){f.debug("hid device closed: "+e.id),p?p=!1:0<--u&&n?n():0===u&&r&&(r(),s.packetIO=void 0)}),t.addEventListener("updated",function(e){}),a.push(t)}),a.filter(function(e){return!e.status}).forEach(function(e){return e.start()})}}(f.winrt||(f.winrt={}))}(pxt||(pxt={})),function(l){!function(e){var r,i,u={};function o(e){if(!e)return Promise.resolve([]);var t=Windows.Devices,n=t.SerialCommunication.SerialDevice,r=t.Enumeration.DeviceInformation,i=[];return e.forEach(function(e){var t=n.getDeviceSelectorFromUsbVidPid(parseInt(e.vid),parseInt(e.pid));i.push(t)}),i.reduce(function(e,t){var n;return e.then(function(e){return n=e,r.findAllAsync(t,null)}).then(function(e){if(n)for(var t=0;t<e.length;++t)n.push(e[t]);else n=e;return Promise.resolve(n)})},Promise.resolve(null)).then(function(e){return e?Promise.map(e,function(e){return n.fromIdAsync(e.id)}):Promise.resolve([])})}function a(t){i&&!i.test(t.name)||(l.debug("serial port added "+t.name+" - "+t.id),u[t.id]={info:t},Windows.Devices.SerialCommunication.SerialDevice.fromIdAsync(t.id).done(function(e){u[t.id].device=e,function n(r){var i=u[r];if(!i)return;if(!i.device){var e=Windows.Devices.Enumeration.DeviceAccessInformation.createFromId(r).currentStatus;return void l.reportError("winrt_device","could not connect to serial device; device status: "+e)}var t=Windows.Storage.Streams;i.device.baudRate=115200;var o=i.device.inputStream;var a=new t.DataReader(o);a.inputStreamOptions=t.InputStreamOptions.partial;var s={};var c=function(){u[r]&&!i.cancellingDeferred&&(i.readingOperation=a.loadAsync(32),i.readingOperation.done(function(e){var t=a.readString(4*Math.floor(a.unconsumedBufferLength/4));l.Util.bufferSerial(s,t,r),setTimeout(function(){return c()},1)},function(e){var t=i.readingOperation.operation.status;t===Windows.Foundation.AsyncStatus.canceled?(a.detachStream(),a.close(),i.cancellingDeferred&&setTimeout(function(){return i.cancellingDeferred.resolve()},25)):setTimeout(function(){return n(r)},1e3)}))};setTimeout(function(){return c()},100)}(t.id)}))}function s(e){delete u[e.id]}function c(e){var t=u[e.id];t&&t.info.update(e)}e.initSerial=function(){var e=!(!l.appTarget.serial||!(l.appTarget.serial.nameFilter||l.appTarget.serial.vendorId&&l.appTarget.serial.productId));if(l.appTarget.serial&&l.appTarget.serial.log&&e){var t,n=Windows.Devices.SerialCommunication.SerialDevice;l.appTarget.serial.vendorId&&l.appTarget.serial.productId?t=n.getDeviceSelectorFromUsbVidPid(parseInt(l.appTarget.serial.vendorId),parseInt(l.appTarget.serial.productId)):(i=new RegExp(l.appTarget.serial.nameFilter),t=n.getDeviceSelector()),(r=Windows.Devices.Enumeration.DeviceInformation.createWatcher(t,null)).addEventListener("added",a),r.addEventListener("removed",s),r.addEventListener("updated",c),r.start()}},e.suspendSerialAsync=function(){r&&(r.stop(),r.removeEventListener("added",a),r.removeEventListener("removed",s),r.removeEventListener("updated",c),r=void 0);var i=Promise.resolve();return Object.keys(u).forEach(function(e){var t=u[e],n=t.readingOperation;if(n){var r=Promise.defer();t.cancellingDeferred=r,i=i.then(function(){return r.promise.timeout(500).catch(function(e){l.reportError("winrt_device","could not cancel reading operation for a device: "+e.message)})}),n.cancel()}}),i.then(function(){Object.keys(u).forEach(function(e){var t=u[e];t.device&&t.device.close()}),u={}})},e.bootloaderViaBaud=function(t){if(!(l.appTarget&&l.appTarget.compile&&l.appTarget.compile.useUF2&&l.appTarget.simulator&&l.appTarget.simulator.boardDefinition&&l.appTarget.simulator.boardDefinition.bootloaderBaudSwitchInfo))return Promise.reject(new Error("device does not support switching to bootloader via baudrate"));var n,e=l.appTarget.simulator.boardDefinition.bootloaderBaudSwitchInfo;return o([{vid:e.vid,pid:e.pid,usageId:void 0,usagePage:void 0}]).then(function(e){return e&&0!==e.length?((n=e).length&&t.isSwitchingToBootloader(),n.forEach(function(e){e.baudRate=1200,e.close()}),Promise.delay(1500)):Promise.reject(new Error("no serial devices to switch into bootloader"))})},e.connectSerialDevicesAsync=o}(l.winrt||(l.winrt={}))}(pxt||(pxt={})),function(f){!function(i){function o(){return"undefined"!=typeof Windows}function a(){return o()?(t.resolve(null),t.promise.then(function(e){return Promise.resolve(e&&e.kind===Windows.ApplicationModel.Activation.ActivationKind.file)})):Promise.resolve(!1)}function n(){return o()?Promise.resolve().then(function(){return i.packetIO?(f.log("disconnecting packetIO"),i.packetIO.disconnectAsync()):Promise.resolve()}).catch(function(e){e.message="error disconnecting packetIO: "+e.message,f.reportException(e)}).then(function(){return f.log("suspending serial"),i.suspendSerialAsync()}).catch(function(e){e.message="error suspending serial: "+e.message,f.reportException(e)}):Promise.resolve()}function s(e){Windows.UI.WebUI.WebUIApplication.removeEventListener("activated",s),t.resolve(e)}function c(e){f.log("suspending");var t=e.suspendingOperation.getDeferral();return n().then(function(){return t.complete()},function(e){return t.complete()}).done()}function u(e){f.log("resuming"),i.packetIO&&(f.log("reconnet pack io"),i.packetIO.reconnectAsync().done()),i.initSerial()}var t,l;function p(e,t){if(void 0===t&&(t=!1),e.kind===Windows.ApplicationModel.Activation.ActivationKind.file){var n=e.files.getAt(0);if(n&&n.isOfType(Windows.Storage.StorageItemTypes.file)){var r=n;Windows.Storage.FileIO.readBufferAsync(r).then(function(e){for(var t=[],n=Windows.Storage.Streams.DataReader.fromBuffer(e);n.unconsumedBufferLength;)t.push(n.readByte());return n.close(),f.cpp.unpackSourceFromHexAsync(new Uint8Array(t))}).then(function(e){return l(e,{openHomeIfFailed:t})})}}}f.BrowserUtils.isWinRT=o,i.promisify=function(e){return new Promise(function(t,n){e.done(function(e){return t(e)},function(e){return n(e)})})},i.toArray=function(e){for(var t=[],n=e.length,r=0;r<n;++r)t.push(e[r]);return t},i.isWindows=function(){return!!navigator&&/Win32/i.test(navigator.platform)},i.isWinRT=o,i.initAsync=function(e){if(!o()||f.BrowserUtils.isIFrame())return Promise.resolve();var t=Windows.UI.Core,n=t.SystemNavigationManager.getForCurrentView(),r=Windows.UI.WebUI.WebUIApplication;return r.addEventListener("suspending",c),r.addEventListener("resuming",u),n.onbackrequested=function(e){f.log("BACK NAVIGATION"),n.appViewBackButtonVisibility=t.AppViewBackButtonVisibility.collapsed,e.handled=!0},i.initSerial(),a().then(function(){e&&(l=e,r.removeEventListener("activated",s),r.addEventListener("activated",p))})},i.captureInitialActivation=function(){o()&&(t=Promise.defer(),Windows.UI.WebUI.WebUIApplication.addEventListener("activated",s))},i.loadActivationProject=function(){return t.promise.then(function(e){return p(e,!0)})},i.hasActivationProjectAsync=a,i.releaseAllDevicesAsync=n}(f.winrt||(f.winrt={}))}(pxt||(pxt={})),function(h){var m;(function(e){var o,a=h.Util;function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.join("\\")}function c(e){var t=s(o.path,e);return h.debug("winrt: reading "+t),m.promisify(Windows.Storage.StorageFile.getFileFromPathAsync(t).then(function(e){return Windows.Storage.FileIO.readTextAsync(e)}))}function u(e,t,n){var r=s(o.path,e);return h.debug("winrt: writing "+s(r,t)),m.promisify(Windows.Storage.StorageFolder.getFolderFromPathAsync(r)).then(function(e){return e.createFileAsync(t,Windows.Storage.CreationCollisionOption.replaceExisting)}).then(function(e){return Windows.Storage.FileIO.writeTextAsync(e,n)}).then(function(){})}function l(e,t){void 0===t&&(t=null);var n=new Error(t||"Error "+e);throw n.statusCode=e,n}e.fileApiAsync=function(e,t){if(a.startsWith(e,"pkg/")){var n=e.slice(4);return t?(r=n,i=t,h.debug("winrt: writing package at "+r),m.promisify(o.createFolderAsync(r,Windows.Storage.CreationCollisionOption.openIfExists)).then(function(){return Promise.map(i.files,function(t){return c(s(r,t.name)).then(function(e){if(t.name!=h.SIMSTATE_JSON){if(t.name==h.CONFIG_NAME)try{JSON.parse(t.content).name||(h.log("Trying to save invalid JSON config"),l(410))}catch(e){h.log("Trying to save invalid format JSON config"),l(410)}e!==t.prevContent&&(h.log("merge error for "+t.name+": previous content changed..."),l(409))}},function(e){})})}).then(function(){return Promise.map(i.files,function(e){return u(r,e.name,e.content)})}).then(function(){return u(r,p,JSON.stringify(i.header,null,4))}).then(function(){return f(r,!1)})):f(n,!0)}if("list"==e)return function(){if(o)return Promise.resolve();var e=Windows.Storage.ApplicationData.current.localFolder;return h.debug("winrt: initializing workspace"),m.promisify(e.createFolderAsync(h.appTarget.id,Windows.Storage.CreationCollisionOption.openIfExists)).then(function(e){o=e,h.debug("winrt: initialized workspace at "+o.path)}).then(function(){})}().then(d);throw l(404);var r,i};var p=".header.json";function f(r,i){return h.debug("winrt: reading package under "+r),c(s(r,h.CONFIG_NAME)).then(function(e){var n=JSON.parse(e);return Promise.map(h.allPkgFiles(n),function(n){return(t=s(r,n),e=s(o.path,t),h.debug("winrt: "+e),m.promisify(Windows.Storage.StorageFile.getFileFromPathAsync(e).then(function(e){return e.getBasicPropertiesAsync().then(function(e){return{name:t,mtime:e.dateModified.getTime()}})}))).then(function(e){var t={name:n,mtime:e?e.mtime:null};return null!=e&&i?c(s(r,n)).then(function(e){return t.content=e,t}):t});var t,e}).then(function(e){var t={path:r,header:null,config:n,files:e};return c(s(r,p)).then(function(e){e&&(t.header=JSON.parse(e))},function(e){}).then(function(){return t})})})}function d(){return m.promisify(o.getFoldersAsync()).then(function(e){return Promise.map(e,function(e){return f(e.name,!1)})}).then(function(e){return Promise.resolve({pkgs:e})})}function t(){return m.promisify(o.deleteAsync(Windows.Storage.StorageDeleteOption.default).then(function(){o=void 0}))}e.getProvider=function(e){return{listAsync:e.listAsync,getAsync:e.getAsync,setAsync:e.setAsync,resetAsync:t}}})((m=h.winrt||(h.winrt={})).workspace||(m.workspace={}))}(pxt||(pxt={}));var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt;!function(t){var e,n,r,i,o;e=t.editor||(t.editor={}),(n=e.SimState||(e.SimState={}))[n.Stopped=0]="Stopped",n[n.Pending=1]="Pending",n[n.Starting=2]="Starting",n[n.Running=3]="Running",e.isBlocks=function(e){return t.U.endsWith(e.name,".blocks")},(r=e.ErrorListState||(e.ErrorListState={})).HeaderOnly="errorListHeader",r.Expanded="errorListExpanded",(i=e.FilterState||(e.FilterState={}))[i.Hidden=0]="Hidden",i[i.Visible=1]="Visible",i[i.Disabled=2]="Disabled",e.initExtensionsAsync=function(e){return Promise.resolve({})},e.initFieldExtensionsAsync=function(e){return Promise.resolve({})},e.HELP_IMAGE_URI="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTMiIGN5PSIxMyIgcj0iMTMiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNy45NTIgOS4xODQwMkMxNy45NTIgMTAuMjU2IDE3LjgxNiAxMS4wNzIgMTcuNTQ0IDExLjYzMkMxNy4yODggMTIuMTkyIDE2Ljc1MiAxMi43OTIgMTUuOTM2IDEzLjQzMkMxNS4xMiAxNC4wNzIgMTQuNTc2IDE0LjU4NCAxNC4zMDQgMTQuOTY4QzE0LjA0OCAxNS4zMzYgMTMuOTIgMTUuNzM2IDEzLjkyIDE2LjE2OFYxNi45NkgxMS44MDhDMTEuNDI0IDE2LjQ2NCAxMS4yMzIgMTUuODQgMTEuMjMyIDE1LjA4OEMxMS4yMzIgMTQuNjg4IDExLjM4NCAxNC4yODggMTEuNjg4IDEzLjg4OEMxMS45OTIgMTMuNDg4IDEyLjUzNiAxMi45NjggMTMuMzIgMTIuMzI4QzE0LjEwNCAxMS42NzIgMTQuNjI0IDExLjE2OCAxNC44OCAxMC44MTZDMTUuMTM2IDEwLjQ0OCAxNS4yNjQgOS45NjgwMiAxNS4yNjQgOS4zNzYwMkMxNS4yNjQgOC4yMDgwMiAxNC40MTYgNy42MjQwMiAxMi43MiA3LjYyNDAyQzExLjc2IDcuNjI0MDIgMTAuNzUyIDcuNzM2MDIgOS42OTYgNy45NjAwMkw5LjE0NCA4LjA4MDAyTDkgNi4wODgwMkMxMC40ODggNS41NjAwMiAxMS44NCA1LjI5NjAyIDEzLjA1NiA1LjI5NjAyQzE0LjczNiA1LjI5NjAyIDE1Ljk2OCA1LjYwODAyIDE2Ljc1MiA2LjIzMjAyQzE3LjU1MiA2Ljg0MDAyIDE3Ljk1MiA3LjgyNDAyIDE3Ljk1MiA5LjE4NDAyWk0xMS40IDIyVjE4LjY0SDE0LjE4NFYyMkgxMS40WiIgZmlsbD0iIzU5NUU3NCIvPgo8L3N2Zz4K",e.initEditorExtensionsAsync=function(){if(!o&&(o=Promise.resolve(),t.appTarget&&t.appTarget.appTheme&&t.appTarget.appTheme.extendFieldEditors)){var e={};o=o.then(function(){return t.BrowserUtils.loadBlocklyAsync()}).then(function(){return t.BrowserUtils.loadScriptAsync("fieldeditors.js")}).then(function(){return t.editor.initFieldExtensionsAsync(e)}).then(function(e){e.fieldEditors&&e.fieldEditors.forEach(function(e){t.blocks.registerFieldEditor(e.selector,e.editor,e.validator)})})}return o}}(pxt||(pxt={})),function(m){!function(e){var c={};function u(e,t,n,r){e.response&&window.parent.postMessage({type:e.type,id:e.id,resp:t,success:n,error:r},"*")}function o(r){return new Promise(function(e,t){var n=m.Util.clone(r);n.id=ts.pxtc.Util.guidGen(),r.response&&(c[n.id]={resolve:e,reject:t}),window.parent.postMessage(n,"*"),r.response||e(void 0)})}e.bindEditorMessages=function(i){var o=(m.appTarget.appTheme.allowParentController||m.shell.isControllerMode())&&m.BrowserUtils.isIFrame(),a=m.appTarget.appTheme.allowPackageExtensions,s=m.appTarget.appTheme.allowSimulatorTelemetry;(o||a||s)&&window.addEventListener("message",function(e){var d=e.data;if(!d||!/^pxt(host|editor|pkgext|sim)$/.test(d.type))return!1;if("pxtpkgext"===d.type&&a)i().then(function(e){e.handleExtensionRequest(d)});else if("pxtsim"===d.type&&s){var t=d;"event"===t.action&&(t.category||t.message?m.reportError(t.category,t.message,t.data):m.tickEvent(t.tick,t.data))}else if(o){var n=Promise.resolve(),h=void 0;if("pxthost"==d.type){var r=c[d.id];r?n=n.then(function(){return r.resolve(d)}):m.debug("pxthost: unknown request "+d.id)}else"pxteditor"==d.type&&(n=n.then(function(){return i().then(function(t){var e=d;switch(m.debug("pxteditor: "+e.action),e.action.toLowerCase()){case"switchjavascript":return Promise.resolve().then(function(){return t.openJavaScript()});case"switchpython":return Promise.resolve().then(function(){return t.openPython()});case"switchblocks":return Promise.resolve().then(function(){return t.openBlocks()});case"startsimulator":return Promise.resolve().then(function(){return t.startSimulator()});case"restartsimulator":return Promise.resolve().then(function(){return t.restartSimulator()});case"hidesimulator":return Promise.resolve().then(function(){return t.collapseSimulator()});case"showsimulator":return Promise.resolve().then(function(){return t.expandSimulator()});case"closeflyout":return Promise.resolve().then(function(){return t.closeFlyout()});case"redo":return Promise.resolve().then(function(){var e=t.editor;e&&e.hasRedo()&&e.redo()});case"undo":return Promise.resolve().then(function(){var e=t.editor;e&&e.hasUndo()&&e.undo()});case"setscale":var n=d;return Promise.resolve().then(function(){return t.editor.setScale(n.scale)});case"stopsimulator":var r=d;return Promise.resolve().then(function(){return t.stopSimulator(r.unload)});case"newproject":var i=d;return Promise.resolve().then(function(){return t.newProject(i.options)});case"importproject":var o=d;return Promise.resolve().then(function(){return t.importProjectAsync(o.project,{filters:o.filters,searchBar:o.searchBar})});case"importtutorial":var a=d;return Promise.resolve().then(function(){return t.importTutorialAsync(a.markdown)});case"proxytosim":var s=d;return Promise.resolve().then(function(){return t.proxySimulatorMessage(s.content)});case"renderblocks":var c=d;return Promise.resolve().then(function(){return t.renderBlocksAsync(c)}).then(function(e){return e.xml.then(function(e){h=e.xml})});case"renderpython":var u=d;return Promise.resolve().then(function(){return t.renderPythonAsync(u)}).then(function(e){h=e.python});case"toggletrace":var l=d;return Promise.resolve().then(function(){return t.toggleTrace(l.intervalSpeed)});case"settracestate":var p=d;return Promise.resolve().then(function(){return t.setTrace(p.enabled,p.intervalSpeed)});case"setsimulatorfullscreen":var f=d;return Promise.resolve().then(function(){return t.setSimulatorFullScreen(f.enabled)});case"togglehighcontrast":return Promise.resolve().then(function(){return t.toggleHighContrast()});case"togglegreenscreen":return Promise.resolve().then(function(){return t.toggleGreenScreen()});case"print":return Promise.resolve().then(function(){return t.printCode()});case"pair":return t.pairAsync();case"info":return Promise.resolve().then(function(){h={versions:m.appTarget.versions,locale:ts.pxtc.Util.userLanguage(),availableLocales:m.appTarget.appTheme.availableLocales}})}return Promise.resolve()})}));n.done(function(){return u(d,h,!0,void 0)},function(e){return u(d,h,!1,e)})}return!0},!1)},e.enableControllerAnalytics=function(){if(m.appTarget.appTheme.allowParentController&&m.BrowserUtils.isIFrame()){var n=m.tickEvent;m.tickEvent=function(e,t){n&&n(e,t),o({type:"pxthost",action:"event",tick:e,response:!1,data:t})};var r=m.reportException;m.reportException=function(e,t){r&&r(e,t);try{o({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}};var i=m.reportError;m.reportError=function(e,t,n){i&&i(e,t,n),o({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:n})}}},e.postHostMessageAsync=o}(m.editor||(m.editor={}))}(pxt||(pxt={})),function(a){var e;(function(e){function n(e){return"experiments-"+e.id}function r(){var n=a.savedAppTheme(),r={},e=i();e.forEach(function(e){var t=o(e);n[e.id]=!!t,t&&(r[e.id]=t?1:0)}),e.length&&Object.keys(r).length&&(a.tickEvent("experiments.loaded",r),a.reloadAppTargetVariant())}function i(){var t=a.appTarget.appTheme.experiments;return t?[{id:"print",name:lf("Print Code"),description:lf("Print the code from the current project"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4740"},{id:"greenScreen",name:lf("Green screen"),description:lf("Display a webcam video stream or a green background behind the code."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4738"},{id:"allowPackageExtensions",name:lf("Editor Extensions"),description:lf("Allow Extensions to add buttons in the editor."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4741"},{id:"instructions",name:lf("Wiring Instructions"),description:lf("Generate step-by-step assembly instructions for breadboard wiring."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4739"},{id:"debugger",name:lf("Debugger"),description:lf("Step through code and inspect variables in the debugger"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4729"},{id:"bluetoothUartConsole",name:"Bluetooth Console",description:lf("Receives UART message through Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4796"},{id:"bluetoothPartialFlashing",name:"Bluetooth Download",description:lf("Download code via Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4807"},{id:"simScreenshot",name:lf("Simulator Screenshots"),description:lf("Download screenshots of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5232"},{id:"python",name:lf("Static Python"),description:lf("Use Static Python to code your device"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5390"},{id:"simGif",name:lf("Simulator Gifs"),description:lf("Download gifs of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5297"},{id:"qrCode",name:lf("Shared QR Code"),description:lf("Generate a QR Code form the shared project url"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5456"},{id:"importExtensionFiles",name:lf("Import Extension Files"),description:lf("Import Extensions from compiled project files")},{id:"debugExtensionCode",name:lf("Debug Extension Code"),description:lf("Use the JavaScript debugger to debug extension code")},{id:"snippetBuilder",name:lf("Snippet Builder"),description:lf("Try out the new snippet dialogs.")},{id:"experimentalHw",name:lf("Experimental Hardware"),description:lf("Enable support for hardware marked 'experimental' in the hardware seletion dialog")},{id:"checkForHwVariantWebUSB",name:lf("Detect Hardware with WebUSB"),description:lf("When compiling, use WebUSB to detect hardware configuration.")},{id:"githubEditor",name:lf("GitHub editor"),description:lf("Review, commit and push to GitHub."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6419"},{id:"githubCompiledJs",name:lf("GitHub Pages JavaScript"),description:lf("Commit compiled javascript when creating a release")},{id:"blocksCollapsing",name:lf("Collapse blocks"),description:lf("Collapse and expand functions or event blocks")},{id:"tutorialBlocksDiff",name:lf("Tutorial Block Diffs"),description:lf("Automatially render blocks diff in tutorials")},{id:"openProjectNewTab",name:lf("Open in New Tab"),description:lf("Open an editor in a new tab.")},{id:"openProjectNewDependentTab",name:lf("Open in New Connected Tab"),description:lf("Open connected editors in different browser tabs.")},{id:"accessibleBlocks",name:lf("Accessible Blocks"),description:lf("Use the WASD keys to move and modify blocks."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6850"},{id:"errorList",name:lf("Error List"),description:lf("Show an error list panel for JavaScript and Python.")}].filter(function(e){return-1<t.indexOf(e.id)}):[]}function o(e){return!!a.storage.getLocal(n(e))}function t(e,t){t!=o(e)&&(t?a.storage.setLocal(n(e),"1"):a.storage.removeLocal(n(e)),r())}e.syncTheme=r,e.all=i,e.clear=function(){i().forEach(function(e){return a.storage.removeLocal(n(e))}),r()},e.someEnabled=function(){return i().some(function(e){return o(e)})},e.isEnabled=o,e.toggle=function(e){t(e,!o(e))},e.state=function(){var t={};return i().forEach(function(e){return t[e.id]=o(e)}),JSON.stringify(t)},e.setState=t})((e=a.editor||(a.editor={})).experiments||(e.experiments={}))}(pxt||(pxt={})),function(e){var t,n;t=e.editor||(e.editor={}),(n=t.PermissionResponses||(t.PermissionResponses={}))[n.Granted=0]="Granted",n[n.Denied=1]="Denied",n[n.NotAvailable=2]="NotAvailable"}(pxt||(pxt={})),function(s){!function(e){var n,r=function(){function e(){this.items={}}return e.prototype.removeItem=function(e){delete this.items[e]},e.prototype.getItem=function(e){return this.items[e]},e.prototype.setItem=function(e,t){this.items[e]=t},e.prototype.clear=function(){this.items={}},e}(),i=function(){function e(e){this.storageId=e}return e.prototype.targetKey=function(e){return this.storageId+"/"+e},e.prototype.removeItem=function(e){window.localStorage.removeItem(this.targetKey(e))},e.prototype.getItem=function(e){return window.localStorage[this.targetKey(e)]},e.prototype.setItem=function(e,t){window.localStorage[this.targetKey(e)]=t},e.prototype.clear=function(){for(var e=this.targetKey(""),t=[],n=0;n<window.localStorage.length;++n){var r=window.localStorage.key(n);0==r.indexOf(e)&&t.push(r)}t.forEach(function(e){return window.localStorage.removeItem(e)})},e}();function o(){if(s.appTarget)return s.appTarget.id;var e=window.pxtConfig;if(e)return e.targetId;var t=window.pxtTargetBundle;return t?t.id:""}function a(){if(!n){var e=o(),t=!1;if(!s.shell.isSandboxMode())try{window.localStorage[e]="1";window.localStorage[e];t=!0}catch(e){}t?(n=new i(e),s.debug("storage: local under "+e)):(n=new r,s.debug("storage: in memory"))}}e.storageId=o,e.setLocal=function(e,t){a(),n.setItem(e,t)},e.getLocal=function(e){return a(),n.getItem(e)},e.removeLocal=function(e){a(),n.removeItem(e)},e.clearLocal=function(){a(),n.clear()}}(s.storage||(s.storage={}))}(pxt||(pxt={})),function(o){!function(e){function a(e){var t=o.appTarget.appTheme.invertedMonaco,n=!(!o.appTarget.appTheme.monacoFieldEditors||!o.appTarget.appTheme.monacoFieldEditors.length),r=o.BrowserUtils.isAndroid(),i=monaco.editor.create(e,{model:null,ariaLabel:o.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!0,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,folding:n,glyphMargin:n||o.appTarget.appTheme.debugger,minimap:{enabled:!1},fixedOverflowWidgets:!0,autoIndent:"full",useTabStops:!0,dragAndDrop:!0,matchBrackets:"always",occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:t?"vs-dark":"vs",renderIndentGuides:!0,accessibilityHelpUrl:"",quickSuggestions:{other:!r,comments:!r,strings:!r},acceptSuggestionOnCommitCharacter:!r,acceptSuggestionOnEnter:r?"off":"on",accessibilitySupport:r?"off":"on"});return i.layout(),i}e.syncModels=function(e,i,o,t){if(!t){var n=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),a={};e.sortedDeps().forEach(function(r){r.getFiles().forEach(function(e){var t=r.id+"/"+e;if(/\.(ts)$/.test(e)&&t!=o){if(!monaco.languages.typescript.typescriptDefaults.getExtraLibs()[t]){var n=r.readFile(e)||"\n";i[t]=monaco.languages.typescript.typescriptDefaults.addExtraLib(n,t)}a[t]="1"}})}),Object.keys(n).filter(function(e){return/\.(ts)$/.test(e)&&!a[e]}).forEach(function(e){i[e].dispose()})}},e.initMonacoAsync=function(o){return new Promise(function(n,e){if("object"!=typeof window.monaco){var r=window.MonacoPaths,t=function(){var e=window.require;e.config({paths:r,ignoreDuplicateModules:["vs/basic-languages/typescript/typescript.contribution","vs/basic-languages/javascript/javascript.contribution"]});var t=window.define;t("vs/basic-languages/typescript/typescript.contribution",["require","exports"],function(){return function(){}}),t("vs/basic-languages/javascript/javascript.contribution",["require","exports"],function(){return function(){}}),t("vs/language/typescript/tsMode",["require","exports"],function(){return{setupTypeScript:function(){},getTypeScriptWorker:function(){},setupJavaScript:function(){},getJavaScriptWorker:function(){}}}),e(["vs/editor/editor.main"],function(){monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.register({id:"typescript",extensions:[".ts",".tsx"],aliases:["TypeScript","ts","typescript"],mimetypes:["text/typescript"]}),monaco.languages.setLanguageConfiguration("typescript",{wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g,comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:monaco.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ \ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:monaco.languages.IndentAction.None,removeText:1}}],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string","comment"]},{open:"/**",close:" */",notIn:["string"]}],folding:{markers:{start:new RegExp("^\\s*//\\s*#?region\\b"),end:new RegExp("^\\s*//\\s*#?endregion\\b")}}}),monaco.languages.setMonarchTokensProvider("typescript",{defaultToken:"invalid",tokenPostfix:".ts",keywords:["abstract","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","infer","instanceof","interface","is","keyof","let","module","namespace","never","new","null","package","private","protected","public","readonly","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","unique","var","void","while","with","yield","async","await","of"],typeKeywords:["any","boolean","number","object","string","undefined"],operators:["<=",">=","==","!=","===","!==","=>","+","-","**","*","/","%","++","--","<<","</",">>",">>>","&","|","^","!","~","&&","||","??","?",":","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=","@"],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,regexpctl:/[(){}\[\]\$\^|\-*+?\.]/,regexpesc:/\\(?:[bBdDfnrstvwWn0\\\/]|@regexpctl|c[A-Z]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/[a-z_$][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w\$]*/,"type.identifier"],{include:"@whitespace"},[/\/(?=([^\\\/]|\\.)+\/([gimsuy]*)(\s*)(\.|;|,|\)|\]|\}|$))/,{token:"regexp",bracket:"@open",next:"@regexp"}],[/[()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/!(?=([^=]|$))/,"delimiter"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/0[xX](@hexdigits)n?/,"number.hex"],[/0[oO]?(@octaldigits)n?/,"number.octal"],[/0[bB](@binarydigits)n?/,"number.binary"],[/(@digits)n?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*\*(?!\/)/,"comment.doc","@jsdoc"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],jsdoc:[[/[^\/*]+/,"comment.doc"],[/\*\//,"comment.doc","@pop"],[/[\/*]/,"comment.doc"]],regexp:[[/(\{)(\d+(?:,\d*)?)(\})/,["regexp.escape.control","regexp.escape.control","regexp.escape.control"]],[/(\[)(\^?)(?=(?:[^\]\\\/]|\\.)+)/,["regexp.escape.control",{token:"regexp.escape.control",next:"@regexrange"}]],[/(\()(\?:|\?=|\?!)/,["regexp.escape.control","regexp.escape.control"]],[/[()]/,"regexp.escape.control"],[/@regexpctl/,"regexp.escape.control"],[/[^\\\/]/,"regexp"],[/@regexpesc/,"regexp.escape"],[/\\\./,"regexp.invalid"],[/(\/)([gimsuy]*)/,[{token:"regexp",bracket:"@close",next:"@pop"},"keyword.other"]]],regexrange:[[/-/,"regexp.escape.control"],[/\^/,"regexp.invalid"],[/@regexpesc/,"regexp.escape"],[/[^\]]/,"regexp"],[/\]/,{token:"regexp.escape.control",next:"@pop",bracket:"@close"}]],string_double:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\$\{/,{token:"delimiter.bracket",next:"@bracketCounting"}],[/[^\\`$]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],bracketCounting:[[/\{/,"delimiter.bracket","@bracketCounting"],[/\}/,"delimiter.bracket","@pop"],{include:"common"}]}}),n(a(o))})};if(window.require)t();else{var i=document.createElement("script");i.type="text/javascript",i.src=r["vs/loader"],i.addEventListener("load",t),document.body.appendChild(i)}}else n(a(o))})},e.createEditor=a}(o.vs||(o.vs={}))}(pxt||(pxt={})),function(u){!function(e){var o,t,a;(t=o=e.EditorLayoutType||(e.EditorLayoutType={}))[t.IDE=0]="IDE",t[t.Sandbox=1]="Sandbox",t[t.Widget=2]="Widget";var s=!(t[t.Controller=3]="Controller");function n(){if(void 0===a){var e=/sandbox=1|#sandbox|#sandboxproject/i.test(window.location.href)||u.BrowserUtils.isIFrame(),t=/nosandbox=1/i.test(window.location.href),n=/controller=1/i.test(window.location.href)&&u.BrowserUtils.isIFrame(),r=/readonly=1/i.test(window.location.href),i=/editorlayout=(widget|sandbox|ide)/i.exec(window.location.href);if(a=o.IDE,t?a=o.Widget:n?a=o.Controller:e&&(a=o.Sandbox),n&&r&&(s=!0),i)switch(i[1].toLowerCase()){case"widget":a=o.Widget;break;case"sandbox":a=o.Sandbox;break;case"ide":a=o.IDE}u.debug("shell: layout type "+o[a]+", readonly "+c())}}function r(){return n(),a==o.Sandbox}function c(){return r()&&!/[?&]edit=1/i.test(window.location.href)||i()&&s}function i(){return n(),a==o.Controller}e.layoutTypeClass=function(){return n(),u.shell.EditorLayoutType[a].toLowerCase()},e.isSandboxMode=r,e.isReadOnly=c,e.isControllerMode=i}(u.shell||(u.shell={}))}(pxt||(pxt={})),function(n){(n.workspace||(n.workspace={})).freshHeader=function(e,t){return{target:n.appTarget.id,targetVersion:n.appTarget.versions.target,name:e,meta:{},editor:n.JAVASCRIPT_PROJECT_NAME,pubId:"",pubCurrent:!1,_rev:null,id:n.U.guidGen(),recentUse:t,modificationTime:t,blobId:null,blobVersion:null,blobCurrent:!1,isDeleted:!1}}}(pxt||(pxt={})),function(e){var t,n;t=e.editor||(e.editor={}),n={},t.registerMonacoFieldEditor=function(e,t){n[e]=t},t.getMonacoFieldEditor=function(e){return n[e]}}(pxt||(pxt={})),function(i){var e,t;e=i.editor||(i.editor={}),t=function(){function e(){}return e.prototype.getId=function(){return"image-editor"},e.prototype.showEditorAsync=function(e,t,n){var r=this;return this.fileType=e,this.editrange=t,this.host=n,this.initAsync().then(function(){var e=r.textToValue(n.getText(t));return e?(r.fv=i.react.getFieldEditorView(r.getFieldEditorId(),e,r.getOptions()),r.fv.onHide(function(){r.onClosed()}),r.fv.show(),new Promise(function(e,t){r.resolver=e,r.rejecter=t})):Promise.resolve(null)})},e.prototype.onClosed=function(){this.resolver&&(this.resolver({range:this.editrange,replacement:this.resultToText(this.fv.getResult())}),this.editrange=void 0,this.resolver=void 0,this.rejecter=void 0)},e.prototype.dispose=function(){this.onClosed()},e.prototype.initAsync=function(){return Promise.resolve()},e.prototype.textToValue=function(e){return null},e.prototype.resultToText=function(e){return e+""},e.prototype.getFieldEditorId=function(){return""},e.prototype.getOptions=function(){return null},e}(),e.MonacoReactFieldEditor=t}(pxt||(pxt={})),function(n){var e,t,r;e=n.editor||(n.editor={}),t="image-editor",r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.textToValue=function(e){return this.isPython=-1===e.indexOf("`"),n.sprite.imageLiteralToBitmap(e)},t.prototype.resultToText=function(e){return n.sprite.bitmapToImageLiteral(e,this.isPython?"python":"typescript")},t.prototype.getFieldEditorId=function(){return"image-editor"},t.prototype.getOptions=function(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo(),showTiles:!0}},t}(e.MonacoReactFieldEditor),e.MonacoSpriteEditor=r,e.spriteEditorDefinition={id:t,foldMatches:!0,glyphCssClass:"sprite-editor-glyph sprite-focus-hover",heightInPixels:510,matcher:{searchString:'img\\s*(?:`|\\(\\s*""")[ a-fA-F0-9\\.\\n]*\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:r},e.registerMonacoFieldEditor(t,e.spriteEditorDefinition)}(pxt||(pxt={})),function(h){var e,t,n;e=h.editor||(h.editor={}),t="tilemap-editor",n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.textToValue=function(e){for(var n=this.readTilemap(e),r=h.react.getTilemapProject().getProjectTiles(n.tileset.tileWidth,!0),t=function(t){n.tileset.tiles.some(function(e){return e.id===t.id})||n.tileset.tiles.push(t)},i=0,o=r.tiles;i<o.length;i++){t(o[i])}for(var a=function(t){t.weight=r.tiles.findIndex(function(e){return e.id===t.id})},s=0,c=n.tileset.tiles;s<c.length;s++){a(c[s])}return n},t.prototype.readTilemap=function(e){var t=h.react.getTilemapProject();if(/^\s*tiles\s*\./.test(e)&&(this.isTilemapLiteral=!1,e)){try{return h.sprite.decodeTilemap(e,"typescript",t)}catch(e){}return null}this.isTilemapLiteral=!0;var n=/^\s*(tilemap(?:8|16|32)?)\s*(?:`([^`]*)`)|(?:\(\s*"""([^"]*)"""\s*\))\s*$/.exec(e),r=(n[2]||n[3]||"").trim();if(this.tilemapLiteral=n[1],r){var i=ts.pxtc.escapeIdentifier(r),o=t.getTilemap(i);if(!o){var a=16;"tilemap8"===this.tilemapLiteral?a=8:"tilemap32"===this.tilemapLiteral&&(a=32);var s=t.createNewTilemap(i,a,16,16),c=s[0];o=s[1],i=c}return this.tilemapName=i,o}return t.blankTilemap(16,16,16)},t.prototype.resultToText=function(r){var i=h.react.getTilemapProject();if(i.pushUndo(),r.deletedTiles)for(var e=0,t=r.deletedTiles;e<t.length;e++){var n=t[e];i.deleteTile(n)}if(r.editedTiles)for(var o=function(t){var e=r.tileset.tiles.findIndex(function(e){return e.id===t}),n=r.tileset.tiles[e];if(!n||n.id.startsWith("*"))return"continue";r.tileset.tiles[e]=i.updateTile(n.id,n.bitmap)},a=0,s=r.editedTiles;a<s.length;a++){o(s[a])}for(var c=0;c<r.tileset.tiles.length;c++){var u=r.tileset.tiles[c];if(u.id.startsWith("*")){var l=i.createNewTile(u.bitmap);r.tileset.tiles[c]=l}else u.data||(r.tileset.tiles[c]=i.resolveTile(u.id))}if(h.sprite.trimTilemapTileset(r),this.isTilemapLiteral){if(this.tilemapName)i.updateTilemap(this.tilemapName,r);else{var p=i.createNewTilemap(lf("level"),r.tileset.tileWidth,r.tilemap.width,r.tilemap.height),f=p[0],d=p[1];d.tilemap.apply(r.tilemap),d.tileset=r.tileset,d.layers=r.layers,this.tilemapName=f}return"typescript"===this.fileType?"tilemap`"+this.tilemapName+"`":'tilemap("""'+this.tilemapName+'""")'}return h.sprite.encodeTilemap(r,"typescript"===this.fileType?"typescript":"python")},t.prototype.getFieldEditorId=function(){return"tilemap-editor"},t.prototype.getOptions=function(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}},t.prototype.getCreateTilemapRange=function(){for(var e,t=this.editrange.getStartPosition(),n=this.editrange.getEndPosition(),r=1;;){e=new monaco.Range(n.lineNumber,n.column,n.lineNumber+1,0);for(var i=this.host.getText(e),o=0;o<i.length;o++)if("("===i.charAt(o))r++;else if(")"===i.charAt(o)&&0===--r){var a=new monaco.Position(n.lineNumber,n.column+o+2);return monaco.Range.fromPositions(t,a)}if((n=e.getEndPosition()).lineNumber>t.lineNumber+20)return null}},t}(e.MonacoReactFieldEditor),e.MonacoTilemapEditor=n,e.tilemapEditorDefinition={id:t,foldMatches:!0,alwaysBuildOnClose:!0,glyphCssClass:"sprite-focus-hover ms-Icon ms-Icon--Nav2DMapView",heightInPixels:510,weight:5,matcher:{searchString:'(?:tilemap(?:8|16|32)?\\s*(?:`|\\(""")(?:[ a-zA-Z0-9_]|\\n)*\\s*(?:`|"""\\)))|(?:tiles\\s*\\.\\s*createTilemap\\s*\\([^\\)]+\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:n},e.registerMonacoFieldEditor(t,e.tilemapEditorDefinition)}(pxt||(pxt={}));var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r},pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim;!function(e){var t,n;(t=e.accessibility||(e.accessibility={})).makeFocusable=function(e){e.setAttribute("focusable","true"),e.setAttribute("tabindex","0")},t.enableKeyboardInteraction=function(e,n,r){n&&e.addEventListener("keydown",function(e){var t="number"==typeof e.which?e.which:e.keyCode;32!==t&&13!==t||n()}),r&&e.addEventListener("keyup",function(e){var t="number"==typeof e.which?e.which:e.keyCode;32!==t&&13!==t||r()})},t.setAria=function(e,t,n){t&&!e.hasAttribute("role")&&e.setAttribute("role",t),n&&!e.hasAttribute("aria-label")&&e.setAttribute("aria-label",n)},t.setLiveContent=function(e){n||((n=document.createElement("div")).setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-hidden","false"),n.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(n)),n.textContent!==e&&(n.textContent=e)}}(pxsim||(pxsim={})),function(m){var p="blue",f="orange";var d=function(e){return 0<e.reduce(function(e,t){return e+(t?1:0)},0)};function g(e,t){var n={};for(var r in e)n[r]=e[r];for(var i in t)n[i]=t[i];return n}function h(e){m.U.assert(!!e,"Invalid pin: "+e);var t=/^(\w+)\.\s*(?:[a-z]*)?([A-Z][A-Z\d_]+)$/.exec(e);return t?t[2]:void 0}function l(e){return"-Z"===e.orientation&&"male"===e.style}m.readPin=h;var t=function(){function e(e){this.availablePowerPins={top:{fiveVolt:m.mkRange(26,51).map(function(e){return{type:"breadboard",row:"+",col:""+e}}),threeVolt:m.mkRange(26,51).map(function(e){return{type:"breadboard",row:"+",col:""+e}}),ground:m.mkRange(26,51).map(function(e){return{type:"breadboard",row:"-",col:""+e}})},bottom:{fiveVolt:m.mkRange(1,26).map(function(e){return{type:"breadboard",row:"+",col:""+e}}),threeVolt:m.mkRange(1,26).map(function(e){return{type:"breadboard",row:"+",col:""+e}}),ground:m.mkRange(1,26).map(function(e){return{type:"breadboard",row:"-",col:""+e}})}},this.opts=e}return e.prototype.allocPartIRs=function(i,c,g){var o=this,u=[],l=function(e,t,n,r){for(var i=[],o=0;o<e.numberOfPins;o++){var a=e.pinDefinitions[o],s=void 0;if("string"==typeof a.target)s=a.target;else{var c=a.target.pinInstantiationIdx;if(!n||void 0===n[c])return void console.log("error: parts no pin found for PinInstantiationIdx: "+c+'. (Is the part missing an ArgumentRole or "trackArgs=" annotations?)');s=n[c]}var u=e.visual.pinLocations[o],l=g.yOffset+u.y,p=Math.round(l/e.visual.pinDistance),f=l-p*e.visual.pinDistance,d=g.xOffset+u.x,h=Math.round(d/e.visual.pinDistance),m={partRelativeRowIdx:p,partRelativeColIdx:h,xOffset:d-h*e.visual.pinDistance,yOffset:f};i.push({def:a,loc:u,target:s,bbFit:m})}return{name:t,def:e,pins:i,partParams:r||{},bbFit:g}},e=i.instantiations||[];return i.instantiation&&e.push(i.instantiation),e.forEach(function(e){if("singleton"===e.kind)u.push(l(i,c));else if("function"===e.kind){var s=e,n=s.fullyQualifiedName.split(","),t={};n.forEach(function(e){o.opts.fnArgs[e]&&o.opts.fnArgs[e].forEach(function(e){t[e]=1})});var r=Object.keys(t);if(!r||!r.length)return void console.log("error: parts failed to read pin(s) from callsite for: "+n);r.forEach(function(e){var t=e.split(",");if(t.length==s.argumentRoles.length){var o=[],a={};t.forEach(function(e,t){var n=s.argumentRoles[t];if(void 0!==n.partParameter&&(a[n.partParameter]=e),void 0!==n.pinInstantiationIdx){var r=n.pinInstantiationIdx,i=h(e);o[r]=i}}),u.push(l(i,c,o,a))}else console.log("error: parts mismatch between number of arguments at callsite (function name: "+n+") vs number of argument roles in part definition (part: "+c+").")})}}),u.filter(function(e){return!!e})},e.prototype.computePartDimensions=function(e,t){var n=e.visual.pinLocations,o=e.pinDefinitions,r=e.numberOfPins;m.U.assert(n.length===r,'Mismatch between "numberOfPins" and length of "visual.pinLocations" for "'+t+'"'),m.U.assert(o.length===r,'Mismatch between "numberOfPins" and length of "pinDefinitions" for "'+t+'"'),m.U.assert(0<r,'Part "'+t+'" has no pins');var i,a,s,c,u=n.map(function(e,t){return n={idx:t},r=e,i=o[t],g(g(n,r),i);var n,r,i}).filter(function(e){return"-Z"===e.orientation}),l=0<u.length,p=e.visual.pinDistance;if(l){var f=u[0],d=Math.ceil(f.x/p),h=Math.ceil(f.y/p);i=d*p-f.x,a=h*p-f.y,s=Math.ceil((i+e.visual.width)/p)+1,c=Math.ceil((a+e.visual.height)/p)+1}else s=Math.ceil(e.visual.width/p),c=Math.ceil(e.visual.height/p),i=s*p-e.visual.width,a=c*p-e.visual.height;return{xOffset:i,yOffset:a,rowCount:c,colCount:s}},e.prototype.allocColumns=function(e){var t=e.length,n=m.visuals.BREADBOARD_MID_COLS-e.map(function(e){return e.colCount}).reduce(function(e,t){return e+t},0);n<=0&&console.log("Not enough breadboard space!");var r=Math.floor(n/(t-1+2)),i=n-r*(t-1),o=Math.floor(i/2),a=(Math.ceil(i/2),1+o);return e.map(function(e){var t=a;return a+=e.colCount+r,t})},e.prototype.placeParts=function(e){var r=m.visuals.BREADBOARD_MID_ROWS+2,i=this.allocColumns(e.map(function(e){return e.bbFit})),o=e.map(function(e){var t=r-e.bbFit.rowCount,n=Math.floor(t/2);return 4<n&&(n=4),n<1&&(n=1),n});return e.map(function(e,t){var n=o[t];return g({startColumnIdx:i[t],startRowIdx:n},e)})},e.prototype.nextColor=function(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=m.visuals.GPIO_WIRE_COLORS.map(function(e){return e})),this.availableWireColors.pop()},e.prototype.allocWireIRs=function(s){var c=this,u=[],e=s.pins.map(function(e,t){var n,r=e.target,i=s.startColumnIdx+e.bbFit.partRelativeColIdx,o=m.visuals.getColumnName(i),a=s.startRowIdx+e.bbFit.partRelativeRowIdx;(7<=a&&(a-=2),l(e.def))?n={type:"breadboard",row:a<5?"j":"a",col:o,style:e.def.style}:n={type:"breadboard",row:m.visuals.getRowName(a),col:o,xOffset:e.bbFit.xOffset/s.def.visual.pinDistance,yOffset:e.bbFit.yOffset/s.def.visual.pinDistance,style:e.def.style};return{start:n,end:r,color:"ground"===r?p:"threeVolt"===r?"red":"fiveVolt"===r?f:"number"==typeof e.def.colorGroup?u[e.def.colorGroup]?u[e.def.colorGroup]:u[e.def.colorGroup]=c.nextColor():c.nextColor(),pinIdx:t}});return g(s,{wires:e})},e.prototype.allocLocation=function(e,t){var n=this;if("ground"===e||"threeVolt"===e||"fiveVolt"==e){if("ground"===e&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===e&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};if("fiveVolt"===e&&this.powerUsage.singleFiveVolt)return{type:"dalboard",pin:this.getBoardFiveVoltPin()};m.U.assert(!!t.referenceBBPin);var r=this.opts.getBBCoord(t.referenceBBPin),i=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(function(e){return n.opts.getBBCoord(e)});i[0]&&i[1]||console.debug('No more available "'+e+'" locations!');var o=0==m.visuals.findClosestCoordIdx(r,i),a=void 0;o?"ground"===e?a=this.availablePowerPins.top.ground:"threeVolt"===e?a=this.availablePowerPins.top.threeVolt:"fiveVolt"===e&&(a=this.availablePowerPins.top.fiveVolt):"ground"===e?a=this.availablePowerPins.bottom.ground:"threeVolt"===e?a=this.availablePowerPins.bottom.threeVolt:"fiveVolt"===e&&(a=this.availablePowerPins.bottom.fiveVolt);var s=a.map(function(e){return n.opts.getBBCoord(e)}),c=m.visuals.findClosestCoordIdx(r,s),u=a[c];return o?(this.availablePowerPins.top.ground.splice(c,1),this.availablePowerPins.top.threeVolt.splice(c,1)):(this.availablePowerPins.bottom.ground.splice(c,1),this.availablePowerPins.bottom.threeVolt.splice(c,1)),u}if("breadboard"===e.type)return e;if("MOSI"===e||"MISO"===e||"SCK"===e)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:u=this.opts.boardDef.spiPins[e]};if("SDA"===e||"SCL"===e)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:u=this.opts.boardDef.i2cPins[e]};m.U.assert("string"==typeof e,"Unknown location type: "+e);var l=e,p=this.opts.boardDef.gpioPinMap[l]||l;return p?{type:"dalboard",pin:p}:void console.debug("unknown pin location for "+l)},e.prototype.getBoardGroundPin=function(){var e=this.opts.boardDef.groundPins&&this.opts.boardDef.groundPins[0]||null;return e||console.debug("No available ground pin on board!"),e},e.prototype.getBoardThreeVoltPin=function(){var e=this.opts.boardDef.threeVoltPins&&this.opts.boardDef.threeVoltPins[0]||null;return e||console.debug("No available 3.3V pin on board!"),e},e.prototype.getBoardFiveVoltPin=function(){var e=this.opts.boardDef.fiveVoltPins&&this.opts.boardDef.fiveVoltPins[0]||null;return e||console.debug("No available 5V pin on board!"),e},e.prototype.allocPowerWires=function(e){var t,n,r=this.getBoardGroundPin(),i=this.getBoardThreeVoltPin(),o=this.getBoardFiveVoltPin();this.opts.boardDef.attachPowerOnRight?(t={type:"breadboard",row:"-",col:"50"},n={type:"breadboard",row:"-",col:"25"}):(t={type:"breadboard",row:"-",col:"26"},n={type:"breadboard",row:"-",col:"1"});var a=[],s=[],c=[];e.bottomGround&&e.topGround&&a.push({start:this.allocLocation("ground",{referenceBBPin:t}),end:this.allocLocation("ground",{referenceBBPin:n}),color:p}),e.topGround?a.push({start:this.allocLocation("ground",{referenceBBPin:t}),end:{type:"dalboard",pin:r},color:p}):e.bottomGround&&a.push({start:this.allocLocation("ground",{referenceBBPin:n}),end:{type:"dalboard",pin:r},color:p}),e.bottomThreeVolt&&e.bottomGround?s.push({start:this.allocLocation("threeVolt",{referenceBBPin:t}),end:this.allocLocation("threeVolt",{referenceBBPin:n}),color:"red"}):e.bottomFiveVolt&&e.bottomGround&&c.push({start:this.allocLocation("fiveVolt",{referenceBBPin:t}),end:this.allocLocation("fiveVolt",{referenceBBPin:n}),color:f}),e.topThreeVolt?s.push({start:this.allocLocation("threeVolt",{referenceBBPin:t}),end:{type:"dalboard",pin:i},color:"red"}):e.bottomThreeVolt&&s.push({start:this.allocLocation("threeVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:i},color:f}),e.topFiveVolt&&!e.topThreeVolt?c.push({start:this.allocLocation("fiveVolt",{referenceBBPin:t}),end:{type:"dalboard",pin:o},color:"red"}):e.bottomFiveVolt&&!e.bottomThreeVolt&&c.push({start:this.allocLocation("fiveVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:o},color:f});var u=[];0<a.length&&u.push({wireIndices:a.map(function(e,t){return t})});var l=a.length;return 0<s.length&&u.push({wireIndices:s.map(function(e,t){return t+l})}),0<c.length&&u.push({wireIndices:s.map(function(e,t){return t+l+s.length})}),{wires:a.concat(s).concat(c),assembly:u}},e.prototype.allocWire=function(e){var r=this,i=[e.start,e.end],n=i.map(function(e){return"ground"===e||"threeVolt"===e||"fiveVolt"===e}),o=i.map(function(e,t){return n[t]?void 0:r.allocLocation(e,{})});if((o=o.map(function(e,t){if(e)return e;var n=o[1-t];return r.allocLocation(i[t],{referenceBBPin:n})}))[0]&&o[1])return{start:o[0],end:o[1],color:e.color}},e.prototype.allocPart=function(i){var e=i.pins.filter(function(e){return l(e.def)}).map(function(e){var t=i.startRowIdx+e.bbFit.partRelativeRowIdx;7<=t&&(t-=2);var n=m.visuals.getRowName(t),r=i.startColumnIdx+e.bbFit.partRelativeColIdx;return{type:"breadboard",row:n,col:m.visuals.getColumnName(r)}});return{name:i.name,visual:i.def.visual,bbFit:i.bbFit,startColumnIdx:i.startColumnIdx,startRowIdx:i.startRowIdx,breadboardConnections:e,params:i.partParams,simulationBehavior:i.def.simulationBehavior}},e.prototype.allocAll=function(){var e,o=this,t=this.opts.partsList.map(function(e){return{name:e,def:o.opts.partDefs[e]}}).filter(function(e){return!!e.def});if(0<t.length){var i=t.map(function(e){return o.computePartDimensions(e.def,e.name)}),a=[];t.forEach(function(e,t){var n=i[t],r=o.allocPartIRs(e.def,e.name,n);a=a.concat(r)});var n=this.placeParts(a).map(function(e){return o.allocWireIRs(e)}),r=n.map(function(e){return e.wires}).reduce(function(e,t){return e.concat(t)},[]).map(function(e){return n=[(t=e).start,t.end],r=n.map(function(e){return"ground"===e}),i=n.map(function(e){return"threeVolt"===e}),o=n.map(function(e){return"fiveVolt"===e}),a=n.map(function(e){return function(e){var t=!1;if("string"!=typeof e&&"breadboard"===e.type){var n=e.row;t=0<=["a","b","c","d","e"].indexOf(n)}return t}(e)}),s=d(r),c=d(i),u=d(o),l=d(a),{topGround:s&&!l,topThreeVolt:c&&!l,topFiveVolt:u&&!l,bottomGround:s&&l,bottomThreeVolt:c&&l,bottomFiveVolt:u&&l,singleGround:s,singleThreeVolt:c,singleFiveVolt:u};var t,n,r,i,o,a,s,c,u,l});this.powerUsage=((e=r.reduce(function(e,t){return{topGround:e.topGround||t.topGround,topThreeVolt:e.topThreeVolt||t.topThreeVolt,topFiveVolt:e.topFiveVolt||t.topFiveVolt,bottomGround:e.bottomGround||t.bottomGround,bottomThreeVolt:e.bottomThreeVolt||t.bottomThreeVolt,bottomFiveVolt:e.bottomFiveVolt||t.bottomFiveVolt,singleGround:t.singleGround?null===e.singleGround:e.singleGround,singleThreeVolt:t.singleThreeVolt?null===e.singleThreeVolt:e.singleThreeVolt,singleFiveVolt:t.singleFiveVolt?null===e.singleFiveVolt:e.singleFiveVolt}},{topGround:!1,topThreeVolt:!1,topFiveVolt:!1,bottomGround:!1,bottomThreeVolt:!1,bottomFiveVolt:!1,singleGround:null,singleThreeVolt:null,singleFiveVolt:null})).singleGround&&(e.topGround=e.bottomGround=!1),e.singleThreeVolt&&(e.topThreeVolt=e.bottomThreeVolt=!1),e.singleFiveVolt&&(e.topFiveVolt=e.bottomFiveVolt=!1),e);var s=this.allocPowerWires(this.powerUsage),c=n.map(function(e,t){var n=o.allocPart(e),r=e.wires.map(function(e){return o.allocWire(e)});if(!r.some(function(e){return!e})){var i=[];return e.wires.forEach(function(e,t){i[e.pinIdx]=t}),{part:n,wires:r,assembly:e.def.assembly.map(function(e){return{part:e.part,wireIndices:(e.pinIndices||[]).map(function(e){return i[e]})}})}}}).filter(function(e){return!!e}),u=[s].concat(c).filter(function(e){return e.assembly&&e.assembly.length});return{partsAndWires:u,wires:[],parts:[],hideBreadboard:!u.some(function(e){return e.part&&e.part.breadboardConnections&&0<e.part.breadboardConnections.length||e.wires&&e.wires.some(function(e){return"breadboard"==e.end.type&&"croc"!=e.end.style||"breadboard"==e.start.type&&"croc"!=e.start.style})})}}return{partsAndWires:[],wires:[],parts:[]}},e}();m.allocateDefinitions=function(e){return new t(e).allocAll()}}(pxsim||(pxsim={})),function(e){!function(s){var e=function(e){this.seq=0,this.type=e},t=function(r){function e(e,t){var n=r.call(this,"response")||this;return n.request_seq=e.seq,n.command=e.command,t?(n.success=!1,n.message=t):n.success=!0,n}return __extends(e,r),e}(s.Message=e);s.Response=t;var n=function(r){function e(e,t){var n=r.call(this,"event")||this;return n.event=e,t&&(n.body=t),n}return __extends(e,r),e}(e);s.Event=n;var r=function(e,t,n,r,i){void 0===n&&(n=0),this.name=e,this.path=t,this.sourceReference=n,r&&(this.origin=r),i&&(this.adapterData=i)};s.Source=r;var i=function(e,t,n){void 0===n&&(n=!1),this.name=e,this.variablesReference=t,this.expensive=n};s.Scope=i;var o=function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this.id=e,this.source=n,this.line=r,this.column=i,this.name=t};s.StackFrame=o;var a=function(e,t){this.id=e,this.name=t||"Thread #"+e};s.Thread=a;var c=function(e,t,n,r,i){void 0===n&&(n=0),this.name=e,this.value=t,this.variablesReference=n,"number"==typeof i&&(this.namedVariables=i),"number"==typeof r&&(this.indexedVariables=r)};s.Variable=c;var u=function(e,t,n,r){this.verified=e,"number"==typeof t&&(this.line=t),"number"==typeof n&&(this.column=n),r&&(this.source=r)};s.Breakpoint=u;var l=function(e,t){this.id=e,this.name=t};s.Module=l;var p=function(e,t,n){void 0===n&&(n=0),this.label=e,this.start=t,this.length=n};s.CompletionItem=p;var f=function(i){function e(e,t,n){void 0===n&&(n=null);var r=i.call(this,"stopped")||this;(r.body={reason:e,threadId:t},n)&&(r.body.text=n);return r}return __extends(e,i),e}(n);s.StoppedEvent=f;var d=function(r){function e(e,t){var n=r.call(this,"continued")||this;return n.body={threadId:e},"boolean"==typeof t&&(n.body.allThreadsContinued=t),n}return __extends(e,r),e}(n);s.ContinuedEvent=d;var h=function(e){function t(){return e.call(this,"initialized")||this}return __extends(t,e),t}(n);s.InitializedEvent=h;var m=function(n){function e(e){var t=n.call(this,"terminated")||this;"boolean"==typeof e&&(t.body={restart:e});return t}return __extends(e,n),e}(n);s.TerminatedEvent=m;var g=function(i){function e(e,t,n){void 0===t&&(t="console");var r=i.call(this,"output")||this;return r.body={category:t,output:e},void 0!==n&&(r.body.data=n),r}return __extends(e,i),e}(n);s.OutputEvent=g;var v=function(r){function e(e,t){var n=r.call(this,"thread")||this;return n.body={reason:e,threadId:t},n}return __extends(e,r),e}(n);s.ThreadEvent=v;var b=function(r){function e(e,t){var n=r.call(this,"breakpoint")||this;return n.body={reason:e,breakpoint:t},n}return __extends(e,r),e}(n);s.BreakpointEvent=b;var y=function(r){function e(e,t){var n=r.call(this,"module")||this;return n.body={reason:e,module:t},n}return __extends(e,r),e}(n);s.ModuleEvent=y;var w=function(){function e(){this._pendingRequests={}}return e.prototype.start=function(e){var r=this;this._sequence=1,this.host=e,this.host.onData(function(e){if("request"===e.type)r.dispatchRequest(e);else if("response"===e.type){var t=e,n=r._pendingRequests[t.seq];n&&(delete r._pendingRequests[t.seq],n(t))}})},e.prototype.stop=function(){this.host&&this.host.close()},e.prototype.sendEvent=function(e){this.send("event",e)},e.prototype.sendResponse=function(e){0<e.seq?console.error("attempt to send more than one response for command "+e.command):this.send("response",e)},e.prototype.sendRequest=function(e,t,n,r){var i=this,o={command:e};if(t&&0<Object.keys(t).length&&(o.arguments=t),this.send("request",o),r){this._pendingRequests[o.seq]=r;var a=setTimeout(function(){clearTimeout(a);var e=i._pendingRequests[o.seq];e&&(delete i._pendingRequests[o.seq],e(new s.Response(o,"timeout")))},n)}},e.prototype.send=function(e,t){if(t.type=e,t.seq=this._sequence++,this.host){var n=JSON.stringify(t);this.host.send(n)}},e.prototype.dispatchRequest=function(e){},e}(),x=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._debuggerLinesStartAt1=!1,e._debuggerColumnsStartAt1=!1,e._clientLinesStartAt1=!0,e._clientColumnsStartAt1=!0,e}return __extends(o,t),o.prototype.shutdown=function(){},o.prototype.dispatchRequest=function(e){var t=new s.Response(e);try{if("initialize"===e.command){var n=e.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null);else{var r=t;r.body={},this.initializeRequest(r,n)}}else"launch"===e.command?this.launchRequest(t,e.arguments):"attach"===e.command?this.attachRequest(t,e.arguments):"disconnect"===e.command?this.disconnectRequest(t,e.arguments):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments):"continue"===e.command?this.continueRequest(t,e.arguments):"next"===e.command?this.nextRequest(t,e.arguments):"stepIn"===e.command?this.stepInRequest(t,e.arguments):"stepOut"===e.command?this.stepOutRequest(t,e.arguments):"stepBack"===e.command?this.stepBackRequest(t,e.arguments):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments):"goto"===e.command?this.gotoRequest(t,e.arguments):"pause"===e.command?this.pauseRequest(t,e.arguments):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments):"scopes"===e.command?this.scopesRequest(t,e.arguments):"variables"===e.command?this.variablesRequest(t,e.arguments):"setVariable"===e.command?this.setVariableRequest(t,e.arguments):"source"===e.command?this.sourceRequest(t,e.arguments):"threads"===e.command?this.threadsRequest(t):"evaluate"===e.command?this.evaluateRequest(t,e.arguments):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments):"completions"===e.command?this.completionsRequest(t,e.arguments):this.customRequest(e.command,t,e.arguments)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack})}},o.prototype.initializeRequest=function(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,this.sendResponse(e)},o.prototype.disconnectRequest=function(e,t){this.sendResponse(e),this.shutdown()},o.prototype.launchRequest=function(e,t){this.sendResponse(e)},o.prototype.attachRequest=function(e,t){this.sendResponse(e)},o.prototype.setBreakPointsRequest=function(e,t){this.sendResponse(e)},o.prototype.setFunctionBreakPointsRequest=function(e,t){this.sendResponse(e)},o.prototype.setExceptionBreakPointsRequest=function(e,t){this.sendResponse(e)},o.prototype.configurationDoneRequest=function(e,t){this.sendResponse(e)},o.prototype.continueRequest=function(e,t){this.sendResponse(e)},o.prototype.nextRequest=function(e,t){this.sendResponse(e)},o.prototype.stepInRequest=function(e,t){this.sendResponse(e)},o.prototype.stepOutRequest=function(e,t){this.sendResponse(e)},o.prototype.stepBackRequest=function(e,t){this.sendResponse(e)},o.prototype.restartFrameRequest=function(e,t){this.sendResponse(e)},o.prototype.gotoRequest=function(e,t){this.sendResponse(e)},o.prototype.pauseRequest=function(e,t){this.sendResponse(e)},o.prototype.sourceRequest=function(e,t){this.sendResponse(e)},o.prototype.threadsRequest=function(e){this.sendResponse(e)},o.prototype.stackTraceRequest=function(e,t){this.sendResponse(e)},o.prototype.scopesRequest=function(e,t){this.sendResponse(e)},o.prototype.variablesRequest=function(e,t){this.sendResponse(e)},o.prototype.setVariableRequest=function(e,t){this.sendResponse(e)},o.prototype.evaluateRequest=function(e,t){this.sendResponse(e)},o.prototype.stepInTargetsRequest=function(e,t){this.sendResponse(e)},o.prototype.gotoTargetsRequest=function(e,t){this.sendResponse(e)},o.prototype.completionsRequest=function(e,t){this.sendResponse(e)},o.prototype.customRequest=function(e,t,n){this.sendErrorResponse(t,1014,"unrecognized request",null)},o.prototype.sendErrorResponse=function(e,t,n,r){var i;"number"==typeof t?(i={id:t,format:n},r&&(i.variables=r),i.showUser=!0):i=t,e.success=!1,o.formatPII(i.format,!0,i.variables),e.body||(e.body={}),e.body.error=i,this.sendResponse(e)},o.prototype.convertClientLineToDebugger=function(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e},o.prototype.convertDebuggerLineToClient=function(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e},o.prototype.convertClientColumnToDebugger=function(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e},o.prototype.convertDebuggerColumnToClient=function(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e},o.prototype.convertClientPathToDebugger=function(e){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?o.uri2path(e):o.path2uri(e):e},o.prototype.convertDebuggerPathToClient=function(e){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?o.uri2path(e):o.path2uri(e):e},o.path2uri=function(e){var t=e.replace(/\\/g,"/");return"/"!==t[0]&&(t="/"+t),encodeURI("file://"+t)},o.uri2path=function(e){return e},o.formatPII=function(e,n,r){return e.replace(o._formatPIIRegexp,function(e,t){return n&&0<t.length&&"_"!==t[0]?e:r[t]&&r.hasOwnProperty(t)?r[t]:e})},o._formatPIIRegexp=/{([^}]+)}/g,o}(s.ProtocolServer=w);s.DebugSession=x}(e.protocol||(e.protocol={}))}(pxsim||(pxsim={})),function(e){!function(e){e.injectPolyphils=function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return void 0!==e&&null!=e&&(t=!t||t<0?0:+t,this.substring(t,t+e.length)===e)}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,r=arguments[1]>>0,i=r<0?Math.max(n+r,0):Math.min(r,n),o=arguments[2],a=void 0===o?n:o>>0,s=a<0?Math.max(n+a,0):Math.min(a,n);i<s;)t[i]=e,i++;return t}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{writable:!0,enumerable:!0,value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var o=t[i];if(e.call(r,o,i,t))return o;i++}}}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint16Array.prototype.fill||Object.defineProperty(Uint16Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint32Array.prototype.fill||Object.defineProperty(Uint32Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint8Array.prototype.some||Object.defineProperty(Uint8Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint16Array.prototype.some||Object.defineProperty(Uint16Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint32Array.prototype.some||Object.defineProperty(Uint32Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint8Array.prototype.reverse||Object.defineProperty(Uint8Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint16Array.prototype.reverse||Object.defineProperty(Uint16Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint32Array.prototype.reverse||Object.defineProperty(Uint32Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Math.imul||(Math.imul=function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},writable:!0,configurable:!0})};var t=function(){function e(e){this._func=e,this._evaluated=!1}return Object.defineProperty(e.prototype,"value",{get:function(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value},enumerable:!0,configurable:!0}),e}();function c(e){e=e.replace(/\\/g,"/");var t=[];return e.split("/").forEach(function(e){".."===e&&t.length?t.pop():e&&"."!==e&&t.push(e)}),t}e.Lazy=t,e.getNormalizedParts=c,e.normalizePath=function(e){return c(e).join("/")},e.relativePath=function(e,t){for(var n=c(e),r=c(t),i=0;n[i]===r[i]&&++i!==n.length&&i!==r.length;);for(var o=n.slice(i),a=r.slice(i),s=0;s<o.length;s++)a.unshift("..");return a.join("/")},e.pathJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";return e.forEach(function(e){e.replace(/\\/g,"/"),e.lastIndexOf("/")===e.length-1&&(e=e.slice(0,e.length-1)),n+="/"+e}),n},e.toArray=function(e){if(Array.isArray(e))return e;for(var t=[],n=0;n<e.length;++n)t.push(e[n]);return t}}(e.util||(e.util={}))}(pxsim||(pxsim={})),function(c){c.getWarningMessage=function(e){for(var t={type:"debugger",subtype:"warning",breakpointIds:[],message:e},n=c.runtime.currFrame;null!=n;)t.breakpointIds.push(n.lastBrkId),n=n.parent;return t};var e=function(){function e(e){var r=this;for(var t in this.fileMap={},this.idMap={},e.forEach(function(e){var t=e[0],n=e[1];r.fileMap[n.source.path]||(r.fileMap[n.source.path]=[]),r.fileMap[n.source.path].push(e),r.idMap[t]=n}),this.fileMap){var n=this.fileMap[t];this.fileMap[t]=n.sort(function(e,t){var n=e[1],r=t[1];return n.line===r.line?r.endLine===n.endLine?n.column-r.column:r.endLine-n.endLine:n.line-r.line})}}return e.prototype.getById=function(e){return this.idMap[e]},e.prototype.verifyBreakpoint=function(e,t){var n,r=this.fileMap[e];if(r)for(var i=0,o=r;i<o.length;i++){var a=o[i],s=a[0],c=a[1];c.line<=t.line&&c.endLine>=t.line&&(n=[s,c])}return n?(n[1].verified=!0,n):[-1,{verified:!1}]},e}();function f(e,t){switch(typeof e){case"string":case"number":case"boolean":return e;case"function":return{text:"(function)",type:"function"};case"undefined":return null;case"object":if(!e)return null;if(e instanceof c.RefObject){t&&(t[e.id]=e);var n=c.RefObject.toDebugString(e),r=n.startsWith("[")?"array":n;return{id:e.id,preview:n,hasFields:null!==e.fields||n.startsWith("["),type:r}}return e._width&&e._height?{text:e._width+"x"+e._height,type:"image"}:{text:"(object)",type:"object"};default:throw new Error}}function a(e,l,t,p){return function(e,t){for(var n={},r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];/^__/.test(o)||!/___\d+$/.test(o)||p&&-1===p.indexOf(o)||(n[o]=f(e[o],l))}if(e.fields&&t)for(var a=0,s=t;a<s.length;a++)o=(o=s[a]).substring(o.lastIndexOf(".")+1),n[o]=f(d(e.vtable.iface[o],e),l);if(e.fields)for(var c=0,u=Object.keys(e.fields).filter(function(e){return!e.startsWith("_")});c<u.length;c++)o=u[c],n[o]=f(e.fields[o],l);else Array.isArray(e.data)&&e.data.forEach(function(e,t){n[t]=f(e,l)});return n}(e,t)}function d(e,t){for(var n={pc:0,arg0:t,fn:e,parent:{}};n.fn;)n=n.fn(n);return n.retval}function s(n,r){var e=n.fn?n.fn.info:null;if(e){var t={thisParam:f(n.argL,r),params:[]};if(e.argumentNames){var i=e.argumentNames;t.params=i.map(function(e,t){return{name:e,value:f(n["arg"+t],r)}})}return{locals:a(n,r),funcInfo:e,breakpointId:n.lastBrkId,callLocationId:n.callLocIdx,arguments:t}}}c.BreakpointMap=e,c.dumpHeap=a,c.injectEnvironmentGlobals=function(e,t){var n=c.runtime.environmentGlobals;if(Object.keys(n).length){var r=e.environmentGlobals={};Object.keys(n).forEach(function(e){return r[e]=f(c.runtime.environmentGlobals[e],t)})}},c.getBreakpointMsg=function(e,t,n){for(var r={},i={type:"debugger",subtype:"breakpoint",breakpointId:t,globals:a(c.runtime.globals,r,void 0,n),stackframes:[]};null!=e;){var o=s(e,r);o&&i.stackframes.push(o),e=e.parent}return{msg:i,heap:r}};var t=function(r){function n(e){var t=r.call(this)||this,n={onDebuggerBreakpoint:function(e){return t.onDebuggerBreakpoint(e)},onDebuggerWarning:function(e){return t.onDebuggerWarning(e)},onDebuggerResume:function(){return t.onDebuggerResume()},onStateChanged:function(e){return t.onStateChanged(e)}};return t.driver=new c.SimulatorDriver(e,n),t}return __extends(n,r),n.prototype.runCode=function(e,t,n,r,i){this.breakpoints=r,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new c.protocol.InitializedEvent),this.driver.run(e,{parts:t,fnArgs:n,boardDefinition:i})},n.prototype.stopSimulator=function(e){void 0===e&&(e=!1),this.driver.stop(e)},n.prototype.initializeRequest=function(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsConfigurationDoneRequest=!0,this.sendResponse(e)},n.prototype.disconnectRequest=function(e,t){this.sendResponse(e),this.shutdown()},n.prototype.launchRequest=function(e,t){this.projectDir||(this.projectDir=c.util.normalizePath(t.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(e)},n.prototype.setBreakPointsRequest=function(i,o){var a=this;i.body={breakpoints:[]};var s=[];o.breakpoints.forEach(function(e){if(a.breakpoints){var t=a.breakpoints.verifyBreakpoint(c.util.relativePath(a.projectDir,o.source.path),e),n=t[0],r=t[1];i.body.breakpoints.push(r),r.verified&&s.push(n)}else i.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(s),this.sendResponse(i)},n.prototype.continueRequest=function(e,t){this.driver.resume(c.SimulatorDebuggerCommand.Resume),this.sendResponse(e)},n.prototype.nextRequest=function(e,t){this.driver.resume(c.SimulatorDebuggerCommand.StepOver),this.sendResponse(e)},n.prototype.stepInRequest=function(e,t){this.driver.resume(c.SimulatorDebuggerCommand.StepInto),this.sendResponse(e)},n.prototype.stepOutRequest=function(e,t){this.driver.resume(c.SimulatorDebuggerCommand.StepOut),this.sendResponse(e)},n.prototype.pauseRequest=function(e,t){this.driver.resume(c.SimulatorDebuggerCommand.Pause),this.sendResponse(e)},n.prototype.threadsRequest=function(e){e.body={threads:[{id:n.THREAD_ID,name:"main"}]},this.sendResponse(e)},n.prototype.stackTraceRequest=function(e,t){if(this.lastBreak){var n=this.state.getFrames();e.body={stackFrames:n}}this.sendResponse(e)},n.prototype.scopesRequest=function(e,t){this.state&&(e.body={scopes:this.state.getScopes(t.frameId)}),this.sendResponse(e)},n.prototype.variablesRequest=function(e,t){this.state&&(e.body={variables:this.state.getVariables(t.variablesReference)}),this.sendResponse(e)},n.prototype.onDebuggerBreakpoint=function(e){if(this.lastBreak=e,this.state=new i(this.lastBreak,this.breakpoints,this.projectDir),e.exceptionMessage){var t=e.exceptionMessage.replace(/___\d+/g,"");this.sendEvent(new c.protocol.StoppedEvent("exception",n.THREAD_ID,t))}else this.sendEvent(new c.protocol.StoppedEvent("breakpoint",n.THREAD_ID))},n.prototype.onDebuggerWarning=function(e){},n.prototype.onDebuggerResume=function(){this.sendEvent(new c.protocol.ContinuedEvent(n.THREAD_ID,!0))},n.prototype.onStateChanged=function(e){switch(e){case c.SimulatorState.Paused:break;case c.SimulatorState.Running:this.sendEvent(new c.protocol.ContinuedEvent(n.THREAD_ID,!0));break;case c.SimulatorState.Stopped:this.sendEvent(new c.protocol.TerminatedEvent)}},n.prototype.fixBreakpoints=function(){for(var e in this.breakpoints.idMap){var t=this.breakpoints.idMap[e];t.source.path=c.util.pathJoin(this.projectDir,t.source.path),t.line=this.convertDebuggerLineToClient(t.line),t.endLine=this.convertDebuggerLineToClient(t.endLine),t.column=this.convertDebuggerColumnToClient(t.column),t.endColumn=this.convertDebuggerColumnToClient(t.endColumn)}},n.THREAD_ID=1,n}(c.protocol.DebugSession);c.SimDebugSession=t;var i=function(){function e(e,t,n){this._message=e,this._map=t,this._dir=n,this._currentId=1,this._frames={},this._vars={};var r=this.nextId();this._vars[r]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:r,expensive:!1}}return e.prototype.getFrames=function(){var r=this;return this._message.stackframes.map(function(e,t){var n=r._map.getById(e.breakpointId);if(n)return{id:(r._frames[e.breakpointId]=e).breakpointId,name:e.funcInfo?e.funcInfo.functionName:0===t?"main":"anonymous",line:n.line,column:n.column,endLine:n.endLine,endColumn:n.endLine,source:n.source}}).filter(function(e){return!!e})},e.prototype.getScopes=function(e){var t=this._frames[e];if(t){var n=this.nextId();return this._vars[n]=this.getVariableValues(t.locals),[{name:"Locals",variablesReference:n,expensive:!1},this._globalScope]}return[this._globalScope]},e.prototype.getVariables=function(e){var t=this._vars[e];return t&&t.value||[]},e.prototype.getVariableValues=function(a){var s=this;return new c.util.Lazy(function(){var e=[];for(var t in a){var n=a[t],r=void 0,i=0;null===n?r="null":void 0===n?r="undefined":"object"==typeof n?(r="(object)",i=s.nextId(),s._vars[i]=s.getVariableValues(n)):r=n.toString();var o=t.substr(0,t.lastIndexOf("___"));e.push({name:o,value:r,variablesReference:i})}return e})},e.prototype.nextId=function(){return this._currentId++},e}()}(pxsim||(pxsim={})),function(c){function u(e){function t(){try{window.print()}catch(e){}}void 0===e&&(e=0),e?setTimeout(t,e):t()}function l(e,t){r({type:"pxtsim",action:"event",tick:e,data:t})}function r(e){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(e,"*")}function p(){setInterval(function(){c.Runtime.postMessage({type:"simulator",command:"reload"})},3e3)}c.print=u,function(e){function t(e){e.origin;var t=e.data||{},n=t.type;if(n)switch(n){case"run":a(t);break;case"instructions":c.instructions.renderInstructions(t);break;case"stop":o();break;case"mute":s(t.mute);break;case"stopsound":c.AudioContextManager.stopAll();break;case"print":u();break;case"recorder":!function(e){if(!i)return;switch(e.action){case"start":i.startRecording(e.width);break;case"stop":i.stopRecording()}}(t);break;case"screenshot":c.Runtime.postScreenshotAsync(t).done();break;case"custom":c.handleCustomMessage&&c.handleCustomMessage(t);break;case"pxteditor":break;case"debugger":i&&i.handleDebuggerMsg(t);break;case"simulator":var r=t;switch(r.command){case"focus":l("simulator.focus",{timestamp:r.timestamp});break;case"blur":l("simulator.blur",{timestamp:r.timestamp})}default:!function(e){if(!i||i.dead)return;i.board.receiveMessage(e)}(t)}}var i;function o(){i&&(i.kill(),i.board&&i.board.kill())}function a(e){o(),e.mute&&s(e.mute),e.localizedStrings&&c.localization.setLocalizedStrings(e.localizedStrings),(i=new c.Runtime(e)).board.initAsync(e).done(function(){i.run(function(e){c.dumpLivePointers(),c.Runtime.postMessage({type:"toplevelcodefinished"})})})}function s(e){c.AudioContextManager.mute(e)}e.start=function(){window.addEventListener("message",t,!1),e.frameid=window.location.hash.slice(1),function(){if("serviceWorker"in navigator&&-1!==window.location.href.indexOf("---simulator")&&!c.U.isLocalHost()){var e=window.location.pathname,n=e.substring(1,e.indexOf("---"));navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("message",function(e){var t=e.data;t&&"serviceworker"===t.type&&"activated"===t.state&&t.ref===n&&p()});var t=window.location.href.replace(/---simulator.*$/,"---simserviceworker");navigator.serviceWorker.register(t).then(function(e){console.log("Simulator ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("Simulator ServiceWorker registration failed: ",e)})}}(),c.Runtime.postMessage({type:"ready",frameid:e.frameid})},e.stop=o,e.run=a}(c.Embed||(c.Embed={})),c.tickEvent=l,c.reportError=function(e,t,n){r({type:"pxtsim",action:"event",tick:"error",category:e,message:t,data:n})},c.reload=p}(pxsim||(pxsim={})),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(e){pxsim.Embed.start()}),function(M){!function(e){var u=10,r=30,a=function(e){return e+"x"},s=20,R=3,N=5,D=5,l=40,p=50,f=1.5,t=[816*.95,1056*.95],n=[1,1],i=n[0],o=n[1],c=(t[0]-86.4)/o-48*o,d=465,h=400,L=1.7,m=.17,g=.25,v=.3,b=.23,y="\n            .instr-panel {\n                margin: 20px;\n                padding: 24px;\n                border-width: 4px;\n                border-color: gray;\n                border-style: solid;\n                border-radius: 20px;\n                display: inline-block;\n                width: "+c+"px;\n                height: "+((t[1]-86.4)/i-48*i)+"px;\n                position: relative;\n                overflow: hidden;\n                page-break-inside: avoid;\n            }\n            .board-svg {\n                margin: 0 auto;\n                display: block;\n                position: absolute;\n                bottom: 24px;\n                left: "+((c-d)/2+24)+"px;\n            }\n            .panel-num-outer {\n                position: absolute;\n                left: "+-4+"px;\n                top: "+-4+"px;\n                width: 120px;\n                height: 120px;\n                border-width: 4px;\n                border-style: solid;\n                border-color: gray;\n                border-radius: 20px 0 20px 0;\n            }\n            .panel-num {\n                margin: 10px 0;\n                text-align: center;\n                font-size: 80px;\n            }\n            .cmp-div {\n                display: inline-block;\n            }\n            .reqs-div {\n                margin-left: 144px;\n                margin-top: 5px;\n            }\n            .partslist-wire,\n            .partslist-cmp {\n                margin: 10px;\n            }\n            .partslist-wire {\n                display: inline-block;\n            }\n            ";function w(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r={l:0,t:0,w:0,h:0},i=document.createElementNS("http://www.w3.org/2000/svg","svg");n.appendChild(i),i.appendChild(e.el);var o={viewBox:e.x+" "+e.y+" "+e.w+" "+e.h,preserveAspectRatio:"xMidYMid"};r.w=e.w,r.h=e.h;var a=function(e){r.h*=e,r.w*=e,o.width=r.w,o.height=r.h};t.cmpScale&&a(t.cmpScale),t.cmpWidth&&t.cmpWidth<r.w?a(t.cmpWidth/r.w):t.cmpHeight&&t.cmpHeight<r.h&&a(t.cmpHeight/r.h),M.svg.hydrate(i,o);var s=r.l,c=r.t,u=r.w,l=r.h,p=function(e){if(e<r.l){var t=r.l-e;r.l=e,r.w+=t}},f=function(e){var t=r.l+r.w;if(t<e){var n=e-t;r.w+=n}},d=function(e){if(e<r.t){var t=r.t-e;r.t=e,r.h+=t}},h=function(e){var t=r.t+r.h;if(t<e){var n=e-t;r.h+=n}},m=[-.3,.3],g=m[0],v=m[1],b=[1.4,1];if(t&&t.top){var y=(I=t.topSize)/b[0],w=[s+u/2,c-R-(E=I/b[1])/2],x=w[0],k=w[1],A=M.visuals.mkTxt(x,k,I,0,t.top,g,v);M.U.addClass(A,"cmp-lbl"),n.appendChild(A);var T=y*t.top.length;d(k-E/2),p(x-T/2),f(x+T/2)}if(t&&t.bot){y=(I=t.botSize)/b[0];var C=[s+u/2,c+l+R+(E=I/b[1])/2];x=C[0],k=C[1],A=M.visuals.mkTxt(x,k,I,0,t.bot,g,v);M.U.addClass(A,"cmp-lbl"),n.appendChild(A);T=y*t.bot.length;h(k+E/2),p(x-T/2),f(x+T/2)}if(t&&t.right){var E=(I=t.rightSize)/b[1],S=(T=(y=I/b[0])*t.right.length,[s+u+N+T/2,c+l/2]),_=(x=S[0],S[1]);A=M.visuals.mkTxt(x,_,I,0,t.right,g,v);M.U.addClass(A,"cmp-lbl"),n.appendChild(A),d(_-E/2),f(x+T/2),h(_+E/2)}if(t&&t.left){E=(I=t.leftSize)/b[1],T=(y=I/b[0])*t.left.length;var I,P=[s-D-T/2,c+l/2];x=P[0],_=P[1],A=M.visuals.mkTxt(x,_,I,0,t.left,g,v);M.U.addClass(A,"cmp-lbl"),n.appendChild(A),d(_-E/2),p(x-T/2),h(_+E/2)}var U={viewBox:r.l+" "+r.t+" "+r.w+" "+r.h,width:r.w*L,height:r.h*L,preserveAspectRatio:"xMidYMid"};M.svg.hydrate(n,U);var O=document.createElement("div");return O.appendChild(n),O}function x(e,t){var n,r=M.runtime.board;if("wire"==e)n=M.visuals.mkWirePart([0,0],t.wireClr||"red",t.crocClips);else{var i=e;if("string"==typeof i.builtIn)n=(0,r.builtinPartVisuals[i.builtIn])([0,0]);else n=M.visuals.mkGenericPartSVG(i)}return w(n,t)}function k(e,t,n){void 0===n&&(n=!1);var r={state:M.runtime.board,boardDef:e.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:e.allAlloc.requiresBreadboard,partDefs:e.cmpDefs,maxWidth:t+"px",fnArgs:e.fnArgs,wireframe:n,partsList:[]},i=new M.visuals.BoardHost(M.visuals.mkBoardView({visual:r.boardDef.visual,boardDef:r.boardDef,wireframe:r.wireframe}),r),o=i.getView();return M.U.addClass(o,"board-svg"),i}function A(){var e=document.createElement("div");return M.U.addClass(e,"instr-panel"),e}function T(i){var e,o=A(),t=w((e=i.boardDef,M.visuals.mkBoardView({visual:e.visual,boardDef:e}).getView()),{left:a(1),leftSize:r,cmpScale:m});o.appendChild(t);var n=w(new M.visuals.Breadboard({}).getSVGAndSize(),{left:a(1),leftSize:r,cmpScale:g});return o.appendChild(n),i.allCmps.forEach(function(e){var t=1;"buttonpair"===e.visual.builtIn&&(t=2);var n=x(e.visual,{left:a(t),leftSize:r,cmpScale:v});M.U.addClass(n,"partslist-cmp"),o.appendChild(n)}),i.allWireColors.forEach(function(e){var t=i.colorToWires[e].length,n=i.boardDef.pinStyles[e]||"female",r=x("wire",{left:a(t),leftSize:s,wireClr:e,cmpScale:b,crocClips:"croc"==n});M.U.addClass(r,"partslist-wire"),o.appendChild(r)}),o}function C(e,r){var t=A(),n=k(r,d,!0);!function(r,i,o){var e=r.getView();0<i&&M.U.addClass(e,"grayed");for(var t=function(n){var e=o.stepToCmps[n];e&&e.forEach(function(e){var t=r.addPart(e);n===i&&(e.breadboardConnections.forEach(function(e){return r.highlightBreadboardPin(e)}),M.U.addClass(t.element,"notgrayed"))});var t=o.stepToWires[n];t&&t.forEach(function(e){var t=r.addWire(e);t&&n===i&&("breadboard"==e.start.type?r.highlightBreadboardPin(e.start):r.highlightBoardPin(e.start.pin),"breadboard"==e.end.type?r.highlightBreadboardPin(e.end):r.highlightBoardPin(e.end.pin),r.highlightWire(t))})},n=0;n<=i;n++)t(n)}(n,e,r),t.appendChild(n.getView());var i=document.createElement("div");M.U.addClass(i,"panel-num-outer"),M.U.addClass(i,"noselect"),t.appendChild(i);var o=document.createElement("div");M.U.addClass(o,"panel-num"),o.textContent=e+1+"",i.appendChild(o);var a=document.createElement("div");M.U.addClass(a,"reqs-div"),t.appendChild(a);var s=r.stepToWires[e]||[],c=function(e){if("breadboard"===e.type){var t=e;return"("+t.row+","+t.col+")"}return e.pin};return s.forEach(function(e){var t=!1;"dalboard"==e.end.type&&(t="croc"==r.boardDef.pinStyles[e.end.pin]);var n=x("wire",{top:c(e.end),topSize:u,bot:c(e.start),botSize:u,wireClr:e.color,cmpHeight:l,crocClips:t});M.U.addClass(n,"cmp-div"),a.appendChild(n)}),(r.stepToCmps[e]||[]).forEach(function(o){("buttonpair"===o.visual.builtIn?[o.breadboardConnections[0],o.breadboardConnections[2]]:[o.breadboardConnections[0]]).forEach(function(e,t){var n;e?n="("+e.row+","+e.col+")":n="";var r=f;"buttonpair"===o.visual.builtIn&&(r*=.5);var i=x(o.visual,{top:n,topSize:u,cmpHeight:p,cmpScale:r});M.U.addClass(i,"cmp-div"),a.appendChild(i)})}),t}function E(e,t){t.boardDef.pinStyles||(t.boardDef.pinStyles={}),t.configData&&M.setConfigData(t.configData.cfg,t.configData.cfgKey);var n={type:"run",code:"",boardDefinition:t.boardDef,partDefinitions:t.partDefinitions};M.runtime=new M.Runtime(n),M.runtime.board=null,M.initCurrentRuntime(n);var r=document.createElement("style");r.textContent+=y,document.head.appendChild(r);var i=t.partDefinitions,o=new M.visuals.Breadboard({}),a=function(e){var t=M.allocateDefinitions(e),i=[],o=[],a=1;t.partsAndWires.forEach(function(e){var n=e.part,r=e.wires;e.assembly.forEach(function(e,t){e.part&&n&&(o[a+t]=[n]),e.wireIndices&&0<e.wireIndices.length&&r&&(i[a+t]=e.wireIndices.map(function(e){return r[e]}))}),a+=e.assembly.length});var n=a-1,r=t.partsAndWires.map(function(e){return e.part}).filter(function(e){return!!e}),s=t.partsAndWires.map(function(e){return e.wires||[]}).reduce(function(e,t){return e.concat(t)},[]),c={},u=[];return s.forEach(function(e){c[e.color]||(c[e.color]=[],u.push(e.color)),c[e.color].push(e)}),{boardDef:e.boardDef,cmpDefs:e.partDefs,fnArgs:e.fnArgs,allAlloc:t,stepToWires:i,stepToCmps:o,allWires:s,allCmps:r,lastStep:n,colorToWires:c,allWireColors:u}}({boardDef:t.boardDef,partDefs:i,partsList:t.parts,fnArgs:t.fnArgs,getBBCoord:o.getCoord.bind(o)});a.allAlloc.requiresBreadboard=!0;s=a,c=document.getElementById("front-panel"),(u=k(s,h,!1)).addAll(s.allAlloc),c.appendChild(u.getView());var s,c,u,l=T(a);e.appendChild(l);for(var p=0;p<=a.lastStep;p++){var f=C(p,a);e.appendChild(f)}t.print&&M.print(2e3)}e.renderParts=E,e.renderInstructions=function(e){document.getElementById("proj-title").innerText=e.options.name||"",E(document.body,e.options)}}(M.instructions||(M.instructions={}))}(pxsim||(pxsim={})),function(o){function a(e,t){if(void 0===t&&(t="sim: check failed"),!e)throw new Error(t)}o.quiet=!1,o.check=a,o.title="";var n={},r={};o.getConfig=function(e){return r.hasOwnProperty(e+"")?r[e+""]:null},o.getConfigKey=function(e){return n.hasOwnProperty(e)?n[e]:null},o.getAllConfigKeys=function(){return Object.keys(n)},o.setConfigKey=function(e,t){n[e]=t},o.setConfig=function(e,t){r[e]=t},o.setConfigData=function(e,t){r=e,n=t},o.getConfigData=function(){return{cfg:r,cfgKey:n}},o.setTitle=function(e){o.title=e};var i=function(){function e(){o.runtime?this.id=o.runtime.registerLiveObject(this):this.id=0}return e.prototype.destroy=function(){},e.prototype.scan=function(e){throw o.U.userError("scan not implemented")},e.prototype.gcKey=function(){throw o.U.userError("gcKey not implemented")},e.prototype.gcSize=function(){throw o.U.userError("gcSize not implemented")},e.prototype.gcIsStatic=function(){return!1},e.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefObject id:"+this.id)},e.prototype.toDebugString=function(){return"(object)"},e.toAny=function(e){return e&&e.toAny?e.toAny():e},e.toDebugString=function(e){return null===e?"null":void 0===e?"undefined;":e.vtable&&e.vtable.name?e.vtable.name:e.toDebugString?e.toDebugString():"string"==typeof e?JSON.stringify(e):e.toString()},e}();o.RefObject=i;var s=function(e,t,n){this.func=e,this.caps=t,this.args=n};o.FnWrapper=s;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields={},e}return __extends(e,t),e.prototype.scan=function(e){for(var t=0,n=Object.keys(this.fields);t<n.length;t++){var r=n[t];e(r,this.fields[r])}},e.prototype.gcKey=function(){return this.vtable.name},e.prototype.gcSize=function(){return this.vtable.numFields+1},e.prototype.destroy=function(){this.fields=null,this.vtable=null},e.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefRecord id:"+this.id+" ("+this.vtable.name+")")},e}(i);o.RefRecord=c;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields=[],e}return __extends(e,t),e.prototype.scan=function(e){for(var t=0;t<this.fields.length;++t)e("_cap"+t,this.fields[t])},e.prototype.gcKey=function(){return o.functionName(this.func)},e.prototype.gcSize=function(){return this.fields.length+3},e.prototype.isRef=function(e){return a(0<=e&&e<this.fields.length),e<this.len},e.prototype.ldclo=function(e){return a(0<=(e>>=2)&&e<this.fields.length),this.fields[e]},e.prototype.destroy=function(){this.fields=null,this.func=null},e.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefAction id:"+this.id+" len:"+this.fields.length)},e}(i);o.RefAction=u,function(e){e.seedAddRandom=function(e){},e.mkAction=function(e,t){var n=new u;n.len=e,n.func=t;for(var r=0;r<e;++r)n.fields.push(null);return n},e.runAction=function(e,t){var n=o.getResume();n(e instanceof u?new s(e.func,e.fields,t):new s(e,null,t))};var v={};e.dumpPerfCounters=function(){if(o.runtime&&o.runtime.perfCounters){for(var e="calls,us,name\n",t=0,n=o.runtime.perfCounters;t<n.length;t++){var r=n[t];r.lastFew.sort();var i=r.lastFew[r.lastFew.length>>1];e+=r.numstops+","+r.value+","+r.name+","+i+"\n"}!function(e){for(var t,n,r="",i=function(e,t){r+=e.length>=t?e:("              "+e).slice(-t)},o=function(e){return i(""+Math.round(e),6)},a=function(e,t){i(Math.round(t)+"",8),r+=" /",o(e),r+=" =",o(t/e)},s=0,c=e.split(/\n/);s<c.length;s++){var u=c[s];if(u&&/^\d/.test(u)){var l=u.split(/,/),p=v[l[2]];p||(v[l[2]]=p={stops:0,us:0,meds:[]}),t=l[2],n=25,r+=t.length>=n?t:(t+"                         ").slice(0,n);var f=parseInt(l[0]),d=parseInt(l[1]);a(f,d),r+=" |",a(f-p.stops,d-p.us),r+=" ~";var h=parseInt(l[3]);o(h),10<p.meds.length&&p.meds.shift(),p.meds.push(h);var m=p.meds.slice();m.sort(function(e,t){return e-t});var g=m[m.length>>1];r+=" ~~",o(g),p.stops=f,p.us=d,r+="\n"}}console.log(r)}(e)}}}(o.pxtcore||(o.pxtcore={}));var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.v=void 0,e}return __extends(e,t),e.prototype.scan=function(e){e("*",this.v)},e.prototype.gcKey=function(){return"LOC"},e.prototype.gcSize=function(){return 2},e.prototype.destroy=function(){},e.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefRefLocal id:"+this.id+" v:"+this.v)},e}(i);o.RefRefLocal=e;var t,l,p,f,d,h,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vtable=o.mkMapVTable(),e.data=[],e}return __extends(e,t),e.prototype.scan=function(e){for(var t=0,n=this.data;t<n.length;t++){var r=n[t];e(r.key,r.val)}},e.prototype.gcKey=function(){return"{...}"},e.prototype.gcSize=function(){return 2*this.data.length+4},e.prototype.findIdx=function(e){e+="";for(var t=0;t<this.data.length;++t)if(this.data[t].key==e)return t;return-1},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.data.length;++e)this.data[e].val=0;this.data=[]},e.prototype.print=function(){o.runtime&&o.runtime.refCountingDebug&&console.log("RefMap id:"+this.id+" size:"+this.data.length)},e.prototype.toAny=function(){var t={};return this.data.forEach(function(e){t[e.key]=i.toAny(e.val)}),t},e}(i);function g(){o.runtime&&o.runtime.dumpLivePointers()}o.RefMap=m,o.dumpLivePointers=g,(t=o.numops||(o.numops={})).toString=function(e){return null===e?"null":void 0===e?"undefined":e.toString()},t.toBoolDecr=function(e){return!!e},t.toBool=function(e){return!!e},(l=o.langsupp||(o.langsupp={})).toInt=function(e){return 0|e},l.toFloat=function(e){return e},l.ignore=function(e){return e},(p=o.pxtcore||(o.pxtcore={})).ptrOfLiteral=function(e){return e},p.debugMemLeaks=function(){g()},p.templateHash=function(){return 0},p.programHash=function(){return 0},p.programName=function(){return o.title},p.programSize=function(){return 0},p.afterProgramPage=function(){return 0},p.getConfig=function(e,t){var n=o.getConfig(e);return null==n?t:n},p.toInt=function(e){return e>>0},p.toUInt=function(e){return e>>>0},p.toDouble=function(e){return e},p.toFloat=function(e){return e},p.fromInt=function(e){return e},p.fromUInt=function(e){return e},p.fromDouble=function(e){return e},p.fromFloat=function(e){return e},p.fromBool=function(e){return!!e},function(r){function n(e,t){if(t+="",e instanceof c)return e.fields[t];var n=e.findIdx(t);return n<0?void 0:e.data[n].val}function i(e,t,n){if(t+="",e instanceof c){e.fields[t]=n}else{var r=e.findIdx(t);r<0?e.data.push({key:t,val:n}):e.data[r].val=n}}r.toInt8=function(e){return(255&e)<<24>>24},r.toInt16=function(e){return(65535&e)<<16>>16},r.toInt32=function(e){return 0|e},r.toUInt32=function(e){return e>>>0},r.toUInt8=function(e){return 255&e},r.toUInt16=function(e){return 65535&e},r.nullFix=function(e){return null==e||!1===e?0:!0===e?1:e},r.nullCheck=function(e){null==e&&o.U.userError("Dereferencing null/undefined value.")},r.panic=function(e){o.U.userError("PANIC! Code "+e)},r.stringToBool=function(e){return e?1:0},r.ptrToBool=function(e){return e?1:0},r.emptyToNull=function(e){return""==e?0:e},r.ldlocRef=function(e){return e.v},r.stlocRef=function(e,t){e.v=t},r.mklocRef=function(){return new e},r.stclo=function(e,t,n){return a(0<=t&&t<e.fields.length),a(null===e.fields[t]),e.fields[t]=n,e},r.runtimeWarning=function(e){o.Runtime.postMessage(o.getWarningMessage(e))},r.mkMap=function(){return new m},r.mapGet=function(e,t){return n(e,r.mapKeyNames[t])},r.mapSet=function(e,t,n){return i(e,r.mapKeyNames[t],n)},r.mapGetByString=n,r.mapDeleteByString=function(e,t){e instanceof m||r.panic(923);var n=e.findIdx(t);return 0<=n&&e.data.splice(n,1),!0},r.mapSetGeneric=i,r.mapGetGeneric=n,r.mapSetByString=i,r.keysOf=function(e){var t=new o.RefCollection;if(e instanceof m)for(var n=0,r=e.data;n<r.length;n++){var i=r[n];t.push(i.key)}return t}}(f=o.pxtrt||(o.pxtrt={})),(d=o.pxtcore||(o.pxtcore={})).mkClassInstance=function(e){a(!!e.methods);var t=new c;return t.vtable=e,t},d.switch_eq=function(e,t){return e==t},d.typeOf=function(e){return typeof e},(h=o.thread||(o.thread={})).panic=f.panic,h.pause=function(e){var t=o.getResume();o.runtime.schedule(function(){t()},e)},h.runInBackground=function(e){o.runtime.runFiberAsync(e).done()},h.forever=function(t){f.nullCheck(t),function e(){o.runtime.runFiberAsync(t).then(function(){return Promise.delay(20)}).then(e).done()}()}}(pxsim||(pxsim={})),function(f){var r,e,t,n,i,o=function(t){function e(){var e=t.call(this)||this;return e.data=[],e}return __extends(e,t),e.prototype.scan=function(e){for(var t=0;t<this.data.length;++t)e("["+t+"]",this.data[t])},e.prototype.gcKey=function(){return"[...]"},e.prototype.gcSize=function(){return this.data.length+2},e.prototype.toArray=function(){return this.data.slice(0)},e.prototype.toAny=function(){return this.data.map(function(e){return f.RefObject.toAny(e)})},e.prototype.toDebugString=function(){for(var e="[",t=0;t<this.data.length;++t){0<t&&(e+=",");var n=f.RefObject.toDebugString(this.data[t]);if(100<e.length+n.length){0==t&&(e+=n.substr(0,100)),e+="...";break}e+=n}return e+="]"},e.prototype.destroy=function(){for(var e=this.data,t=0;t<e.length;++t)e[t]=0;this.data=[]},e.prototype.isValidIndex=function(e){return 0<=e&&e<this.data.length},e.prototype.push=function(e){this.data.push(e)},e.prototype.pop=function(){return this.data.pop()},e.prototype.getLength=function(){return this.data.length},e.prototype.setLength=function(e){this.data.length=e},e.prototype.getAt=function(e){return this.data[e]},e.prototype.setAt=function(e,t){this.data[e]=t},e.prototype.insertAt=function(e,t){this.data.splice(e,0,t)},e.prototype.removeAt=function(e){return this.data.splice(e,1)[0]},e.prototype.indexOf=function(e,t){return this.data.indexOf(e,t)},e.prototype.print=function(){},e}(f.RefObject);f.RefCollection=o,function(e){function r(e,t){if(f.pxtrt.nullCheck(e),e.isValidIndex(t))return e.removeAt(t)}function i(e,t,n){return f.pxtrt.nullCheck(e),e.indexOf(t,n)}e.mk=function(){return new o},e.isArray=function(e){return e instanceof o},e.length=function(e){return f.pxtrt.nullCheck(e),e.getLength()},e.setLength=function(e,t){f.pxtrt.nullCheck(e),e.setLength(t)},e.push=function(e,t){f.pxtrt.nullCheck(e),e.push(t)},e.pop=function(e,t){return f.pxtrt.nullCheck(e),e.pop()},e.getAt=function(e,t){return f.pxtrt.nullCheck(e),e.getAt(t)},e.removeAt=r,e.insertAt=function(e,t,n){f.pxtrt.nullCheck(e),e.insertAt(t,n)},e.setAt=function(e,t,n){f.pxtrt.nullCheck(e),e.setAt(t,n)},e.indexOf=i,e.removeElement=function(e,t){f.pxtrt.nullCheck(e);var n=i(e,t,0);return 0<=n?(r(e,n),1):0}}(f.Array_||(f.Array_={})),(e=r=f.Math_||(f.Math_={})).imul=Math.imul||function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0},e.idiv=function(e,t){return(0|e)/(0|t)|0},e.round=function(e){return Math.round(e)},e.roundWithPrecision=function(e,t){if((t|=0)<=0)return Math.round(e);if(0==e)return 0;for(var n=0;0==n&&t<21;){var r=Math.pow(10,t++);n=Math.round(e*r+Number.EPSILON)/r}return n},e.ceil=function(e){return Math.ceil(e)},e.floor=function(e){return Math.floor(e)},e.sqrt=function(e){return Math.sqrt(e)},e.pow=function(e,t){return Math.pow(e,t)},e.clz32=function(e){return Math.clz32(e)},e.log=function(e){return Math.log(e)},e.log10=function(e){return Math.log10(e)},e.log2=function(e){return Math.log2(e)},e.exp=function(e){return Math.exp(e)},e.sin=function(e){return Math.sin(e)},e.sinh=function(e){return Math.sinh(e)},e.cos=function(e){return Math.cos(e)},e.cosh=function(e){return Math.cosh(e)},e.tan=function(e){return Math.tan(e)},e.tanh=function(e){return Math.tanh(e)},e.asin=function(e){return Math.asin(e)},e.asinh=function(e){return Math.asinh(e)},e.acos=function(e){return Math.acos(e)},e.acosh=function(e){return Math.acosh(e)},e.atan=function(e){return Math.atan(e)},e.atanh=function(e){return Math.atanh(e)},e.atan2=function(e,t){return Math.atan2(e,t)},e.trunc=function(e){return 0<e?Math.floor(e):Math.ceil(e)},e.random=function(){return Math.random()},e.randomRange=function(e,t){if(e==t)return e;if(t<e){var n=e;e=t,t=n}return Math.floor(e)==e&&Math.floor(t)==t?e+Math.floor(Math.random()*(t-e+1)):e+Math.random()*(t-e)},function(e){function n(e,t){return f.pxtrt.nullFix(e)==f.pxtrt.nullFix(t)}e.lt=function(e,t){return e<t},e.le=function(e,t){return e<=t},e.neq=function(e,t){return!n(e,t)},e.eq=n,e.eqDecr=function(e,t){return f.pxtrt.nullFix(e)==f.pxtrt.nullFix(t)},e.gt=function(e,t){return t<e},e.ge=function(e,t){return t<=e},e.div=function(e,t){return 0|Math.floor(e/t)},e.mod=function(e,t){return e%t},e.bnot=function(e){return~e},e.toString=function(e){return e+""}}(f.Number_||(f.Number_={})),(t=f.thumb||(f.thumb={})).adds=function(e,t){return e+t|0},t.subs=function(e,t){return e-t|0},t.divs=function(e,t){return 0|Math.floor(e/t)},t.muls=function(e,t){return r.imul(e,t)},t.ands=function(e,t){return e&t},t.orrs=function(e,t){return e|t},t.eors=function(e,t){return e^t},t.lsls=function(e,t){return e<<t},t.lsrs=function(e,t){return e>>>t},t.asrs=function(e,t){return e>>t},t.bnot=function(e){return~e},t.ignore=function(e){return e},function(e){function n(e){return e<<16>>16}e.adds=function(e,t){return n(e+t)},e.subs=function(e,t){return n(e-t)},e.divs=function(e,t){return n(Math.floor(e/t))},e.muls=function(e,t){return n(r.imul(e,t))},e.ands=function(e,t){return n(e&t)},e.orrs=function(e,t){return n(e|t)},e.eors=function(e,t){return n(e^t)},e.lsls=function(e,t){return n(e<<t)},e.lsrs=function(e,t){return(65535&e)>>>t},e.asrs=function(e,t){return n(e>>t)},e.bnot=function(e){return~e},e.ignore=function(e){return e}}(f.avr||(f.avr={})),(n=f.String_||(f.String_={})).stringConv=function(e){var t=f.getResume();e instanceof f.RefRecord&&e.vtable.toStringMethod?f.runtime.runFiberAsync(e.vtable.toStringMethod,e).done(function(){t(f.runtime.currFrame.retval+"")}):t(e+"")},n.mkEmpty=function(){return""},n.fromCharCode=function(e){return String.fromCharCode(e)},n.toNumber=function(e){return parseFloat(e)},n.concat=function(e,t){return e+t},n.substring=function(e,t,n){return f.pxtrt.nullCheck(e),e.slice(t,t+n)},n.equals=function(e,t){return e==t},n.compare=function(e,t){return e==t?0:e<t?-1:1},n.compareDecr=function(e,t){return e==t?0:e<t?-1:1},n.length=function(e){return e.length},n.substr=function(e,t,n){return e.substr(t,n)},n.charAt=function(e,t){return e.charAt(t)},n.charCodeAt=function(e,t){return f.pxtrt.nullCheck(e),n=e,r=t,f.pxtrt.nullCheck(n),0<=r&&r<n.length?e.charCodeAt(t):0;var n,r},n.indexOf=function(e,t,n){return f.pxtrt.nullCheck(e),null==t?-1:e.indexOf(t,n)},n.lastIndexOf=function(e,t,n){return f.pxtrt.nullCheck(e),null==t?-1:e.lastIndexOf(t,n)},n.includes=function(e,t,n){return f.pxtrt.nullCheck(e),null!=t&&e.includes(t,n)},(i=f.Boolean_||(f.Boolean_={})).toString=function(e){return e?"true":"false"},i.bang=function(e){return!e};var a,d=function(n){function e(e){var t=n.call(this)||this;return t.data=e,t.isStatic=!1,t}return __extends(e,n),e.prototype.scan=function(e){},e.prototype.gcKey=function(){return"Buffer"},e.prototype.gcSize=function(){return 2+(this.data.length+3>>2)},e.prototype.gcIsStatic=function(){return this.isStatic},e.prototype.print=function(){},e.prototype.toDebugString=function(){return a.toHex(this)},e}(f.RefObject);f.RefBuffer=d,function(e){var i,t;function u(e){var t=function(e){switch(e){case i.Int8LE:return-1;case i.UInt8LE:return 1;case i.Int16LE:return-2;case i.UInt16LE:return 2;case i.Int32LE:return-4;case i.UInt32LE:return 4;case i.Int8BE:return-10;case i.UInt8BE:return 10;case i.Int16BE:return-20;case i.UInt16BE:return 20;case i.Int32BE:return-40;case i.UInt32BE:return 40;case i.Float32LE:return 4;case i.Float32BE:return 40;case i.Float64LE:return 8;case i.Float64BE:return 80;default:throw f.U.userError("bad format")}}(e),n=!1;t<0&&(n=!0,t=-t);var r=!1;return 10<=t&&(r=!0,t/=10),{size:t,signed:n,swap:r,isFloat:e>=i.Float32LE}}function r(e){return new d(new Uint8Array(e))}function o(e,t){return f.pxtrt.nullCheck(e),0<=t&&t<e.data.length}function n(e,t){return o(e,t)?e.data[t]:0}function l(e){e.isStatic&&f.U.userError("Writing to read only buffer.")}function a(e,t,n){o(e,t)&&(l(e),e.data[t]=n)}function s(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=-1),n<0||n>e.data.length||(r<0&&(r=e.data.length),r=Math.min(r,e.data.length-n),l(e),e.data.fill(t,n,n+r))}function c(e,t,n,r,i){if(n.buffer===e.buffer)c(e,t,n.slice(r,r+i),0,i);else for(var o=0;o<i;++o)e[t+o]=n[r+o]}(t=i=e.NumberFormat||(e.NumberFormat={}))[t.Int8LE=1]="Int8LE",t[t.UInt8LE=2]="UInt8LE",t[t.Int16LE=3]="Int16LE",t[t.UInt16LE=4]="UInt16LE",t[t.Int32LE=5]="Int32LE",t[t.Int8BE=6]="Int8BE",t[t.UInt8BE=7]="UInt8BE",t[t.Int16BE=8]="Int16BE",t[t.UInt16BE=9]="UInt16BE",t[t.Int32BE=10]="Int32BE",t[t.UInt32LE=11]="UInt32LE",t[t.UInt32BE=12]="UInt32BE",t[t.Float32LE=13]="Float32LE",t[t.Float64LE=14]="Float64LE",t[t.Float32BE=15]="Float32BE",t[t.Float64BE=16]="Float64BE",e.getNumber=function(e,t,n){var r=u(t);if(r.isFloat){var i=e.data.buffer.slice(n,n+r.size);return r.swap&&new Uint8Array(i).reverse(),4==r.size?new Float32Array(i)[0]:new Float64Array(i)[0]}for(var o=0,a=0;a<r.size;++a){o<<=8;var s=r.swap?n+a:n+r.size-a-1;o|=e.data[s]}if(r.signed){var c=32-8*r.size;o=o<<c>>c}else o>>>=0;return o},e.setNumber=function(e,t,n,r){var i=u(t);if(i.isFloat){var o=new Uint8Array(i.size);4==i.size?new Float32Array(o.buffer)[0]=r:new Float64Array(o.buffer)[0]=r,i.swap&&o.reverse();for(var a=0;a<i.size;++a)e.data[n+a]=o[a]}else for(a=0;a<i.size;++a){var s=i.swap?n+i.size-a-1:n+a;e.data[s]=255&r,r>>=8}},e.createBuffer=r,e.createBufferFromHex=function(e){for(var t=r(e.length>>1),n=0;n<e.length;n+=2)t.data[n>>1]=parseInt(e.slice(n,n+2),16);return t.isStatic=!0,t},e.isReadOnly=function(e){return e.isStatic},e.getBytes=function(e){return e.data},e.getUint8=function(e,t){return n(e,t)},e.getByte=n,e.setUint8=function(e,t,n){a(e,t,n)},e.setByte=a,e.length=function(e){return e.data.length},e.fill=s,e.slice=function(e,t,n){return t=Math.min(e.data.length,t),n<0&&(n=e.data.length),n=Math.min(n,e.data.length-t),new d(e.data.slice(t,t+n))},e.toHex=function(e){for(var t="0123456789abcdef",n="",r=0;r<e.data.length;++r)n+=t[e.data[r]>>4],n+=t[15&e.data[r]];return n},e.toString=function(e){return f.U.fromUTF8(f.U.uint8ArrayToString(e.data))};var p=-2147483648;e.shift=function(e,t,n,r){r<0&&(r=e.data.length-n),n<0||n+r>e.data.length||n+r<n||0==r||0==t||t==p||0!=r&&0!=t&&t!=p&&(t<=-r||r<=t?s(e,0):(l(e),t<0?(t=-t,c(e.data,n+t,e.data,n,r-t),e.data.fill(0,n,n+t)):(r-=t,c(e.data,n,e.data,n+t,r),e.data.fill(0,n+r,n+r+t))))},e.rotate=function(e,t,n,r){if(r<0&&(r=e.data.length-n),!(n<0||n+r>e.data.length||n+r<n||0==r||0==t||t==p)){l(e),t<0&&(t+=r<<8),(t%=r)<0&&(t+=r);for(var i=e.data,o=t,a=0,s=o,c=r;a!=s;){var u=i[a+n];i[a+++n]=i[s+n],i[s+++n]=u,s==c?s=o:a==o&&(o=s)}}},e.write=function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=-1),i<0&&(i=n.data.length),r<0||t<0||t>e.data.length||(i=Math.min(n.data.length-r,e.data.length-t))<0||(l(e),c(e.data,t,n.data,r,i))}}(a=f.BufferMethods||(f.BufferMethods={}))}(pxsim||(pxsim={})),function(t){(t.control||(t.control={})).createBufferFromUTF8=function(e){return new t.RefBuffer(t.U.stringToUint8Array(t.U.toUTF8(e)))}}(pxsim||(pxsim={})),function(e){!function(e){var i={};e.setLocalizedStrings=function(e){i=e||{}};var o=!0;function a(e,l){return 0==l.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){var r=l[parseInt(t)],i="",o=/^:f(\d*)\.(\d+)/.exec(n);if(o){var a=parseInt(o[2]),s=parseInt(o[1])||0,c=/^0/.test(o[1])?"0":" ",u=r.toFixed(a);if(0<s&&0<a&&(s+=a+1),0<s)for(;u.length<s;)u=c+u;i=u}else i=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(i.toLowerCase())?i="an "+i:/^\s*[bcdfgjklmnpqrstvwxz]/.test(i.toLowerCase())&&(i="a "+i):":s"==n?i=1==r?"":"s":":q"==n?i=p(i):":jq"==n?i=f(i):":uri"==n?i=encodeURIComponent(i).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?i=encodeURI(i).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(i=(100*r).toFixed(1).toString()+"%"),i})}function p(e){return e?e.replace(/([^\w .!?\-$])/g,function(e){return"&#"+e.charCodeAt(0)+";"}):e}function f(e){return e.replace(/[^\w .!?\-$]/g,function(e){var t=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-t.length)+t})}e.lf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=i[e]||e;return!o&&r!=e&&/\d:s\}/.test(r)&&(r=r.replace(/\{\d+:s\}/g,"")),a(r=r.replace(/^\{(id|loc):[^\}]+\}/g,""),t)},e.fmt_va=a,e.htmlEscape=p,e.jsStringQuote=f}(e.localization||(e.localization={}))}(pxsim||(pxsim={})),function(pxsim){var MIN_MESSAGE_WAIT_MS=200,tracePauseMs=0,U;!function(e){function n(e){return e.split(/\s+/).filter(function(e){return!!e})}function t(e){for(;e.firstChild;)e.removeChild(e.firstChild)}var r;e.containsClass=function(t,e){return n(e).every(function(e){return function(e,t){if(e.classList)return e.classList.contains(t);var n=(e.className+"").split(/\s+/);return!(n.indexOf(t)<0)}(t,e)})},e.addClass=function(t,e){n(e).forEach(function(e){return function(e,t){if(e.classList)e.classList.add(t);else{var n=(e.className+"").split(/\s+/);n.indexOf(t)<0&&(e.className.baseVal+=" "+t)}}(t,e)})},e.removeClass=function(r,e){n(e).forEach(function(e){return n=e,void((t=r).classList?t.classList.remove(n):t.className.baseVal=(t.className+"").split(/\s+/).filter(function(e){return e!=n}).join(" "));var t,n})},e.remove=function(e){e.parentElement.removeChild(e)},e.removeChildren=t,e.clear=function(e){t(e)},e.assert=function(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)},e.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},e.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t},e.now=function(){return Date.now()},e.perfNowUs=function(){return r||(r="undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now),1e3*r()},e.nextTick=function(e){Promise._async._schedule(e)},e.stringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n},e.uint8ArrayToString=function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n},e.fromUTF8=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e.charCodeAt(n);t+=37==r||127<r?"%"+r.toString(16):e.charAt(n)}return decodeURIComponent(t)},e.toUTF8=function(e,t){var n="";if(!e)return n;for(var r=0;r<e.length;++r){var i=e.charCodeAt(r);if(i<=127)n+=e.charAt(r);else if(i<=2047)n+=String.fromCharCode(192|i>>6,128|63&i);else{if(!t&&55296<=i&&i<=56319){var o=e.charCodeAt(++r);isNaN(o)||(i=65536+(i-55296<<10)+(o-56320))}n+=i<=65535?String.fromCharCode(224|i>>12,128|i>>6&63,128|63&i):String.fromCharCode(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}}return n},e.isLocalHost=function(){try{return"undefined"!=typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)}catch(e){return!1}}}(U=pxsim.U||(pxsim.U={}));var BreakLoopException=function(){},pxtcore;function getResume(){return pxsim.runtime.getResume()}pxsim.BreakLoopException=BreakLoopException,function(e){function t(e){var t=pxsim.runtime.currTryFrame();t||U.userError("unhandled exception: "+e);var n=t.handlerFrame;throw(pxsim.runtime.currFrame=n).pc=t.handlerPC,n.tryFrame=t.parent,n.thrownValue=e,n.hasThrownValue=!0,new BreakLoopException}e.beginTry=function(e){pxsim.runtime.currFrame.tryFrame={parent:pxsim.runtime.currTryFrame(),handlerPC:e,handlerFrame:pxsim.runtime.currFrame}},e.endTry=function(){var e=pxsim.runtime.currFrame;e.tryFrame=e.tryFrame.parent},e.throwValue=t,e.getThrownValue=function(){var e=pxsim.runtime.currFrame;return U.assert(e.hasThrownValue),e.hasThrownValue=!1,e.thrownValue},e.endFinally=function(){var e=pxsim.runtime.currFrame;e.hasThrownValue&&(e.hasThrownValue=!1,t(e.thrownValue))}}(pxtcore=pxsim.pxtcore||(pxsim.pxtcore={})),pxsim.getResume=getResume;var SERIAL_BUFFER_LENGTH=16,BaseBoard=function(){function e(){var t=this;this.messageListeners=[],this.serialOutBuffer="",this.messages=[],this.lastSerialTime=0,this.debouncedPostAll=function(){var e=Date.now();e-t.lastSerialTime>MIN_MESSAGE_WAIT_MS?(clearTimeout(t.serialTimeout),t.messages.length&&(Runtime.postMessage({type:"bulkserial",data:t.messages,id:pxsim.runtime.id,sim:!0}),t.messages=[],t.lastSerialTime=e)):t.serialTimeout=setTimeout(t.debouncedPostAll,50)},this.id="b"+Math.round(2147483647*Math.random()),this.bus=new pxsim.EventBus(pxsim.runtime)}return e.prototype.updateView=function(){},e.prototype.receiveMessage=function(e){this.dispatchMessage(e)},e.prototype.dispatchMessage=function(e){for(var t=0,n=this.messageListeners;t<n.length;t++){(0,n[t])(e)}},e.prototype.addMessageListener=function(e){this.messageListeners.push(e)},Object.defineProperty(e.prototype,"storedState",{get:function(){return this.runOptions?(this.runOptions.storedState||(this.runOptions.storedState={}),this.runOptions.storedState):{}},enumerable:!0,configurable:!0}),e.prototype.initAsync=function(e){return this.runOptions=e,Promise.resolve()},e.prototype.setStoredState=function(e,t){null==t?delete this.storedState[e]:this.storedState[e]=t,Runtime.postMessage({type:"simulator",command:"setstate",stateKey:e,stateValue:t})},e.prototype.onDebuggerResume=function(){},e.prototype.screenshotAsync=function(e){return Promise.resolve(void 0)},e.prototype.kill=function(){},e.prototype.writeSerial=function(e){this.serialOutBuffer+=e,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(this.messages.push({time:Date.now(),data:this.serialOutBuffer}),this.debouncedPostAll(),this.serialOutBuffer="")},e}();pxsim.BaseBoard=BaseBoard;var CoreBoard=function(t){function e(){var e=t.call(this)||this;return e.updateSubscribers=[],e.updateView=function(){e.updateSubscribers.forEach(function(e){return e()})},e.builtinParts={},e.builtinVisuals={},e.builtinPartVisuals={},e}return __extends(e,t),e.prototype.kill=function(){t.prototype.kill.call(this),pxsim.AudioContextManager.stopAll()},e}(BaseBoard);pxsim.CoreBoard=CoreBoard;var BareBoard=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(BaseBoard),LogType,vVb;function initBareRuntime(){pxsim.runtime.board=new BareBoard;var e=pxsim;e.basic={pause:pxsim.thread.pause,showNumber:function(e){var t=getResume();console.log("SHOW NUMBER:",e),U.nextTick(t)}},e.serial={writeString:function(e){return pxsim.runtime.board.writeSerial(e)}},e.pins={createBuffer:pxsim.BufferMethods.createBuffer},e.control={inBackground:pxsim.thread.runInBackground,createBuffer:pxsim.BufferMethods.createBuffer,dmesg:function(e){return console.log("DMESG: "+e)},__log:function(e,t){return console.log("LOG: "+t.trim())}}}pxsim.initBareRuntime=initBareRuntime,vVb=LogType||(LogType={}),vVb[vVb.UserSet=0]="UserSet",vVb[vVb.BackAdd=1]="BackAdd",vVb[vVb.BackRemove=2]="BackRemove";var EventQueue=function(){function e(e,t){this.runtime=e,this.valueToArgs=t,this.max=5,this.events=[],this.awaiters=[],this._handlers=[],this._addRemoveLog=[]}return e.prototype.push=function(e,t){if(0<this.awaiters.length)if(t){var n=this.awaiters.shift();n&&n()}else{var r=this.awaiters.slice();this.awaiters=[],r.forEach(function(e){return e()})}return 0==this.handlers.length||this.events.length>this.max?Promise.resolve():(this.events.push(e),this.lock?Promise.resolve():this.poke())},e.prototype.poke=function(){var r=this;this.lock=!0;var e=this.events;return this.events=[],Promise.each(e,function(n){return Promise.each(r.handlers,function(e){var t;return(t=r.runtime).runFiberAsync.apply(t,__spreadArrays([e],r.valueToArgs?r.valueToArgs(n):[n]))})}).then(function(){return 0<r.events.length?r.poke():(r.lock=!1,r._addRemoveLog.forEach(function(e){e.log===LogType.BackAdd?r.addHandler(e.act):e.log===LogType.BackRemove?r.removeHandler(e.act):r.setHandler(e.act)}),r._addRemoveLog=[],Promise.resolve())})},Object.defineProperty(e.prototype,"handlers",{get:function(){return this._handlers},enumerable:!0,configurable:!0}),e.prototype.setHandler=function(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.UserSet}):this._handlers=[e]},e.prototype.addHandler=function(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.BackAdd}):-1==this._handlers.indexOf(e)&&this._handlers.push(e)},e.prototype.removeHandler=function(e){if(this.lock)this._addRemoveLog.push({act:e,log:LogType.BackRemove});else{var t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}},e.prototype.addAwaiter=function(e){this.awaiters.push(e)},e}();function bind(e){var i=e.arg0,o=e.fn;return function(e){for(var t=0;e.hasOwnProperty("arg"+t);)t++;for(var n=e,r=t;0<r;r--)n["arg"+r]=n["arg"+(r-1)];return e.arg0=i,o(e)}}function _leave(e,t){return e.parent.retval=t,e.parent}function syntheticRefAction(t){return pxtcore.mkAction(0,function(e){return _leave(e,t(e))})}pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0,pxsim.syntheticRefAction=syntheticRefAction;var TimeoutScheduled=function(e,t,n,r){this.id=e,this.fn=t,this.totalRuntime=n,this.timestampCall=r};pxsim.TimeoutScheduled=TimeoutScheduled;var PausedTimeout=function(e,t){this.fn=e,this.timeRemaining=t};function mkVTable(e){return{name:e.name,numFields:e.numFields,classNo:e.classNo,methods:e.methods,iface:e.iface,lastSubtypeNo:e.lastSubtypeNo,toStringMethod:e.toStringMethod,maxBgInstances:e.maxBgInstances}}pxsim.PausedTimeout=PausedTimeout,pxsim.mkVTable=mkVTable;var mapVTable=null;function mkMapVTable(){return mapVTable||(mapVTable=mkVTable({name:"_Map",numFields:0,classNo:0,lastSubtypeNo:0,methods:null})),mapVTable}function functionName(e){var t=e.info;return t?t.functionName+" ("+t.fileName+":"+(t.line+1)+":"+(t.column+1)+")":"()"}pxsim.mkMapVTable=mkMapVTable,pxsim.functionName=functionName;var Runtime=function(){function Runtime(msg){var _this=this;this.numGlobals=1e3,this.dead=!1,this.running=!1,this.idleTimer=void 0,this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0,this.startTime=0,this.startTimeUs=0,this.pausedTime=0,this.lastPauseTimestamp=0,this.globals={},this.environmentGlobals={},this.otherFrames=[],this.loopLock=null,this.loopLockWaitList=[],this.heapSnapshots=[],this.timeoutsScheduled=[],this.timeoutsPausedOnBreakpoint=[],this.pausedOnBreakpoint=!1,this.perfOffset=0,this.perfElapsed=0,this.perfStack=0,this.refCountingDebug=!1,this.refObjId=1,this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;var threadId=0,breakpoints=null,currResume,dbgHeap,dbgResume,breakFrame=null,lastYield=Date.now(),userGlobals,__this=this,evalIface={runtime:this,oops:oops,doNothing:doNothing,pxsim:pxsim,globals:this.globals,setupYield:setupYield,maybeYield:maybeYield,setupDebugger:setupDebugger,isBreakFrame:isBreakFrame,breakpoint:breakpoint,trace:trace,checkStack:checkStack,leave:_leave,checkResumeConsumed:checkResumeConsumed,setupResume:setupResume,setupLambda:setupLambda,checkSubtype:checkSubtype,failedCast:failedCast,buildResume:buildResume,mkVTable:mkVTable,bind:bind,leaveAccessor:leaveAccessor};function oops(e){throw new Error("sim error: "+e)}function doNothing(e){return e.pc=-1,_leave(e,e.parent.retval)}function flushLoopLock(){for(;0<__this.loopLockWaitList.length&&!__this.loopLock;){__this.loopLockWaitList.shift()()}}var yieldReset=function(){};function setupYield(e){yieldReset=e}function loopForSchedule(e){var t=new Object,n=e.pc;return __this.loopLock=t,__this.otherFrames.push(e),function(){__this.dead||(U.assert(e.pc==n),U.assert(__this.loopLock===t),__this.loopLock=null,loop(e),flushLoopLock())}}function maybeYield(e,t,n){if(__this.pausedOnBreakpoint)return!1;__this.cleanScheduledExpired(),yieldReset();var r=Date.now();return 20<=r-lastYield&&(lastYield=r,e.pc=t,e.r0=n,setTimeout(loopForSchedule(e),5),!0)}function setupDebugger(e,t){return(breakpoints=new Uint8Array(e))[0]=msg.breakOnStart?1:0,userGlobals=t,breakpoints}function isBreakFrame(e){if(!breakFrame)return!0;for(var t=breakFrame;t;t=t.parent)if(t==e)return!0;return!1}function breakpoint(t,n,e,r){var i={};__this.loopLock=i,U.assert(!dbgResume),U.assert(!dbgHeap),t.pc=n,t.r0=r;var o=pxsim.getBreakpointMsg(t,e,userGlobals),a=o.msg,s=o.heap;return dbgHeap=s,pxsim.injectEnvironmentGlobals(a,s),Runtime.postMessage(a),breakpoints[0]=0,breakFrame=null,__this.pauseScheduled(),dbgResume=function(e){if(dbgHeap=dbgResume=null,__this.dead)return null;switch(__this.resumeAllPausedScheduled(),__this.board.onDebuggerResume(),pxsim.runtime=__this,U.assert(t.pc==n),breakpoints[0]=0,breakFrame=null,e.subtype){case"resume":break;case"stepover":breakpoints[0]=1,breakFrame=t;break;case"stepinto":breakpoints[0]=1;break;case"stepout":breakpoints[0]=1,breakFrame=t.parent||t}U.assert(__this.loopLock==i),__this.loopLock=null,__this.otherFrames.push(t),loop(t),flushLoopLock()},null}function trace(e,t,n,r){if(setupResume(t,n),"<main>"===r.functionName||"main.ts"===r.fileName){var i=pxsim.getBreakpointMsg(t,e,userGlobals).msg;i.subtype="trace",Runtime.postMessage(i),pxsim.thread.pause(tracePauseMs||1)}else pxsim.thread.pause(0);checkResumeConsumed()}function handleDebuggerMsg(e){switch(e.subtype){case"config":var t=e;if(t.setBreakpoints&&breakpoints){breakpoints.fill(0);for(var n=0,r=t.setBreakpoints;n<r.length;n++){var i=r[n];breakpoints[i]=1}}break;case"traceConfig":tracePauseMs=e.interval;break;case"pause":breakpoints[0]=1,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(e);break;case"variables":var o=e,a=void 0;if(dbgHeap){var s=dbgHeap[o.variablesReference];void 0!==s&&(a=pxsim.dumpHeap(s,dbgHeap,o.fields))}Runtime.postMessage({type:"debugger",subtype:"variables",req_seq:e.seq,variables:a})}}function removeFrame(e){for(var t=__this.otherFrames,n=t.length-1;0<=n;--n)if(t[n]===e)return void t.splice(n,1);U.userError("frame cannot be removed!")}function loop(t){if(__this.dead)console.log("Runtime terminated");else{U.assert(!__this.loopLock),__this.perfStartRuntime(),removeFrame(t);try{for(pxsim.runtime=__this;t;)__this.currFrame=t,__this.currFrame.overwrittenPC=!1,t=t.fn(t),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(t=__this.currFrame);__this.perfStopRuntime()}catch(e){if(e instanceof BreakLoopException)return void U.nextTick(loopForSchedule(__this.currFrame));if(__this.perfStopRuntime(),__this.errorHandler)__this.errorHandler(e);else{console.error("Simulator crashed, no error handler",e.stack);var n=pxsim.getBreakpointMsg(t,t.lastBrkId,userGlobals),r=n.msg,i=n.heap;pxsim.injectEnvironmentGlobals(r,i),r.exceptionMessage=e.message,r.exceptionStack=e.stack,Runtime.postMessage(r),__this.postError&&__this.postError(e)}}}}function checkStack(e){100<e&&U.userError("Stack overflow")}function actionCall(e){return e.depth=e.parent.depth+1,checkStack(e.depth),e.pc=0,e}function setupTop(e){var t=setupTopCore(e);return setupResume(t,0),t}function setupTopCore(e){var t={parent:null,pc:0,depth:0,threadId:++threadId,fn:function(){return e&&e(t.retval),null}};return t}function topCall(e,t){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0);var n={parent:setupTopCore(t),fn:e,depth:0,pc:0};__this.otherFrames=[n],loop(actionCall(n))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(e,t){currResume=buildResume(e,t)}function leaveAccessor(e,t){if(e.stage2Call){for(var n={pc:0,fn:null,depth:e.depth,parent:e.parent},r=1;e.hasOwnProperty("arg"+r);)n["arg"+(r-1)]=e["arg"+r],r++;return setupLambda(n,t),n}return e.parent.retval=t,e.parent}function setupLambda(e,t,n){if(n){for(var r=e,i=1;i<n;++i)r["arg"+(i-1)]=r["arg"+i];delete r["arg"+(n-1)]}t instanceof pxsim.RefAction?(e.fn=t.func,e.caps=t.fields):"function"==typeof t?e.fn=t:oops("calling non-function")}function checkSubtype(e,t){if(!e)return!1;var n=e.vtable;return t===n||n&&t.classNo<=n.classNo&&n.classNo<=t.lastSubtypeNo}function failedCast(e){pxsim.control&&pxsim.control.dmesgValue&&pxsim.control.dmesgValue(e),oops("failed cast on "+e)}function buildResume(o,a){currResume&&oops("already has resume"),o.pc=a;var s=Date.now();__this.otherFrames.push(o);var c=function(e){if(!__this.dead){if(!__this.loopLock){pxsim.runtime=__this;var t=Date.now();if(3<t-s&&(lastYield=t),U.assert(o.pc==a),e instanceof pxsim.FnWrapper){var n=e,r={parent:o,fn:n.func,lambdaArgs:n.args,pc:0,caps:n.caps,depth:o.depth+1},i={};return __this.loopLock=i,removeFrame(o),__this.otherFrames.push(r),U.nextTick(function(){U.assert(__this.loopLock===i),__this.loopLock=null,loop(actionCall(r)),flushLoopLock()})}return o.retval=e,loop(o)}__this.loopLockWaitList.push(function(){return c(e)})}};return c}var entryPoint=msg.code&&eval(msg.code)(evalIface);this.run=function(e){return topCall(entryPoint,e)},this.getResume=function(){currResume||oops("noresume");var e=currResume;return currResume=null,e},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=function(e){currResume=null,0<=e&&(_this.currFrame.pc=e),_this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}return Runtime.prototype.registerLiveObject=function(e){return this.refObjId++},Runtime.prototype.runningTime=function(){return U.now()-this.startTime-this.pausedTime},Runtime.prototype.runningTimeUs=function(){return 4294967295&U.perfNowUs()-this.startTimeUs>>0},Runtime.prototype.runFiberAsync=function(n,r,i,o){var a=this;return new Promise(function(e,t){return U.nextTick(function(){(pxsim.runtime=a).setupTop(e),pxtcore.runAction(n,[r,i,o])})})},Runtime.prototype.currTryFrame=function(){for(var e=this.currFrame;e;e=e.parent)if(e.tryFrame)return e.tryFrame;return null},Runtime.prototype.traceObjects=function(){for(var a={};2<this.heapSnapshots.length;)this.heapSnapshots.shift();var e={count:0,size:0,name:"TOTAL"},n={TOTAL:e};function s(e,t,n){if(void 0===n&&(n=null),t instanceof pxsim.RefObject){var r=t;if(!r.gcIsStatic()){var i=a[r.id];if(i)n&&i.pointers.push([n,e]);else{var o={obj:r,path:null,pointers:[[n,e]]};a[r.id]=o,r.scan(function(e,t){t instanceof pxsim.RefObject&&!a[t.id]&&s(e,t,o)})}}}}this.heapSnapshots.push({visited:a,statsByType:n});for(var t=0,r=Object.keys(this.globals);t<r.length;t++){s((m=r[t]).replace(/___\d+$/,""),this.globals[m])}var i=this.otherFrames.slice();this.currFrame&&i.indexOf(this.currFrame)<0&&i.unshift(this.currFrame);for(var o=0,c=this.getThreads();o<c.length;o++)for(var u=c[o],l="Thread-"+this.rootFrame(u).threadId,p=u;p;p=p.parent){for(var f=l+"."+functionName(p.fn),d=0,h=Object.keys(p);d<h.length;d++){var m=h[d];if(/^(r0|arg\d+|.*___\d+)/.test(m)){var g=p[m];g instanceof pxsim.RefObject&&s(f+"."+(m=m.replace(/___.*/,"")),g)}}if(p.caps)for(var v=0,b=p.caps;v<b.length;v++){s(f+".cap",b[v])}}var y=Object.keys(a).map(function(e){return a[e]});y.sort(function(e,t){return t.obj.gcSize()-e.obj.gcSize()});var w=function(e){if(null==e.path){var t="";e.path="(cycle)";for(var n=0,r=e.pointers;n<r.length;n++){var i=r[n],o=i[0],a=i[1];if(null==o)return void(e.path=a);w(o);var s=o.path+"."+a;(!t||t.length>s.length)&&(t=s)}e.path=t}};y.forEach(w);for(var x=[e],k=0,A=y;k<A.length;k++){var T=A[k],C=T.obj.gcSize(),E=T.obj.gcKey();n.hasOwnProperty(E)||x.push(n[E]={count:0,size:0,name:E}),(U=n[E]).size+=C,U.count++,e.size+=C,e.count++}x.sort(function(e,t){return e.size-t.size});for(var S="",_=function(e){return("        "+e.toString()).slice(-7)},I=0,P=x;I<P.length;I++){var U=P[I];S+=_(4*U.size)+_(U.count)+" "+U.name+"\n"}var O=function(e){return _(4*e.obj.gcSize())+" "+e.obj.gcKey()+" "+e.path},R=y.slice(0,20).map(O).join("\n"),N="";if(3<=this.heapSnapshots.length){var D=this.heapSnapshots[this.heapSnapshots.length-3].visited,L=this.heapSnapshots[this.heapSnapshots.length-2].visited;N=y.filter(function(e){return!D[e.obj.id]&&L[e.obj.id]}).filter(function(e){return!((t=e.obj)instanceof pxsim.RefRecord&&t.vtable&&t.vtable.maxBgInstances&&n[t.gcKey()].count<=t.vtable.maxBgInstances);var t}).map(O).join("\n")}return"Threads:\n"+this.threadInfo()+"\n\nSummary:\n"+S+"\n\nLarge Objects:\n"+R+"\n\nNew Objects:\n"+N},Runtime.prototype.getThreads=function(){var e=this.otherFrames.slice();return this.currFrame&&e.indexOf(this.currFrame)<0&&e.unshift(this.currFrame),e},Runtime.prototype.rootFrame=function(e){for(var t=e;t.parent;)t=t.parent;return t},Runtime.prototype.threadInfo=function(){for(var e="",t=0,n=this.getThreads();t<n.length;t++){var r=n[t];e+="Thread "+this.rootFrame(r).threadId+":\n";for(var i=0,o=pxsim.getBreakpointMsg(r,r.lastBrkId).msg.stackframes;i<o.length;i++){var a=o[i].funcInfo;e+="   at "+a.functionName+" ("+a.fileName+":"+(a.line+1)+":"+(a.column+1)+")\n"}e+="\n"}return e},Runtime.postMessage=function(e){e&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(e,"*"),Runtime.messagePosted&&Runtime.messagePosted(e))},Runtime.postScreenshotAsync=function(t){var e=pxsim.runtime&&pxsim.runtime.board;return(e?e.screenshotAsync().catch(function(e){console.debug("screenshot failed")}):Promise.resolve(void 0)).then(function(e){return Runtime.postMessage({type:"screenshot",data:e,delay:t&&t.delay})})},Runtime.requestToggleRecording=function(){var e=pxsim.runtime;e&&Runtime.postMessage({type:"recorder",action:e.recording?"stop":"start"})},Runtime.prototype.restart=function(){this.kill(),setTimeout(function(){return pxsim.Runtime.postMessage({type:"simulator",command:"restart"})},500)},Runtime.prototype.kill=function(){this.dead=!0,this.stopRecording(),this.stopIdle(),this.setRunning(!1)},Runtime.prototype.updateDisplay=function(){this.board.updateView(),this.postFrame()},Runtime.prototype.startRecording=function(e){var t=this;!this.recording&&this.running&&(this.recording=!0,this.recordingTimer=setInterval(function(){return t.postFrame()},66),this.recordingLastImageData=void 0,this.recordingWidth=e)},Runtime.prototype.stopRecording=function(){this.recording&&(this.recordingTimer&&clearInterval(this.recordingTimer),this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0)},Runtime.prototype.postFrame=function(){var o=this;if(this.recording&&this.running){var a=pxsim.U.now();this.board.screenshotAsync(this.recordingWidth).then(function(e){if(o.recordingLastImageData&&e&&o.recordingLastImageData.data.byteLength==e.data.byteLength){var t=o.recordingLastImageData.data,n=e.data,r=t.byteLength,i=0;for(i=0;i<r&&t[i]==n[i];++i);if(i==r)return}o.recordingLastImageData=e,Runtime.postMessage({type:"screenshot",data:e,time:a})})}},Runtime.prototype.queueDisplayUpdate=function(){this.numDisplayUpdates++},Runtime.prototype.maybeUpdateDisplay=function(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())},Runtime.prototype.setRunning=function(e){this.running!=e&&(this.running=e,this.running?(this.startTime=U.now(),this.startTimeUs=U.perfNowUs(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"running"})):(this.stopRecording(),this.stopIdle(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"killed"})),this.stateChanged&&this.stateChanged())},Runtime.prototype.dumpLivePointers=function(){},Runtime.prototype.setupPerfCounters=function(e){e&&e.length&&(this.perfCounters=e.map(function(e){return new PerfCounter(e)}))},Runtime.prototype.perfStartRuntime=function(){0!==this.perfOffset?this.perfStack++:this.perfOffset=U.perfNowUs()-this.perfElapsed},Runtime.prototype.perfStopRuntime=function(){this.perfStack?this.perfStack--:(this.perfElapsed=this.perfNow(),this.perfOffset=0)},Runtime.prototype.perfNow=function(){return 0===this.perfOffset&&U.userError("bad time now"),U.perfNowUs()-this.perfOffset|0},Runtime.prototype.startPerfCounter=function(e){if(this.perfCounters){var t=this.perfCounters[e];t.start&&U.userError("startPerf"),t.start=this.perfNow()}},Runtime.prototype.stopPerfCounter=function(e){if(this.perfCounters){var t=this.perfCounters[e];t.start||U.userError("stopPerf");var n=this.perfNow()-t.start;t.start=0,t.value+=n,t.numstops++;var r=t.lastFewPtr++;r>=t.lastFew.length&&(r=0,t.lastFewPtr=1),t.lastFew[r]=n}},Runtime.prototype.startIdle=function(){var t=this;void 0===this.idleTimer&&(this.idleTimer=setInterval(function(){if(t.running&&!t.pausedOnBreakpoint){var e=t.board.bus;e&&e.queueIdle()}},20))},Runtime.prototype.stopIdle=function(){void 0!==this.idleTimer&&(clearInterval(this.idleTimer),this.idleTimer=void 0)},Runtime.prototype.schedule=function(t,e){var n=this;if(e<=0&&(e=0),this.pausedOnBreakpoint)return this.timeoutsPausedOnBreakpoint.push(new PausedTimeout(t,e)),-1;var r=U.now(),i=new TimeoutScheduled(-1,t,e,r);return i.id=setTimeout(function(){var e=n.timeoutsScheduled.indexOf(i);0<=e&&n.timeoutsScheduled.splice(e,1),t()},e),this.timeoutsScheduled.push(i),i.id},Runtime.prototype.pauseScheduled=function(){var r=this;this.pausedOnBreakpoint=!0,this.timeoutsScheduled.forEach(function(e){clearTimeout(e.id);var t=U.now()-e.timestampCall,n=e.totalRuntime-t;n<=0&&(n=1),r.timeoutsPausedOnBreakpoint.push(new PausedTimeout(e.fn,n))}),this.lastPauseTimestamp=U.now(),this.timeoutsScheduled=[]},Runtime.prototype.resumeAllPausedScheduled=function(){var t=this;this.pausedOnBreakpoint=!1,this.timeoutsPausedOnBreakpoint.forEach(function(e){t.schedule(e.fn,e.timeRemaining)}),this.lastPauseTimestamp&&(this.pausedTime+=U.now()-this.lastPauseTimestamp,this.lastPauseTimestamp=0),this.timeoutsPausedOnBreakpoint=[]},Runtime.prototype.cleanScheduledExpired=function(){var n=U.now();this.timeoutsScheduled=this.timeoutsScheduled.filter(function(e){var t=n-e.timestampCall;return e.totalRuntime>t})},Runtime}();pxsim.Runtime=Runtime;var PerfCounter=function(e){this.name=e,this.start=0,this.numstops=0,this.value=0,this.lastFew=new Uint32Array(32),this.lastFewPtr=0};pxsim.PerfCounter=PerfCounter}(pxsim||(pxsim={})),function(s){var c,e,n,t;(e=c=s.SimulatorState||(s.SimulatorState={}))[e.Unloaded=0]="Unloaded",e[e.Stopped=1]="Stopped",e[e.Pending=2]="Pending",e[e.Starting=3]="Starting",e[e.Running=4]="Running",e[e.Paused=5]="Paused",e[e.Suspended=6]="Suspended",(t=n=s.SimulatorDebuggerCommand||(s.SimulatorDebuggerCommand={}))[t.StepInto=0]="StepInto",t[t.StepOver=1]="StepOver",t[t.StepOut=2]="StepOut",t[t.Resume=3]="Resume",t[t.Pause=4]="Pause";var r=function(){function e(e,t){void 0===t&&(t={}),this.container=e,this.options=t,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.breakpointsSet=!1,this._runOptions={},this.state=c.Unloaded,this.frameCleanupTimeout=0,this.debuggerSeq=1,this.debuggerResolvers={}}return e.prototype.isDebug=function(){return this._runOptions&&!!this._runOptions.debug},e.prototype.isTracing=function(){return this._runOptions&&!!this._runOptions.trace},e.prototype.hasParts=function(){return this._runOptions&&this._runOptions.parts&&!!this._runOptions.parts.length},e.prototype.setDirty=function(){this.state==s.SimulatorState.Running&&this.suspend()},e.prototype.setPending=function(){this.setState(c.Pending)},e.prototype.focus=function(){var e=this.simFrames()[0];e&&e.focus()},e.prototype.registerDependentEditor=function(e){e&&(this._dependentEditors||(this._dependentEditors=[]),this._dependentEditors.push(e))},e.prototype.dependentEditors=function(){return this._dependentEditors&&(this._dependentEditors=this._dependentEditors.filter(function(e){return!!e.parent}),this._dependentEditors.length||(this._dependentEditors=void 0)),this._dependentEditors},e.prototype.setStarting=function(){this.setState(c.Starting)},e.prototype.setHwDebugger=function(e){e?(this.hwdbg=e,this.setState(c.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(c.Running),this.stop())},e.prototype.handleHwDebuggerMsg=function(e){this.hwdbg&&this.handleMessage(e)},e.prototype.setThemes=function(e){s.U.assert(e&&0<e.length),this.themes=e},e.prototype.startRecording=function(e){this.simFrames()[0]&&this.postMessage({type:"recorder",action:"start",width:e})},e.prototype.stopRecording=function(){this.postMessage({type:"recorder",action:"stop"})},e.prototype.setFrameState=function(e){var t=e.nextElementSibling,n=t.nextElementSibling;switch(this.state){case c.Pending:case c.Starting:t.style.display="",t.className="",n.style.display="";break;case c.Stopped:case c.Suspended:s.U.addClass(e,this.state==c.Stopped||this._runOptions&&this._runOptions.autoRun?this.stoppedClass:this.invalidatedClass),this._runOptions&&this._runOptions.autoRun?t.style.display="none":(t.style.display="",t.className="videoplay xicon icon"),n.style.display="none",this.scheduleFrameCleanup();break;default:s.U.removeClass(e,this.stoppedClass),s.U.removeClass(e,this.invalidatedClass),t.style.display="none",n.style.display="none"}},e.prototype.setState=function(e){var t=this;this.state!=e&&(this.state=e,this.freeze(this.state==c.Paused),this.simFrames().forEach(function(e){return t.setFrameState(e)}),this.options.onStateChanged&&this.options.onStateChanged(this.state))},e.prototype.freeze=function(e){var n="pause-overlay";e?s.util.toArray(this.container.querySelectorAll("div.simframe")).forEach(function(e){if(!e.querySelector("div."+n)){var t=document.createElement("div");t.className=n,t.onclick=function(e){return e.preventDefault(),!1},e.appendChild(t)}}):s.util.toArray(this.container.querySelectorAll("div.simframe div."+n)).forEach(function(e){return e.parentElement.removeChild(e)})},e.prototype.simFrames=function(e){void 0===e&&(e=!1);var t=s.util.toArray(this.container.getElementsByTagName("iframe")),n=this.loanedIFrame();return n&&!e&&t.unshift(n),t},e.prototype.postMessage=function(t,n){if(this.hwdbg)this.hwdbg.postMessage(t);else{var e=t,r=this.dependentEditors(),i=this.simFrames();if(n&&e&&e.broadcast){var o=window.parent&&window.parent!==window.window?window.parent:window.opener;this.options.nestedEditorSim&&o?n!==o&&o.postMessage(t,"*"):r?r.forEach(function(e){n!==e&&e.postMessage(t,"*")}):i.length<2?(this.container.appendChild(this.createFrame()),i=this.simFrames()):i[1].dataset.runid!=this.runId&&this.startFrame(i[1])}for(var a=0;a<i.length;++a){var s=i[a];if((!n||s.contentWindow!=n)&&(s.contentWindow&&(s.contentWindow.postMessage(t,"*"),"recorder"==t.type&&"start"==t.action)))break}}},e.prototype.createFrame=function(e){var t=this,n=document.createElement("div");n.className="simframe ui embed";var r=document.createElement("iframe");r.id="sim-frame-"+this.nextId(),r.title=s.localization.lf("Simulator"),r.allowFullscreen=!0,r.setAttribute("allow","autoplay"),r.setAttribute("sandbox","allow-same-origin allow-scripts");var i=this.options.simUrl||(window.pxtConfig||{}).simUrl||"/sim/simulator.html";r.className="no-select",r.src=i+"#"+r.id,r.frameBorder="0",r.dataset.runid=this.runId,n.appendChild(r);var o=document.createElement("i");o.className="videoplay xicon icon",o.style.display="none",o.onclick=function(e){return e.preventDefault(),t.state!=c.Running&&t.state!=c.Starting&&(t.options.restart?t.options.restart():t.start()),r.focus(),!1},n.appendChild(o);var a=document.createElement("div");return a.className="ui active loader",o.style.display="none",n.appendChild(a),this._runOptions&&this.applyAspectRatioToFrame(r),n},e.prototype.preload=function(e){this.simFrames().length||(this.container.appendChild(this.createFrame()),this.applyAspectRatio(e),this.setStarting())},e.prototype.stop=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.clearDebugger(),this.postMessage({type:"stop"}),this.setState(t?c.Starting:c.Stopped),e&&this.unload()},e.prototype.suspend=function(){this.postMessage({type:"stop"}),this.setState(c.Suspended)},e.prototype.unload=function(){this.cancelFrameCleanup(),s.U.removeChildren(this.container),this.setState(c.Unloaded),this._runOptions=void 0,this._currentRuntime=void 0,this.runId=void 0},e.prototype.mute=function(e){this._currentRuntime&&(this._currentRuntime.mute=e),this.postMessage({type:"mute",mute:e})},e.prototype.stopSound=function(){this.postMessage({type:"stopsound"})},e.prototype.isLoanedSimulator=function(e){return!!this.loanedSimulator&&this.loanedIFrame()==e},e.prototype.loanSimulator=function(){return this.loanedSimulator||(this.loanedSimulator=this.container.firstElementChild||this.createFrame(),this.loanedSimulator.parentNode&&this.container.removeChild(this.loanedSimulator)),this.loanedSimulator},e.prototype.unloanSimulator=function(){this.loanedSimulator&&(this.loanedSimulator.parentNode&&this.loanedSimulator.parentNode.removeChild(this.loanedSimulator),this.container.insertBefore(this.loanedSimulator,this.container.firstElementChild),delete this.loanedSimulator)},e.prototype.loanedIFrame=function(){return this.loanedSimulator&&this.loanedSimulator.parentNode&&this.loanedSimulator.querySelector("iframe")},e.prototype.cancelFrameCleanup=function(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=0)},e.prototype.scheduleFrameCleanup=function(){var e=this;this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(function(){e.frameCleanupTimeout=0,e.cleanupFrames()},5e3)},e.prototype.applyAspectRatio=function(t){var n=this;(t||this._runOptions)&&this.simFrames().forEach(function(e){return n.applyAspectRatioToFrame(e,t)})},e.prototype.applyAspectRatioToFrame=function(e,t){var n=t||this._runOptions.aspectRatio;e.parentElement.style.paddingBottom=100/n+"%"},e.prototype.cleanupFrames=function(){var t=this,e=this.simFrames(!0);e.shift(),e.forEach(function(e){t.state!=c.Stopped&&e.dataset.runid==t.runId||(t.options.removeElement?t.options.removeElement(e.parentElement):e.parentElement.remove())})},e.prototype.hide=function(t){var n=this;if(this.suspend(),this.options.removeElement){var e=this.simFrames();e.forEach(function(e){n.options.removeElement(e.parentElement,t)}),0==e.length&&t&&t()}},e.prototype.unhide=function(){var t=this;this.options.unhideElement&&this.simFrames().forEach(function(e){t.options.unhideElement(e.parentElement)})},e.prototype.run=function(e,t){void 0===t&&(t={}),this._runOptions=t,this.runId=this.nextId(),this._currentRuntime={type:"run",boardDefinition:t.boardDefinition,parts:t.parts,fnArgs:t.fnArgs,code:e,partDefinitions:t.partDefinitions,mute:t.mute,highContrast:t.highContrast,light:t.light,cdnUrl:t.cdnUrl,localizedStrings:t.localizedStrings,refCountingDebug:t.refCountingDebug,version:t.version,clickTrigger:t.clickTrigger,breakOnStart:t.breakOnStart,storedState:t.storedState},this.start()},e.prototype.restart=function(){this.stop(),this.start()},e.prototype.areBreakpointsSet=function(){return this.breakpointsSet},e.prototype.start=function(){if(this.clearDebugger(),this.addEventListeners(),this.applyAspectRatio(),this.scheduleFrameCleanup(),this._currentRuntime){this.breakpointsSet=!1;var e=this.simFrames()[0];if(e)this.startFrame(e);else{var t=this.createFrame(this._runOptions&&this._runOptions.light);this.container.appendChild(t),e=t.firstElementChild}this.setState(c.Running),this.setTraceInterval(this.traceInterval)}},e.prototype.startFrame=function(e){if(!this._currentRuntime||!e.contentWindow)return!1;var t=JSON.parse(JSON.stringify(this._currentRuntime)),n="",r=/player=([A-Za-z0-9]+)/i.exec(window.location.href);return r&&(n=r[1]),t.frameCounter=++this.frameCounter,t.options={theme:this.themes[this.nextFrameId++%this.themes.length],player:n},t.id=t.options.theme+"-"+this.nextId(),e.dataset.runid=this.runId,e.dataset.runtimeid=t.id,e.contentWindow.postMessage(t,"*"),this.setFrameState(e),!0},e.prototype.handleMessage=function(e,t){switch(e.type||""){case"ready":var n=e.frameid;(r=document.getElementById(n))&&(this.startFrame(r),this.options.revealElement&&this.options.revealElement(r)),this.options.onSimulatorReady&&this.options.onSimulatorReady();break;case"status":var r;n=e.frameid;if(r=document.getElementById(n)){var i=e;switch(i.state){case"killed":i.runtimeid==r.dataset.runtimeid&&this.setState(c.Stopped)}}break;case"simulator":this.handleSimulatorCommand(e);break;case"serial":case"pxteditor":case"screenshot":case"custom":case"recorder":break;case"debugger":this.handleDebuggerMessage(e);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:this.postMessage(e,t)}},e.prototype.addEventListeners=function(){var t=this;this.listener||(this.listener=function(e){t.hwdbg||t.handleMessage(e.data,e.source)},window.addEventListener("message",this.listener,!1))},e.prototype.removeEventListeners=function(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)},e.prototype.resume=function(e){var t;switch(e){case n.Resume:t="resume",this.setState(c.Running);break;case n.StepInto:t="stepinto",this.setState(c.Running);break;case n.StepOut:t="stepout",this.setState(c.Running);break;case n.StepOver:t="stepover",this.setState(c.Running);break;case n.Pause:t="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:t})},e.prototype.setBreakpoints=function(e){this.breakpointsSet=!0,this.postDebuggerMessage("config",{setBreakpoints:e})},e.prototype.setTraceInterval=function(e){this.traceInterval=e,this.postDebuggerMessage("traceConfig",{interval:e})},e.prototype.variablesAsync=function(e,t){return this.postDebuggerMessageAsync("variables",{variablesReference:e,fields:t}).then(function(e){return e},function(e){})},e.prototype.handleSimulatorCommand=function(e){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(e)},e.prototype.clearDebugger=function(){var t=this,n=new Error("Debugging cancelled");Object.keys(this.debuggerResolvers).forEach(function(e){(0,t.debuggerResolvers[e].reject)(n)}),this.debuggerResolvers={},this.debuggerSeq++},e.prototype.handleDebuggerMessage=function(e){("trace"!==e.subtype&&console.log("DBG-MSG",e.subtype,e),e.seq)&&((a=this.debuggerResolvers[e.seq].resolve)&&a(e));switch(e.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(e);break;case"breakpoint":var t=e;if(this.state==c.Running){t.exceptionMessage?this.suspend():this.setState(c.Paused),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(t);for(var n=t.exceptionMessage+"\n",r=0,i=t.stackframes;r<i.length;r++){var o=i[r].funcInfo;n+="   at "+o.functionName+" ("+o.fileName+":"+(o.line+1)+":"+(o.column+1)+")\n"}t.exceptionMessage&&console.error(n)}else console.error("debugger: trying to pause from "+this.state);break;case"trace":t=e;this.state==c.Running&&this.options.onTraceMessage&&this.options.onTraceMessage(t);break;default:var a,s=e.req_seq;if(s)(a=this.debuggerResolvers[s].resolve)&&(delete this.debuggerResolvers[s],a(e))}},e.prototype.postDebuggerMessageAsync=function(r,i){var o=this;return void 0===i&&(i={}),new Promise(function(e,t){var n=o.debuggerSeq++;o.debuggerResolvers[n.toString()]={resolve:e,reject:t},o.postDebuggerMessage(r,i,n)})},e.prototype.postDebuggerMessage=function(e,t,n){void 0===t&&(t={});var r=JSON.parse(JSON.stringify(t));r.type="debugger",r.subtype=e,n&&(r.seq=n),this.postMessage(r)},e.prototype.nextId=function(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")},Object.defineProperty(e.prototype,"stoppedClass",{get:function(){return this.options&&this.options.stoppedClass||"grayscale"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invalidatedClass",{get:function(){return this.options&&this.options.invalidatedClass||"sepia"},enumerable:!0,configurable:!0}),e}();s.SimulatorDriver=r}(pxsim||(pxsim={})),function(E){E.mkRange=function(e,t){for(var n=[];e<t;e++)n.push(e);return n};var e=function(){function e(e,t){this.runtime=e,this.valueToArgs=t,this.queues={},this.backgroundHandlerFlag=!1,this.nextNotifyEvent=1024,this.schedulerID=15,this.idleEventID=2}return e.prototype.setBackgroundHandlerFlag=function(){this.backgroundHandlerFlag=!0},e.prototype.setNotify=function(e,t){this.notifyID=e,this.notifyOneID=t},e.prototype.setIdle=function(e,t){this.schedulerID=e,this.idleEventID=t},e.prototype.start=function(e,t,n,r){void 0===r&&(r=!1);var i=(n?"back":"fore")+":"+e+":"+t;return!this.queues[i]&&r&&(this.queues[i]=new E.EventQueue(this.runtime,this.valueToArgs)),this.queues[i]},e.prototype.listen=function(e,t,n){e==this.schedulerID&&t==this.idleEventID&&this.runtime.startIdle();var r=this.start(e,t,this.backgroundHandlerFlag,!0);this.backgroundHandlerFlag?r.addHandler(n):r.setHandler(n),this.backgroundHandlerFlag=!1},e.prototype.removeBackgroundHandler=function(t){var n=this;Object.keys(this.queues).forEach(function(e){e.startsWith("back:")&&n.queues[e].removeHandler(t)})},e.prototype.getQueues=function(e,t,n){var r=[this.start(0,0,n)];return 0==e&&0==t||(t&&r.push(this.start(0,t,n)),e&&r.push(this.start(e,0,n)),e&&t&&r.push(this.start(e,t,n))),r},e.prototype.queue=function(e,t,n){if(void 0===n&&(n=null),!E.runtime.pausedOnBreakpoint){var r=this.notifyID&&this.notifyOneID&&e==this.notifyOneID;r&&(e=this.notifyID);var i=this.getQueues(e,t,!0).concat(this.getQueues(e,t,!1));this.lastEventValue=t,this.lastEventTimestampUs=E.U.perfNowUs(),Promise.each(i,function(e){return e?e.push(n,r):Promise.resolve()})}},e.prototype.queueIdle=function(){this.schedulerID&&this.idleEventID&&this.queue(this.schedulerID,this.idleEventID)},e.prototype.wait=function(e,t,n){this.start(e,t,!1,!0).addAwaiter(n)},e.prototype.getLastEventValue=function(){return this.lastEventValue},e.prototype.getLastEventTime=function(){return 4294967295&this.lastEventTimestampUs-E.runtime.startTimeUs},e}();E.EventBus=e;var t=function(){function e(n){var r=this;this.runtime=n,this.queue=[],this.process=function(){var e=r.queue[0];if(e&&!r.runtime.dead){n=r.runtime;var t=e.frame();n.queueDisplayUpdate(),n.maybeUpdateDisplay(),!1===t?(r.queue.shift(),r.queue[0]&&(r.queue[0].setTimeoutHandle=setTimeout(r.process,r.queue[0].interval)),e.whenDone(!1)):e.setTimeoutHandle=setTimeout(r.process,e.interval)}}}return e.prototype.cancelAll=function(){var e=this.queue;this.queue=[];for(var t=0,n=e;t<n.length;t++){var r=n[t];r.whenDone(!0),r.setTimeoutHandle&&clearTimeout(r.setTimeoutHandle)}},e.prototype.cancelCurrent=function(){var e=this.queue[0];e&&(this.queue.shift(),e.whenDone(!0),e.setTimeoutHandle&&clearTimeout(e.setTimeoutHandle))},e.prototype.enqueue=function(e){e.whenDone||(e.whenDone=function(){}),this.queue.push(e),1==this.queue.length&&this.process()},e.prototype.executeAsync=function(n){var r=this;return E.U.assert(!n.whenDone),new Promise(function(e,t){n.whenDone=e,r.enqueue(n)})},e}();function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}E.AnimationQueue=t,function(e){var t,r,i,o,a=0,w=!1;function x(){return t||(t=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}return}()),t}function c(){i&&(i.gain.value=0),a=0,o&&o.pause()}function n(){c(),p()}e.mute=function(e){w=e,n();var t=x();!e&&t&&"suspended"===t.state&&t.resume()},e.stopAll=n,e.stop=function(){c()},e.frequency=function(){return a};var s,u=[null,"triangle","sawtooth","sine"],l=[];function k(e,t){var n,r=u[e];if(r){var i=x().createOscillator();return i.type=r,i.frequency.value=t,i}if(5==e)n=function(){if(!s)for(var e=(s=x().createBuffer(1,1e5,x().sampleRate)).getChannelData(0),t=251771520,n=0;n<1e5;n++)t^=t<<13,t^=t>>17,t^=t<<5,e[n]=(1023&t)/512-1;return s}();else{if(!(11<=e&&e<=15))return null;n=function(e){if(!l[e]){for(var t=x().createBuffer(1,1024,x().sampleRate),n=t.getChannelData(0),r=0;r<1024;r++)n[r]=r<e/100*1024?1:-1;l[e]=t}return l[e]}(10*(e-10))}var o=x().createBufferSource();return o.buffer=n,o.loop=!0,5!=e&&(o.playbackRate.value=t/(x().sampleRate/1024)),o}var A=[],T=function(){function e(){}return e.prototype.mute=function(){this.generator&&(this.generator.stop(),this.generator.disconnect()),this.gain&&this.gain.disconnect(),this.gain=null,this.generator=null},e.prototype.remove=function(){var e=A.indexOf(this);0<=e&&A.splice(e,1),this.mute()},e}(),C=1;function p(){for(C++;A.length;)A[0].remove()}function f(u){var l=C,p=x(),f=0,d=new T,h=-1,m=-1,g=0;5<A.length&&A[0].remove(),A.push(d);var v=function(e,t){return e/1024/2*(t?.7:1)},b=function(){d.mute(),g=0,m=h=-1},y=function(){if(f>=u.data.length||!u.data[f])return Promise.delay(g).then(b);var e=u.data[f],t=E.BufferMethods.getNumber(u,E.BufferMethods.NumberFormat.UInt16LE,f+2),n=E.BufferMethods.getNumber(u,E.BufferMethods.NumberFormat.UInt16LE,f+4),r=E.BufferMethods.getNumber(u,E.BufferMethods.NumberFormat.UInt16LE,f+6),i=E.BufferMethods.getNumber(u,E.BufferMethods.NumberFormat.UInt16LE,f+8),o=E.BufferMethods.getNumber(u,E.BufferMethods.NumberFormat.UInt16LE,f+10),a=11<=e&&e<=15,s=v(r,a),c=v(i,a);if(!p||l!=C)return Promise.delay(n);if(h!=e||m!=t){if(d.generator)return Promise.delay(g).then(function(){return b(),y()});if(d.generator=w?null:k(e,t),!d.generator)return Promise.delay(n);if(h=e,m=t,d.gain=p.createGain(),d.gain.gain.value=s,o!=t)if(null!=d.generator.frequency)d.generator.frequency.linearRampToValueAtTime(o,p.currentTime+(g+n)/1e3);else if(null!=d.generator.playbackRate){d.generator.playbackRate.linearRampToValueAtTime(o/(x().sampleRate/1024),p.currentTime+(g+n)/1e3)}d.generator.connect(d.gain),d.gain.connect(p.destination),d.generator.start()}return f+=12,d.gain.gain.setValueAtTime(s,p.currentTime+g/1e3),g+=n,d.gain.gain.linearRampToValueAtTime(c,p.currentTime+g/1e3),y()};return y().then(function(){return d.remove()})}function d(e,t){if(!(w||e<=0)){a=e;var n=x();if(n){r&&(r.stop(),r.disconnect(),r=void 0),t=Math.max(0,Math.min(1,t));try{r=n.createOscillator(),i=n.createGain(),r.type="triangle",r.connect(i),i.connect(n.destination),i.gain.value=t,r.start(0)}catch(e){return void(i=r=void 0)}r.frequency.value=e,i.gain.value=t}}}e.muteAllChannels=p,e.queuePlayInstructions=function(e,t){var n=C;Promise.delay(e).then(function(){return n!=C?Promise.resolve():f(t)}).done()},e.playInstructionsAsync=f,e.tone=d,e.playBufferAsync=function(r){return r?new Promise(function(e){function t(){e&&e(),e=void 0}var n="data:audio/wav;base64,"+window.btoa(function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n}(r.data));o=new Audio(n),w&&(o.volume=0),o.onended=function(){return t()},o.onpause=function(){return t()},o.onerror=function(){return t()},o.play()}):Promise.resolve()},e.sendMidiMessage=function(e){var t=e.data;if(t.length){var n,r=t[0]>>4,i=15&t[0],o=t[1]||0,a=(n=o,440*Math.pow(2,(n-69)/12)),s=t[2]||0;8==r||9==r&&0==s?c():9==r&&(d(a,1),9==i&&setTimeout(function(){return c()},500))}}}(E.AudioContextManager||(E.AudioContextManager={})),E.isTouchEnabled=n,E.hasPointerEvents=r,E.pointerEvents=r()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:n()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"}}(pxsim||(pxsim={})),function(U){!function(t){function o(t,n){return function(e){return e*(n/t)}}function n(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}t.translateEl=function(e,t){U.svg.hydrate(e,{transform:"translate("+t[0]+" "+t[1]+")"})},t.composeSVG=function(e){var t=[e.el1,e.el2],n=t[0],r=t[1];U.U.assert(0==n.x&&0==n.y&&0==r.x&&0==r.y,"el1 and el2 x,y offsets not supported");var i=function(e,t,n){return U.svg.hydrate(e,{x:t,y:n})},o=function(e,t,n){return U.svg.hydrate(e,{width:t+"px",height:n+"px"})},a=e.scaleUnit2,s=e.scaleUnit2/e.scaleUnit1,c=n.w*s,u=n.h*s;o(n.el,c,u);var l=1*r.w,p=1*r.h;o(r.el,l,p);var f=e.margin,d=f[0],h=f[1],m=f[2],g=f[3],v=e.middleMargin,b=Math.max(c,l),y=h+(b-c)/2,w=d;i(n.el,y,w);var x=h+(b-l)/2,k=w+u+v;i(r.el,x,k);var A,T,C,E=[w,w+u,k,k+p],S=h+b+g,_=d+u+v+p+m,I=U.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+S+" "+_,class:"sim-bb"});A=I,T=e.maxWidth,C=e.maxHeight,T&&U.svg.hydrate(A,{width:T}),C&&U.svg.hydrate(A,{height:C}),i(I,0,0);var P=U.svg.child(I,"g");return I.appendChild(n.el),I.appendChild(r.el),{under:P,over:U.svg.child(I,"g"),host:I,edges:E,scaleUnit:a,toHostCoord1:function(e){var t=e[0],n=e[1];return[t*s+y,n*s+w]},toHostCoord2:function(e){var t=e[0],n=e[1];return[1*t+x,1*n+k]}}},t.mkScaleFn=o,t.mkImageSVG=function(e){var t=o(e.imageUnitDist,e.targetUnitDist),n=t(e.width),r=t(e.height),i=U.svg.elt("image",{width:n,height:r});return i.setAttributeNS("http://www.w3.org/1999/xlink","href",""+e.image),{el:i,w:n,h:r,x:0,y:0}},t.findDistSqrd=n,t.findClosestCoordIdx=function(t,e){return e.map(function(e){return n(t,e)}).reduce(function(e,t,n,r){return t<r[e]?n:e},0)},t.mkTxt=function(e,t,n,r,i,o,a){var s=U.svg.elt("text");a=a||.3;var c=(o=o||-.33333)*n*i.length,u=a*n;return U.svg.hydrate(s,{style:"font-size:"+n+"px;",transform:"translate("+e+" "+t+") rotate("+r+") translate("+c+" "+u+")"}),U.U.addClass(s,"noselect"),s.textContent=i,s},t.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],t.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},t.mapWireColor=function(e){return t.WIRE_COLOR_MAP[e]||e},t.PIN_DIST=15,t.rgbToHsl=function(e){var t,n,r,i=[e[0]/255,e[1]/255,e[2]/255],o=i[0],a=i[1],s=i[2],c=Math.min(o,a,s),u=Math.max(o,a,s),l=u-c,p=u+c;return r=p/2*100,0===l?n=t=0:(u===o?t=(a-s)/l%6*60:u===a?t=60*((s-o)/l+2):u===s&&(t=60*((o-a)/l+4)),n=50<r?l/(2-p)*100:l/p*100),[Math.floor(t),Math.floor(n),Math.floor(r)]}}(U.visuals||(U.visuals={}))}(pxsim||(pxsim={})),function(s){var a;!function(e){function o(e,t,n){var r={class:e,d:t};n&&(r.title=n);var i=a.elt("path");return a.hydrate(i,r),i}function i(e,t){void 0===t&&(t=!1);var n=a.elt("linearGradient");a.hydrate(n,{id:e,x1:"0%",y1:"0%",x2:t?"100%":"0%",y2:t?"0%":"100%"});a.child(n,"stop",{offset:"0%"}),a.child(n,"stop",{offset:"100%"}),a.child(n,"stop",{offset:"100%"}),a.child(n,"stop",{offset:"100%"});return n}function r(e){var t=a.elt("title");return t.textContent=e,t}e.parseString=function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").getElementsByTagName("svg").item(0)},e.toDataUri=function(e){return"data:image/svg+xml,"+encodeURI(e)},e.cursorPoint=function(e,t,n){return e.x=null!=n.clientX?n.clientX:n.pageX,e.y=null!=n.clientY?n.clientY:n.pageY,e.matrixTransform(t.getScreenCTM().inverse())},e.rotateElement=function(e,t,n,r){e.setAttribute("transform","translate("+t+","+n+") rotate("+(r+90)+") translate("+-t+","+-n+")")},e.hydrate=function(e,t){for(var n in t)"title"==n?a.title(e,t[n]):e.setAttributeNS(null,n,t[n])},e.elt=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&a.hydrate(n,t),n},e.child=function(e,t,n){var r=a.elt(t,n);return e.appendChild(r),r},e.mkPath=o,e.path=function(e,t,n,r){var i=o(t,n,r);return e.appendChild(i),i},e.fill=function(e,t){e.style.fill=t},e.filter=function(e,t){e.style.filter=t},e.fills=function(e,t){e.forEach(function(e){return e.style.fill=t})},e.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},e.onClick=function(t,n){var r=!1;s.pointerEvents.down.forEach(function(e){return t.addEventListener(e,function(e){return r=!0},!1)}),t.addEventListener(s.pointerEvents.up,function(e){return!r||(r=!1,n(e),e.preventDefault(),!1)},!1)},e.buttonEvents=function(t,n,r,i,o){var a=!1;s.pointerEvents.down.forEach(function(e){return t.addEventListener(e,function(e){return a=!0,r&&r(e),!0},!1)}),t.addEventListener(s.pointerEvents.move,function(e){return!a||(n&&n(e),e.preventDefault(),!1)},!1),t.addEventListener(s.pointerEvents.up,function(e){a=!1,i&&i(e)},!1),t.addEventListener(s.pointerEvents.leave,function(e){a=!1,i&&i(e)},!1),t.addEventListener("keydown",function(e){a=!1,o&&o(e)})},e.mkLinearGradient=i,e.linearGradient=function(e,t,n){void 0===n&&(n=!1);var r=i(t,n);return e.appendChild(r),r},e.setGradientColors=function(e,t,n){e&&(e.childNodes[0].style.stopColor=t,e.childNodes[1].style.stopColor=t,e.childNodes[2].style.stopColor=n,e.childNodes[3].style.stopColor=n)},e.setGradientValue=function(e,t){e.childNodes[1].getAttribute("offset")!=t&&(e.childNodes[1].setAttribute("offset",t),e.childNodes[2].setAttribute("offset",t))},e.animate=function(e,t){s.U.addClass(e,t);var n=e.parentElement;n&&(n.removeChild(e),n.appendChild(e))},e.mkTitle=r,e.title=function(e,t){var n=r(t);return e.appendChild(n),n},e.toHtmlColor=function(e){return"rgba("+(e>>16&255)+", "+(e>>8&255)+", "+(255&e)+", "+(e>>24&1)+")"}}(a=s.svg||(s.svg={}))}(pxsim||(pxsim={})),function(e){var t=function(e){this.id=e};e.Button=t;var n=function(e){this.props=e,this.usesButtonAB=!1,this.aBtn=new t(this.props.ID_BUTTON_A),this.bBtn=new t(this.props.ID_BUTTON_B),this.abBtn=new t(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0};e.ButtonPairState=n}(pxsim||(pxsim={})),function(e){var t=function(){this.usesHeading=!1,this.heading=90};(pxsim||(pxsim={})).CompassState=t}(),function(e){var t=function(){function e(){this.files={}}return e.prototype.append=function(e,t){this.files[e]=(this.files[e]||"")+t},e.prototype.remove=function(e){delete this.files[e]},e}();e.FileSystemState=t}(pxsim||(pxsim={})),function(e){var t=function(){this.usesLightLevel=!1,this.lightLevel=128};(pxsim||(pxsim={})).LightSensorState=t}(),function(d){!function(f){f.mkBoardView=function(e){var t=e.visual;return new f.GenericBoardSvg({visualDef:t,boardDef:e.boardDef,wireframe:e.wireframe})};var e=function(){function e(e,t){var n=this;this.parts=[],this.boardView=e,(this.opts=t).boardDef.pinStyles||(t.boardDef.pinStyles={}),this.state=t.state;var r=t.partsList,i=0<r.length||t.forceBreadboardLayout;if(i){this.breadboard=new f.Breadboard({wireframe:t.wireframe});var o=t.boardDef.marginWhenBreadboarding||[0,0,40,0],a=f.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[o[0],o[1],20,o[3]],middleMargin:o[2],maxWidth:t.maxWidth,maxHeight:t.maxHeight}),s=a.under,c=a.over;this.view=a.host;var u=a.edges;this.fromMBCoord=a.toHostCoord1,this.fromBBCoord=a.toHostCoord2,this.partGroup=c,this.partOverGroup=d.svg.child(this.view,"g"),this.style=d.svg.child(this.view,"style",{}),this.defs=d.svg.child(this.view,"defs",{}),this.wireFactory=new f.WireFactory(s,c,u,this.style,this.getLocCoord.bind(this),this.getPinStyle.bind(this));var l=d.allocateDefinitions({boardDef:t.boardDef,partDefs:t.partDefs,fnArgs:t.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:r});l.partsAndWires.length||t.forceBreadboardLayout?(this.addAll(l),l.requiresBreadboard||t.forceBreadboardRender?l.hideBreadboard&&this.breadboard&&this.breadboard.hide():i=!1):i=!1}if(!i){delete this.breadboard,delete this.wireFactory,delete this.partOverGroup,delete this.partGroup,delete this.style,delete this.defs,delete this.fromBBCoord,delete this.fromMBCoord;var p=this.boardView.getView().el;this.view=p,this.partGroup=d.svg.child(this.view,"g"),this.partOverGroup=d.svg.child(this.view,"g"),t.maxWidth&&d.svg.hydrate(this.view,{width:t.maxWidth}),t.maxHeight&&d.svg.hydrate(this.view,{height:t.maxHeight})}this.state.updateSubscribers.push(function(){return n.updateState()})}return e.prototype.highlightBoardPin=function(e){this.boardView.highlightPin(e)},e.prototype.highlightBreadboardPin=function(e){this.breadboard.highlightLoc(e)},e.prototype.highlightWire=function(e){e.wires.forEach(function(e){d.U.addClass(e,"highlight"),e.style.visibility="visible"}),d.U.addClass(e.endG,"highlight")},e.prototype.getView=function(){return this.view},e.prototype.screenshotAsync=function(i){var e=this.view.cloneNode(!0);e.setAttribute("width",this.view.width.baseVal.value+""),e.setAttribute("height",this.view.height.baseVal.value+"");var t=(new XMLSerializer).serializeToString(e),o="data:image/svg+xml,"+encodeURIComponent(t.replace(/\s+/g," ").replace(/"/g,"'"));return new Promise(function(n,e){var r=document.createElement("img");r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height,0<i?(e.width=i,e.height=r.height*i/r.width|0):e.width<200?(e.width*=2,e.height*=2):480<e.width&&(e.width/=2,e.height/=2);var t=e.getContext("2d");t.drawImage(r,0,0,e.width,e.height),n(t.getImageData(0,0,e.width,e.height))},r.onerror=function(e){console.log(e),n(void 0)},r.src=o})},e.prototype.updateState=function(){this.parts.forEach(function(e){return e.updateState()})},e.prototype.getBBCoord=function(e){var t=this.breadboard.getCoord(e);return this.fromBBCoord(t)},e.prototype.getPinCoord=function(e){var t=this.boardView.getCoord(e);if(t)return this.fromMBCoord(t);console.error("Unable to find coord for pin: "+e)},e.prototype.getLocCoord=function(e){var t;if("breadboard"===e.type){var n=e;t=this.getBBCoord(n)}else{var r=e.pin;t=this.getPinCoord(r)}return t||console.debug("Unknown location: "+name),t},e.prototype.getPinStyle=function(e){return"breadboard"==e.type?"female":this.opts.boardDef.pinStyles[e.pin]||"female"},e.prototype.addPart=function(e){var t=this,n=null;if(e.simulationBehavior){var r=e.simulationBehavior,i=this.state.builtinVisuals[r],o=this.state.builtinParts[r];(n=i()).init(this.state.bus,o,this.view,e.params)}else{var a=e.visual;n=new f.GenericPart(a)}this.parts.push(n),this.partGroup.appendChild(n.element),n.overElement&&this.partOverGroup.appendChild(n.overElement),n.defs&&n.defs.forEach(function(e){return t.defs.appendChild(e)}),this.style.textContent+=n.style||"";var s=e.startColumnIdx,c=e.startRowIdx,u={type:"breadboard",row:f.getRowName(c),col:f.getColumnName(s),xOffset:e.bbFit.xOffset/e.visual.pinDistance,yOffset:e.bbFit.yOffset/e.visual.pinDistance},l=this.getBBCoord(u);n.moveToCoord(l);var p="sim-"+e.name+"-cmp";return d.U.addClass(n.element,p),d.U.addClass(n.element,"sim-cmp"),n.updateTheme(),n.updateState(),n},e.prototype.addWire=function(e){return this.wireFactory.addWire(e.start,e.end,e.color)},e.prototype.addAll=function(i){var o=this;i.partsAndWires.forEach(function(e){var t=e.wires,n=t&&t.every(function(e){return o.wireFactory.checkWire(e.start,e.end)});n&&t.forEach(function(e){return i.wires.push(o.addWire(e))});var r=e.part;!r||t&&!n||i.parts.push(o.addPart(r))}),i.requiresBreadboard=!!i.wires.length||!!i.parts.length},e}();f.BoardHost=e}(d.visuals||(d.visuals={}))}(pxsim||(pxsim={})),function(K){!function(P){P.BREADBOARD_MID_ROWS=10,P.BREADBOARD_MID_COLS=30;var U=[4,4],e=P.BREADBOARD_MID_ROWS+U.length,O=[4,9,14,19],t=25+O.length,R=15*(P.BREADBOARD_MID_COLS+3),N=15*(e+4+5.5),D=N*(2/3),L=N*(.5*(1-2/3)),n=15*(P.BREADBOARD_MID_COLS-1),M=(R-n)/2,F=L+(D-15*(e-1))/2,B=15*(t-1),j=(R-B)/2,H=(L-15)/2,z=j,V=H+L+D,r=1.3,i=6,o=2,u=1.3,a="abcdefghij".split("").reverse();function G(e){return""+(e+1)}function W(e){return a[e]}function q(h){for(var m=h.xOffset||0,r=h.yOffset||0,g=[],v=K.svg.elt("g"),b=h.colStartIdx||0,i=h.rowStartIdx||0,o=function(e){return e?e.slice(0,e.length):[]},y=function(e,t){for(var n,r=0;0<=(n=e.indexOf(t));)e.splice(n,1),r+=1;return r},a=0,s=o(h.rowIdxsWithGap),e=function(e){for(var l=0,p=o(h.colIdxsWithGap),f=r+e*h.pinDist+a*h.pinDist,d=e+i,t=function(e){var t=m+e*h.pinDist+l*h.pinDist,n=e+b,r=function(e){return K.svg.hydrate(e.el,"circle"==e.el.tagName?{cx:t,cy:f}:{x:t-.5*e.w,y:f-.5*e.h}),v.appendChild(e.el),e.el},i=r(h.mkPin()),o=r(h.mkHoverPin()),a=h.getRowName(d),s=h.getColName(n),c=h.getGroupName?h.getGroupName(d,n):null,u={el:i,hoverEl:o,cx:t,cy:f,row:a,col:s,group:c};g.push(u),l+=y(p,n)},n=0;n<h.colCount;n++)t(n);a+=y(s,d)},t=0;t<h.rowCount;t++)e(t);return{g:v,allPins:g}}function J(){var e=K.svg.elt("rect"),t=i;return K.svg.hydrate(e,{class:"sim-bb-pin",rx:o,ry:o,width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}}function $(){var e=K.svg.elt("rect"),t=i*r;return K.svg.hydrate(e,{class:"sim-bb-pin-hover",rx:o,ry:o,width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}}function Y(e,t,n,r,i,o,a){var s=P.mkTxt(e,t,n,r,i);K.U.addClass(s,"sim-bb-label"),a&&a.forEach(function(e){return K.U.addClass(s,e)});var c=P.mkTxt(e,t,n*u,r,i);return K.U.addClass(c,"sim-bb-label-hover"),a&&a.forEach(function(e){return K.U.addClass(c,e)}),{el:s,hoverEl:c,txt:i,group:o}}P.getColumnName=G,P.getRowName=W,P.mkGrid=q;var s=function(){function e(e){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),e.wireframe&&K.U.addClass(this.bb,"sim-bb-outline")}return e.prototype.hide=function(){this.bb.style.display="none"},e.prototype.updateLocation=function(e,t){K.svg.hydrate(this.bb,{x:e+"px",y:t+"px"})},e.prototype.getPin=function(e,t){var n=this.rowColToPin[e];if(!n)return null;var r=n[t];return r||null},e.prototype.getCoord=function(e){var t=e.row,n=e.col,r=e.xOffset,i=e.yOffset,o=this.getPin(t,n);if(!o)return null;var a=15*(r||0),s=15*(i||0);return[o.cx+a,o.cy+s]},e.prototype.getPinDist=function(){return 15},e.prototype.buildDom=function(){var s=this;this.bb=K.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+R+" "+N,class:"sim-bb",width:R+"px",height:N+"px"}),this.styleEl=K.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=K.svg.child(this.bb,"defs",{}),K.svg.child(this.bb,"rect",{class:"sim-bb-background",width:R,height:N,rx:4.5,ry:4.5});var i="sim-bb-channel-grad",e=K.svg.elt("linearGradient");K.svg.hydrate(e,{id:i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(e);K.svg.child(e,"stop",{offset:"0%",style:"stop-color: #AAA;"}),K.svg.child(e,"stop",{offset:"20%",style:"stop-color: #CCC;"}),K.svg.child(e,"stop",{offset:"80%",style:"stop-color: #CCC;"}),K.svg.child(e,"stop",{offset:"100%",style:"stop-color: #AAA;"});var t=function(e,t,n){var r=K.svg.child(s.bb,"rect",{class:"sim-bb-channel "+(n||""),y:e-t/2,width:R,height:t});return r.setAttribute("fill","url(#"+i+")"),r};t(L+D/2,15,"sim-bb-mid-channel"),t(L,.75,"sim-bb-sml-channel"),t(L+D,.75,"sim-bb-sml-channel");var n=function(e,t){return""+(e<P.BREADBOARD_MID_ROWS/2?"b":"t")+G(t)},r=function(e){return 0===e?"-":"+"},o=function(e,t){var n=t<25?"b":"t";return""+r(e)+n},a=q({xOffset:M,yOffset:F,rowCount:P.BREADBOARD_MID_ROWS,colCount:P.BREADBOARD_MID_COLS,pinDist:15,mkPin:J,mkHoverPin:$,getRowName:W,getColName:G,getGroupName:n,rowIdxsWithGap:U});a.g;this.allPins=this.allPins.concat(a.allPins);var c=q({xOffset:z,yOffset:V,rowCount:2,colCount:25,pinDist:15,mkPin:J,mkHoverPin:$,getRowName:r,getColName:G,getGroupName:o,colIdxsWithGap:O});c.g;this.allPins=this.allPins.concat(c.allPins);var u=q({xOffset:j,yOffset:H,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:J,mkHoverPin:$,getRowName:r,getColName:G,getGroupName:o,colIdxsWithGap:O.map(function(e){return e+25})});u.g;this.allPins=this.allPins.concat(u.allPins),this.allPins.forEach(function(e){var t=e.el,n=e.row,r=e.col,i=e.hoverEl,o="("+n+","+r+")";K.svg.hydrate(t,{title:o}),K.svg.hydrate(i,{title:o})}),this.allPins.forEach(function(e){var t=s.rowColToPin[e.row];t||(t=s.rowColToPin[e.row]={}),t[e.col]=e});for(var l=function(e,t,n,r,i,o){var a=s.getCoord({type:"breadboard",row:e,col:t});return Y(a[0]+n,a[1]+r,10.5,-90,i,o)},p=0;p<P.BREADBOARD_MID_COLS;p++){var f=G(p),d=l(W(0),f,0,-15,f,n(0,p));this.allLabels.push(d);var h=P.BREADBOARD_MID_ROWS-1,m=l(W(h),f,0,15,f,n(h,p));this.allLabels.push(m)}for(var g=0;g<P.BREADBOARD_MID_ROWS;g++){var v=W(g);d=l(v,G(0),-15,0,v);this.allLabels.push(d);m=l(v,G(P.BREADBOARD_MID_COLS-1),15,0,v);this.allLabels.push(m)}var b=[Y(13.05,L+D+12,30,-90,"-",o(0,0),["sim-bb-blue"]),Y(12,L+D+L-12,25.5,-90,"+",o(1,0),["sim-bb-red"]),Y(R-12+1.05,L+D+12,30,-90,"-",o(0,24),["sim-bb-blue"]),Y(R-12,L+D+L-12,25.5,-90,"+",o(1,24),["sim-bb-red"])];this.allLabels=this.allLabels.concat(b);var y=[Y(13.05,12,30,-90,"-",o(0,25),["sim-bb-blue"]),Y(12,L-12,25.5,-90,"+",o(1,25),["sim-bb-red"]),Y(R-12+1.05,12,30,-90,"-",o(0,49),["sim-bb-blue"]),Y(R-12,L-12,25.5,-90,"+",o(1,49),["sim-bb-red"])];this.allLabels=this.allLabels.concat(y);var w={};this.allLabels.forEach(function(e){e.el;var t=e.txt;(w[t]=w[t]||[]).push(e)});this.allPins.forEach(function(t){var e,n=t.row,r=t.col,i=(t.group,s.rowColToLbls[n]||(s.rowColToLbls[n]={})),o=i[r]||(i[r]=[]);"-"===(e=t).row||"+"===e.row?Number(r)<=25?b.filter(function(e){return e.group==t.group}).forEach(function(e){return o.push(e)}):y.filter(function(e){return e.group==t.group}).forEach(function(e){return o.push(e)}):(w[n].forEach(function(e){return o.push(e)}),w[r].forEach(function(e){return o.push(e)}))});var x=B+22.5,k=(x-B)/2,A=function(e,t,n,r){var i=K.svg.elt("rect");return K.svg.hydrate(i,{class:"sim-bb-bar "+r,x:e,y:t-1.5,width:x,height:3}),{el:i,group:n}},T=[A(z-k,V-9,o(0,49),"sim-bb-blue"),A(z-k,V+15+9,o(1,49),"sim-bb-red"),A(j-k,H-9,o(0,0),"sim-bb-blue"),A(j-k,H+15+9,o(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(T),this.allPowerBars.forEach(function(e){return s.bb.appendChild(e.el)});var C=this.allPins.map(function(e){return e.group}).filter(function(e,t,n){return n.indexOf(e)==t}),E=C.map(function(e){return K.svg.elt("g")});E.forEach(function(e){return K.U.addClass(e,"sim-bb-pin-group")}),E.forEach(function(e,t){return K.U.addClass(e,"group-"+C[t])});var S={};C.forEach(function(e,t){return S[e]=E[t]});var _={};this.allPins.forEach(function(e,t){var n=e.group;(_[n]||(_[n]=[])).push(e)}),C.forEach(function(e){var t=_[e],n=[t.map(function(e){return e.cx}),t.map(function(e){return e.cy})],r=n[0],i=n[1],o=function(e){return e.reduce(function(e,t){return e<t?e:t})},a=function(e){return e.reduce(function(e,t){return t<e?e:t})},s=[o(r),a(r),o(i),a(i)],c=s[0],u=s[1],l=s[2],p=s[3],f=K.svg.elt("rect"),d=Math.max(u-c,1e-4),h=Math.max(p-l,1e-4);K.svg.hydrate(f,{x:c,y:l,width:d,height:h}),K.U.addClass(f,"sim-bb-group-wire"),S[e].appendChild(f)}),this.allPins.forEach(function(e){var t=S[e.group];t.appendChild(e.el),t.appendChild(e.hoverEl)});var I=K.svg.elt("g");K.svg.hydrate(I,{class:"sim-bb-group-misc"}),E.push(I),this.allLabels.forEach(function(e){if(e.group){var t=S[e.group];t.appendChild(e.el),t.appendChild(e.hoverEl)}else I.appendChild(e.el),I.appendChild(e.hoverEl)}),E.forEach(function(e){return s.bb.appendChild(e)})},e.prototype.getSVGAndSize=function(){return{el:this.bb,y:0,x:0,w:R,h:N}},e.prototype.highlightLoc=function(e){var t=e.row,n=e.col,r=this.rowColToPin[t][n];r.cx,r.cy;this.rowColToLbls[t][n].forEach(function(e){K.U.addClass(e.el,"highlight"),K.U.addClass(e.hoverEl,"highlight")})},e}();P.Breadboard=s}(K.visuals||(K.visuals={}))}(pxsim||(pxsim={})),function(w){!function(h){h.BOARD_SYTLE="\n        .noselect {\n            -webkit-touch-callout: none; /* iOS Safari */\n            -webkit-user-select: none;   /* Chrome/Safari/Opera */\n            -khtml-user-select: none;    /* Konqueror */\n            -moz-user-select: none;      /* Firefox */\n            -ms-user-select: none;       /* Internet Explorer/Microsoft Edge */\n            user-select: none;           /* Non-prefixed version, currently\n                                            not supported by any browser */\n        }\n\n        .sim-board-pin {\n            fill:#999;\n            stroke:#000;\n            stroke-width:"+h.PIN_DIST/3+"px;\n        }\n        .sim-board-pin-lbl {\n            fill: #333;\n        }\n        .gray-cover {\n            fill:#FFF;\n            opacity: 0.3;\n            stroke-width:0;\n            visibility: hidden;\n        }\n        .sim-board-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width:"+h.PIN_DIST/6+'px;\n        }\n        .sim-board-pin-hover:hover {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-lbl {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            fill: #555;\n        }\n        .sim-board-pin-lbl-hover {\n            fill: red;\n        }\n        .sim-board-outline .sim-board-pin-lbl-hover {\n            fill: black;\n        }\n        .sim-board-pin-lbl,\n        .sim-board-pin-lbl-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            pointer-events: all;\n            stroke-width: 0;\n        }\n        .sim-board-pin-lbl-hover {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,\n        .sim-board-pin-lbl.highlight {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,\n        .sim-board-pin-lbl-hover.highlight {\n            visibility: visible;\n        }\n        /* Graying out */\n        .grayed .sim-board-pin-lbl:not(.highlight) {\n            fill: #AAA;\n        }\n        .grayed .sim-board-pin:not(.highlight) {\n            fill:#BBB;\n            stroke:#777;\n        }\n        .grayed .gray-cover {\n            visibility: inherit;\n        }\n        .grayed .sim-cmp:not(.notgrayed) {\n            opacity: 0.3;\n        }\n        /* Highlighting */\n        .sim-board-pin-lbl.highlight {\n            fill: #000;\n            font-weight: bold;\n        }\n        .sim-board-pin.highlight {\n            fill:#999;\n            stroke:#000;\n        }\n        ';var m=.7*h.PIN_DIST,g=1.5*m,v=.66666*h.PIN_DIST,b=.66666*h.PIN_DIST+h.PIN_DIST/3,y=0,e=function(){function e(e){var r=this;this.props=e,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=y++;var a=e.visualDef,t=e.wireframe&&a.outlineImage?a.outlineImage:a.image,n=h.mkImageSVG({image:t,width:a.width,height:a.height,imageUnitDist:a.pinDist,targetUnitDist:h.PIN_DIST}),s=h.mkScaleFn(a.pinDist,h.PIN_DIST);this.width=n.w,this.height=n.h;var i=n.el;this.element=w.svg.elt("svg"),w.svg.hydrate(this.element,{version:"1.0",viewBox:"0 0 "+this.width+" "+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),e.wireframe&&w.U.addClass(this.element,"sim-board-outline"),this.style=w.svg.child(this.element,"style",{}),this.style.textContent+=h.BOARD_SYTLE,this.defs=w.svg.child(this.element,"defs",{}),this.g=w.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(i),this.background=i,w.svg.hydrate(i,{class:"sim-board"});var c=function(){var e=w.svg.elt("circle"),t=v;return w.svg.hydrate(e,{class:"sim-board-pin",r:t/2}),{el:e,w:t,h:t,x:0,y:0}},u=function(){var e=w.svg.elt("circle"),t=b;return w.svg.hydrate(e,{class:"sim-board-pin-hover",r:t/2}),{el:e,w:t,h:t,x:0,y:0}},l=function(){var e=w.svg.elt("rect"),t=v;return w.svg.hydrate(e,{class:"sim-board-pin",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}},p=function(){var e=w.svg.elt("rect"),t=b;return w.svg.hydrate(e,{class:"sim-board-pin-hover",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}},o=a.pinBlocks.map(function(t,e){var n=s(t.x)+h.PIN_DIST/2,r=s(t.y)+h.PIN_DIST/2,i=t.labels.length,o=h.mkGrid({xOffset:n,yOffset:r,rowCount:1,colCount:i,pinDist:h.PIN_DIST,mkPin:a.useCrocClips?c:l,mkHoverPin:a.useCrocClips?u:p,getRowName:function(){return""+(e+1)},getColName:function(e){return t.labels[e]},getGroupName:function(){return t.labels.join(" ")}});o.allPins,o.g;return w.U.addClass(o.g,"sim-board-pin-group"),o}),f=[];o.forEach(function(e,n){return e.allPins.forEach(function(e,t){r.allPins.push(e),f.push(a.pinBlocks[n])})}),this.allPins.forEach(function(e){var t=e.col;w.svg.hydrate(e.el,{title:t}),w.svg.hydrate(e.hoverEl,{title:t})}),this.allPins.forEach(function(e){r.pinNmToPin[e.col]=e});var d=function(e,t,n,r,i){var o,a;"below"===i?(a=e,o=t+12+.25*n*r.length):(a=e,o=t-11-.32*n*r.length);return h.mkTxt(a,o,n,-90,r)};this.allLabels=this.allPins.map(function(e,t){var n=f[t];return function(e,t,n,r){var i=d(e,t,m,n,r);w.U.addClass(i,"sim-board-pin-lbl");var o=d(e,t,g,n,r);return w.U.addClass(o,"sim-board-pin-lbl-hover"),{el:i,hoverEl:o,txt:n}}(e.cx,e.cy,e.col,n.labelPosition||"above")}),this.allPins.forEach(function(e,t){var n=r.allLabels[t];r.pinNmToLbl[e.col]=n}),this.allPins.forEach(function(e,t){var n=r.allLabels[t];r.g.appendChild(e.el),r.g.appendChild(e.hoverEl),r.g.appendChild(n.el),r.g.appendChild(n.hoverEl)})}return e.prototype.findPin=function(e){var t=this.pinNmToPin[e];return!t&&this.props.boardDef.gpioPinMap&&(e=this.props.boardDef.gpioPinMap[e])&&(t=this.pinNmToPin[e]),t},e.prototype.findPinLabel=function(e){var t=this.pinNmToLbl[e];return!t&&this.props.boardDef.gpioPinMap&&(e=this.props.boardDef.gpioPinMap[e])&&(t=this.pinNmToLbl[e]),t},e.prototype.getCoord=function(e){var t=this.findPin(e);return t?[t.cx,t.cy]:null},e.prototype.mkGrayCover=function(e,t,n,r){var i=w.svg.elt("rect");return w.svg.hydrate(i,{x:e,y:t,width:n,height:r,class:"gray-cover"}),i},e.prototype.getView=function(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}},e.prototype.getPinDist=function(){return h.PIN_DIST},e.prototype.highlightPin=function(e){var t=this.findPinLabel(e),n=this.findPin(e);t&&n&&(w.U.addClass(t.el,"highlight"),w.U.addClass(t.hoverEl,"highlight"),w.U.addClass(n.el,"highlight"),w.U.addClass(n.hoverEl,"highlight"))},e}();h.GenericBoardSvg=e}(w.visuals||(w.visuals={}))}(pxsim||(pxsim={})),function(r){!function(t){function n(e){return t.mkImageSVG({image:e.image,width:e.width,height:e.height,imageUnitDist:e.pinDistance,targetUnitDist:t.PIN_DIST})}t.mkGenericPartSVG=n;var e=function(){function e(e){this.style="",this.defs=[];var t=n(e).el;this.element=r.svg.elt("g"),this.element.appendChild(t)}return e.prototype.moveToCoord=function(e){t.translateEl(this.element,e)},e.prototype.init=function(e,t,n){},e.prototype.updateState=function(){},e.prototype.updateTheme=function(){},e}();t.GenericPart=e}(r.visuals||(r.visuals={}))}(pxsim||(pxsim={})),function(L){!function(P){var e,s=P.PIN_DIST/2.5,E=15,S=100;function U(e){return e.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function O(e,t,n,r){var i=function(e){return e[0]+", "+e[1]},o=e[0],a=e[1],s=t[0],c=t[1],u=c-a,l=[o,a+u*n],p=[s,c-u*n],f=L.svg.mkPath("sim-bb-wire","M"+i(e)+" C"+i(l)+" "+i(p)+" "+i(t));return L.U.addClass(f,"wire-stroke-"+r),f}function R(e,t,n){var r=function(e){return e[0]+", "+e[1]},i=L.svg.mkPath("sim-bb-wire","M"+r(e)+" L"+r(t));return L.U.addClass(i,"wire-stroke-"+n),i}function N(e,t){var n=P.PIN_DIST/4,r=L.svg.elt("circle"),i=e[0],o=e[1],a=s/2+n/2;return L.svg.hydrate(r,{cx:i,cy:o,r:a,class:"sim-bb-wire-end"}),L.U.addClass(r,"wire-fill-"+t),r.style["stroke-width"]=n+"px",r}function _(e,t,n){var r=.24*P.PIN_DIST,i=10*r,o=2*r,a=6*r,s=r,c=P.PIN_DIST/4,u=e[0],l=e[1],p=t?-1:1,f=L.svg.elt("g"),d=L.svg.elt("rect"),h=i,m=o,g=u-m/2,v=l-h/2;L.svg.hydrate(d,{x:g,y:v,width:m,height:h,rx:.5,ry:.5,class:"sim-bb-wire-end"}),d.style["stroke-width"]=c+"px";var b=L.svg.elt("rect"),y=a,w=s,x=u-w/2,k=l+p*(h/2+y/2)-y/2;return L.svg.hydrate(b,{x:x,y:k,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",f.appendChild(b),f.appendChild(d),{el:f,x:g-c,y:Math.min(v,k),w:m+2*c,h:h+y}}function D(e,t,n){var r=.24*P.PIN_DIST,i=4*r,o=10*r,a=3.5*r,s=3.5*r,c=P.PIN_DIST/4,u=e[0],l=e[1],p=t?-1:1,f=L.svg.elt("g"),d=L.svg.elt("polygon"),h=o,m=i,g=u-m/2,v=l-h/2,b=t?.15:.3,y=t?.7:1-.7,w=t?.3:.15;L.svg.hydrate(d,{points:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.map(function(e){return(t=e)[0]+","+t[1];var t}).join(" ")}([g+m*b,v],[g+m*(1-b),v],[g+m,v+h*y],[g+m*(1-w),v+h],[g+m*w,v+h],[g,v+h*y])}),L.svg.hydrate(d,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),d.style["stroke-width"]=c+"px";var x=L.svg.elt("rect"),k=a,A=s,T=u-A/2,C=l+p*(h/2+k/2)-k/2;return L.svg.hydrate(x,{x:T,y:C,width:A,height:k,class:"sim-bb-wire-bare-end"}),f.appendChild(x),f.appendChild(d),{el:f,x:g-c,y:Math.min(v,C),w:m+2*c,h:h+k}}P.WIRES_CSS="\n        .sim-bb-wire {\n            fill:none;\n            stroke-linecap: round;\n            stroke-width:"+s+"px;\n            pointer-events: none;\n        }\n        .sim-bb-wire-end {\n            stroke:#333;\n            fill:#333;\n        }\n        .sim-bb-wire-bare-end {\n            fill: #ccc;\n        }\n        .sim-bb-wire-hover {\n            stroke-width: "+s+"px;\n            visibility: hidden;\n            stroke-dasharray: "+P.PIN_DIST/10+","+P.PIN_DIST/1.5+";\n            /*stroke-opacity: 0.4;*/\n        }\n        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {\n            stroke: #777;\n            fill: #777;\n        }\n        .grayed .sim-bb-wire:not(.highlight) {\n            stroke: #CCC;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {\n            stroke: red;\n            fill: red;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {\n            stroke: #FFF;\n            fill: #FFF;\n        }\n        ",(e=P.WireEndStyle||(P.WireEndStyle={}))[e.BBJumper=0]="BBJumper",e[e.OpenJumper=1]="OpenJumper",e[e.Croc=2]="Croc",P.mkWirePart=function(e,t,n){void 0===n&&(n=!1);var r,i=L.svg.elt("g"),o=e[0],a=e[1],s=[o-E,a-S/2],c=[o+E,a+S/2];t=P.mapWireColor(t),r=n?D(s,!0,t):_(s,!0,t);var u,l,p,f,d,h,m,g,v,b,y,w,x=(l=c,p=t,f=function(e){return e[0]+", "+e[1]},d=(u=s)[0],h=u[1],m=l[0],g=l[1],b=[d,h+.8*(v=g-h)],y=[m,g-.8*v],(w=L.svg.mkPath("sim-bb-wire","M"+f(u)+" C"+f(b)+" "+f(y)+" "+f(l))).style.stroke=p,{el:w,x:Math.min(d,m),y:Math.min(h,g),w:Math.abs(d-m),h:Math.abs(h-g)}),k=_(c,!1,t);i.appendChild(x.el),i.appendChild(r.el),i.appendChild(k.el);var A=Math.min(r.x,k.x),T=Math.max(r.x+r.w,k.x+k.w),C=Math.min(r.y,k.y);return{el:i,x:A,y:C,w:T-A,h:Math.max(r.y+r.h,k.y+k.h)-C}};var t=function(){function e(e,t,n,r,i,o){this.nextWireId=0,this.styleEl=r,this.styleEl.textContent+=P.WIRES_CSS,this.underboard=e,this.overboard=t,this.boardEdges=n,this.getLocCoord=i,this.getPinStyle=o}return e.prototype.indexOfMin=function(e){for(var t=0,n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r],t=r);return t},e.prototype.closestEdgeIdx=function(t){var e=this.boardEdges.map(function(e){return Math.abs(t[1]-e)});return this.indexOfMin(e)},e.prototype.closestEdge=function(e){return this.boardEdges[this.closestEdgeIdx(e)]},e.prototype.drawWire=function(e,t,n){var i=this,r=[],o=L.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),a=function(e){var t,n=P.PIN_DIST/2,r=i.closestEdge(e);return t=r-e[1]<0?r-n:r+n,[e[0],t]},s=this.nextWireId++,c=U(n),u=N(e,c),l=N(t,c),p=L.svg.child(o,"g",{class:"sim-bb-wire-ends-g"});p.appendChild(u),p.appendChild(l);var f=this.closestEdgeIdx(e),d=this.closestEdgeIdx(t);if(f==d){var h=R(e,t,c);o.appendChild(h),r.push(h)}else{var m=a(e),g=a(t),v=R(e,m,c),b=R(t,g,c),y=void 0,w=void 0;!(1!=f&&2!=f||1!=d&&2!=d)?(y=O(m,g,.7,c),w=O(m,g,.7,c)):(y=R(m,g,c),w=R(m,g,c)),L.U.addClass(w,"sim-bb-wire-hover"),o.appendChild(v),r.push(v),o.appendChild(b),r.push(b),this.underboard.appendChild(y),r.push(y),o.appendChild(w),r.push(w);var x="sim-bb-wire-id-"+s,k=function(e){return L.U.addClass(e,x)};k(p),k(w),this.styleEl.textContent+="\n                    ."+x+":hover ~ ."+x+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}var A="\n                .wire-stroke-"+c+" {\n                    stroke: "+P.mapWireColor(n)+";\n                }\n                .wire-fill-"+c+" {\n                    fill: "+P.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=A,{endG:p,end1:u,end2:l,wires:r}},e.prototype.drawWireWithCrocs=function(e,t,n,r){var i=this;void 0===r&&(r=!1);var o=[],a=L.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),s=this.nextWireId++,c=U(n),u=N(e,c),l=t,p=t[0],f=t[1],d=[p=(t=[p,f+40])[0],(f=t[1])+-17],h=(r?function(e,t,n){var r=.24*P.PIN_DIST,i=4*r,o=1.2*r,a=10*r,s=r,c=P.PIN_DIST/4,u=e[0],l=e[1],p=t?-1:1,f=L.svg.elt("g"),d=L.svg.elt("rect"),h=i,m=o,g=u-m/2,v=l+10-h/2;L.svg.hydrate(d,{x:g,y:v,width:m,height:h,rx:.5,ry:.5,class:"sim-bb-wire-end"}),d.style["stroke-width"]=c+"px";var b=L.svg.elt("rect"),y=a,w=s,x=u-w/2,k=l+10+p*(h/2+y/2)-y/2;return L.svg.hydrate(b,{x:x,y:k,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",f.appendChild(b),f.appendChild(d),{el:f,x:g-c,y:Math.min(v,k),w:m+2*c,h:h+y}}(d,!0):D(d,!0)).el,m=L.svg.child(a,"g",{class:"sim-bb-wire-ends-g"});m.appendChild(u);var g,v,b,y,w=this.closestEdgeIdx(e),x=this.closestEdgeIdx(l);if(w==x){var k=R(e,t,c);a.appendChild(k),o.push(k)}else{var A=(g=e,b=P.PIN_DIST/2,y=i.closestEdge(g),v=y-g[1]<0?y-b:y+b,[g[0],v]),T=R(e,A,c),C=void 0,E=void 0;!(1!=w&&2!=w||1!=x&&2!=x)?(C=O(A,t,.7,c),E=O(A,t,.7,c)):(C=R(A,t,c),E=R(A,t,c)),L.U.addClass(E,"sim-bb-wire-hover"),a.appendChild(T),o.push(T),this.underboard.appendChild(C),o.push(C);var S="sim-bb-wire-id-"+s,_=function(e){return L.U.addClass(e,S)};_(m),_(E),this.styleEl.textContent+="\n                    ."+S+":hover ~ ."+S+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}m.appendChild(h);var I="\n                .wire-stroke-"+c+" {\n                    stroke: "+P.mapWireColor(n)+";\n                }\n                .wire-fill-"+c+" {\n                    fill: "+P.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=I,{endG:m,end1:u,end2:h,wires:o}},e.prototype.checkWire=function(e,t){var n=this.getLocCoord(e),r=this.getLocCoord(t);return!!n&&!!r},e.prototype.addWire=function(e,t,n){var r=this.getLocCoord(e),i=this.getLocCoord(t);if(r&&i){var o=this.getPinStyle(t);return"dalboard"==t.type&&"croc"==o?this.drawWireWithCrocs(r,i,n):this.drawWire(r,i,n)}console.debug("unable to allocate wire for "+e+" or "+t)},e}();P.WireFactory=t}(L.visuals||(L.visuals={}))}(pxsim||(pxsim={}));